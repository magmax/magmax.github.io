<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Python: Cómo hacer pruebas 2: unittest | El blog de MagMax</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Tras el artículo Python: Cómo hacer pruebas (1) es lógico pensar que vendrá la segunda parte.
En esta ocasión nos centraremos en UnitTest.
  Construcción básica Hay muchas ocasiones en las que las pruebas realizadas con doctest se nos quedarán cortas. Por ejemplo, ¿cómo probamos un acceso a base de datos? ¿Y una interacción entre clases? Con este fin está unittest. Hay gente que lo denomina &ldquo;PyUnit&rdquo;, ya que es similar a JUnit.">
    <meta name="generator" content="Hugo 0.79.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    

    
      

    

    
    
    <meta property="og:title" content="Python: Cómo hacer pruebas 2: unittest" />
<meta property="og:description" content="Tras el artículo Python: Cómo hacer pruebas (1) es lógico pensar que vendrá la segunda parte.
En esta ocasión nos centraremos en UnitTest.
  Construcción básica Hay muchas ocasiones en las que las pruebas realizadas con doctest se nos quedarán cortas. Por ejemplo, ¿cómo probamos un acceso a base de datos? ¿Y una interacción entre clases? Con este fin está unittest. Hay gente que lo denomina &ldquo;PyUnit&rdquo;, ya que es similar a JUnit." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/python-pruebas-2/" />
<meta property="article:published_time" content="2011-09-27T00:00:00+00:00" />
<meta property="article:modified_time" content="2011-09-27T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />
<meta itemprop="name" content="Python: Cómo hacer pruebas 2: unittest">
<meta itemprop="description" content="Tras el artículo Python: Cómo hacer pruebas (1) es lógico pensar que vendrá la segunda parte.
En esta ocasión nos centraremos en UnitTest.
  Construcción básica Hay muchas ocasiones en las que las pruebas realizadas con doctest se nos quedarán cortas. Por ejemplo, ¿cómo probamos un acceso a base de datos? ¿Y una interacción entre clases? Con este fin está unittest. Hay gente que lo denomina &ldquo;PyUnit&rdquo;, ya que es similar a JUnit.">
<meta itemprop="datePublished" content="2011-09-27T00:00:00+00:00" />
<meta itemprop="dateModified" content="2011-09-27T00:00:00+00:00" />
<meta itemprop="wordCount" content="696">



<meta itemprop="keywords" content="python testing,unittest," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python: Cómo hacer pruebas 2: unittest"/>
<meta name="twitter:description" content="Tras el artículo Python: Cómo hacer pruebas (1) es lógico pensar que vendrá la segunda parte.
En esta ocasión nos centraremos en UnitTest.
  Construcción básica Hay muchas ocasiones en las que las pruebas realizadas con doctest se nos quedarán cortas. Por ejemplo, ¿cómo probamos un acceso a base de datos? ¿Y una interacción entre clases? Con este fin está unittest. Hay gente que lo denomina &ldquo;PyUnit&rdquo;, ya que es similar a JUnit."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        El blog de MagMax
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="" title="Inicio page">
              Inicio
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="../en" title="English page">
              English
            </a>
          </li>
          
        </ul>
      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://magmax.org/blog/python-pruebas-2/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://magmax.org/blog/python-pruebas-2/&amp;text=Python:%20C%c3%b3mo%20hacer%20pruebas%202:%20unittest" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://magmax.org/blog/python-pruebas-2/&amp;title=Python:%20C%c3%b3mo%20hacer%20pruebas%202:%20unittest" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Python: Cómo hacer pruebas 2: unittest</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2011-09-27T00:00:00Z">September 27, 2011</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Tras el artículo <a href="https://magmax.org/blog/python-pruebas-1/">Python: Cómo hacer pruebas (1)</a> es lógico pensar que vendrá la segunda parte.</p>
<p>En esta ocasión nos centraremos en UnitTest.</p>
<!-- raw HTML omitted -->
<figure>
    <img src="/images/python.png"
         alt="Python"/> 
</figure>

<h2 id="construcción-básica">Construcción básica</h2>
<p>Hay muchas ocasiones en las que las pruebas realizadas con doctest se nos quedarán cortas. Por ejemplo, ¿cómo probamos un acceso a base de datos? ¿Y una interacción entre clases? Con este fin está unittest. Hay gente que lo denomina &ldquo;PyUnit&rdquo;, ya que es similar a JUnit.</p>
<p>Unittest nos ofrece toda la potencia del lenguaje para probar nuestros programas. De esta manera, escribiremos &ldquo;Casos de pruebas&rdquo; que podremos agrupar en &ldquo;Suites de pruebas&rdquo;. Además, nos permitirá agrupar funcionalidad común, de manera que preparemos nuestro entorno (a esto se le conoce como &ldquo;fixture&rdquo;).</p>
<p>Como en el tutorial anterior, vamos a poner un ejemplo y a probarlo. Voy a utilizar la función <code>factorial</code> del otro ejemplo que ya sabemos que funciona:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">import</span> unittest
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">factorial</span>(n):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> n <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">else</span> n <span style="color:#f92672">*</span> factorial(n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">tester</span> (unittest<span style="color:#f92672">.</span>TestCase):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_1</span>(self):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>        self<span style="color:#f92672">.</span>assertEqual(<span style="color:#ae81ff">1</span>, factorial(<span style="color:#ae81ff">1</span>))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    unittest<span style="color:#f92672">.</span>main()
</code></pre></div><p>Como podemos ver, creamos una clase que hereda de <em>unittest.TestCase</em>, ya que es un caso de pruebas. Python facilita la tarea de crear numerosas clases y así aislar los casos de uso que necesitemos, a menudo con una inicialización diferente. A continuación vienen los tests, que deben comenzar por la palabra &ldquo;<em>test</em>&rdquo; o no se ejecutarán.</p>
<p>En el <code>main</code> ejecutamos el programa principal de unittest, lo que permitirá descubrir los tests de la clase en la que estamos. Esto se puede hacer en línea de órdenes mediante (sólo a partir de Python 2.7):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>$ python -m unittest MODULO_A_PROBAR_SIN_EXTENSIÓN
</code></pre></div><h2 id="partes-de-un-test">Partes de un test</h2>
<p>Los tests, por lo general, constan de 3 partes que recomiendo diferenciar:</p>
<ul>
<li><em>Inicialización</em>, que es donde se establecen valores necesarios para nuestros tests. Debe ser pequeña. A menudo ni siquiera es necesaria y se elimina. Por ejemplo, puede ser la construción del SUT (<em>Subject Under Test</em>).</li>
<li><em>Ejecución</em>, que es la línea en la que se llama a la funcionalidad a probar. No debe ocupar más de una línea.</li>
<li><em>Comprobación</em>, que es el test propiamente dicho, expresado en forma de verificaciones.</li>
</ul>
<p>Veamos el test desglosado:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>class tester <span style="color:#f92672">(</span>unittest.TestCase<span style="color:#f92672">)</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>    def test_1<span style="color:#f92672">(</span>self<span style="color:#f92672">)</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>        <span style="color:#75715e"># inicialización (vacío)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>        result <span style="color:#f92672">=</span> factorial<span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>    <span style="color:#75715e"># ejecución</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>        self.assertEqual<span style="color:#f92672">(</span>1, result<span style="color:#f92672">)</span>  <span style="color:#75715e"># comprobación</span>
</code></pre></div><h2 id="funciones-especiales">Funciones especiales</h2>
<p>Hay algunas funciones especiales, que son:</p>
<ul>
<li><em>setUp</em>, que permite inicializar la <em>fixture</em>, es decir, establecer un entorno de pruebas para cada prueba. Se ejecutará siempre antes de cada test.</li>
<li><em>tearDown</em>, que realiza la operación contraria, es decir, se ejecuta siempre después de cada test.</li>
<li><em>setUpClass</em>, que se ejecuta una única vez al comienzo de la clase.</li>
<li><em>tearDownClass</em>, que se lanza cuando se han terminado todos los tests.</li>
</ul>
<h2 id="comprobaciones">Comprobaciones</h2>
<p><a href="https://docs.python.org/library/unittest.html#unittest.TestCase.assertEqual">Hay muchos tipos de comprobaciones a realizar</a> . Se puede comprobar si el resultado es igual, menor, mayor, contiene, etc. el valor esperado o, incluso, si lanza una excepción.</p>
<p>Hay escuelas de pensamiento que opinan que <em>un test debe contener una única verificación</em>. No es un grupo de radicales, sino que tiene su sentido: los tests nos evitan tener que depurar, y si el nombre del test está bien elegido, un fallo en una comprobación nos dirá exactamente dónde está el problema. Si tenemos varias comprobaciones en un test, esta comprobación no será inmediata.</p>
<p>Realmente Python nos facilita esta tarea, ya que si necesitamos una nueva comprobación, podemos desglosarlo en una clase nueva, de manera que en la inicialización de la clase establezcamos la sección de inicialización del test y dejar para las funciones sólo las comprobaciones.</p>
<h2 id="comprobaciones-adicionales">Comprobaciones adicionales</h2>
<p>Si necesitamos realizar comprobaciones más complejas, podemos utilizar módulos dedicados a ello, como <a href="https://code.google.com/p/hamcrest/wiki/TutorialPython">Hamcrest</a>.</p>
<h2 id="ineficiente">Ineficiente</h2>
<p>Alguien puede pensar que es peor utilizar Unittest frente a doctest. En algunos
casos, esta afirmación es totalmente cierta, como en el caso de la función
<em>factorial</em>. Sin embargo, doctest no ofrece la versatilidad que permite
unittest. Esto quedará demostrado en la siguiente entrega de <a href="https://magmax.org/blog/python-pruebas-1/">Python: Cómo
hacer pruebas</a>, donde estudiaremos herramientas que nos faciliten las pruebas,
y seguiremos con otro tutorial más con los dobles o <em>mocks</em>, que facilitarán
aún más la creación de pruebas.</p>
<h2 id="más-información">Más información</h2>
<p>Podemos encontrar más información en la web de <a href="https://docs.python.org/library/unittest.html">unittest</a> .</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/python-testing" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">python testing</a>
   </li>
  
   <li class="list">
     <a href="/tags/unittest" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">unittest</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "magmax" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Relacionado</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/blog/python-pruebas-1/">Python: Cómo hacer pruebas 1: doctest</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/asegura/">No comentes: ¡Asegura!</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://magmax.org/" >
    &copy;  El blog de MagMax 2021 
  </a>
    <div>














</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
