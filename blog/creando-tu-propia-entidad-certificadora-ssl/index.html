<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Creando tu propia Entidad Certificadora SSL (y volcando certificados autofirmados) | El blog de MagMax</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Otro artículo que no es mío original, pero sinceramente, la idea que tengo de certificados es la justa. Este artículo ma ha parecido que va al grano y que cuenta por qué aparece el incómodo mensaje de &ldquo;certificado no confiable&rdquo; y cómo evitarlo.
El artículo original es Creating Your Own SSL Certificate Authority (and Dumping Self Signed Certs), y creo que el autor es Tony Bourke, mirando los comentarios.
Espero que os parezca tan interesante como a mí, aunque el último ejemplo lo he añadido sólo por completitud.">
    <meta name="generator" content="Hugo 0.79.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    

    
      

    

    
    
    <meta property="og:title" content="Creando tu propia Entidad Certificadora SSL (y volcando certificados autofirmados)" />
<meta property="og:description" content="Otro artículo que no es mío original, pero sinceramente, la idea que tengo de certificados es la justa. Este artículo ma ha parecido que va al grano y que cuenta por qué aparece el incómodo mensaje de &ldquo;certificado no confiable&rdquo; y cómo evitarlo.
El artículo original es Creating Your Own SSL Certificate Authority (and Dumping Self Signed Certs), y creo que el autor es Tony Bourke, mirando los comentarios.
Espero que os parezca tan interesante como a mí, aunque el último ejemplo lo he añadido sólo por completitud." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/creando-tu-propia-entidad-certificadora-ssl/" />
<meta property="article:published_time" content="2015-06-27T00:00:00+00:00" />
<meta property="article:modified_time" content="2015-06-27T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />
<meta itemprop="name" content="Creando tu propia Entidad Certificadora SSL (y volcando certificados autofirmados)">
<meta itemprop="description" content="Otro artículo que no es mío original, pero sinceramente, la idea que tengo de certificados es la justa. Este artículo ma ha parecido que va al grano y que cuenta por qué aparece el incómodo mensaje de &ldquo;certificado no confiable&rdquo; y cómo evitarlo.
El artículo original es Creating Your Own SSL Certificate Authority (and Dumping Self Signed Certs), y creo que el autor es Tony Bourke, mirando los comentarios.
Espero que os parezca tan interesante como a mí, aunque el último ejemplo lo he añadido sólo por completitud.">
<meta itemprop="datePublished" content="2015-06-27T00:00:00+00:00" />
<meta itemprop="dateModified" content="2015-06-27T00:00:00+00:00" />
<meta itemprop="wordCount" content="1571">



<meta itemprop="keywords" content="security,ssl," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Creando tu propia Entidad Certificadora SSL (y volcando certificados autofirmados)"/>
<meta name="twitter:description" content="Otro artículo que no es mío original, pero sinceramente, la idea que tengo de certificados es la justa. Este artículo ma ha parecido que va al grano y que cuenta por qué aparece el incómodo mensaje de &ldquo;certificado no confiable&rdquo; y cómo evitarlo.
El artículo original es Creating Your Own SSL Certificate Authority (and Dumping Self Signed Certs), y creo que el autor es Tony Bourke, mirando los comentarios.
Espero que os parezca tan interesante como a mí, aunque el último ejemplo lo he añadido sólo por completitud."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        El blog de MagMax
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="" title="Inicio page">
              Inicio
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="../en" title="English page">
              English
            </a>
          </li>
          
        </ul>
      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://magmax.org/blog/creando-tu-propia-entidad-certificadora-ssl/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://magmax.org/blog/creando-tu-propia-entidad-certificadora-ssl/&amp;text=Creando%20tu%20propia%20Entidad%20Certificadora%20SSL%20%28y%20volcando%20certificados%20autofirmados%29" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://magmax.org/blog/creando-tu-propia-entidad-certificadora-ssl/&amp;title=Creando%20tu%20propia%20Entidad%20Certificadora%20SSL%20%28y%20volcando%20certificados%20autofirmados%29" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Creando tu propia Entidad Certificadora SSL (y volcando certificados autofirmados)</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2015-06-27T00:00:00Z">June 27, 2015</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Otro artículo que no es mío original, pero sinceramente, la idea que tengo de
certificados es la justa. Este artículo ma ha parecido que va al grano y que
cuenta por qué aparece el incómodo mensaje de &ldquo;certificado no confiable&rdquo; y cómo
evitarlo.</p>
<p>El artículo original es <a href="https://datacenteroverlords.com/2012/03/01/creating-your-own-ssl-certificate-authority/">Creating Your Own SSL Certificate Authority (and
Dumping Self Signed Certs)</a>, y creo que el autor es Tony Bourke, mirando los
comentarios.</p>
<p>Espero que os parezca tan interesante como a mí, aunque el último ejemplo lo he
añadido sólo por completitud.</p>
<!-- raw HTML omitted -->
<figure>
    <img src="/images/ssl.jpg"
         alt="SSL"/> 
</figure>

<hr>
<p>SSL (o TSL si se quiere ser totalmente correcto) nos ofrece muchas cosas (a
pesar de los defectos aparecidos recientemente):</p>
<ul>
<li>Privacidad (deja de mirar mi password)</li>
<li>Integridad (los datos no se han modificado al vuelo)</li>
<li>Confianza (eres quien dices ser)</li>
</ul>
<p>Se necesitan las tres cuando se construye algo en Amazon (¡maldito seas, Amazon
Prime!). Pero también se utiliza SSL para las interfaces de usuario web y otras
<abbr title="Graphical User Interface">GUI</abbr>

cuando se administras dispositivos bajo
nuestro control.</p>
<p>Cuando un <em>website</em> obtiene un certificado SSL, típicamente lo compra a una de
las principales entidades certificadoras como DigiCert, Symantec (compraron la
sección de registros de Verisign), o si te gusta el asesino de elefantes y
libertad, GoDaddy. Oscilan entre $12 USD a varios cientos al año, dependiendo de
la compañía y del nivel de confianza.</p>
<p>El beneficio que ofrecen estas entidades certificadoras consiste en una cadena
de confianza. Tu navegador confía en ellas, ellas confían en un <em>website</em>, por
lo que tu navegador confía en el <em>website</em> (se puede revisar su <a href="https://datacenteroverlords.com/2011/09/25/ssl-who-do-you-trust/">artículo sobre
confianza SSL</a>, que contiene el mejor diagrama SSL jamás imaginado).</p>
<figure>
    <img src="/images/ssl-creation/trustchain.png"
         alt="Cadena de confianza"/> 
</figure>

<p>Nuestros dispositivos, por otra parte, aquéllos que configuras y a los que sólo accede tu organización, no necesitan esa cadena de confianza sobre infrastructuras públicas. Lo primero, puede resultar realmente caro comprar un certificado SSL para cada dispositivo que se controla. Y segundo, fuiste tú quien levantó esos dispositivos, por lo que no necesitas ese nivel de confianza.</p>
<p>Por eso las interfaces de usuario web (y otras interfaces basadas en SSL) casi
siempre se protegen con certificados autofirmados. Son <a href="https://www.madboa.com/geek/openssl/#cert-self">realmente sencillos de
crear</a> y gratuítos. También proporcionan toda la seguiridad que implica la
encriptación, aunque no hacen nada sobre la confianza. Por esa razón, cuando te
conectas a un dispositivo con un certificado autofirmado verás algo como esto:</p>
<figure>
    <img src="/images/ssl-creation/securitywarningie.png"
         alt="Alerta de certificado en el Internet Explorer"/> 
</figure>

<p>Por lo que tienes la elección, comprar un costoso certificado SSL de una
<abbr title="Certified Authority">CA</abbr>

(Entidad Certificadora) u obtener esos errores. Bueno, hay una tercera opción, que es crear una entidad certificadora privada y venderlos completamente gratis.</p>
<h2 id="openssl">OpenSSL</h2>
<p>OpenSSL es una herramienta libre que viene en la mayoría de las instalaciones de
MacOS X, Linux, *BSD y Unix. También se puede descargar el <a href="https://www.slproweb.com/products/Win32OpenSSL.html">binario para
instalaciones Windows</a>. Y OpenSSL es todo lo que se necesita para crear una entidad certificadora privada.</p>
<p>El proceso para crear tu propia entidad certificadora es muy simple:</p>
<ol>
<li>Crear una clave privada.</li>
<li>Autofirmarla</li>
<li>Instalar la CA raíz en varias máquinas.</li>
</ol>
<p>Una vez hecho esto, cada dispositivo que se maneje vía HTTPS sólo necesita tener creado su propio certificado con los pasos siguientes:</p>
<ol>
<li>Crear un CSR por dispositivo.</li>
<li>Firmar el CSR con la clave CA raíz.</li>
</ol>
<p>Puedes tener configurada la CA raíz en menos de una hora. Y aquí viene cómo hacerlo.</p>
<h2 id="crear-el-certificado-raíz-se-hace-una-vez">Crear el Certificado Raíz (se hace una vez)</h2>
<p>Crear el certificado raíz es fácil y se hace rápidamente. Con estos sencillos pasos se obtiene un certificado SSL raíz que se instalará en todos los escritorios, y una clave privada que se utilizará para firmar los certificados que se instalan en varios dispositivos.</p>
<h3 id="crear-la-clave-raíz">Crear la clave raíz</h3>
<p>El primer paso es crear la
<abbr title="private root key">clave raíz privada</abbr>

que sólo requiere un paso. En el ejemplo de abajo, estoy creando una clave de
2048 bits:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>openssl genrsa -out rootCA.key <span style="color:#ae81ff">2048</span>
</code></pre></div><p>Los tamaños de clave estándar actuales son 1024, 2048 y, aunque mucho menos extendido, 4096. Yo he elegido 2048, que es el más utilizado hoy en día. 4096 suele ser una exageración (y las claves con longitud 4096 es 5 veces más intensa computacionalmente que 2048), y se está abandonando 1024.</p>
<p>Nota importante: Mantener esta clave privada <strong>muy privada</strong>. Ésta es la base de toda confianza para tus certificados, y si alguien obtiene una copia, podría generar certificados que acepte el navegador. También se puede crear una clave que esté protegida mediante una contraseña añadiendo <code>-des3</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>openssl genrsa -out rootCA.key <span style="color:#ae81ff">2048</span> -des3
</code></pre></div><p>Se pedirá que se introduzca una contraseña, y desde entonces se retará a introducir la contraseña cada vez que se use la clave. Claro, si olvidads la clave tendrás que hacer todo esto de nuevo.</p>
<h3 id="el-siguiente-paso-es-autofirmar-este-certificado">El siguiente paso es autofirmar este certificado</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>openssl req -x509 -new -nodes -key rootCA.key -days <span style="color:#ae81ff">1024</span> -out rootCA.pem
</code></pre></div><p>Lo que comenzará un <em>script</em> interactivo que preguntará varios bits de información. Se rellenarán como vea conveniente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>   You are about to be asked to enter information that will be incorporated
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>   into your certificate request.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>   What you are about to enter is what is called a Distinguished Name or a DN.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>   There are quite a few fields but you can leave some blank
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>   For some fields there will be a default value,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>   If you enter <span style="color:#e6db74">&#39;.&#39;</span>, the field will be left blank.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>   -----
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>   Country Name <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> letter code<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>AU<span style="color:#f92672">]</span>:US
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>   State or Province Name <span style="color:#f92672">(</span>full name<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Some-State<span style="color:#f92672">]</span>:Oregon
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>   Locality Name <span style="color:#f92672">(</span>eg, city<span style="color:#f92672">)</span> <span style="color:#f92672">[]</span>:Portland
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>   Organization Name <span style="color:#f92672">(</span>eg, company<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Internet Widgits Pty Ltd<span style="color:#f92672">]</span>:Overlords
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>   Organizational Unit Name <span style="color:#f92672">(</span>eg, section<span style="color:#f92672">)</span> <span style="color:#f92672">[]</span>:IT
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>   Common Name <span style="color:#f92672">(</span>eg, YOUR name<span style="color:#f92672">)</span> <span style="color:#f92672">[]</span>:Data Center Overlords
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>   Email Address <span style="color:#f92672">[]</span>:none@none.com
</code></pre></div><p>Una vez hecho, se creará un certificado SSL llamado <strong>rootCA.pem</strong>, firmado por sí mismo, válido durante 1024 días, y que funcionará como tu certificado raíz. Lo más interesante de las autoridades certificadoras tradicionales es que ese certificado raíz está también autofirmado. Pero antes de comenzar una entidad certificadora propia, recuerde que el truco es mantener estos certificados en <em>cada navegador del mundo</em>.</p>
<h3 id="instalar-el-certificado-raíz-en-las-máquinas">Instalar el certificado raíz en las máquinas</h3>
<p>Para los portátiles/sobremesas/terminales, se necesitará instalar el certificado raíz en los repositorios de certificados confiables. Lo que puede ser un poco difícil.</p>
<p>Algunos navegadores utilizan el repositorio por defecto del sistema operativo. Por ejemplo, en Windows tanto IE como Chrome usan la gestión por defecto de certificados. Vaya a IE, <strong>Internet Options</strong>, a la pestaña <strong>Contenido/Content</strong>, y pulse el botón <strong>Certificados/Certificates</strong>. En Chrome vaya a <strong>Opciones/Settings</strong>, <strong>Mostrar opciones avanzadas/Show advanced settings</strong> y <strong>Manejar certificados/Manage certificates</strong>. Lo que se pretende es instalar el certificado CA raíz (no la clave) bajo la pestaña <strong>Trusted root Certificate Authorities</strong>.</p>
<figure>
    <img src="/images/ssl-creation/setuprepo2.png"
         alt="Configuración en el IE"/> 
</figure>

<p>Por el contrario, en Windows Firefox tiene su propio repositorio de certificados, por lo que si se utiliza IE o Chrome tanto como Firefox, se tendrá que instalar el certificado raíz tanto en el repositorio de Windows como en el de Firefox.</p>
<p>En Mac, Safari, Firefox y Chrome utilizan el sistema de gestión de certificados del Mac OS X, por lo que sólo se tendrá que instalar una vez. En Linux, creo que se gestiona desde cada navegador.</p>
<h3 id="crear-un-certificado-hacer-una-vez-por-dispositivo">Crear un certificado (hacer una vez por dispositivo)</h3>
<p>Será necesario seguir este proceso para cada dispositivo en el que se desee instalar un certificado confiable. Primero, al igual que con el paso del CA raíz, se necesita una clave privada (diferente de la del CA raíz).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>openssl genrsa -out device.key <span style="color:#ae81ff">2048</span>
</code></pre></div><p>Una vez creada la clave, se generará la solicitud de firmado de certificado:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>openssl req -new -key device.key -out device.csr
</code></pre></div><p>El sistema realizará varias preguntas (País, Región/Provincia, etc.). Responder según corresponda. Sin embargo, la pregunta importante es <strong>common-name</strong>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>Common Name <span style="color:#f92672">(</span>eg, YOUR name<span style="color:#f92672">)</span> <span style="color:#f92672">[]</span>: 10.0.0.1
</code></pre></div><p>Lo que se ve en el campo de la dirección del navegador cuando se accede a tu dispositivo <strong>debe</strong> ser lo que se ponga bajo el <strong>common name</strong>, <em>incluso si es una dirección IP</em>. Sí, incluso una dirección IP (IPv4 o IPv6) funciona como <strong>common name</strong>.</p>
<p>Si no se corresponden, incluso un certificado firmado adecuadamente no se validará adecuadamente, y se obtendrá el error de que &ldquo;No se puede verificar la autenticidad&rdquo;.</p>
<p>Una vez hecho esto, se firmará el CSR, lo que requiere la clave CA raíz:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>openssl x509 -req -in device.csr -CA root.pem -CAkey root.key -CAcreateserial -out device.crt -days <span style="color:#ae81ff">500</span>
</code></pre></div><p>Esto crea un certificado autofirmado llamado <code>device.crt</code> que es válido durante 500 días (se puede ajustar el número de días, claro, pero no tiene sentido que sea mayor que el del certificado raíz).</p>
<p>El paso siguiente consiste en coger la clave y el certificado e instalarlos en el dispositivo. La mayoría de los dispositivos de red que se controlan mediante HTTPS tienen algún mecanismo para instalarlo. Por ejemplo, tengo un LTM VE (virtual edition) F5 como máquina virtual en mi host ESXi 4.</p>
<p>Entro en la
<abbr title="Graphical User Interface, o Interfaz Gráfica de Usuario">GUI</abbr>

web del F5 (y debería ser la última vez que saluda el aviso) y voy
a <strong>System</strong>, <strong>Device Certificates</strong>,  y <strong>Device Certificate</strong>:</p>
<figure>
    <img src="/images/ssl-creation/importcert.png"
         alt="Configuración del F5"/> 
</figure>

<p>En el desplegable selecciono <strong>Certificate and Key</strong>, y bien puedo pegar el contenido de los ficheros con la clave y el certificado o puedo subirlos desde mi máquina:</p>
<figure>
    <img src="/images/ssl-creation/importcertandkeyf5.png"
         alt="Importando el certificado y la clave en el F5"/> 
</figure>

<p>Después, todo lo que necesito hacer es cerrar el navegador y volver a entrar en la web del GUI. Si todo fue bien, no habrá aviso y se obtendrá un precioso verde en la barra de navegación:</p>
<figure>
    <img src="/images/ssl-creation/importedcertkeyf5.png"
         alt="Barra de navegación con el certificado correctamente firmado"/> 
</figure>

<p>Y hablando de VMWare, ¿os suena, quizá, el molesto mensaje que se ve cuando se conecta contra un servidor ESXi?</p>
<p>Se puede eliminar creando una clave y certificado para el servidor ESXi e instalándola en <code>/etc/vmware/ssl/rui.crt</code> y <code>/etc/vmware/ssl/rui.key</code>.</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/security" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">security</a>
   </li>
  
   <li class="list">
     <a href="/tags/ssl" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">ssl</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "magmax" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://magmax.org/" >
    &copy;  El blog de MagMax 2021 
  </a>
    <div>














</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
