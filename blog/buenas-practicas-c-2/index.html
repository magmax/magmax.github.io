<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Buenas prácticas en Ansi C (2) | El blog de MagMax</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Tras comentar las buenas prácticas más básicas en Ansi C, veamos ahora las buenas prácticas cuando estamos haciendo una librería, ya sea estática o dinámica.
En concreto, me centraré en la librería estática y luego pasaré a dar algunas pautas para las dinámicas.
  Encapsulación El objetivo de lo que voy a exponer consiste en aislar en la medida de lo posible nuestra librería con el fin de que sea lo más reutilizable posible.">
    <meta name="generator" content="Hugo 0.79.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    

    
      

    

    
    
    <meta property="og:title" content="Buenas prácticas en Ansi C (2)" />
<meta property="og:description" content="Tras comentar las buenas prácticas más básicas en Ansi C, veamos ahora las buenas prácticas cuando estamos haciendo una librería, ya sea estática o dinámica.
En concreto, me centraré en la librería estática y luego pasaré a dar algunas pautas para las dinámicas.
  Encapsulación El objetivo de lo que voy a exponer consiste en aislar en la medida de lo posible nuestra librería con el fin de que sea lo más reutilizable posible." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/buenas-practicas-c-2/" />
<meta property="article:published_time" content="2011-06-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2011-06-18T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />
<meta itemprop="name" content="Buenas prácticas en Ansi C (2)">
<meta itemprop="description" content="Tras comentar las buenas prácticas más básicas en Ansi C, veamos ahora las buenas prácticas cuando estamos haciendo una librería, ya sea estática o dinámica.
En concreto, me centraré en la librería estática y luego pasaré a dar algunas pautas para las dinámicas.
  Encapsulación El objetivo de lo que voy a exponer consiste en aislar en la medida de lo posible nuestra librería con el fin de que sea lo más reutilizable posible.">
<meta itemprop="datePublished" content="2011-06-18T00:00:00+00:00" />
<meta itemprop="dateModified" content="2011-06-18T00:00:00+00:00" />
<meta itemprop="wordCount" content="1419">



<meta itemprop="keywords" content="ansi c," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Buenas prácticas en Ansi C (2)"/>
<meta name="twitter:description" content="Tras comentar las buenas prácticas más básicas en Ansi C, veamos ahora las buenas prácticas cuando estamos haciendo una librería, ya sea estática o dinámica.
En concreto, me centraré en la librería estática y luego pasaré a dar algunas pautas para las dinámicas.
  Encapsulación El objetivo de lo que voy a exponer consiste en aislar en la medida de lo posible nuestra librería con el fin de que sea lo más reutilizable posible."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        El blog de MagMax
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="" title="Inicio page">
              Inicio
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="../en" title="English page">
              English
            </a>
          </li>
          
        </ul>
      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://magmax.org/blog/buenas-practicas-c-2/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://magmax.org/blog/buenas-practicas-c-2/&amp;text=Buenas%20pr%c3%a1cticas%20en%20Ansi%20C%20%282%29" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://magmax.org/blog/buenas-practicas-c-2/&amp;title=Buenas%20pr%c3%a1cticas%20en%20Ansi%20C%20%282%29" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Buenas prácticas en Ansi C (2)</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2011-06-18T00:00:00Z">June 18, 2011</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Tras comentar las <a href="https://magmax.org/blog/buenas-practicas-c-1/">buenas prácticas más básicas en Ansi C</a>, veamos ahora las buenas prácticas cuando estamos haciendo una librería, ya sea estática o dinámica.</p>
<p>En concreto, me centraré en la librería estática y luego pasaré a dar algunas pautas para las dinámicas.</p>
<!-- raw HTML omitted -->
<figure>
    <img src="/images/ansic.jpg"
         alt="Ansi C"/> 
</figure>

<h2 id="encapsulación">Encapsulación</h2>
<p>El objetivo de lo que voy a exponer consiste en aislar en la medida de lo posible nuestra librería con el fin de que sea lo más reutilizable posible.</p>
<p>Veremos cómo proteger a nuestra librería del mal programador, así como al mal programador de nuestra librería :D</p>
<p>Hay que diferenciar aquí dos tipos de archivos de cabecera: los internos, utilizados por nuestros archivos <code>.c</code>, y los externos, que será la forma que tengan otros programas de utilizar nuestra librería.</p>
<h2 id="macros">Macros</h2>
<p>Quedan completamente prohibidas las macros en los archivos de cabecera externos.</p>
<p>Hay distintas razones para esto: no forman parte como tales de nuestra librería, no son fácilmente mantenibles, y son más difíciles de depurar.</p>
<h2 id="enumerados">Enumerados</h2>
<p>No es buena idea utilizar enumerados en los archivos de cabecera externos. Sinceramente, me gustaría decir lo contrario, pero dependiendo de las opciones de compilación podemos conseguir verdaderos poltergeist por culpa de los enumerados.</p>
<p>Por lo tanto, para las constantes es mejor utilizar <code>#define</code>.</p>
<p>En los internos dará igual, porque para cuando lleguen al usuario de nuestra librería ya están compilados.</p>
<h2 id="sólo-lo-indispensable">Sólo lo indispensable</h2>
<p>En los archivos de cabecera externos se pondrá exclusivamente lo indispensable:</p>
<ul>
<li>Cuanta más funcionalidad exportemos, más tendremos que mantener.</li>
<li>Cuanto más complejo sea, más preguntas recibiremos.</li>
<li>Cuanto más sencillo sea, más feliz el usuario de la libreria.</li>
</ul>
<h2 id="estructuras">Estructuras</h2>
<p>Nunca deis la oportunidad al programador de poder acceder a una estructura de vuestra librería.</p>
<p>Para ello yo suelo utilizar la siguiente técnica: en las cabeceras externas no hay ninguna estructura, pero sí punteros a void; en las funciones que exporto, lo primero que hago es transformar los punteros a void a estructuras internas (que pueden estar en archivos de cabecera internos).</p>
<p>Veamos un ejemplo.</p>
<p>Archivo <code>ejemplo.h</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#75715e">// archivo de cabecera externo &#34;ejemplo.h&#34;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#75715e"></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span style="color:#66d9ef">typedef</span> ejemplo_t <span style="color:#66d9ef">void</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>ejemplo_t<span style="color:#f92672">*</span> <span style="color:#a6e22e">ejemplo_new</span> ();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span style="color:#66d9ef">void</span>       <span style="color:#a6e22e">ejemplo_destroy</span>(ejemplo_t<span style="color:#f92672">*</span> t);
</code></pre></div><p>Archivo <code>ejemplo.c</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;ejemplo.h&#34;</span><span style="color:#75715e">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#75715e"></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  <span style="color:#66d9ef">int</span> a;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> b;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>} ejemplo_tp;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>ejemplo_t<span style="color:#f92672">*</span> <span style="color:#a6e22e">ejemplo_new</span> () {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  ejemplo_tp<span style="color:#f92672">*</span> result;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  result <span style="color:#f92672">=</span> calloc (<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(ejemplo_tp));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  <span style="color:#75715e">// inicializar result
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> result;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ejemplo_destroy</span>(ejemplo_t<span style="color:#f92672">*</span> vejemplo) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>  ejemplo_tp<span style="color:#f92672">*</span> ejemplo <span style="color:#f92672">=</span> (ejemplo_tp<span style="color:#f92672">*</span>) vejemplo;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>  <span style="color:#75715e">// liberar variables internas de &#34;ejemplo&#34;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#75715e"></span>  free (ejemplo);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>}
</code></pre></div><p>Aquí hay algunas convenciones de nombrado que yo suelo utilizar, aunque seguro que podéis encontrar otras mejores.</p>
<p>Lo primero, es decir que el <code>_t</code> de la estructura me hace referencia a &ldquo;tipo&rdquo;, con el fin de diferenciar lo que es un tipo de lo que es una variable. Se me hace muy raro ver cosas como:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>ejemplo data; <span style="color:#75715e">// raro. Además, ¿cómo llamas a la variable?
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#75715e"></span>ejemplo_t ejemplo; <span style="color:#75715e">// se diferencia claramente el tipo de la variable.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span style="color:#75715e"></span>a <span style="color:#f92672">=</span> (ejemplo)(data); <span style="color:#75715e">// ¿Estamos multiplicando variables o haciendo un cast?
</span></code></pre></div><p>Después vemos un <code>_tp</code> que yo utilizo para nombrar mis <em>tipos privados</em>, para diferenciarlos de los que estarán en las cabeceras externas.</p>
<p>Para terminar, en mis métodos suelo llamar a las variables de los tipos públicos con una uve (<code>v</code>) delante, con el fin de avisarme que ése es el <code>void</code>.</p>
<h2 id="getters-y-setters">Getters y setters</h2>
<p>Como no dejamos al usuario acceder a nuestra estructura a mano, no podrá realizar modificaciones sobre las variables. Por lo tanto, será necesario utilizar getters y setters para este fin.</p>
<p>Y una vez dicho eso&hellip; No debería ser lo habitual utilizar estos getters y setters, ya que la librería no debe ser un almacén de datos, sino una unidad de proceso. Es decir: lo normal no debe ser modificar valores desde fuera, sino desde dentro, como resultado de operaciones. Es evidente que, aun así, siempre necesitaremos algún getter y setter, aunque trataremos de evitarlos.</p>
<p>Es bastante común tener que enviar mucha información de configuración. Ésta puede encapsularse en una estructura pública y recibirla en el constructor.</p>
<h2 id="orientación-a-objetostads">Orientación a objetos/TADs</h2>
<p>En C no tenemos Orientación a objetos, pero sí tenemos TADs (Tipos Abstractos de Datos). Toda librería debería ser un TAD.</p>
<p>Por esta razón, será normal encontrar en nuestras librerías un <em>constructor</em> y un <em>destructor</em>. Antes ya puse un ejemplo de esto.</p>
<p>Si dejamos al usuario acceder a nuestras variables, tarde o temprano tendremos un alto acoplamiento.</p>
<h2 id="creciendo">Creciendo</h2>
<p>Si necesitamos ampliar nuestras estructuras públicas, siempre deberían hacerlo por debajo. De esta manera se seguirá manteniendo compatibilidad hacia atrás.</p>
<p>A menudo suele ser buena idea utilizar un número de versión o el tamaño de la estructura en uno de sus propios campos, con el fin de determinar que estamos utilizando ésa versión. El problema de estas aproximaciones es que dependemos del buen uso que le dé el programador.</p>
<p>Una solución mejor es transformar esa estructura pública en un nuevo TAD que ya manejaremos nosotros, evitando cualquier tipo de imprudencia o descuido.</p>
<p>De todas maneras&hellip; ¡¡ya dije que no usárais estructuras públicas!! :P</p>
<h2 id="librerías-dinámicas">Librerías dinámicas</h2>
<p>Es importante que nuestra librería dinámica mantenga en su archivo de cabecera público tipos de datos con forma de puntero a función para facilitar la vida a quien vaya a usarla, ya que no se puede acceder directamente a las funciones, pero siempre habrá que cargarlas.</p>
<p>En el ejemplo anterior:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#75715e">// archivo de cabecera externo &#34;ejemplodll.h&#34;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#75715e"></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span style="color:#66d9ef">typedef</span> ejemplo_t <span style="color:#66d9ef">void</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span style="color:#66d9ef">typedef</span> ejemplo_t<span style="color:#f92672">*</span> (<span style="color:#f92672">*</span> PF_ejemplo_new) ();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">void</span>       (<span style="color:#f92672">*</span> PF_ejemplo_destroy) ();
</code></pre></div><h2 id="fachadas">Fachadas</h2>
<p>La creación de una librería dinámica es una invitación a la duplicación de código. Todos los programas que quieran utilizarla tendrán que cargar la librería, cargar sus funciones en variables/estructuras internas, realizar casts complejos, gestionar errores, etc.</p>
<p>Por lo tanto, es buena idea proporcionar una librería estática cuya función
consista en acceder a la librería dinámica. Es el resultado de aplicar el
<a href="https://en.wikipedia.org/wiki/Facade_pattern">patrón fachada</a> o <em>facade</em>.</p>
<p>Esto facilitará mucho la vida al usuario. Veamos un ejemplo (continuando con el ejemplo de más arriba, que amplío un poco):</p>
<h3 id="dll">DLL</h3>
<p>Archivo <code>ejemplo.h</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#75715e">// archivo de cabecera externo &#34;ejemplo.h&#34;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#75715e"></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span style="color:#66d9ef">typedef</span> ejemplo_t <span style="color:#66d9ef">void</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span style="color:#66d9ef">typedef</span> ejemplo_t<span style="color:#f92672">*</span> (<span style="color:#f92672">*</span> PF_ejemplo_new) ();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">void</span>       (<span style="color:#f92672">*</span> PF_ejemplo_destroy) ();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">void</span>       (<span style="color:#f92672">*</span> PF_ejemplo_operacion1) (ejemplo_t<span style="color:#f92672">*</span> t);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">void</span>       (<span style="color:#f92672">*</span> PF_ejemplo_operacion2) (ejemplo_t<span style="color:#f92672">*</span> t, <span style="color:#66d9ef">int</span> a);
</code></pre></div><p>Archivo <code>ejemplo.c</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;ejemplo.h&#34;</span><span style="color:#75715e">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#75715e"></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  <span style="color:#66d9ef">int</span> a;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> b;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>} ejemplo_tp;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>ejemplo_t<span style="color:#f92672">*</span> <span style="color:#a6e22e">ejemplo_new</span> () {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  ejemplo_tp<span style="color:#f92672">*</span> result;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  result <span style="color:#f92672">=</span> calloc (<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(ejemplo_tp));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  <span style="color:#75715e">// inicializar result
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> result;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ejemplo_destroy</span>(ejemplo_t<span style="color:#f92672">*</span> vejemplo) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>  ejemplo_tp<span style="color:#f92672">*</span> ejemplo <span style="color:#f92672">=</span> (ejemplo_tp<span style="color:#f92672">*</span>) vejemplo;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>  <span style="color:#75715e">// liberar variables internas de &#34;ejemplo&#34;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#75715e"></span>  free (ejemplo);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ejemplo_operacion1</span>(ejemplo_t<span style="color:#f92672">*</span> vejemplo) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>  ejemplo_tp<span style="color:#f92672">*</span> ejemplo <span style="color:#f92672">=</span> (ejemplo_tp<span style="color:#f92672">*</span>) vejemplo;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>  <span style="color:#75715e">// operar
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span style="color:#75715e"></span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ejemplo_operacion2</span>(ejemplo_t<span style="color:#f92672">*</span> vejemplo, <span style="color:#66d9ef">int</span> a) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>  ejemplo_tp<span style="color:#f92672">*</span> ejemplo <span style="color:#f92672">=</span> (ejemplo_tp<span style="color:#f92672">*</span>) vejemplo;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>  <span style="color:#75715e">// operar
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span style="color:#75715e"></span>}
</code></pre></div><h3 id="lib">Lib</h3>
<p>Archivo <code>lejemplo.h</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#75715e">// archivo de cabecera &#34;lejemplo.h&#34;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span>    lejemplo_t <span style="color:#66d9ef">void</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>ejemplo_t<span style="color:#f92672">*</span> <span style="color:#a6e22e">lejemplo_new</span> ();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span style="color:#66d9ef">void</span>       <span style="color:#a6e22e">ljemplo_destroy</span>(lejemplo_t<span style="color:#f92672">*</span> t);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span style="color:#66d9ef">void</span>       <span style="color:#a6e22e">lejemplo_operacion1</span> (lejemplo_t<span style="color:#f92672">*</span> t);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span style="color:#66d9ef">void</span>       <span style="color:#a6e22e">lejemplo_operacion2</span> (lejemplo_t<span style="color:#f92672">*</span> t, <span style="color:#66d9ef">int</span> a);
</code></pre></div><p>Archivo <code>lejemplo.c</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#75715e">// archivo de implementación, &#34;lejemplo.c&#34;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#75715e"></span><span style="color:#75715e">#import &#34;ejemplo.h&#34;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#75715e">#import &#34;lejemplo.h&#34;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#75715e"></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  PF_ejemplo_new new;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  PF_ejemplo_destroy destroy;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  PF_ejemplo_operacion1 operacion1;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  PF_ejemplo_operacion2 operacion2;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>} functions_tp;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  <span style="color:#66d9ef">void</span><span style="color:#f92672">*</span> dllhandle;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>  ejemplo_t<span style="color:#f92672">*</span> internal;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>  functions_tp functions;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>} lejemplo_tp;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>ejemplo_t<span style="color:#f92672">*</span> <span style="color:#a6e22e">lejemplo_new</span> () {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>  ejemplo_tp<span style="color:#f92672">*</span> result <span style="color:#f92672">=</span> calloc (<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(lejemplo_tp));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>  result<span style="color:#f92672">-&gt;</span>dllhandle <span style="color:#f92672">=</span> dlopen (<span style="color:#e6db74">&#34;ejemplo.so&#34;</span>, RT_LAZY);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>  result<span style="color:#f92672">-&gt;</span>functions.new <span style="color:#f92672">=</span> (PF_ejemplo_new) dlsym (result<span style="color:#f92672">-&gt;</span>dllhandle, <span style="color:#e6db74">&#34;ejemplo_new&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>  result<span style="color:#f92672">-&gt;</span>functions.destroy <span style="color:#f92672">=</span> (PF_ejemplo_destroy) dlsym (result<span style="color:#f92672">-&gt;</span>dllhandle, <span style="color:#e6db74">&#34;ejemplo_destroy&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>  result<span style="color:#f92672">-&gt;</span>functions.operacion1 <span style="color:#f92672">=</span> (PF_ejemplo_operacion1) dlsym (result<span style="color:#f92672">-&gt;</span>dllhandle, <span style="color:#e6db74">&#34;ejemplo_operacion1&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>  result<span style="color:#f92672">-&gt;</span>functions.operacion2 <span style="color:#f92672">=</span> (PF_ejemplo_operacion2) dlsym (result<span style="color:#f92672">-&gt;</span>dllhandle, <span style="color:#e6db74">&#34;ejemplo_operacion2&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>  result<span style="color:#f92672">-&gt;</span>internal <span style="color:#f92672">=</span> result<span style="color:#f92672">-&gt;</span>funcitons.new ();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>  <span style="color:#75715e">// añadir control de errores allá donde haga falta
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span style="color:#75715e"></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>  <span style="color:#66d9ef">return</span> result;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">lejemplo_destroy</span>(lejemplo_t<span style="color:#f92672">*</span> vejemplo) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>  lejemplo_tp<span style="color:#f92672">*</span> ejemplo <span style="color:#f92672">=</span> (lejemplo_tp<span style="color:#f92672">*</span>) vejemplo;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>  ejemplo<span style="color:#f92672">-&gt;</span>functions.destroy(ejemplo<span style="color:#f92672">-&gt;</span>internal);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>  dlclose (ejemplo<span style="color:#f92672">-&gt;</span>dllhandle);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>  free (ejemplo);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>  <span style="color:#75715e">// Añadir comprobaciones de nulos y demás.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span style="color:#75715e"></span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">lejemplo_operacion1</span> (lejemplo_t<span style="color:#f92672">*</span> t) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span>  lejemplo_tp<span style="color:#f92672">*</span> ejemplo <span style="color:#f92672">=</span> (lejemplo_tp<span style="color:#f92672">*</span>) vejemplo;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span>  ejemplo<span style="color:#f92672">-&gt;</span>functions.operacion1 (ejemplo<span style="color:#f92672">-&gt;</span>internal);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">lejemplo_operacion2</span> (lejemplo_t<span style="color:#f92672">*</span> t, <span style="color:#66d9ef">int</span> a) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span>  lejemplo_tp<span style="color:#f92672">*</span> ejemplo <span style="color:#f92672">=</span> (lejemplo_tp<span style="color:#f92672">*</span>) vejemplo;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53</span>  ejemplo<span style="color:#f92672">-&gt;</span>functions.operacion2 (ejemplo<span style="color:#f92672">-&gt;</span>internal, a);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54</span>}
</code></pre></div><p>Se podría hacer hasta una carga &ldquo;<em>lazy</em>&rdquo;, esperando a cargar las funciones en el momento de su utilización, pero eso puede implicar una gestión de errores más compleja (con lo indicado, la gestión de errores está centralizada al inicializar).</p>
<p>Utilizando esta librería, al usuario se le quitan muchos dolores de cabeza, ya que tendría que realizar eso mismo de todas maneras.</p>
<h2 id="olvidos-descuidos-etc">Olvidos, descuidos, etc.</h2>
<p>Seguramente he olvidado comentar muchísimas cosas, pero creo que ya me he extendido lo suficiente.</p>
<p>Se aceptan sugerencias para completar todos estos consejos.</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/ansi-c" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">ansi c</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "magmax" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Relacionado</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/blog/buenas-practicas-c-1/">Buenas prácticas en Ansi C (1)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/atheist-c/">Atheist: Probando módulos C</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://magmax.org/" >
    &copy;  El blog de MagMax 2021 
  </a>
    <div>














</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
