<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Python: Cómo hacer pruebas 2: unittest - El blog de MagMax</title><meta name="Description" content="El blog de un Ingeniero Informático: tutoriales, manuales, opiniones, comparativas, ..."><meta property="og:title" content="Python: Cómo hacer pruebas 2: unittest" />
<meta property="og:description" content="Tras el artículo Python: Cómo hacer pruebas (1) es lógico pensar que vendrá la segunda parte.
En esta ocasión nos centraremos en UnitTest.
  Construcción básica Hay muchas ocasiones en las que las pruebas realizadas con doctest se nos quedarán cortas. Por ejemplo, ¿cómo probamos un acceso a base de datos? ¿Y una interacción entre clases? Con este fin está unittest. Hay gente que lo denomina &ldquo;PyUnit&rdquo;, ya que es similar a JUnit." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/python-pruebas-2/" />
<meta property="og:image" content="https://magmax.org/icons/favicon.png"/>
<meta property="article:published_time" content="2011-09-27T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-28T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://magmax.org/icons/favicon.png"/>

<meta name="twitter:title" content="Python: Cómo hacer pruebas 2: unittest"/>
<meta name="twitter:description" content="Tras el artículo Python: Cómo hacer pruebas (1) es lógico pensar que vendrá la segunda parte.
En esta ocasión nos centraremos en UnitTest.
  Construcción básica Hay muchas ocasiones en las que las pruebas realizadas con doctest se nos quedarán cortas. Por ejemplo, ¿cómo probamos un acceso a base de datos? ¿Y una interacción entre clases? Con este fin está unittest. Hay gente que lo denomina &ldquo;PyUnit&rdquo;, ya que es similar a JUnit."/>
<meta name="application-name" content="El blog de MagMax">
<meta name="apple-mobile-web-app-title" content="El blog de MagMax"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://magmax.org/blog/python-pruebas-2/" /><link rel="prev" href="https://magmax.org/blog/xpweek/" /><link rel="next" href="https://magmax.org/blog/python-web/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Python: Cómo hacer pruebas 2: unittest",
        "inLanguage": "es",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/magmax.org\/blog\/python-pruebas-2\/"
        },"genre": "posts","keywords": "python testing, unittest","wordcount":  702 ,
        "url": "https:\/\/magmax.org\/blog\/python-pruebas-2\/","datePublished": "2011-09-27T00:00:00+00:00","dateModified": "2021-01-28T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "Miguel Ángel"},"author": {
                "@type": "Person",
                "name": "Miguel Ángel"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Inicio </a><a class="menu-item" href="/tags"> Tags </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/blog/python-pruebas-2/" selected>Español</option></select>
                    </a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">Inicio</a><a class="menu-item" href="/tags" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/blog/python-pruebas-2/" selected>Español</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contenido</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Python: Cómo hacer pruebas 2: unittest</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Miguel Ángel</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="27 Sep 2011">27 Sep 2011</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;702 palabras&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;4 minutos&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contenido</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#construcción-básica">Construcción básica</a></li>
    <li><a href="#partes-de-un-test">Partes de un test</a></li>
    <li><a href="#funciones-especiales">Funciones especiales</a></li>
    <li><a href="#comprobaciones">Comprobaciones</a></li>
    <li><a href="#comprobaciones-adicionales">Comprobaciones adicionales</a></li>
    <li><a href="#ineficiente">Ineficiente</a></li>
    <li><a href="#más-información">Más información</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Tras el artículo <a href="https://magmax.org/blog/python-pruebas-1/" rel="">Python: Cómo hacer pruebas (1)</a> es lógico pensar que vendrá la segunda parte.</p>
<p>En esta ocasión nos centraremos en UnitTest.</p>
<!-- raw HTML omitted -->
<figure>
    <img src="/images/python.png"
         alt="Python"/> 
</figure>

<h2 id="construcción-básica">Construcción básica</h2>
<p>Hay muchas ocasiones en las que las pruebas realizadas con doctest se nos quedarán cortas. Por ejemplo, ¿cómo probamos un acceso a base de datos? ¿Y una interacción entre clases? Con este fin está unittest. Hay gente que lo denomina &ldquo;PyUnit&rdquo;, ya que es similar a JUnit.</p>
<p>Unittest nos ofrece toda la potencia del lenguaje para probar nuestros programas. De esta manera, escribiremos &ldquo;Casos de pruebas&rdquo; que podremos agrupar en &ldquo;Suites de pruebas&rdquo;. Además, nos permitirá agrupar funcionalidad común, de manera que preparemos nuestro entorno (a esto se le conoce como &ldquo;fixture&rdquo;).</p>
<p>Como en el tutorial anterior, vamos a poner un ejemplo y a probarlo. Voy a utilizar la función <code>factorial</code> del otro ejemplo que ya sabemos que funciona:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">tester</span> <span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">factorial</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>Como podemos ver, creamos una clase que hereda de <em>unittest.TestCase</em>, ya que es un caso de pruebas. Python facilita la tarea de crear numerosas clases y así aislar los casos de uso que necesitemos, a menudo con una inicialización diferente. A continuación vienen los tests, que deben comenzar por la palabra &ldquo;<em>test</em>&rdquo; o no se ejecutarán.</p>
<p>En el <code>main</code> ejecutamos el programa principal de unittest, lo que permitirá descubrir los tests de la clase en la que estamos. Esto se puede hacer en línea de órdenes mediante (sólo a partir de Python 2.7):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ python -m unittest MODULO_A_PROBAR_SIN_EXTENSIÓN
</code></pre></td></tr></table>
</div>
</div><h2 id="partes-de-un-test">Partes de un test</h2>
<p>Los tests, por lo general, constan de 3 partes que recomiendo diferenciar:</p>
<ul>
<li><em>Inicialización</em>, que es donde se establecen valores necesarios para nuestros tests. Debe ser pequeña. A menudo ni siquiera es necesaria y se elimina. Por ejemplo, puede ser la construción del SUT (<em>Subject Under Test</em>).</li>
<li><em>Ejecución</em>, que es la línea en la que se llama a la funcionalidad a probar. No debe ocupar más de una línea.</li>
<li><em>Comprobación</em>, que es el test propiamente dicho, expresado en forma de verificaciones.</li>
</ul>
<p>Veamos el test desglosado:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">class tester <span class="o">(</span>unittest.TestCase<span class="o">)</span>:
    def test_1<span class="o">(</span>self<span class="o">)</span>:
        <span class="c1"># inicialización (vacío)</span>
        <span class="nv">result</span> <span class="o">=</span> factorial<span class="o">(</span>1<span class="o">)</span>    <span class="c1"># ejecución</span>
        self.assertEqual<span class="o">(</span>1, result<span class="o">)</span>  <span class="c1"># comprobación</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="funciones-especiales">Funciones especiales</h2>
<p>Hay algunas funciones especiales, que son:</p>
<ul>
<li><em>setUp</em>, que permite inicializar la <em>fixture</em>, es decir, establecer un entorno de pruebas para cada prueba. Se ejecutará siempre antes de cada test.</li>
<li><em>tearDown</em>, que realiza la operación contraria, es decir, se ejecuta siempre después de cada test.</li>
<li><em>setUpClass</em>, que se ejecuta una única vez al comienzo de la clase.</li>
<li><em>tearDownClass</em>, que se lanza cuando se han terminado todos los tests.</li>
</ul>
<h2 id="comprobaciones">Comprobaciones</h2>
<p><a href="https://docs.python.org/library/unittest.html#unittest.TestCase.assertEqual" target="_blank" rel="noopener noreffer">Hay muchos tipos de comprobaciones a realizar</a> . Se puede comprobar si el resultado es igual, menor, mayor, contiene, etc. el valor esperado o, incluso, si lanza una excepción.</p>
<p>Hay escuelas de pensamiento que opinan que <em>un test debe contener una única verificación</em>. No es un grupo de radicales, sino que tiene su sentido: los tests nos evitan tener que depurar, y si el nombre del test está bien elegido, un fallo en una comprobación nos dirá exactamente dónde está el problema. Si tenemos varias comprobaciones en un test, esta comprobación no será inmediata.</p>
<p>Realmente Python nos facilita esta tarea, ya que si necesitamos una nueva comprobación, podemos desglosarlo en una clase nueva, de manera que en la inicialización de la clase establezcamos la sección de inicialización del test y dejar para las funciones sólo las comprobaciones.</p>
<h2 id="comprobaciones-adicionales">Comprobaciones adicionales</h2>
<p>Si necesitamos realizar comprobaciones más complejas, podemos utilizar módulos dedicados a ello, como <a href="https://code.google.com/p/hamcrest/wiki/TutorialPython" target="_blank" rel="noopener noreffer">Hamcrest</a>.</p>
<h2 id="ineficiente">Ineficiente</h2>
<p>Alguien puede pensar que es peor utilizar Unittest frente a doctest. En algunos
casos, esta afirmación es totalmente cierta, como en el caso de la función
<em>factorial</em>. Sin embargo, doctest no ofrece la versatilidad que permite
unittest. Esto quedará demostrado en la siguiente entrega de <a href="https://magmax.org/blog/python-pruebas-1/" rel="">Python: Cómo
hacer pruebas</a>, donde estudiaremos herramientas que nos faciliten las pruebas,
y seguiremos con otro tutorial más con los dobles o <em>mocks</em>, que facilitarán
aún más la creación de pruebas.</p>
<h2 id="más-información">Más información</h2>
<p>Podemos encontrar más información en la web de <a href="https://docs.python.org/library/unittest.html" target="_blank" rel="noopener noreffer">unittest</a> .</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Actualizado el 28 Jan 2021</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartir en Twitter" data-sharer="twitter" data-url="https://magmax.org/blog/python-pruebas-2/" data-title="Python: Cómo hacer pruebas 2: unittest" data-hashtags="python testing,unittest"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Facebook" data-sharer="facebook" data-url="https://magmax.org/blog/python-pruebas-2/" data-hashtag="python testing"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Linkedin" data-sharer="linkedin" data-url="https://magmax.org/blog/python-pruebas-2/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en WhatsApp" data-sharer="whatsapp" data-url="https://magmax.org/blog/python-pruebas-2/" data-title="Python: Cómo hacer pruebas 2: unittest" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Tumblr" data-sharer="tumblr" data-url="https://magmax.org/blog/python-pruebas-2/" data-title="Python: Cómo hacer pruebas 2: unittest" data-tags="python testing,unittest"><i class="fab fa-tumblr fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Reddit" data-sharer="reddit" data-url="https://magmax.org/blog/python-pruebas-2/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Instapaper" data-sharer="instapaper" data-url="https://magmax.org/blog/python-pruebas-2/" data-title="Python: Cómo hacer pruebas 2: unittest" data-description=""><i data-svg-src="/lib/simple-icons/icons/instapaper.min.svg"></i></a><a href="javascript:void(0);" title="Compartir en Digg" data-sharer="digg" data-url="https://magmax.org/blog/python-pruebas-2/"><i class="fab fa-digg fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Blogger" data-sharer="blogger" data-url="https://magmax.org/blog/python-pruebas-2/" data-title="Python: Cómo hacer pruebas 2: unittest" data-description=""><i class="fab fa-blogger fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/python-testing/">python testing</a>,&nbsp;<a href="/tags/unittest/">unittest</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Regresar</a></span>&nbsp;|&nbsp;<span><a href="/">Inicio</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/xpweek/" class="prev" rel="prev" title="Lecciones aprendidas en la XPWeek"><i class="fas fa-angle-left fa-fw"></i>Lecciones aprendidas en la XPWeek</a>
            <a href="/blog/python-web/" class="next" rel="next" title="Python en la web">Python en la web<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Provisto por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.79.1">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Miguel Ángel</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Volver arriba">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentarios">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copiar al portapapeles","maxShownLines":10},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
