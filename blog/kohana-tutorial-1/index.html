<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Kohana: Tutorial 1 | El blog de MagMax</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Con este artículo comienzo una serie de tutoriales de Kohana.
Kohana es un Framework PHP, es decir: un entorno de trabajo &ldquo;prefabricado&rdquo; que ya nos soluciona algunos de los problemas más típicos de la programación.
Como me gusta avanzar programando, programaremos desde la primera línea. Para ello vamos a tener como objetivo la creación de un &ldquo;ToDoList Manager&rdquo;, es decir: vamos a crear una web que nos permita gestionar tareas.">
    <meta name="generator" content="Hugo 0.79.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    

    
      

    

    
    
    <meta property="og:title" content="Kohana: Tutorial 1" />
<meta property="og:description" content="Con este artículo comienzo una serie de tutoriales de Kohana.
Kohana es un Framework PHP, es decir: un entorno de trabajo &ldquo;prefabricado&rdquo; que ya nos soluciona algunos de los problemas más típicos de la programación.
Como me gusta avanzar programando, programaremos desde la primera línea. Para ello vamos a tener como objetivo la creación de un &ldquo;ToDoList Manager&rdquo;, es decir: vamos a crear una web que nos permita gestionar tareas." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/kohana-tutorial-1/" />
<meta property="article:published_time" content="2010-12-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2010-12-09T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />
<meta itemprop="name" content="Kohana: Tutorial 1">
<meta itemprop="description" content="Con este artículo comienzo una serie de tutoriales de Kohana.
Kohana es un Framework PHP, es decir: un entorno de trabajo &ldquo;prefabricado&rdquo; que ya nos soluciona algunos de los problemas más típicos de la programación.
Como me gusta avanzar programando, programaremos desde la primera línea. Para ello vamos a tener como objetivo la creación de un &ldquo;ToDoList Manager&rdquo;, es decir: vamos a crear una web que nos permita gestionar tareas.">
<meta itemprop="datePublished" content="2010-12-09T00:00:00+00:00" />
<meta itemprop="dateModified" content="2010-12-09T00:00:00+00:00" />
<meta itemprop="wordCount" content="1702">



<meta itemprop="keywords" content="kohana," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Kohana: Tutorial 1"/>
<meta name="twitter:description" content="Con este artículo comienzo una serie de tutoriales de Kohana.
Kohana es un Framework PHP, es decir: un entorno de trabajo &ldquo;prefabricado&rdquo; que ya nos soluciona algunos de los problemas más típicos de la programación.
Como me gusta avanzar programando, programaremos desde la primera línea. Para ello vamos a tener como objetivo la creación de un &ldquo;ToDoList Manager&rdquo;, es decir: vamos a crear una web que nos permita gestionar tareas."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        El blog de MagMax
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="" title="Inicio page">
              Inicio
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="../en" title="English page">
              English
            </a>
          </li>
          
        </ul>
      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://magmax.org/blog/kohana-tutorial-1/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://magmax.org/blog/kohana-tutorial-1/&amp;text=Kohana:%20Tutorial%201" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://magmax.org/blog/kohana-tutorial-1/&amp;title=Kohana:%20Tutorial%201" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Kohana: Tutorial 1</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2010-12-09T00:00:00Z">December 9, 2010</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Con este artículo comienzo una serie de tutoriales de Kohana.</p>
<p>Kohana es un Framework PHP, es decir: un entorno de trabajo &ldquo;prefabricado&rdquo; que ya nos soluciona algunos de los problemas más típicos de la programación.</p>
<p>Como me gusta avanzar programando, programaremos desde la primera línea. Para ello vamos a tener como objetivo la creación de un &ldquo;ToDoList Manager&rdquo;, es decir: vamos a crear una web que nos permita gestionar tareas.</p>
<p>En el ejemplo se accederá a base de datos. Debo decir que me ha costado mucho encontrar ejemplos válidos que accedan a base de datos.</p>
<!-- raw HTML omitted -->
<figure>
    <img src="/images/php.png"
         alt="PHP"/> 
</figure>

<h2 id="prerrequisitos">Prerrequisitos</h2>
<p>Voy a utilizar Kohana versión 3.0.8. Seguramente sea compatible con las siguientes.</p>
<h2 id="un-poquito-de-teoría">Un poquito de teoría</h2>
<p>Kohana sigue un patrón Modelo-Vista-Controlador (MVC). Hay mucho escrito sobre este patrón, por lo que no me extenderé demasiado:</p>
<ul>
<li>Modelo: Los datos tal cual se guardan.</li>
<li>Vista: La representación en la pantalla.</li>
<li>Controlador: La lógica de negocio.</li>
</ul>
<h2 id="configuración">Configuración</h2>
<p>Vamos a configurar Kohana. Hemos desplegado el framework y vamos al fichero <code>application/bootstrap.php</code>, en el que vamos a habilitar algunas cosas. No podéis copiar a ciegas; aquí sólo os doy un ejemplo de lo que tengo yo puesto. Tened también en cuenta que no lo pego entero, ya que nos valen la mayor parte de los valores por defecto:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#a6e22e">Kohana</span><span style="color:#f92672">::</span><span style="color:#a6e22e">init</span>(<span style="color:#66d9ef">array</span>(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  <span style="color:#e6db74">&#39;base_url&#39;</span>   <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;/~miguel/kohana&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  <span style="color:#e6db74">&#39;index_file&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;index.php&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#a6e22e">Kohana</span><span style="color:#f92672">::</span><span style="color:#a6e22e">modules</span>(<span style="color:#66d9ef">array</span>(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  <span style="color:#e6db74">&#39;database&#39;</span>   <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">MODPATH</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;database&#39;</span>,   <span style="color:#75715e">// Database access
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#75715e"></span>  <span style="color:#e6db74">&#39;orm&#39;</span>        <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">MODPATH</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;orm&#39;</span>,        <span style="color:#75715e">// Object Relationship Mapping
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#75715e"></span>  ));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Como es sencillo, voy rápido: Le decimos a Kohana dónde está nuestra aplicación
y cuál es el archivo que va a renderizar las cosas. Como véis, yo lo tengo en
<code>/~miguel/kohana</code>. Después habilitamos algunos módulos, que servirán para acceder a base de datos.</p>
<p>Si sois tan pijos como yo y os gustan las URL&rsquo;s limpias, mejor si indicáis el &ldquo;index_file&rdquo; de la manera que se indica arriba y después creáis un <code>.htaccess</code> como el siguiente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-apacheconf" data-lang="apacheconf"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#75715e"># Turn on URL rewriting</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>RewriteEngine <span style="color:#66d9ef">On</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#75715e"># Installation directory</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>RewriteBase /~miguel/kohana/
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#75715e"># Protect hidden files from being viewed</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  Order Deny,Allow
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  Deny From <span style="color:#66d9ef">All</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span style="color:#75715e"># Protect application and system files from being viewed</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>RewriteRule ^(?:application|modules|system)\\b.* index.php/$0 [L]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#75715e"># Allow any files or directories that exist to be displayed directly</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>RewriteCond %{REQUEST_FILENAME} !-f
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>RewriteCond %{REQUEST_FILENAME} !-d
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#75715e"># Rewrite all other URLs to index.php/URL</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>RewriteRule .* index.php/$0 [PT]
</code></pre></div><p>Finalmente, configuramos la base de datos en el archivo <code>modules/database/config/database.php</code>. Ya tenéis un patrón y es autoexplicativo. Centraros en &lsquo;default&rsquo; y olvidaros de &lsquo;alternate&rsquo; (o borradlo si queréis).</p>
<h2 id="el-modelo">El modelo</h2>
<p>El modelo es lo que existe en la base de datos, básicamente. Así que comenzamos por crear una base de datos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>tasks<span style="color:#f92672">`</span> (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>  <span style="color:#e6db74">&#39;id&#39;</span> int(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>  <span style="color:#e6db74">&#39;title&#39;</span> varchar(<span style="color:#ae81ff">60</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>  <span style="color:#e6db74">&#39;description&#39;</span> longtext <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>  <span style="color:#e6db74">&#39;created&#39;</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span>  <span style="color:#e6db74">&#39;duedate&#39;</span> datetime <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span>  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#e6db74">&#39;id&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span>  <span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#e6db74">&#39;title&#39;</span> (<span style="color:#e6db74">&#39;title&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span>) ENGINE<span style="color:#f92672">=</span>MyISAM AUTO_INCREMENT<span style="color:#f92672">=</span><span style="color:#ae81ff">17</span> <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8;
</code></pre></div><p>Ahora tenemos que decirle a Kohana que use esta tabla. Para ello basta crear el archivo <code>application/classes/model/task.php</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#a6e22e">defined</span>(<span style="color:#e6db74">&#34;SYSPATH&#34;</span>) <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;No Direct Script Access&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Model_Task</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ORM</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Bien. Paremos. ¿Para qué queremos un archivo vacío?</p>
<p>Realmente no está vacío. Para empezar, estamos restringiendo el acceso. Todos nuestros archivos PHP salvo las vistas deberían comenzar así, por seguridad. Además, estamos heredando de ORM, y esta clase padre ya nos dará todo lo que necesitamos: accederá a la base de datos y verá qué campos necesitamos aquí.</p>
<p>Personalmente, tanto automatismo no me gusta demasiado y prefiero indicarle qué tabla es la que quiero emplear:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#a6e22e">defined</span>(<span style="color:#e6db74">&#34;SYSPATH&#34;</span>) <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;No Direct Script Access&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Model_Task</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ORM</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>  <span style="color:#66d9ef">public</span> $_table_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tasks&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Y hemos terminado el modelo. Fácil, ¿no?</p>
<h2 id="el-controlador">El Controlador</h2>
<p>Creamos el archivo <code>application/classes/controller/task.php</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#a6e22e">defined</span>(<span style="color:#e6db74">&#39;SYSPATH&#39;</span>) <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#39;No Direct Script Access&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Controller_Task</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Controller</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __construct(<span style="color:#a6e22e">Kohana_Request</span> $request)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    <span style="color:#66d9ef">parent</span><span style="color:#f92672">::</span><span style="color:#a6e22e">__construct</span>($request);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">action_index</span> ()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>    $vista <span style="color:#f92672">=</span> <span style="color:#a6e22e">View</span><span style="color:#f92672">::</span><span style="color:#a6e22e">factory</span>(<span style="color:#e6db74">&#39;task_index&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    $vista<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">set</span> (<span style="color:#e6db74">&#39;task_list&#39;</span>, $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">get_tasklist</span>());
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">request</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> $vista;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">action_add</span> ()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>    $vista <span style="color:#f92672">=</span> <span style="color:#a6e22e">View</span><span style="color:#f92672">::</span><span style="color:#a6e22e">factory</span>(<span style="color:#e6db74">&#39;task_add&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">request</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> $vista;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>    <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span> <span style="color:#a6e22e">isset</span>($_POST) <span style="color:#66d9ef">OR</span> <span style="color:#f92672">!</span> <span style="color:#a6e22e">array_key_exists</span>(<span style="color:#e6db74">&#39;title&#39;</span>, $_POST))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>      <span style="color:#66d9ef">return</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>    <span style="color:#66d9ef">if</span> ( $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">create_task</span> () )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>      $vista<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">set</span> (<span style="color:#e6db74">&#39;message&#39;</span>, <span style="color:#e6db74">&#39;Task added&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>    <span style="color:#66d9ef">else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>      $vista<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">set</span> (<span style="color:#e6db74">&#39;message&#39;</span>, <span style="color:#e6db74">&#39;Error al añadir&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">create_task</span> ()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>    $newtask <span style="color:#f92672">=</span> <span style="color:#a6e22e">ORM</span><span style="color:#f92672">::</span><span style="color:#a6e22e">factory</span>(<span style="color:#e6db74">&#39;task&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>    $newtask<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">title</span> <span style="color:#f92672">=</span> $_POST[<span style="color:#e6db74">&#39;title&#39;</span>];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>    $newtask<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">description</span> <span style="color:#f92672">=</span> $_POST[<span style="color:#e6db74">&#39;description&#39;</span>];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>    $newtask<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">created</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">strftime</span>(<span style="color:#e6db74">&#39;%Y-%m-%d %H.%M.%S&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>    $newtask<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">duedate</span> <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getAsDate</span>($_POST[<span style="color:#e6db74">&#39;duedate&#39;</span>]);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>    $newtask<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">save</span>();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>    <span style="color:#66d9ef">return</span> $newtask<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">saved</span>();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getAsDate</span> ($value)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span>    $result <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span> ($value)) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span>      $result <span style="color:#f92672">=</span> $value<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; 00.00.00&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span>    <span style="color:#a6e22e">print_r</span>($result);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span>    <span style="color:#66d9ef">return</span> $result;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53</span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">get_tasklist</span> ()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55</span>    $tasks <span style="color:#f92672">=</span> <span style="color:#a6e22e">ORM</span><span style="color:#f92672">::</span><span style="color:#a6e22e">factory</span>(<span style="color:#e6db74">&#39;task&#39;</span>)<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">find_all</span>();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57</span>    $result <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59</span>    <span style="color:#66d9ef">foreach</span> ($tasks <span style="color:#66d9ef">as</span> $task)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60</span>      $result[] <span style="color:#f92672">=</span> $task;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62</span>    <span style="color:#66d9ef">return</span> $result;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66</span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Analicemos un poco este código.</p>
<p>Lo primero de todo es la seguridad, por lo que evitamos el acceso directo.</p>
<p>A continuación se crea una clase <code>Controller_Task</code> que hereda de <code>Controller</code>. El nombre de la clase está sujeto a una &ldquo;convención de nombres&rdquo;:https://kohanaframework.org/guide/about.conventions, y heredamos de Controller porque somos un controlador :D</p>
<p>El constructor no tiene mucho misterio: tenemos que implementarlo y llamamos al constructor padre. No tenemos nada más que inicializar, por lo que podemos terminar.</p>
<p>La función <code>action_index</code> es, como el nombre indica, una acción. Será la
acción por defecto que se ejecute cuando alguien realice una solicitud sobre el
controlador. Si simplificamos su código hasta un simple <code>echo 'hola';</code>,
podremos comprobar que todo funciona accediendo a la misma dirección que pusimos
en la configuración, en &lsquo;base_url&rsquo;, seguido del nombre básico del controlador,
es decir, &lsquo;task&rsquo;. En mi caso, la dirección es
<code>https://localhost:/~miguel/kohana/task</code>. Si no habéis activado las URLs
limpias, tendréis que indicar quién debe renderizar esa página, accediendo a
algo como <code>https://localhost:/~miguel/kohana/index.php/task</code>.</p>
<p>Como vemos, la acción <code>action_index</code> crea una vista a partir de una plantilla y la devuelve como respuesta. Veremos más sobre estas vistas en el apartado siguiente.</p>
<p>La acción <code>action_add</code> va a tratar de crear una tarea nueva. Además, voy a reutilizar esta función. Si viene sin datos, sólo mostrará la ventana. Si viene con datos, creará una nueva tarea. Por ello, lo primero que hago es crear la vista que voy a devolver, ya que es común a ambos casos de uso, y después trato de insertarla, guardándome un mensaje en cada caso.</p>
<p>La función <code>create_task</code> es quien realmente crea la tarea. Para ello hace uso del ORM, obteniendo los valores de la variable <code>$_POST</code>. Las fechas tengo que modificarlas a mano para que tengan el formato esperado por mysql (&ldquo;YYYY-MM-DD hh.mm.ss&rdquo;).</p>
<p>La función <code>get_tasklist</code> serializa la lista de tareas para pasársela a la vista.</p>
<h2 id="cosas-importantes">Cosas importantes</h2>
<p>Aquí hay dos cosas importantes: el uso de la base de datos y el paso de parámetros con la vista.</p>
<p>Para usar la base de datos, estamos usando el ORM. Éste está &ldquo;bastante bien documentado&rdquo;:https://kohanaframework.org/guide/api/ORM.</p>
<p>Para obtener datos de la vista, los obtenemos de la variable <code>$_POST</code>, ya que éste ha sido el método que he decido utilizar para el envío de datos (y suele ser el más recomendable). Los nombres de los campos son los que he puesto en la vista y que veremos más adelante.</p>
<p>Para enviar datos a la vista, lo que hago es establecerlos al objeto &ldquo;View&rdquo; con la función &ldquo;set&rdquo;. Esto funcionará como una tabla Hash cuando esté en la vista.</p>
<h2 id="las-vistas">Las vistas</h2>
<p>Antes de entrar en materia, como no me gusta repetirme, crearemos un par de archivos. Todas las vistas deben ir en <code>application/views</code>.</p>
<p>Los dos archivos a crear no tienen mayor misterio y no entraré a describirlos:</p>
<h3 id="headerphp">header.php</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#75715e">&lt;!DOCTYPE html PUBLIC &#34;-//W3C//DTD XHTML 1.0 Strict//EN&#34; &#34;https://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&#34;&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">xmlns</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://www.w3.org/1999/xhtml&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>&lt;<span style="color:#f92672">head</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  &lt;<span style="color:#f92672">title</span>&gt;Vista para Kohana PHP
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">http-equiv</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Content-Type&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/html; charset=UTF-8&#34;</span> /&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css&#34;</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span>/&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    Date.<span style="color:#a6e22e">firstDayOfWeek</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>    Date.<span style="color:#a6e22e">format</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;yyyy/mm/dd&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>      <span style="color:#a6e22e">$</span>(document).<span style="color:#a6e22e">ready</span>(<span style="color:#66d9ef">function</span>() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>        <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;.date&#34;</span>).<span style="color:#a6e22e">datepicker</span>({ <span style="color:#a6e22e">dateFormat</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;yy-mm-dd&#39;</span>, <span style="color:#a6e22e">firstDay</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span> });
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>      });
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>  &lt;/<span style="color:#f92672">script</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>&lt;/<span style="color:#f92672">head</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>&lt;<span style="color:#f92672">body</span>&gt;
</code></pre></div><h3 id="footerphp">footer.php</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>&lt;/<span style="color:#f92672">body</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><p>Sí, hago algo de uso de jquery, pero no os asustéis que sólo es para la inserción de fechas. El resto de la aplicación será horrible :-P</p>
<p>Vamos con el índice:</p>
<h3 id="task_indexphp">task_index.php</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#66d9ef">include</span> <span style="color:#e6db74">&#39;header.php&#39;</span>; <span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#960050;background-color:#1e0010">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#960050;background-color:#1e0010">&lt;table&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#960050;background-color:#1e0010">  &lt;thead&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#960050;background-color:#1e0010">    &lt;tr&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#960050;background-color:#1e0010">      &lt;th&gt;Title
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#960050;background-color:#1e0010">      &lt;th&gt;Creation
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span style="color:#960050;background-color:#1e0010">      &lt;th&gt;Due date
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#960050;background-color:#1e0010">      &lt;th&gt;Planned date
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#960050;background-color:#1e0010">      &lt;th&gt;Completed
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#960050;background-color:#1e0010">    &lt;/tr&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#960050;background-color:#1e0010">  &lt;/thead&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span style="color:#960050;background-color:#1e0010">  &lt;tbody&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#960050;background-color:#1e0010">  &lt;?php
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#960050;background-color:#1e0010">  foreach ($task_list as $task)
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#960050;background-color:#1e0010">  {
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span style="color:#960050;background-color:#1e0010">    echo &#34;&#34;;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span style="color:#960050;background-color:#1e0010">    echo &#39;&#39;.$task-&gt;title.&#34;&#34;;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span style="color:#960050;background-color:#1e0010">    echo &#34;&#34;.$task-&gt;created.&#34;&#34;;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#960050;background-color:#1e0010">    echo &#34;&#34;.$task-&gt;duedate.&#34;&#34;;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span style="color:#960050;background-color:#1e0010">    echo &#34;&#34;;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span style="color:#960050;background-color:#1e0010">  }
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span style="color:#960050;background-color:#1e0010">  ?&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span style="color:#960050;background-color:#1e0010">  &lt;/tbody&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span style="color:#960050;background-color:#1e0010">&lt;/table&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span style="color:#960050;background-color:#1e0010">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span style="color:#960050;background-color:#1e0010">&lt;?php echo &#34;&#34;.html::anchor(&#34;task/add&#34;,&#34;Add new task&#34;); ?&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span style="color:#960050;background-color:#1e0010">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span style="color:#960050;background-color:#1e0010">&lt;?php include &#34;footer.php&#34;; ?&gt;
</span></code></pre></div><p>Como en la función del controlador &ldquo;action_index&rdquo; insertamos la variable <code>$task_list</code>, ahora podemos recuperarla y recorrerla. De esta manera creamos una vista horrible. Dejo como tarea ponerla bonita, ya que eso no es el tema de este tutorial.</p>
<p>Nos queda poder añadir tareas (<em>task_add.php</em>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#66d9ef">include</span> <span style="color:#e6db74">&#39;header.php&#39;</span>; <span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#960050;background-color:#1e0010">&lt;?php
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#960050;background-color:#1e0010">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#960050;background-color:#1e0010">if (isset($message))
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#960050;background-color:#1e0010">{
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#960050;background-color:#1e0010">  print $message;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#960050;background-color:#1e0010">}
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span style="color:#960050;background-color:#1e0010">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#960050;background-color:#1e0010">print html::anchor(&#39;task&#39;,&#39;List of tasks&#39;);
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#960050;background-color:#1e0010">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#960050;background-color:#1e0010">print form::open();
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#960050;background-color:#1e0010">print form::label(&#39;title&#39;, &#39;Título&#39;);
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span style="color:#960050;background-color:#1e0010">print form::input(&#39;title&#39;);
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#960050;background-color:#1e0010">print form::textarea(&#39;description&#39;);
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#960050;background-color:#1e0010">print form::label(&#39;duedate&#39;, &#39;Due Date:&#39;);
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#960050;background-color:#1e0010">print form::input(&#39;duedate&#39;, null, array (&#39;class&#39;=&gt;&#39;date&#39;) );
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span style="color:#960050;background-color:#1e0010">print form::submit(&#39;submit&#39;, &#39;Send&#39;);
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span style="color:#960050;background-color:#1e0010">print form::close();
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span style="color:#960050;background-color:#1e0010">?&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#960050;background-color:#1e0010">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span style="color:#960050;background-color:#1e0010">&lt;?php include &#39;footer.php&#39;; ?&gt;
</span></code></pre></div><p>En este caso he creado un formulario utilizando las funciones de Kohana. Como véis, los nombres de los campos se corresponden con los que utilicé en la función &ldquo;create_task&rdquo;.</p>
<h2 id="fin">Fin</h2>
<p>Como decían en en 1,2,3&hellip; &ldquo;hasta aquí puedo leer&rdquo;. Como primera aplicación me parece mucho más interesante que el triste &ldquo;hola mundo&rdquo;, ya que tiene todos los componentes de una aplicación real: modelo, vista y controlador (el &ldquo;hola mundo&rdquo; no tiene más que controlador), acceso a bases de datos, etc.</p>
<p>No he entrado con el &ldquo;update_task&rdquo; ya que no es más complicado que el &ldquo;create_task&rdquo;. Lo dejo como ejercicio.</p>
<p>Habrá segunda parte de este tutorial.</p>
<h2 id="referencias">Referencias</h2>
<p>No hay mucha documentación de <a href="https://kohanaframework.org/">Kohana</a>. Sin embargo, el <a href="https://kohanaframework.org/guide/tutorials.orm">ORM de Kohana</a> sí está bien documentado y no creo que tengáis mayor problema con esa parte. Siempre prefiero utilizar sistemas que me eviten el SQL a mano, ya que éste puede tener &ldquo;sql-injection&rdquo;.</p>
<p>Acordáos de seguir las <a href="https://kohanaframework.org/guide/about.conventions">convenciones</a>. También podéis echar un vistazo a otros
tutoriales, como el de <a href="https://www.ajaxman.net/category/kohana">Ajaxman</a> o el de
<a href="https://net.tutsplus.com/tutorials/php/kohana-the-swift-php-framework/">Christian Gilè</a>, sin
contar los <a href="https://kohanaframework.org/guide/tutorials.helloworld">tutoriales de la propia página de Kohana</a>.</p>
<p>Espero que os haya resultado interesante.</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/kohana" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">kohana</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "magmax" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://magmax.org/" >
    &copy;  El blog de MagMax 2021 
  </a>
    <div>














</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
