<!DOCTYPE html>
<html prefix="
og: https://ogp.me/ns#
article: https://ogp.me/ns/article#
" lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Cache-Control" content="max-age=43200">
<meta http-equiv="ETag" content="b'43516d322f35b42f7136bc9e4ca4c9c80cc1466c'">
<title>Unit tests en Java | MagMax Blog</title>
<link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="/assets/css/code.css" rel="stylesheet" type="text/css">
<link href="/assets/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="/assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="/assets/css/custom.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/magmax">
<link rel="canonical" href="http://magmax.org/blog/java-unit-test/">
<link rel="icon" href="/favicon.png" sizes="128x128">
<link rel="icon" href="/favicon_330.png" sizes="330x330">
<link rel="icon" href="/favicon.ico" sizes="16x16">
<meta name="author" content="Miguel Ángel García">
<link rel="prev" href="/blog/porque-php-mola/" title="Por qué PHP mola" type="text/html">
<link rel="next" href="/blog/java-unit-test-2/" title="Unit tests en Java (II)" type="text/html">
<meta property="og:site_name" content="MagMax Blog">
<meta property="og:title" content="Unit tests en Java">
<meta property="og:url" content="http://magmax.org/blog/java-unit-test/">
<meta property="og:description" content="El otro día me di cuenta de que no había escrito ningún artículo sobre tests unitarios en Java. ¡Eso hay que arreglarlo!
Tengo artículos más complejos pero, a veces, volver a la base ayuda a tener una">
<meta property="og:type" content="article">
<meta property="article:author" content="Miguel Ángel García">
<meta property="article:published_time" content="2012-07-09T00:00:00+00:00">
<meta property="article:updated" content="2012-07-09T00:00:00">
<meta property="article:tag" content="java testing">
<meta property="article:tag" content="testing">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@magmax_en">
<meta name="twitter:creator" content="@magmax">
<meta name="twitter:title" content="MagMax Blog">
<meta name="twitter:description" content="El blog de un Ingeniero Informático: tutoriales, manuales, opiniones, comparativas, ...">
<meta name="twitter:url" content="http://magmax.org//blog/java-unit-test/">
<meta name="twitter:image" content="http://magmax.org/favicon.png">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="container">
<!-- This keeps the margins nice -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://magmax.org/">

        <span id="blog-title">MagMax Blog</span>
      </a>
    </div>
<!-- /.navbar-header -->
    <div class="collapse navbar-collapse navbar-ex1-collapse">
      <ul class="nav navbar-nav">
<li>
<a href="/">Inicio</a>
                </li>
<li>
<a href="/archive.html">Archivo</a>
                </li>
<li>
<a href="/categories">Categorías</a>
                </li>
<li>
<a href="/projects">Proyectos</a>
                </li>
<li>
<a href="/news">Posts Externos</a>

        
      </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
<form class="navbar-form navbar-left" role="search" action="http://google.com/search" method="get">
<div class="form-group">
<input type="hidden" name="sitesearch" value="magmax.org"><input type="text" name="q" class="form-control" placeholder="Search / Buscar">
</div>
</form>
</li>

        <li style="margin-left:0">
          <a href="http://feeds.feedburner.com/magmax">
            <img src="/assets/images/rss.png" style="width:22px;height:22px"></a>
        </li>

        
      </ul>
</div>
<!-- /.navbar-collapse -->
  </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
  <div class="body-content">
    <div class="row">
      <div class="page-content col-md-9">
        
        <article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="https://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="/blog/java-unit-test/" class="u-url">Unit tests en Java</a></h1>
            <div class="metadata text-muted">
              <i class="glyphicon glyphicon-calendar"></i>
              <p class="dateline">
                <time class="published dt-published" datetime="2012-07-09T00:00:00+00:00" title="2012-07-09">2012-07-09</time>
                // <time class="updated dt-updated" datetime="2012-07-09T00:00:00" title="2012-07-09">2012-07-09</time></p>
              <p class="commentline">            <a href="/blog/java-unit-test/#disqus_thread" data-disqus-identifier="cache/posts/java-unit-test.html">Comments</a>

</p>
              <address class="vcard author"><a class="url fn" href="https://magmax.org">Miguel Ángel García</a></address>
            </div>
            <br></header><div class="e-content entry-content" itemprop="articleBody text">
            <div>
<p>El otro día me di cuenta de que no había escrito ningún artículo sobre tests unitarios en Java. ¡Eso hay que arreglarlo!</p>
<p>Tengo artículos más complejos pero, a veces, volver a la base ayuda a tener una mejor visión de conjunto. Además, nunca se sabe lo que se puede aprender de lo básico.</p>
<p>Aprovecharé para hacer incapié en las características de los buenos tests.</p>
<p><em>Actualización 2012-07-11</em>: Añado árbol de directorios y cabeceras indicando a qué archivo pertenecen.
<em>Actualización 2012-07-13</em>: Gracias a un comentario de David Marín, descubro que la parte de los proveedores de datos es completamente errónea y la arreglo.</p>
<!-- TEASER_END -->
<div class="section" id="que-vamos-a-probar">
<h2>Qué vamos a probar</h2>
<p>Hay dos aproximaciones posibles. Por una parte, podría poner una función y probarla. Esto es lo que se denominaría "probar <em>legacy code</em>". Otra aproximación sería <em>Test Driven Development</em> o <em>TDD</em>, que consiste en escribir la prueba primero y después producir código que hace pasar la prueba.</p>
<p>Como soy amante de TDD, he decidido seguir esta aproximación. Pero me vais a permitir que analice ambas.</p>
<div class="section" id="legacy-code">
<h3>Legacy code</h3>
<p>Sólo se puede probar el código que es testeable. Parece algo trivial, pero no es tan sencillo verlo.</p>
<p>Las funciones <em>legacy</em> son aquéllas que nos encontramos de código antiguo y que no tienen pruebas. A menudo tendrán muchos parámetros de entrada, realizarán varias tareas y tendrán código duplicado. En muchas ocasiones, también hay mucho <em>"código tricky"</em>, es decir: trucos que ha usado el programador para demostrar que es mejor que nadie. Todo eso hace el código dificil de seguir, comprobar, depurar y comprender.</p>
<p>A menudo, en el código antiguo, es fácil encontrar funciones que admiten, literalmente, decenas de parámetros. Una función así, directamente, <em>no se puede probar</em>. La cantidad de casos posibles y de caminos existentes es tan grande y la probabilidad de tener que modificar algo en el futuro es tan alta que no merece la pena. En estos casos, los test unitarios no sirven.</p>
<p>Es mejor atacar con tests de sistema, que nos permitan comprobar que no rompemos nada mientras rehacemos este tipo de funciones.</p>
</div>
<div class="section" id="test-driven-development">
<h3>Test Driven Development</h3>
<p>Cuando se realiza la prueba primero, es más dificil encontrar funciones tan grandes. Normalmente, las pruebas se dirigen en exclusiva a lo que necesitas, por lo que tiendes a eliminar todo lo que sobra.</p>
<p>Además, preparar una prueba demasiado compleja es un trabajo agotador, y suele evitarse por pruebas más simples. Así, rellenar una estructura enorme es más dificil que pasar una pequeña. Por eso es más sencillo cumplir el principio de unica responsabilidad cuando se utilizan técnicas como TDD.</p>
<p>Hay que pensar que los mayores usuarios de la mayor parte de nuestras funciones serán otros programadores (o nosotros mismos). Gracias a TDD se consigue un código más legible para los desarrolladores, más fiable y totalmente documentado, ya que los tests no dejan de ser ejemplos de uso.</p>
<p>Además, cuando se encuentra un nuevo defecto, lo suyo es crear primero el test para evitar que vuelva a suceder en el futuro. Así el fallo queda documentado de la forma más fiable: probando que el código se comporta exactamente como queremos.</p>
</div>
</div>
<div class="section" id="el-problema">
<h2>El problema</h2>
<p>Como suelo hacer, voy a exponer un problema y a solucionarlo. En este caso, vamos a realizar una clase de estadística, que permita obtener la mediana de una lista de números.</p>
<p>Comencemos:</p>
<div class="section" id="estructura">
<h3>Estructura</h3>
<p>Como suelo hacer, aquí tenéis el archivo maven que vamos a usar, para que no haya problemas de dependencias ni ejecución. Usaremos JUnit 4.10:</p>
<pre class="code xml"><a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-1"></a><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-2"></a>  <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-3"></a>  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-4"></a>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-5"></a>  <span class="nt">&lt;groupId&gt;</span>org.magmax<span class="nt">&lt;/groupId&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-6"></a>  <span class="nt">&lt;artifactId&gt;</span>stats<span class="nt">&lt;/artifactId&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-7"></a>  <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-8"></a>  <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-9"></a>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-10"></a>  <span class="nt">&lt;name&gt;</span>stats<span class="nt">&lt;/name&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-11"></a>  <span class="nt">&lt;url&gt;</span>http://maven.apache.org<span class="nt">&lt;/url&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-12"></a>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-13"></a>  <span class="nt">&lt;properties&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-14"></a>    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-15"></a>  <span class="nt">&lt;/properties&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-16"></a>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-17"></a>  <span class="nt">&lt;dependencies&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-18"></a>    <span class="nt">&lt;dependency&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-19"></a>      <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-20"></a>      <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-21"></a>      <span class="nt">&lt;version&gt;</span>4.10<span class="nt">&lt;/version&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-22"></a>      <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-23"></a>    <span class="nt">&lt;/dependency&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-24"></a>  <span class="nt">&lt;/dependencies&gt;</span>
<a name="rest_code_ba99d08e4174432b94dfacb0188da1a8-25"></a><span class="nt">&lt;/project&gt;</span>
</pre>
<p>La estructura de ficheros que generaremos será la siguiente:</p>
<pre class="code java"><a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-1"></a><span class="p">.</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-2"></a><span class="err">├──</span> <span class="n">pom</span><span class="p">.</span><span class="na">xml</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-3"></a><span class="err">└──</span> <span class="n">src</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-4"></a>    <span class="err">├──</span> <span class="n">main</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-5"></a>    <span class="err">│</span>   <span class="err">└──</span> <span class="n">java</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-6"></a>    <span class="err">│</span>       <span class="err">└──</span> <span class="n">org</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-7"></a>    <span class="err">│</span>           <span class="err">└──</span> <span class="n">magmax</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-8"></a>    <span class="err">│</span>               <span class="err">└──</span> <span class="n">stats</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-9"></a>    <span class="err">│</span>                   <span class="err">└──</span> <span class="n">Stats</span><span class="p">.</span><span class="na">java</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-10"></a>    <span class="err">└──</span> <span class="n">test</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-11"></a>        <span class="err">└──</span> <span class="n">java</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-12"></a>            <span class="err">└──</span> <span class="n">org</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-13"></a>                <span class="err">└──</span> <span class="n">magmax</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-14"></a>                    <span class="err">└──</span> <span class="n">stats</span>
<a name="rest_code_63df50bbecf24b60ae9459d17d5f6e3d-15"></a>                        <span class="err">└──</span> <span class="n">StatsTest</span><span class="p">.</span><span class="na">java</span>
</pre>
</div>
<div class="section" id="escribiendo-codigo">
<h3>Escribiendo código</h3>
<p>Vamos con los tests:</p>
<pre class="code java"><a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-1"></a><span class="c1">// file src/test/java/org/magmax/stats/StatsTest.java</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-2"></a><span class="kn">package</span> <span class="nn">org.magmax.stats</span><span class="p">;</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-3"></a>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-4"></a><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-5"></a><span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="p">;</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-6"></a><span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="p">;</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-7"></a>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-8"></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StatsTest</span> <span class="p">{</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-9"></a>    <span class="kd">private</span> <span class="n">Stats</span> <span class="n">sut</span><span class="p">;</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-10"></a>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-11"></a>    <span class="nd">@Before</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-12"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-13"></a>            <span class="n">sut</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Stats</span><span class="p">();</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-14"></a>    <span class="p">}</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-15"></a>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-16"></a>    <span class="nd">@Test</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-17"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">MedianaVectorVacio</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-18"></a>            <span class="n">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sut</span><span class="p">.</span><span class="na">mediana</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">));</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-19"></a>    <span class="p">}</span>
<a name="rest_code_df44cadc2fbb499b9de6ad25826270ca-20"></a><span class="p">}</span>
</pre>
<p>Como veis, lo único que hay que hacer es utilizar la notación "@Test" y ya está.</p>
<p>Me parece muy interesante mostrar que aquí se han realizado más operaciones de las que parecen. Por ejemplo, sin saberlo <em>hemos decidido</em> que calcularemos la media de un array de enteros. Este requisito nunca estuvo en el enunciado. ¿Por qué se ha hecho así? Porque era más sencillo para el test.</p>
<p>También hemos decidido cómo se construye la clase de la que vamos a crear objetos, mediante un constructor sin parámetros. Y hemos decidido que no sea un método estático, sino que es necesario instanciar un objeto de la clase.</p>
<p>Aquí hay parte de mi experiencia desarrollando: no me gustan los métodos estáticos porque siempre terminan dando problemas y me gusta llamar al objeto a probar "sut", que significa "Subject Under Test" (objeto en pruebas). Esto me permite identificar rápidamente qué objeto estoy probando.</p>
<p>Para ser TDD extrictos, lanzaremos el tests y veremos que falla. Decimos que estamos en rojo o que el test está rojo porque está fallando. Así que lo arreglamos:</p>
<pre class="code java"><a name="rest_code_210543ee4e6842fe9d094e5b6b9de240-1"></a><span class="c1">// file src/main/java/org/magmax/stats/Stats.java</span>
<a name="rest_code_210543ee4e6842fe9d094e5b6b9de240-2"></a><span class="kn">package</span> <span class="nn">org.magmax.stats</span><span class="p">;</span>
<a name="rest_code_210543ee4e6842fe9d094e5b6b9de240-3"></a>
<a name="rest_code_210543ee4e6842fe9d094e5b6b9de240-4"></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Stats</span>
<a name="rest_code_210543ee4e6842fe9d094e5b6b9de240-5"></a><span class="p">{</span>
<a name="rest_code_210543ee4e6842fe9d094e5b6b9de240-6"></a>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">mediana</span> <span class="p">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_210543ee4e6842fe9d094e5b6b9de240-7"></a>            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_210543ee4e6842fe9d094e5b6b9de240-8"></a>    <span class="p">}</span>
<a name="rest_code_210543ee4e6842fe9d094e5b6b9de240-9"></a><span class="p">}</span>
</pre>
<p>Ahora ya tenemos luz verde (o el test está verde). Es importante ver el verde, igual que lo es ver el rojo.</p>
<p>Como veis, eso es el código mínimo que necesito para que pase mis tests. A menudo esto se denomina "<em>diseño evolutivo</em>", y es más importante de lo que parece conocerlo. Sin saberlo, me está dando un caso base que, en la mayor parte de las ocasiones, se mantendrá incluso al final. La experiencia me ha enseñado que este primer test suele ser siempre parte de las condiciones iniciales de la función.</p>
</div>
<div class="section" id="anadiendo-tests">
<h3>Añadiendo tests</h3>
<p>Como no quiero aburriros, voy a saltarme unos cuantos ciclos de test-rojo-codificación-verde-refactorización-verde:</p>
<pre class="code java"><a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-1"></a><span class="c1">// file src/test/java/org/magmax/stats/StatsTest.java</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-2"></a><span class="kn">package</span> <span class="nn">org.magmax.stats</span><span class="p">;</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-3"></a>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-4"></a><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-5"></a><span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="p">;</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-6"></a><span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="p">;</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-7"></a>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-8"></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StatsTest</span> <span class="p">{</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-9"></a>    <span class="kd">private</span> <span class="n">Stats</span> <span class="n">sut</span><span class="p">;</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-10"></a>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-11"></a>    <span class="nd">@Before</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-12"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-13"></a>            <span class="n">sut</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Stats</span><span class="p">();</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-14"></a>    <span class="p">}</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-15"></a>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-16"></a>    <span class="nd">@Test</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-17"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">MedianaVectorVacio</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-18"></a>            <span class="n">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sut</span><span class="p">.</span><span class="na">mediana</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">));</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-19"></a>    <span class="p">}</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-20"></a>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-21"></a>    <span class="nd">@Test</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-22"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">MedianaVectorUnElemento</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-23"></a>            <span class="n">assertEquals</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">sut</span><span class="p">.</span><span class="na">mediana</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span><span class="p">{</span><span class="mi">5</span><span class="p">}));</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-24"></a>    <span class="p">}</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-25"></a>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-26"></a>    <span class="nd">@Test</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-27"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">MedianaTresElementos</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-28"></a>            <span class="n">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">sut</span><span class="p">.</span><span class="na">mediana</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">}));</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-29"></a>    <span class="p">}</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-30"></a>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-31"></a>    <span class="nd">@Test</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-32"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">MedianaCuatroElementos</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-33"></a>            <span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">sut</span><span class="p">.</span><span class="na">mediana</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">}));</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-34"></a>    <span class="p">}</span>
<a name="rest_code_d6e679a64117422aa61ed829c81d6b0f-35"></a><span class="p">}</span>
</pre>
<p>Fijaos que, durante la elaboración del último test, <tt class="docutils literal">MedianaCuatroElementos</tt>, he tomado otra decisión de diseño que no se encontraba en el enunciado, y que ésta queda documentada gracias al test: si el número de elementos es par, tendré dos elementos en el centro; quiero el primero de ellos.</p>
<p>Aquí también se aprecia la experiencia: trato de utilizar siempre diferentes datos y, si son iguales, trato de evitar obtener un resultado ya obtenido previamente.</p>
<p>Vamos con el programa:</p>
<pre class="code java"><a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-1"></a><span class="c1">// file src/main/java/org/magmax/stats/Stats.java</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-2"></a><span class="kn">package</span> <span class="nn">org.magmax.stats</span><span class="p">;</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-3"></a>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-4"></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Stats</span> <span class="p">{</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-5"></a>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-6"></a>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">mediana</span><span class="p">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-7"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-8"></a>                    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-9"></a>            <span class="p">}</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-10"></a>            <span class="k">return</span> <span class="n">v</span><span class="o">[</span><span class="n">obtenerPosicionMedio</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="o">]</span><span class="p">;</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-11"></a>    <span class="p">}</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-12"></a>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-13"></a>    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">obtenerPosicionMedio</span><span class="p">(</span><span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-14"></a>            <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="mf">2.00001</span><span class="p">);</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-15"></a>    <span class="p">}</span>
<a name="rest_code_4c78af041e88429fa347b7fcf08ae66d-16"></a><span class="p">}</span>
</pre>
<p>Cuando ya tenía verde decidí refactorizar. Y refactorizando me di cuenta de que tenía un algoritmo horrible en el método, así que lo saqué a otro método a parte, <tt class="docutils literal">obtenerPosicionMedio</tt>.</p>
</div>
<div class="section" id="paso-siguiente">
<h3>Paso siguiente</h3>
<p>En este momento todo está terminado,... ¿no? Pues no. Aún queda refactorizar las pruebas. Ese paso es tan importante como refactorizar el programa principal. Miradlo desde este punto de vista: si las pruebas son complejas de realizar, nadie las hará. Si son complejas de mantener, nadie las mantendrá.</p>
<p>Tal y como expliqué en el artículo "Pruebas Unitarias: Proveedores de datos":link://slug/dataproviders, podemos utilizar proveedores de datos:</p>
<pre class="code java"><a name="rest_code_11a43715dc6f4cc58462c89ab0027401-1"></a><span class="c1">// file src/test/java/org/magmax/stats/StatsTest.java</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-2"></a><span class="kn">package</span> <span class="nn">org.magmax.stats</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-3"></a>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-4"></a><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-5"></a><span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-6"></a><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-7"></a><span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-8"></a><span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-9"></a><span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-10"></a><span class="kn">import</span> <span class="nn">org.junit.runners.Parameterized</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-11"></a>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-12"></a><span class="nd">@RunWith</span><span class="p">(</span><span class="n">Parameterized</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-13"></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StatsTest</span> <span class="p">{</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-14"></a>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-15"></a>    <span class="kd">private</span> <span class="n">Stats</span> <span class="n">sut</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-16"></a>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">expected</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-17"></a>    <span class="kd">private</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">input</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-18"></a>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-19"></a>    <span class="nd">@Before</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-20"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-21"></a>            <span class="n">sut</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Stats</span><span class="p">();</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-22"></a>    <span class="p">}</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-23"></a>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-24"></a>    <span class="nd">@Parameterized.Parameters</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-25"></a>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Collection</span> <span class="nf">numbers</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-26"></a>            <span class="k">return</span> <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="k">new</span> <span class="n">Object</span><span class="o">[][]</span><span class="p">{</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-27"></a>                                    <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span><span class="p">{}},</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-28"></a>                                    <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span><span class="p">{</span><span class="mi">5</span><span class="p">}},</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-29"></a>                                    <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">}},</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-30"></a>                                    <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">}},</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-31"></a>                            <span class="p">});</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-32"></a>    <span class="p">}</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-33"></a>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-34"></a>    <span class="kd">public</span> <span class="nf">StatsTest</span><span class="p">(</span><span class="kt">int</span> <span class="n">expected</span><span class="p">,</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-35"></a>            <span class="k">this</span><span class="p">.</span><span class="na">expected</span> <span class="o">=</span> <span class="n">expected</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-36"></a>            <span class="k">this</span><span class="p">.</span><span class="na">input</span> <span class="o">=</span> <span class="n">input</span><span class="p">;</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-37"></a>    <span class="p">}</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-38"></a>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-39"></a>    <span class="nd">@Test</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-40"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMediana</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-41"></a>            <span class="n">assertEquals</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">sut</span><span class="p">.</span><span class="na">mediana</span><span class="p">(</span><span class="n">input</span><span class="p">));</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-42"></a>    <span class="p">}</span>
<a name="rest_code_11a43715dc6f4cc58462c89ab0027401-43"></a><span class="p">}</span>
</pre>
<p>Con lo que se reduce la complejidad y se facilita poder insertar nuevos casos de uso.</p>
</div>
</div>
</div>
          </div>
          <br><div>
            <nav><span class="author">
                <span class="glyphicon glyphicon-user"></span> 
                <span>Publicado:Miguel Ángel García</span>
              </span>
               

              
              <span class="dateline">
                <span class="glyphicon glyphicon-calendar"></span> 
                <time class="published dt-published" datetime="2012-07-09T00:00:00+00:00" title="2012-07-09">2012-07-09</time></span>
               
              <span class="tags">
                <span class="glyphicon glyphicon-tags"></span> 
                <a class="label label-primary p-category" href="/categories/java-testing/" rel="tag">java testing</a>
                <a class="label label-primary p-category" href="/categories/testing/" rel="tag">testing</a>
              </span>
                      <ul class="pager">
<li class="previous">
              <a href="/blog/porque-php-mola/" rel="prev" title="Por qué PHP mola">
                <span class="glyphicon glyphicon-arrow-left"></span>
                Publicación anterior
              </a>
            </li>
            <li class="next">
              <a href="/blog/java-unit-test-2/" rel="next" title="Unit tests en Java (II)">
                Siguiente publicación
                <span class="glyphicon glyphicon-arrow-right"></span>
              </a>
            </li>
        </ul></nav>
</div>
          <section class="comments"><h2>Comentarios</h2>
                            <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="magmax",
            disqus_url="http://magmax.org/blog/java-unit-test/",
        disqus_title="Unit tests en Java",
        disqus_identifier="cache/posts/java-unit-test.html",
        disqus_config = function () {
            this.language = "es_ES";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


          </section></article><script>var disqus_shortname="magmax";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
      <aside class="sidebar col-md-3"><div>
<section class="panel panel-default"><div class="panel-heading">
    <h3 class="panel-title">Last comments</h3>
  </div>
  <div class="panel-body">
    <div id="disqus_last_comments" class="dsq-widget">
      <script type="text/javascript" src="https://magmax.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=32&amp;excerpt_length=150">
      </script>
</div>
  </div>
</section>
</div>
          <div>
<section class="panel panel-default"><div class="panel-heading">
    <h3 class="panel-title">GitHub Repos</h3>
  </div>
  <div class="panel-body">
    <ul id="gh_repos" class="list-unstyled">
<li class="loading">Status updating…</li>
    </ul>
</div>
  <div class="panel-footer">
    <a href="https://github.com/magmax">@magmax</a> on GitHub
  </div>
</section>
</div>
      </aside>
</div>

    <footer>
      Contents © 2009-2020 <a href="mailto:">Miguel Ángel García</a> 
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/es/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;width:80px;height:15px;vertical-align:middle" src="https://i.creativecommons.org/l/by-nc-sa/2.5/es/80x15.png"></a>; Using <a href="/stories/credits/">a lot of free software</a>
      
    </footer>
</div>
</div>




<script data-main="/assets/js/main" src="/assets/js/libs/require/require.min.js"></script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9308241-3', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
