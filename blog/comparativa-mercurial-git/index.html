<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Hg vs Git - El blog de MagMax</title><meta name="Description" content="Voy a comparar mercurial y git, pero sólo valen formas que sean reproducibles. Pretendo desmitificar o corroborar rumores."><meta property="og:title" content="Hg vs Git" />
<meta property="og:description" content="Voy a comparar mercurial y git, pero sólo valen formas que sean reproducibles. Pretendo desmitificar o corroborar rumores." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/comparativa-mercurial-git/" /><meta property="og:image" content="https://magmax.org/icons/favicon.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-05-27T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-28T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://magmax.org/icons/favicon.png"/>

<meta name="twitter:title" content="Hg vs Git"/>
<meta name="twitter:description" content="Voy a comparar mercurial y git, pero sólo valen formas que sean reproducibles. Pretendo desmitificar o corroborar rumores."/>
<meta name="application-name" content="El blog de MagMax">
<meta name="apple-mobile-web-app-title" content="El blog de MagMax"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://magmax.org/blog/comparativa-mercurial-git/" /><link rel="prev" href="https://magmax.org/blog/patterns-observer/" /><link rel="next" href="https://magmax.org/blog/patentes/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Hg vs Git",
        "inLanguage": "es",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/magmax.org\/blog\/comparativa-mercurial-git\/"
        },"genre": "posts","keywords": "mercurial, git, dvcs","wordcount":  1487 ,
        "url": "https:\/\/magmax.org\/blog\/comparativa-mercurial-git\/","datePublished": "2013-05-27T00:00:00+00:00","dateModified": "2021-01-28T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "Miguel Ángel"},"author": {
                "@type": "Person",
                "name": "Miguel Ángel"
            },"description": "Voy a comparar mercurial y git, pero sólo valen formas que sean reproducibles. Pretendo desmitificar o corroborar rumores."
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Inicio </a><a class="menu-item" href="/posts"> Posts </a><a class="menu-item" href="/tags"> Tags </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/blog/comparativa-mercurial-git/" selected>Español</option></select>
                    </a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">Inicio</a><a class="menu-item" href="/posts" title="">Posts</a><a class="menu-item" href="/tags" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/blog/comparativa-mercurial-git/" selected>Español</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contenido</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Hg vs Git</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Miguel Ángel</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="27 May 2013">27 May 2013</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1487 palabras&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;7 minutos&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contenido</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#este-artículo-es-un-coñazo">Este artículo es un coñazo</a></li>
    <li><a href="#conclusiones">Conclusiones</a></li>
    <li><a href="#críticas">Críticas</a></li>
    <li><a href="#agradecimientos">Agradecimientos</a></li>
    <li><a href="#scripts">Scripts</a></li>
    <li><a href="#demostraciones">Demostraciones</a>
      <ul>
        <li><a href="#si-mueves-un-archivo-en-mercurial-ocupará-espacio-de-nuevo">Si mueves un archivo en mercurial, ocupará espacio de nuevo</a></li>
        <li><a href="#conservando-historia-entre-moves">Conservando historia entre moves</a></li>
        <li><a href="#dos-pushes-simultáneos-sin-conflicto">Dos <em>pushes</em> simultáneos sin conflicto</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Vamos con tópicos: Mercurial vs Git.</p>
<p>Voy a intentar desmitificar o corroborar rumores, de manera unívoca y que cualquiera pueda reproducir.</p>
<p>Este artículo y los siguientes admiten colaboraciones :D</p>
<figure><img src="/images/gitvshg.png"
         alt="Git vs Mercurial"/>
</figure>

<h2 id="este-artículo-es-un-coñazo">Este artículo es un coñazo</h2>
<p>Pues sí. Este artículo es un coñazo total. Por eso voy a comenzar por el final: las conclusiones. Así, los crédulos, pueden evitarse la parte de demostración y leer sólo las conclusiones. Los incrédulos pueden llegar hasta el final y comprobar que he tratado de ser todo lo objetivo posible.</p>
<h2 id="conclusiones">Conclusiones</h2>
<p>Aquí tenemos las conclusiones finales:</p>
<ul>
<li>Si en Mercurial renombras un archivo, el repositorio requiere de nuevo el espacio ocupado por el archivo. En git, la diferencia es inapreciable.</li>
<li>En Mercurial, dos &ldquo;push&rdquo; simultáneos sin conflicto pueden provocar que el segundo se cancele. En git no ocurre.</li>
</ul>
<p>Esto demuestra que Git da un mejor rendimiento que Mercurial.</p>
<h2 id="críticas">Críticas</h2>
<p>Por favor, estoy dispuesto a soportar cualquier tipo de crítica. Sin embargo, me gustaría indicar que este artículo me ha costado <strong>MUCHO</strong>, ya que no es nada sencillo pensar en las demostraciones y menos realizarlas de manera que se puedan repetir. Y también ha sido compleja la maquetación. Por esa razón, espero que cualquier crítica venga acompañada de demostraciones.</p>
<p>Sé de algunos otros problemas, pero no puedo demostrarlos, así que me los cayo. Estas pruebas son completamente <strong>OBJETIVAS</strong>.</p>
<p>También acepto demostraciones a favor/en contra de ambos. Sed creativos.</p>
<h2 id="agradecimientos">Agradecimientos</h2>
<p>Agradezco a <a href="https://arco.esi.uclm.es/~david.villa/" target="_blank" rel="noopener noreffer">David Villa</a> su paciencia haciendo <em>code review</em> de estos scripts.
Me equivoqué al pasarle el de Mercurial y se puede decir que lo rehizo él solo.</p>
<h2 id="scripts">Scripts</h2>
<p>Los <em>Scripts</em> necesarios para reproducir lo que expongo aquí se pueden encontrar
en <a href="https://github.com/magmax/git-vs-hg" target="_blank" rel="noopener noreffer">github</a>. Allí será donde haga modificaciones a los mismos.</p>
<h2 id="demostraciones">Demostraciones</h2>
<h3 id="si-mueves-un-archivo-en-mercurial-ocupará-espacio-de-nuevo">Si mueves un archivo en mercurial, ocupará espacio de nuevo</h3>
<table>

  <tr>

    <th>Mercurial</th>

    <th>Git</th>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ seq <span class="m">10000000</span> &gt; <span class="nv">$WC1</span>/file
$ ls -lh <span class="nv">$WC1</span>
total 6,6M
-rw-r--r-- <span class="m">1</span> miguel miguel 6,6M may <span class="m">27</span> 19:39 file
$ hg -R <span class="nv">$WC1</span> add <span class="nv">$WC1</span>/file
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ seq <span class="m">10000000</span> &gt; <span class="nv">$WC1</span>/file
$ ls -lh <span class="nv">$WC1</span>
total 6,6M
-rw-r--r-- <span class="m">1</span> miguel miguel 6,6M may <span class="m">27</span> 19:39 file
$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> add <span class="nv">$WC1</span>/file
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">export</span> <span class="nv">WC1</span><span class="o">=</span>/tmp/wc1-hg
$ hg init <span class="nv">$WC1</span>
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">export</span> <span class="nv">WC1</span><span class="o">=</span>/tmp/wc1-git
$ git init <span class="nv">$WC1</span>
Initialized empty Git repository in /tmp/wc1-git/.git/
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ hg -R <span class="nv">$WC1</span> commit -m <span class="s2">&#34;initial&#34;</span>
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> commit -m <span class="s2">&#34;initial&#34;</span>
<span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> 50f537c<span class="o">]</span> initial
 <span class="m">1</span> file changed, <span class="m">1000000</span> insertions<span class="o">(</span>+<span class="o">)</span>
 create mode <span class="m">100644</span> file
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ du -hs
8,7M /tmp/wc1-hg
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ du -hs /tmp/wc1-git
8,9M /tmp/wc1-git
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ hg -R <span class="nv">$WC1</span> mv <span class="nv">$WC1</span>/file <span class="nv">$WC1</span>/example
$ hg -R <span class="nv">$WC1</span> commit -m <span class="s2">&#34;second&#34;</span>
$ du -hs <span class="nv">$WC1</span>
11M /tmp/wc1-hg
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> mv file example
$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> commit -am <span class="s2">&#34;second&#34;</span>
<span class="o">[</span>master f206fe1<span class="o">]</span> second
 <span class="m">1</span> file changed, <span class="m">0</span> insertions<span class="o">(</span>+<span class="o">)</span>, <span class="m">0</span> deletions<span class="o">(</span>-<span class="o">)</span>
 rename <span class="nv">file</span> <span class="o">=</span>&gt; example <span class="o">(</span>100%<span class="o">)</span>
$ du -hs <span class="nv">$WC1</span>
8,9M /tmp/wc1-git
      </code></pre></div>
    </td>

  
</tr>



</table>

<p><strong>Conclusión:</strong> Si mueves un archivo en Mercurial, volverá a ocupar espacio. Si mueves un archivo en git, el repositorio seguirá ocupando lo mismo (prácticamente).</p>
<h3 id="conservando-historia-entre-moves">Conservando historia entre moves</h3>
<p>Este apartado continúa el script anterior:</p>
<table>

  <tr>

    <th>Mercurial</th>

    <th>Git</th>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ hg -R <span class="nv">$WC1</span> mv <span class="nv">$WC1</span>/example <span class="nv">$WC1</span>/file
$ hg -R <span class="nv">$WC1</span> commit -m <span class="s2">&#34;third&#34;</span>
$ du -hs <span class="nv">$WC1</span>
11M /tmp/wc1-hg
$ hg -R <span class="nv">$WC1</span> log <span class="nv">$WC1</span>/file --follow
changeset: 2:3d54fb888504
tag: tip
user: Miguel Angel Garcia &lt;magmax@example.org&gt;
date: Thu Jun <span class="m">13</span> 05:31:08 <span class="m">2013</span> +0200
summary: third

changeset: 1:f13ffb871397
user: Miguel Angel Garcia &lt;magmax@example.org&gt;
date: Thu Jun <span class="m">13</span> 05:31:07 <span class="m">2013</span> +0200
summary: second

changeset: 0:e47df7ca3541
user: Miguel Angel Garcia &lt;magmax@example.org&gt;
date: Thu Jun <span class="m">13</span> 05:31:07 <span class="m">2013</span> +0200
summary: initial
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> mv example file
$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> commit -am <span class="s2">&#34;third&#34;</span>
<span class="o">[</span>master dd45fed<span class="o">]</span> third
 <span class="m">1</span> file changed, <span class="m">0</span> insertions<span class="o">(</span>+<span class="o">)</span>, <span class="m">0</span> deletions<span class="o">(</span>-<span class="o">)</span>
 rename <span class="nv">example</span> <span class="o">=</span>&gt; file <span class="o">(</span>100%<span class="o">)</span>
$ du -hs <span class="nv">$WC1</span>
8,9M /tmp/wc1-git
$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> log -- file
commit dd45fedd449babb33a019f23a2dae244e18f400c
Author: Miguel Angel Garcia &lt;magmax@example.org&gt;
Date: Mon May <span class="m">27</span> 19:46:49 <span class="m">2013</span> +0200

    third

commit f206fe12540494bf1f6f5193bd6234865da75e13
Author: Miguel Angel Garcia &lt;magmax@example.org&gt;
Date: Mon May <span class="m">27</span> 19:46:48 <span class="m">2013</span> +0200

    second

commit 50f537cac82b6499c8519af7c7710211bf96c0c3
Author: Miguel Angel Garcia &lt;magmax@example.org&gt;
Date: Mon May <span class="m">27</span> 19:46:48 <span class="m">2013</span> +0200

    initial
      </code></pre></div>
    </td>


  
</tr>



</table>

<p><strong>Conclusión</strong>: Tanto Mercurial como Git siguen correctamente la historia del archivo. (Gracias, Juan Penalta)</p>
<p>Como dato curioso, se observa que al volver a mover el archivo, en esta ocasión
no ocupa espacio en mercurial.</p>
<h3 id="dos-pushes-simultáneos-sin-conflicto">Dos <em>pushes</em> simultáneos sin conflicto</h3>
<p><strong>NOTA:</strong> En esta demostración se utilizará el archivo <code>annotate-output</code>, que se encuentra en el paquete &ldquo;<strong>devscripts</strong>&rdquo;. Tan solo añade la hora y el tipo de salida (<em>stdout</em> o <em>stderr</em>) y redirecciona todo a la salida estándar.</p>
<table>

  <tr>

    <th>Mercurial</th>

    <th>Git</th>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">export</span> <span class="nv">SERVER</span><span class="o">=</span>server-hg
$ <span class="nb">export</span> <span class="nv">WC1</span><span class="o">=</span>/tmp/wc1-hg
$ <span class="nb">export</span> <span class="nv">WC2</span><span class="o">=</span>/tmp/wc2-hg
$ hg init <span class="nv">$SERVER</span>
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">export</span> <span class="nv">SERVER</span><span class="o">=</span>/home/miguel/server-git
$ <span class="nb">export</span> <span class="nv">WC1</span><span class="o">=</span>/tmp/wc1-git
$ <span class="nb">export</span> <span class="nv">WC2</span><span class="o">=</span>/tmp/wc2-git
$ git --bare init <span class="nv">$SERVER</span>
Initialized empty Git repository in /tmp/server-git/
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">echo</span> -e <span class="s1">&#39;[hooks]\npretxnchangegroup.sleep=sleep 2&#39;</span> &gt; <span class="nv">$SERVER</span>/.hg/hgrc
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">echo</span> -e <span class="s1">&#39;#!/bin/bash\nsleep 2&#39;</span> &gt; <span class="nv">$SERVER</span>/hooks/post-receive
$ chmod <span class="m">755</span> <span class="nv">$SERVER</span>/hooks/post-receive
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ hg clone ssh://localhost/<span class="nv">$SERVER</span> <span class="nv">$WC1</span>
no changes found
updating to branch default
<span class="m">0</span> files updated, <span class="m">0</span> files merged, <span class="m">0</span> files removed, <span class="m">0</span> files unresolved
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ git clone <span class="nv">$SERVER</span> <span class="nv">$WC1</span>
Cloning into <span class="s1">&#39;/tmp/wc1-git&#39;</span>...
warning: You appear to have cloned an empty repository.
<span class="k">done</span>.
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ touch <span class="nv">$WC1</span>/file
$ hg -R <span class="nv">$WC1</span> add <span class="nv">$WC1</span>/file
$ hg -R <span class="nv">$WC1</span> commit -m <span class="s2">&#34;initial version&#34;</span>
$ hg -R <span class="nv">$WC1</span> push
pushing to ssh://localhost//tmp/server-hg
searching <span class="k">for</span> changes
remote: adding changesets
remote: adding manifests
remote: adding file changes
remote: added <span class="m">1</span> changesets with <span class="m">1</span> changes to <span class="m">1</span> files
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ touch <span class="nv">$WC1</span>/INITIAL
$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> add INITIAL
$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> commit -m <span class="s2">&#34;master branch creation&#34;</span>
<span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> 38576fe<span class="o">]</span> master branch creation
 <span class="m">0</span> files changed
 create mode <span class="m">100644</span> INITIAL
$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> push origin master
To /tmp/server-git
 * <span class="o">[</span>new branch<span class="o">]</span> master -&gt; master
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ hg clone ssh://localhost/<span class="nv">$SERVER</span> <span class="nv">$WC2</span>
requesting all changes
adding changesets
adding manifests
adding file changes
added <span class="m">1</span> changesets with <span class="m">1</span> changes to <span class="m">1</span> files
updating to branch default
<span class="m">1</span> files updated, <span class="m">0</span> files merged, <span class="m">0</span> files removed, <span class="m">0</span> files unresolved
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ git clone <span class="nv">$SERVER</span> <span class="nv">$WC2</span>
Cloning into <span class="s1">&#39;/tmp/wc2-git&#39;</span>...
<span class="k">done</span>.
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ touch <span class="nv">$WC1</span>/file2
$ hg -R <span class="nv">$WC1</span> branch branch1
marked working directory as branch branch1
<span class="o">(</span>branches are permanent and global, did you want a bookmark?<span class="o">)</span>
$ hg -R <span class="nv">$WC1</span> add <span class="nv">$WC2</span>/file2
$ hg -R <span class="nv">$WC1</span> commit -m <span class="s2">&#34;changes on wc1&#34;</span>
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ touch <span class="nv">$WC1</span>/file
$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> checkout -b working-copy-1
Switched to a new branch <span class="s1">&#39;working-copy-1&#39;</span>
$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> add file
$ git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span> commit -m <span class="s2">&#34;change 1&#34;</span>
<span class="o">[</span>working-copy-1 de8c105<span class="o">]</span> change <span class="m">1</span>
 <span class="m">0</span> files changed
 create mode <span class="m">100644</span> file
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ touch <span class="nv">$WC2</span>/fileB
$ hg -R <span class="nv">$WC2</span> branch branch2
marked working directory as branch branch2
<span class="o">(</span>branches are permanent and global, did you want a bookmark?<span class="o">)</span>
$ hg -R <span class="nv">$WC2</span> add <span class="nv">$WC2</span>/fileB
$ hg -R <span class="nv">$WC2</span> commit -m <span class="s2">&#34;changes on wc2&#34;</span>
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ touch <span class="nv">$WC2</span>/fileB
$ git --git-dir<span class="o">=</span><span class="nv">$WC2</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC2</span> checkout -b working-copy-2
Switched to a new branch <span class="s1">&#39;working-copy-2&#39;</span>
$ git --git-dir<span class="o">=</span><span class="nv">$WC2</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC2</span> add fileB
$ git --git-dir<span class="o">=</span><span class="nv">$WC2</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC2</span> commit -m <span class="s2">&#34;changes on wc2&#34;</span>
<span class="o">[</span>working-copy-2 eee3889<span class="o">]</span> changes on wc2
 <span class="m">0</span> files changed
 create mode <span class="m">100644</span> fileB
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ annotate-output +<span class="s2">&#34;WC__1__%H:%M:%S&#34;</span> hg -R <span class="nv">$WC1</span> push --new-branch <span class="p">&amp;</span>
$ annotate-output +<span class="s2">&#34;WC__2__%H:%M:%S&#34;</span> hg -R <span class="nv">$WC2</span> push --new-branch
WC__2__13:31:54 I: Started hg -R /tmp/wc2-hg push --new-branch
WC__1__13:31:54 I: Started hg -R /tmp/wc1-hg push --new-branch
WC__1__13:31:57 O: pushing to ssh://localhost//tmp/server-hg
WC__1__13:31:57 O: searching <span class="k">for</span> changes
WC__1__13:31:57 O: remote: adding changesets
WC__1__13:31:57 O: remote: adding manifests
WC__1__13:31:57 O: remote: adding file changes
WC__1__13:31:57 O: remote: added <span class="m">1</span> changesets with <span class="m">1</span> changes to <span class="m">1</span> files
WC__1__13:31:57 I: Finished with exitcode <span class="m">0</span>
WC__2__13:31:58 E: abort: push failed:
WC__2__13:31:58 O: pushing to ssh://localhost//tmp/server-hg
WC__2__13:31:58 E: <span class="s1">&#39;unsynced changes&#39;</span>
WC__2__13:31:58 O: searching <span class="k">for</span> changes
WC__2__13:31:58 O: remote: waiting <span class="k">for</span> lock on repository /tmp/server-hg held by
<span class="s1">&#39;nightcrawler:6267&#39;</span>
WC__2__13:31:58 I: Finished with exitcode <span class="m">255</span>
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ annotate-output +<span class="s2">&#34;WC__1__%H:%M:%S&#34;</span> git --git-dir<span class="o">=</span><span class="nv">$WC1</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC1</span>
push origin master <span class="p">&amp;</span>
$ annotate-output +<span class="s2">&#34;WC__2__%H:%M:%S&#34;</span> git --git-dir<span class="o">=</span><span class="nv">$WC2</span>/.git --work-tree<span class="o">=</span><span class="nv">$WC2</span>
push origin master
WC__1__13:30:35 I: Started git --git-dir<span class="o">=</span>/tmp/wc1-git/.git
--work-tree<span class="o">=</span>/tmp/wc1-git push origin working-copy-1:working-copy-1
WC__2__13:30:35 I: Started git --git-dir<span class="o">=</span>/tmp/wc2-git/.git
--work-tree<span class="o">=</span>/tmp/wc2-git push origin working-copy-2:working-copy-2
WC__2__13:30:37 E: To /tmp/server-git
WC__1__13:30:37 E: To /tmp/server-git
WC__2__13:30:37 E: * <span class="o">[</span>new branch<span class="o">]</span> working-copy-2 -&gt; working-copy-2
WC__1__13:30:37 E: * <span class="o">[</span>new branch<span class="o">]</span> working-copy-1 -&gt; working-copy-1
WC__2__13:30:37 I: Finished with exitcode <span class="m">0</span>
WC__1__13:30:37 I: Finished with exitcode <span class="m">0</span>
      </code></pre></div>
    </td>

  
</tr>



</table>

<p><strong>Conclusión:</strong> Dos pushes simultáneos sobre ramas diferentes en Mercurial dará un error a la segunda que entre, si la primera se acepta. En git ambas podrán pasar.</p>
<p>¿Por qué ha ocurrido esto en Mercurial? ¿Qué es <strong>&ldquo;Unsynced changes&rdquo;</strong>? Mirando el código es un problema en el protocolo; Mercurial realiza 4 fases principales:</p>
<ol>
<li>Saludo</li>
<li>Solicitar un hash con el estado de las cabezas del servidor.</li>
<li>Ejecutar hooks</li>
<li>Enviar los deltas con el hash. Si el hash no coincide, abortará.</li>
</ol>
<p>En nuestro caso, un proceso se ha quedado bloqueado en el paso 3 y el otro ha
obtenido una hash que no coincidirá más tarde. El resultado es que ambas ramas
se bloquean hasta poder alcanzar el paso 4. La primera que llegue, modificará
las cabezas y, por tanto, la hash, que hará que la segunda aborte.
Si el primer proceso falla (un hook que no devuelve 0), la segunda pasará.</p>
<p><strong>Nota personal:</strong> Subjetivamente, encuentro mucho más útiles los mensajes de Git que de Mercurial.</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Actualizado el 28 Jan 2021</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartir en Twitter" data-sharer="twitter" data-url="https://magmax.org/blog/comparativa-mercurial-git/" data-title="Hg vs Git" data-hashtags="mercurial,git,dvcs"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Facebook" data-sharer="facebook" data-url="https://magmax.org/blog/comparativa-mercurial-git/" data-hashtag="mercurial"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Linkedin" data-sharer="linkedin" data-url="https://magmax.org/blog/comparativa-mercurial-git/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en WhatsApp" data-sharer="whatsapp" data-url="https://magmax.org/blog/comparativa-mercurial-git/" data-title="Hg vs Git" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Tumblr" data-sharer="tumblr" data-url="https://magmax.org/blog/comparativa-mercurial-git/" data-title="Hg vs Git" data-caption="Voy a comparar mercurial y git, pero sólo valen formas que sean reproducibles. Pretendo desmitificar o corroborar rumores." data-tags="mercurial,git,dvcs"><i class="fab fa-tumblr fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Reddit" data-sharer="reddit" data-url="https://magmax.org/blog/comparativa-mercurial-git/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Instapaper" data-sharer="instapaper" data-url="https://magmax.org/blog/comparativa-mercurial-git/" data-title="Hg vs Git" data-description="Voy a comparar mercurial y git, pero sólo valen formas que sean reproducibles. Pretendo desmitificar o corroborar rumores."><i data-svg-src="/lib/simple-icons/icons/instapaper.min.svg"></i></a><a href="javascript:void(0);" title="Compartir en Digg" data-sharer="digg" data-url="https://magmax.org/blog/comparativa-mercurial-git/"><i class="fab fa-digg fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Blogger" data-sharer="blogger" data-url="https://magmax.org/blog/comparativa-mercurial-git/" data-title="Hg vs Git" data-description="Voy a comparar mercurial y git, pero sólo valen formas que sean reproducibles. Pretendo desmitificar o corroborar rumores."><i class="fab fa-blogger fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/mercurial/">mercurial</a>,&nbsp;<a href="/tags/git/">git</a>,&nbsp;<a href="/tags/dvcs/">dvcs</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Regresar</a></span>&nbsp;|&nbsp;<span><a href="/">Inicio</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/patterns-observer/" class="prev" rel="prev" title="Patrones: Observer (Java/Python)"><i class="fas fa-angle-left fa-fw"></i>Patrones: Observer (Java/Python)</a>
            <a href="/blog/patentes/" class="next" rel="next" title="Patentes">Patentes<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Provisto por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Miguel Ángel</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Volver arriba">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentarios">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="https://magmax.disqus.com/embed.js" defer></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copiar al portapapeles","maxShownLines":10},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'UA-9308241-3', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-9308241-3" async></script></body>
</html>
