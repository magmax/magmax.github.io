<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Usando Git(3): Internals - El blog de MagMax</title><meta name="Description" content="Tutorial de git tercera parte: Cómo funciona Git"><meta property="og:title" content="Usando Git(3): Internals" />
<meta property="og:description" content="Tutorial de git tercera parte: Cómo funciona Git" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/usando-git3/" /><meta property="og:image" content="https://magmax.org/icons/favicon.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-11-26T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-28T00:00:00+00:00" /><meta property="og:site_name" content="My cool site" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://magmax.org/icons/favicon.png"/>

<meta name="twitter:title" content="Usando Git(3): Internals"/>
<meta name="twitter:description" content="Tutorial de git tercera parte: Cómo funciona Git"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://magmax.org/blog/usando-git3/" /><link rel="prev" href="https://magmax.org/blog/webdriver-practico/" /><link rel="next" href="https://magmax.org/blog/micro-web-framework-en-python/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Usando Git(3): Internals",
        "inLanguage": "es",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/magmax.org\/blog\/usando-git3\/"
        },"genre": "posts","keywords": "git, dvcs","wordcount":  2063 ,
        "url": "https:\/\/magmax.org\/blog\/usando-git3\/","datePublished": "2013-11-26T00:00:00+00:00","dateModified": "2021-01-28T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Miguel Ángel"
            },"description": "Tutorial de git tercera parte: Cómo funciona Git"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Inicio </a><a class="menu-item" href="/posts"> Posts </a><a class="menu-item" href="/tags"> Tags </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="Selecciona el lenguage">
                    <i class="fa fa-globe" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/blog/usando-git3/" selected>Español</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">Inicio</a><a class="menu-item" href="/posts" title="">Posts</a><a class="menu-item" href="/tags" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Selecciona el lenguage">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/blog/usando-git3/" selected>Español</option></select>
                </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contenido</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Usando Git(3): Internals</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Miguel Ángel</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="26 Nov 2013">26 Nov 2013</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2063 palabras&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;10 minutos&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contenido</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#qué-es-git">Qué es Git</a></li>
    <li><a href="#ext2">Ext2</a>
      <ul>
        <li><a href="#problemas-de-ext2">Problemas de Ext2</a></li>
      </ul>
    </li>
    <li><a href="#git">Git</a>
      <ul>
        <li><a href="#dimensión-uno-bloques-de-datos-blobs">Dimensión uno: Bloques de datos (Blobs)</a></li>
        <li><a href="#dimensión-dos-árboles-trees">Dimensión dos: Árboles (Trees)</a></li>
        <li><a href="#dimensión-tres-commits">Dimensión tres: Commits</a></li>
        <li><a href="#dimensión-cuatro-tags">Dimensión cuatro: Tags</a></li>
      </ul>
    </li>
    <li><a href="#ramas">Ramas</a></li>
    <li><a href="#simplicidad">Simplicidad</a></li>
    <li><a href="#eficiencia">Eficiencia</a></li>
    <li><a href="#más-información">Más información</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Anteriormente vimos lo más básico de <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a>, en dos tutoriales separados: <a href="https://magmax.org/blog/usando-git/" rel="">lo más básico de git</a> y <a href="https://magmax.org/blog/usando-git/" rel="">cómo trabajar con varias working copies</a>.</p>
<p>En esta ocasión me gustaría compartir cómo funciona Git desde dentro. Y muchas veces, la mejor manera de saber cómo funciona algo es construirlo. Por esa razón vamos a diseñar nuestro propio <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a>.</p>
<p>Veremos que no es tan complejo como pueda parecer, y conocer cómo funciona nos permitirá saber qué podemos hacer. Siempre es interesante saber <a href="https://magmax.org/blog/como-funcionan-las-cosas/" rel="">cómo funcionan las cosas</a>.</p>
<p>Y demostraré que <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> no tiene ramas.</p>
<figure><img src="/images/git.png"
         alt="git"/>
</figure>

<h2 id="qué-es-git">Qué es Git</h2>
<p>Hay <a href="https://en.wikipedia.org/wiki/Distributed_revision_control" target="_blank" rel="noopener noreffer ">DVCS</a>, como <a href="https://mercurial.selenic.com/" target="_blank" rel="noopener noreffer ">Mercurial</a>, que guardan las diferencias entre versiones. <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> sólo guarda ficheros completos, por lo que yo lo veo más bien como un sistema de ficheros sobre el que han montado un sistema de control de versiones. Precisamente por eso me gustaría comenzar contando cómo funciona un sistema de ficheros, <a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a>, y por qué no es adecuado para resolver los problemas que resuelve Git.</p>
<p>No tengáis miedo a este artículo, es más sencillo de lo que parece por el título. Mi profesor de sistemas operativos, Eduardo D., siempre nos decía: <strong>&ldquo;Aquí no hay magia, sólo programas&rdquo;</strong>.</p>
<h2 id="ext2">Ext2</h2>
<p>Un sistema de ficheros tiene que tener ficheros. Y habitualmente directorios. Éstos varían frecuentemente, por lo que es importante gestionar esta característica.</p>
<p>Por eso, los diseñadores de <a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a> vieron el sistema de ficheros como un conjunto de bloques de dos tipos: Archivos y Directorios.</p>
<p>Un <strong>Archivo</strong> contiene una serie de características (nombre, permisos, dueño,&hellip;), y un contenido arbitrariamente grande. Por eso decidieron poner una pequeña cantidad de datos junto a las características y una lista de direcciones donde continúa el contenido del archivo. Es decir: podemos decir que el <strong>Archivo</strong> contiene características y que hay otro tipo de objetos llamados &ldquo;<strong>Datos</strong>&rdquo; con el contenido. Cuando un <strong>Archivo</strong> es demasiado grande, las últimas direcciones apuntarán a otros nodos que contienen más direcciones de bloques de <strong>Datos</strong>.</p>
<p>Un <strong>Directorio</strong> funciona igual, gestionando una serie de características y una lista de <strong>Archivos</strong> y de otros <strong>Directorios</strong>.</p>
<p>Finalmente, la gestión de la memoria libre se hace de una manera similar, mediante bloques de memoria libre que apuntan a otros bloques de memoria libres. Sí, utiliza la propia memoria libre para gestionar lo que está libre.</p>
<p><a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a> se basa en conocer la posición de dos elementos especiales del sistema: la raíz del árbol de directorios y la raíz del espacio libre. Al fin y al cabo, necesitamos tener un nodo origen del que parten todos los demás.</p>
<p>Si tuviéramos que implementar <a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a> a alto nivel, probablemente necesitaríamos estos cuatro objetos: <strong>Directorio</strong>, <strong>Fichero</strong>, <strong>Datos</strong> y <strong>EspacioLibre</strong>.</p>
<p><a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a> es mucho más que esto, con un sistema de bitácora que lo hace semi-transacional, y otras características necesarias para recuperarse de problemas, pero éste es un artículo sobre <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> y con esto es suficiente.</p>
<h3 id="problemas-de-ext2">Problemas de Ext2</h3>
<p><a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a> está pensado para archivos que se modifican con frecuencia. En un <a href="https://en.wikipedia.org/wiki/Distributed_revision_control" target="_blank" rel="noopener noreffer ">DVCS</a> los archivos no se modifican nunca. Esto puede suponer una pérdida importante de eficiencia.</p>
<p>Además, un <a href="https://en.wikipedia.org/wiki/Distributed_revision_control" target="_blank" rel="noopener noreffer ">DVCS</a> tiene una dimensión más: el tiempo. Un mismo archivo tiene historia.</p>
<p>Estas dos características hacen necesario pensar otra solución en lugar de utilizar <a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a>.</p>
<h2 id="git">Git</h2>
<p>Git es un sistema en 4 dimensiones. Veremos cuáles son éstas y cómo no se diferencia tanto de <a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a>, al menos conceptualmente.</p>
<p>Algo que no debemos olvidar es que <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> es una implementación de alto nivel. Eso significa que donde <a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a> utiliza direcciones de memoria, <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> tiene que utilizar algo más grande: nombres de archivos.</p>
<h3 id="dimensión-uno-bloques-de-datos-blobs">Dimensión uno: Bloques de datos (Blobs)</h3>
<p>Igual que <a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a>, <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> tiene bloques de datos, que se llaman <strong>Blobs</strong>. Estos <strong>Blobs</strong> se tienen que guardar en archivos, por lo que aquí surge el primer problema: ¿Cómo direccionar de forma unívoca un <strong>Blob</strong>? ¿Cuál es el equivalente de una &ldquo;posición de memoria&rdquo;?</p>
<p>La solución es muy sencilla: Se calcula el <a href="https://es.wikipedia.org/wiki/Secure_Hash_Algorithm" target="_blank" rel="noopener noreffer ">Sha1</a> del <strong>Blob</strong> y se utiliza como nombre de archivo. Recordemos que el contenido de un archivo no cambia nunca, por lo que es algo perfectamente válido.</p>
<p>Estos <strong>Blob</strong> tendrán un tamaño máximo, de manera que sean sencillos de manejar. Si dos <strong>Blob</strong> comparten la misma <a href="https://es.wikipedia.org/wiki/Secure_Hash_Algorithm" target="_blank" rel="noopener noreffer ">Sha1</a>, se asume que tienen el mismo contenido y esto permite ahorrar espacio, guardándolo en memoria una única vez. Las probabilidades de que un bloque de tamaño fijo genere el mismo <a href="https://es.wikipedia.org/wiki/Secure_Hash_Algorithm" target="_blank" rel="noopener noreffer ">Sha1</a> que otro diferente son, en la práctica, nulas.</p>
<p>Así mismo, para ahorrar espacio se guarda la información comprimida en <a href="https://es.wikipedia.org/wiki/Formato_de_compresi%C3%B3n_ZIP" target="_blank" rel="noopener noreffer ">Zip</a>.</p>
<p>A los archivos cuyo nombre coincide con el <a href="https://es.wikipedia.org/wiki/Secure_Hash_Algorithm" target="_blank" rel="noopener noreffer ">Sha1</a> y contienen algún tipo de elemento de <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> se les denomina <strong>objetos</strong> y se guardarán en el directorio <code>.git/objects</code>.</p>
<p>Esto es un <strong>Blob</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">-------------------------
</span></span><span class="line"><span class="cl">| a1ad5...              |
</span></span><span class="line"><span class="cl">|-----------------------|
</span></span><span class="line"><span class="cl">| Blob           | size |
</span></span><span class="line"><span class="cl">|------------------------
</span></span><span class="line"><span class="cl">| Zipped content        |
</span></span><span class="line"><span class="cl">| example               |
</span></span><span class="line"><span class="cl">-------------------------
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ejemplo:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls .git/objects/a1/ad5a63324b733e8caf056f5167d4ee9957bf79
</span></span><span class="line"><span class="cl">.git/objects/a1/ad5a63324b733e8caf056f5167d4ee9957bf79
</span></span><span class="line"><span class="cl">$ git cat-file -t a1ad5a63324b733e8caf056f5167d4ee9957bf79
</span></span><span class="line"><span class="cl">blob
</span></span><span class="line"><span class="cl">$ git cat-file -p a1ad5a63324b733e8caf056f5167d4ee9957bf79
</span></span><span class="line"><span class="cl">Zipped content
</span></span><span class="line"><span class="cl">example
</span></span><span class="line"><span class="cl">$
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="dimensión-dos-árboles-trees">Dimensión dos: Árboles (Trees)</h3>
<p>De la misma manera que en <a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a> hay archivos y directorios, en <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">git</a> hay <strong>Trees</strong>.</p>
<p>Los <strong>Trees</strong> son unos bloques especiales que permiten dar un orden a los bloques de datos y almacenar cierta meta-información, como permisos, un nombre, etc.</p>
<p>Nuevamente nos encontramos con algo que no va a cambiar con el tiempo. Si un archivo o un directorio cambiase, sería otro diferente. Así que se puede guardar el <strong>Tree</strong> utilizando también su <a href="https://es.wikipedia.org/wiki/Secure_Hash_Algorithm" target="_blank" rel="noopener noreffer ">Sha1</a> como nombre. Igual que los <strong>Blobs</strong>, si dos archivos tienen el mismo <a href="https://es.wikipedia.org/wiki/Secure_Hash_Algorithm" target="_blank" rel="noopener noreffer ">Sha1</a> podemos asumir que son iguales. Es más: podemos guardarlos junto con los <strong>Blobs</strong>, ya que también son <strong>objetos</strong>.</p>
<p>Al contrario que en <a href="https://es.wikipedia.org/wiki/Ext2" target="_blank" rel="noopener noreffer ">Ext2</a>, los objetos <strong>Tree</strong> pueden contener referencias a <strong>Blobs</strong> y a otros <strong>Trees</strong>, por lo que no hay distinción real entre &ldquo;Archivos&rdquo; y &ldquo;Directorios&rdquo;.</p>
<p>Como veis, lo único que tenemos de momento son un montón de archivos con nombres de 40 bytes (su <a href="https://es.wikipedia.org/wiki/Secure_Hash_Algorithm" target="_blank" rel="noopener noreffer ">Sha1</a>), aunque el significado de éstos puede ser distinto para <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a>.</p>
<p>Esto es un <strong>Tree</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">---------------------------
</span></span><span class="line"><span class="cl">| a1975...                |
</span></span><span class="line"><span class="cl">|-------------------------|
</span></span><span class="line"><span class="cl">| Tree           | size   |
</span></span><span class="line"><span class="cl">|--------------------------
</span></span><span class="line"><span class="cl">| perms, type, sha1, name |
</span></span><span class="line"><span class="cl">| perms, type, sha1, name |
</span></span><span class="line"><span class="cl">| ...                     |
</span></span><span class="line"><span class="cl">---------------------------
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ejemplo:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls .git/objects/a1/a1975049511402aac1e2710bd4762ba7d15b74d1
</span></span><span class="line"><span class="cl">.git/objects/a1/a1975049511402aac1e2710bd4762ba7d15b74d1
</span></span><span class="line"><span class="cl">$ git cat-file -t a1975049511402aac1e2710bd4762ba7d15b74d1
</span></span><span class="line"><span class="cl">tree
</span></span><span class="line"><span class="cl">$ git cat-file -p a1975049511402aac1e2710bd4762ba7d15b74d1
</span></span><span class="line"><span class="cl"><span class="m">040000</span> tree ef67b9c831b2a669b8d8508cc5a9ed052d05e613	folder1
</span></span><span class="line"><span class="cl"><span class="m">040000</span> tree 0a546f747dd82b6b765cf272867f2d04c60fd8dd	folder2
</span></span><span class="line"><span class="cl"><span class="m">040000</span> tree 9194aeb855a27f7aec885eeeff32c88e26c8ee1c	folder3
</span></span><span class="line"><span class="cl"><span class="m">040000</span> tree 9ad174760352980f6c5d4222bb2e54484189a2d3	folder4
</span></span><span class="line"><span class="cl"><span class="m">100644</span> blob 6dc5a02b1d0dcb1e7e187972033f05b07e9592fe	file1
</span></span><span class="line"><span class="cl"><span class="m">040000</span> tree 08a180175c5df5e2d4f545fb15e65c50bb488c65	folder5
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="dimensión-tres-commits">Dimensión tres: Commits</h3>
<p>Y he aquí la tercera dimensión: el tiempo. Cada vez que hacemos <code>git commit</code>, <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> guarda un nuevo tipo de nodo, el <strong>Commit</strong>, que consiste en una lista <strong>Trees</strong> con alguna característica, como la descripción, el usuario y la fecha.</p>
<p>La implementación es sencilla: Cuando alguien hace <code>git add</code>, <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> se guarda el <strong>objeto</strong>(contenido + sha1) en un directorio distinto, de la forma que vimos arriba (bueno, esto no es del todo cierto&hellip; realmente guarda diffs, pero eso no importa ahora). Así, al hacer un <code>git commit</code> basta crear un nuevo objeto <strong>Commit</strong> con sus características y la lista de <strong>Trees</strong> que contuviera el <strong>commit</strong> anterior más los cambios almacenados. Después se cogen todos los <strong>objetos</strong> generados y se guardan con los demás.</p>
<p>Esta configuración hace que también sea muy sencillo implementar un <code>git push</code> o <code>git pull</code>, ya que basta con sincronizar el directorio con todos los <strong>objects</strong> (bueno&hellip; y alguna cosilla más).</p>
<p>Esto es un <strong>Commit</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">---------------------------
</span></span><span class="line"><span class="cl">| b52b8...                |
</span></span><span class="line"><span class="cl">|-------------------------|
</span></span><span class="line"><span class="cl">| Commit         | size   |
</span></span><span class="line"><span class="cl">|--------------------------
</span></span><span class="line"><span class="cl">| tree a2e96...           |
</span></span><span class="line"><span class="cl">| parent 0e443...         |
</span></span><span class="line"><span class="cl">| author MagMax           |
</span></span><span class="line"><span class="cl">| timestamp               |
</span></span><span class="line"><span class="cl">| commiter MagMax         |
</span></span><span class="line"><span class="cl">| timestamp               |
</span></span><span class="line"><span class="cl">| description             |
</span></span><span class="line"><span class="cl">---------------------------
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ejemplo:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls .git/objects/b5/2b8ec9e4784cc0ce458d13d8868bc5255e5ce7
</span></span><span class="line"><span class="cl">.git/objects/b5/2b8ec9e4784cc0ce458d13d8868bc5255e5ce7
</span></span><span class="line"><span class="cl">$ git cat-file -t b52b8ec9e4784cc0ce458d13d8868bc5255e5ce7
</span></span><span class="line"><span class="cl">commit
</span></span><span class="line"><span class="cl">$ git cat-file -p b52b8ec9e4784cc0ce458d13d8868bc5255e5ce7
</span></span><span class="line"><span class="cl">tree a2e96967bbb39652ecb6a5d0fee882eeb8d7f829
</span></span><span class="line"><span class="cl">parent 0e4432bf3cb667dbc9a99afcc3601696e8c110af
</span></span><span class="line"><span class="cl">author MagMax &lt;miguelangel@magmax.org&gt; <span class="m">1371385169</span> +0200
</span></span><span class="line"><span class="cl">committer MagMax &lt;miguelangel@magmax.org&gt; <span class="m">1371385169</span> +0200
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The description of this commit.
</span></span></code></pre></td></tr></table>
</div>
</div><p>Tan solo falta saber por dónde vamos. Para eso, <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> utiliza una serie de archivos en los que se guarda <strong>&ldquo;referencias&rdquo;</strong>, que consisten en el <a href="https://es.wikipedia.org/wiki/Secure_Hash_Algorithm" target="_blank" rel="noopener noreffer ">Sha1</a> de los objetos. Así, el <strong>HEAD</strong> que apareció en el tutorial anterior no es más que un archivo (<code>.git/HEAD</code>) donde se guarda la referencia en la que nos encontramos. Y la referencia no es más que otro archivo (<code>.git/refs/heads/master</code> ) que contendrá el <a href="https://es.wikipedia.org/wiki/Secure_Hash_Algorithm" target="_blank" rel="noopener noreffer ">Sha1</a> del <strong>commit</strong> actual. Así de fácil. Os invito a que comprovéis el contenido de estos archivos en vuestro repositorio local:</p>
<ul>
<li><code>.git/HEAD</code> contiene: ref: refs/heads/master</li>
<li><code>.git/refs/heads/master</code> contiene: 00ce77b5f13e7750ba87e091e8df5df0956101fb</li>
<li>Existe el archivo `.git/objects/00/ce77b5f13e7750ba87e091e8df5df0956101fb</li>
<li>Ejecutando <code>git show</code> comprobaremos que el último commit fue 00ce77b5f13e7750ba87e091e8df5df0956101fb</li>
</ul>
<h3 id="dimensión-cuatro-tags">Dimensión cuatro: Tags</h3>
<p>Consisten en referencias a <strong>commits</strong>, de manera que se puede establecer un nombre alternativo para estos <strong>commits</strong>.</p>
<p>Los veremos más adelante; de momento baste saber que estos <strong>Tags</strong> también son <strong>objetos</strong> y se guardan junto con todos los demás.</p>
<p>Su composición es similar a los <strong>commits</strong>, salvo que guardan referencias a otros <strong>commits</strong> en lugar de <strong>trees</strong>.</p>
<h2 id="ramas">Ramas</h2>
<p>Las ramas no son <strong>objetos</strong>.</p>
<p>A <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> le gustan las cosas inmutables, lo que no cambia. Un <strong>Tag</strong> no cambia nunca. Podemos borrarlo y crear otro diferente, pero el mismo <strong>Tag</strong> es inmutable. Lo mismo ocurre con <strong>Archivos</strong>, <strong>Árboles</strong> y <strong>Commits</strong>.</p>
<p>Sin embargo, en <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> el concepto de &ldquo;rama&rdquo; es efímero. Consiste en una referencia a un <strong>commit</strong>, pero irá cambiando frecuentemente, con cada <strong>commit</strong>. Además, no es un concepto indispensable. Así, una <strong>working copy</strong> por defecto sólo <em>trackea</em> una rama (habitualmente, <em>&ldquo;master&rdquo;</em>).</p>
<p>Las ramas son, en realidad, referencias. Es decir, punteros. Sólo eso y nada más. Y puedo demostrarlo:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cat .git/refs/heads/master
</span></span><span class="line"><span class="cl">00ce77b5f13e7750ba87e091e8df5df0956101fb
</span></span></code></pre></td></tr></table>
</div>
</div><p>Vaya&hellip; Está apuntando al mismo <strong>changeset</strong> que vimos antes :D</p>
<p>Por lo tanto, en <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> <strong>las ramas no son objetos</strong>. Al no ser <strong>objetos</strong>, no se copian con un <code>git fetch</code>.</p>
<p>Pensemos en los punteros de C o C++: podemos tener dos punteros apuntando a la misma variable. Cada puntero tendrá un nombre, y puede ser diferente o igual (en el caso de C y C++, sólo si están en distinto ámbito). Con <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> ocurre lo mismo: lo que importa es el <strong>commit</strong>, no el nombre que se le ha puesto. Por eso los nombres de las ramas son locales. Podemos referirnos a una rama en el servidor, indicando que está allí:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cat .git/refs/remotes/origin/master
</span></span><span class="line"><span class="cl">e2bf849e1c09ad79e04e7f6c0fcdcea8e5dd5175
</span></span></code></pre></td></tr></table>
</div>
</div><p>Hmmm&hellip;. vaya. Mi copia local no está sincronizada con el servidor o el <strong>changeset</strong> volvería a coincidir. Necesito hacer un <code>git push</code> para sincronizarlas.</p>
<h2 id="simplicidad">Simplicidad</h2>
<p>Estoy tratando de demostrar algo más: lo que se hace con las órdenes de <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> no es más que consultar archivos, a menudo de texto plano, que podríamos consultar a mano. Es una manera simple de gestionar un sistema complejo.</p>
<ul>
<li>Cada <code>fetch</code> trae un montón de <strong>objetos</strong> y actualiza las referencias remotas que se encuentran en <code>.git/refs/remotes</code>.</li>
<li>Cada <code>commit</code> genera nuevos <strong>objetos</strong> y actualiza las referencias en <code>.git/refs</code> y algunos archivos como <code>.git/HEAD</code> y <code>.git/</code></li>
<li>&hellip;</li>
</ul>
<p>Ahora es fácil entender qué significa <strong>Fast Forward</strong>: Podemos actualizar la rama sin necesidad de generar nuevos objetos. Es decir: basta actualizar las referencias.</p>
<p>También es fácil entender que un <code>add</code> guarda <strong>diffs</strong> en un archivo llamado <code>.git/index</code> (por eso a veces se llama <strong>index</strong> al <strong>stage</strong>). Y es aquí donde también se guarda la información del <code>stash</code>.</p>
<p>Sabiendo cómo funciona <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a>, resulta fácil saber si se puede o no se puede hacer algo. Basta imaginar cómo se haría a mano.</p>
<h2 id="eficiencia">Eficiencia</h2>
<p>Pero no todo es tan sencillo. <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> realizar algunas operaciones para ser más eficiente. En concreto, realiza empaquetados de objetos (por defecto, 6700) para facilitar operaciones. Estos objetos empaquetados pueden estar repetidos: empaquetados y sin empaquetar.</p>
<p>Los paquetes permiten facilitar los envíos de archivos. Así un <code>clone</code> será mucho más rápido, ya que basta enviar un único archivo en lugar de 6700. Además, la copia local ocupará menos. Y es poco probable que nadie necesite acceder a estos archivos antiguos.</p>
<p>Cuando alguien accede, se desempaqueta y así el archivo está duplicado: empaquetado y sin empaquetar. De esta manera se conserva la eficiencia a costa de un poco de espacio. Periódicamente, <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a> puede decidir borrar los objetos que ya estaban empaquetados.</p>
<h2 id="más-información">Más información</h2>
<p>Todo, absolutamente todo lo contado en este post se encuentra en el libro <a href="https://git-scm.com/book/es" target="_blank" rel="noopener noreffer ">progit</a>, de <a href="https://scottchacon.com/" target="_blank" rel="noopener noreffer ">Scott Chacon</a>. Probablemente, también en la web de <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer ">Git</a>.</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Actualizado el 28 Jan 2021</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartir en Twitter" data-sharer="twitter" data-url="https://magmax.org/blog/usando-git3/" data-title="Usando Git(3): Internals" data-via="magmax_en" data-hashtags="git,dvcs"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Facebook" data-sharer="facebook" data-url="https://magmax.org/blog/usando-git3/" data-hashtag="git"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Linkedin" data-sharer="linkedin" data-url="https://magmax.org/blog/usando-git3/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en WhatsApp" data-sharer="whatsapp" data-url="https://magmax.org/blog/usando-git3/" data-title="Usando Git(3): Internals" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Tumblr" data-sharer="tumblr" data-url="https://magmax.org/blog/usando-git3/" data-title="Usando Git(3): Internals" data-caption="Tutorial de git tercera parte: Cómo funciona Git" data-tags="git,dvcs"><i class="fab fa-tumblr fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Reddit" data-sharer="reddit" data-url="https://magmax.org/blog/usando-git3/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Instapaper" data-sharer="instapaper" data-url="https://magmax.org/blog/usando-git3/" data-title="Usando Git(3): Internals" data-description="Tutorial de git tercera parte: Cómo funciona Git"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/instapaper.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en 微博" data-sharer="weibo" data-url="https://magmax.org/blog/usando-git3/" data-title="Usando Git(3): Internals"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Blogger" data-sharer="blogger" data-url="https://magmax.org/blog/usando-git3/" data-title="Usando Git(3): Internals" data-description="Tutorial de git tercera parte: Cómo funciona Git"><i class="fab fa-blogger fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/git/">git</a>,&nbsp;<a href="/tags/dvcs/">dvcs</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Regresar</a></span>&nbsp;|&nbsp;<span><a href="/">Inicio</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/webdriver-practico/" class="prev" rel="prev" title="Webdriver: crackeando la web de Renfe"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Webdriver: crackeando la web de Renfe</a>
            <a href="/blog/micro-web-framework-en-python/" class="next" rel="next" title="Micro-framework web en Python">Micro-framework web en Python<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Con la tecnología de <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.114.1">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Miguel Ángel</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Volver arriba">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentarios">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script type="text/javascript" src="https://magmax.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copiar al portapapeles","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-X5FEBMGR06', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-X5FEBMGR06" async></script></body>
</html>
