<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Pruebas con Bases de Datos en memoria: DBUnit &#43; HSQLDB - El blog de MagMax</title><meta name="Description" content="El blog de un Ingeniero Informático: tutoriales, manuales, opiniones, comparativas, ..."><meta property="og:title" content="Pruebas con Bases de Datos en memoria: DBUnit &#43; HSQLDB" />
<meta property="og:description" content="DBUnit es un sistema sencillo que nos permite cargar con datos nuestra base de datos con el fin de realizar tests con estos datos.
La gran ventaja de DBUnit es poder utilizar un sistema sencillo para indicar los datos a insertar mediante un XML, así como poder exportar una BBDD existente.
Sin embargo, DBUnit no permite la creación de la BBDD, lo que puede ser un problema al intentar usar una BBDD en memoria, como pueda ser HyperSQL o Derby." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/hsqldb-dbunit/" />
<meta property="og:image" content="https://magmax.org/icons/favicon.png"/>
<meta property="article:published_time" content="2011-06-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-28T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://magmax.org/icons/favicon.png"/>

<meta name="twitter:title" content="Pruebas con Bases de Datos en memoria: DBUnit &#43; HSQLDB"/>
<meta name="twitter:description" content="DBUnit es un sistema sencillo que nos permite cargar con datos nuestra base de datos con el fin de realizar tests con estos datos.
La gran ventaja de DBUnit es poder utilizar un sistema sencillo para indicar los datos a insertar mediante un XML, así como poder exportar una BBDD existente.
Sin embargo, DBUnit no permite la creación de la BBDD, lo que puede ser un problema al intentar usar una BBDD en memoria, como pueda ser HyperSQL o Derby."/>
<meta name="application-name" content="El blog de MagMax">
<meta name="apple-mobile-web-app-title" content="El blog de MagMax"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://magmax.org/blog/hsqldb-dbunit/" /><link rel="prev" href="https://magmax.org/blog/formatos-simples/" /><link rel="next" href="https://magmax.org/blog/buenas-practicas-c-2/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Pruebas con Bases de Datos en memoria: DBUnit + HSQLDB",
        "inLanguage": "es",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/magmax.org\/blog\/hsqldb-dbunit\/"
        },"genre": "posts","keywords": "dbunit, db testing, hsqldb, sql","wordcount":  1048 ,
        "url": "https:\/\/magmax.org\/blog\/hsqldb-dbunit\/","datePublished": "2011-06-13T00:00:00+00:00","dateModified": "2021-01-28T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "Miguel Ángel"},"author": {
                "@type": "Person",
                "name": "Miguel Ángel"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Inicio </a><a class="menu-item" href="/tags"> Tags </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/blog/hsqldb-dbunit/" selected>Español</option></select>
                    </a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">Inicio</a><a class="menu-item" href="/tags" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/blog/hsqldb-dbunit/" selected>Español</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contenido</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Pruebas con Bases de Datos en memoria: DBUnit &#43; HSQLDB</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Miguel Ángel</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="13 Jun 2011">13 Jun 2011</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1048 palabras&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;5 minutos&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contenido</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#enunciado">Enunciado</a></li>
    <li><a href="#datos">Datos</a></li>
    <li><a href="#código">Código</a>
      <ul>
        <li><a href="#desglosando-el-código">Desglosando el código</a></li>
      </ul>
    </li>
    <li><a href="#volcado-de-bbdd">Volcado de BBDD</a></li>
    <li><a href="#comparando-tablas">Comparando tablas</a></li>
    <li><a href="#a-tener-en-cuenta">A tener en cuenta</a></li>
    <li><a href="#más-información">Más información</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>DBUnit es un sistema sencillo que nos permite cargar con datos nuestra base de datos con el fin de realizar tests con estos datos.</p>
<p>La gran ventaja de DBUnit es poder utilizar un sistema sencillo para indicar los datos a insertar mediante un XML, así como poder exportar una BBDD existente.</p>
<p>Sin embargo, DBUnit no permite la creación de la BBDD, lo que puede ser un problema al intentar usar una BBDD en memoria, como pueda ser HyperSQL o Derby.</p>
<!-- raw HTML omitted -->
<figure>
    <img src="/images/java.png"
         alt="Java"/> 
</figure>

<h2 id="enunciado">Enunciado</h2>
<p>Como me gusta resolver los problemas concretos y no los abstractos, veamos cómo usar DBUnit con una base de datos en memoria. Para ello utilizaremos un pequeño gestor de libros con una única tabla, que contendrá el id, título y autor.</p>
<h2 id="datos">Datos</h2>
<p>Nuestros datos serán los siguientes:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;dataset&gt;</span>
    <span class="nt">&lt;book</span> <span class="na">id=</span><span class="s">&#34;1&#34;</span> <span class="na">title=</span><span class="s">&#34;Fundación&#34;</span> <span class="na">author=</span><span class="s">&#34;Isaac Asimov&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;book</span> <span class="na">id=</span><span class="s">&#34;2&#34;</span> <span class="na">title=</span><span class="s">&#34;Clean Code&#34;</span> <span class="na">author=</span><span class="s">&#34;Robert C. Martin&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;book</span> <span class="na">id=</span><span class="s">&#34;3&#34;</span> <span class="na">title=</span><span class="s">&#34;Diseño ágil con TDD&#34;</span> <span class="na">author=</span><span class="s">&#34;Carlos Ble&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/dataset&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Aquí ya estamos diseñando. Lo que le estamos diciendo a DBUnit es que vamos a tener una tabla &ldquo;book&rdquo; con 3 columnas, que son &ldquo;id&rdquo;, &ldquo;title&rdquo; y &ldquo;author&rdquo;.</p>
<p>El archivo anterior se situará en el paquete &ldquo;tests&rdquo;, de manera que se empaquetará en el JAR con nuestras pruebas.</p>
<h2 id="código">Código</h2>
<p>Veamos ahora cómo indicárselo a DBUnit:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">test1</span> <span class="kd">extends</span> <span class="n">DBTestCase</span> <span class="o">{</span>
    <span class="kd">static</span>
    <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">driver</span> <span class="o">=</span> <span class="s">&#34;org.hsqldb.jdbcDriver&#34;</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">&#34;jdbc:hsqldb:mem:sample&#34;</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">user</span> <span class="o">=</span><span class="s">&#34;sa&#34;</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">pass</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="o">;</span>

            <span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">PropertiesBasedJdbcDatabaseTester</span><span class="o">.</span><span class="na">DBUNIT_DRIVER_CLASS</span><span class="o">,</span> <span class="n">driver</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">PropertiesBasedJdbcDatabaseTester</span><span class="o">.</span><span class="na">DBUNIT_USERNAME</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">PropertiesBasedJdbcDatabaseTester</span><span class="o">.</span><span class="na">DBUNIT_PASSWORD</span><span class="o">,</span> <span class="n">pass</span><span class="o">);</span>

            <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">driver</span><span class="o">);</span>
            <span class="n">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">pass</span><span class="o">);</span>
            <span class="n">st</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&#34;create table book (&#34;</span>
                    <span class="o">+</span> <span class="s">&#34;id integer, &#34;</span>
                    <span class="o">+</span> <span class="s">&#34;title varchar(50), &#34;</span>
                    <span class="o">+</span> <span class="s">&#34;author varchar(50)&#34;</span>
                    <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="o">);</span>
            <span class="n">con</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">IDataSet</span> <span class="nf">getDataSet</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">InputStream</span> <span class="n">file</span> <span class="o">=</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&#34;/tests/test1.xml&#34;</span><span class="o">);</span>
        <span class="n">IDataSet</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FlatXmlDataSet</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">IDatabaseConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="n">conn</span><span class="o">.</span><span class="na">getRowCount</span><span class="o">(</span><span class="s">&#34;book&#34;</span><span class="o">));</span>
        <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="desglosando-el-código">Desglosando el código</h3>
<p>Veamos ahora qué es lo que hemos hecho.</p>
<p>Lo primero es indicar que nuestro código hereda de <em>DBTestCase</em>. Eso nos obliga a implementar el método abstracto <em>getDataSet</em>. Este método le indica a DBUnit los datos con los que rellenar la BBDD antes de cada test.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="n">IDataSet</span> <span class="nf">getDataSet</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">InputStream</span> <span class="n">file</span> <span class="o">=</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&#34;/tests/test1.xml&#34;</span><span class="o">);</span>
    <span class="n">IDataSet</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FlatXmlDataSet</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Para ello, cargamos el XML anterior como un &ldquo;FlatXML&rdquo;. Como se encuentra dentro de nuestro propio jar, utilizamos <em>getResourceAsStream</em>.</p>
<p>Ahora es necesario inicializar la conexión a BBDD. Como vamos a utilizar todos los argumentos varias veces, los guardamos en variables:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">driver</span> <span class="o">=</span> <span class="s">&#34;org.hsqldb.jdbcDriver&#34;</span><span class="o">;</span>
<span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">&#34;jdbc:hsqldb:mem:sample&#34;</span><span class="o">;</span>
<span class="n">String</span> <span class="n">user</span> <span class="o">=</span><span class="s">&#34;sa&#34;</span><span class="o">;</span>
<span class="n">String</span> <span class="n">pass</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Es importante rellenar el usuario, ya que DBUnit lo requiere. Como véis,
utilizamos una base de datos en memoria de tipo <a href="https://hsqldb.org/" target="_blank" rel="noopener noreffer">HyperSQL</a> .</p>
<p>Ahora inicializamos DBUnit. Para ello, establecemos variables de entorno:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">PropertiesBasedJdbcDatabaseTester</span><span class="o">.</span><span class="na">DBUNIT_DRIVER_CLASS</span><span class="o">,</span> <span class="n">driver</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">PropertiesBasedJdbcDatabaseTester</span><span class="o">.</span><span class="na">DBUNIT_CONNECTION_URL</span><span class="o">,</span> <span class="n">url</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">PropertiesBasedJdbcDatabaseTester</span><span class="o">.</span><span class="na">DBUNIT_USERNAME</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">PropertiesBasedJdbcDatabaseTester</span><span class="o">.</span><span class="na">DBUNIT_PASSWORD</span><span class="o">,</span> <span class="n">pass</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Con esto sería suficiente como para que DBUnit pueda ejecutarse sin problemas, pero la tabla &ldquo;Book&rdquo; no existe. Así que lo solucionamos con el acceso estándar a BBDD de Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">driver</span><span class="o">);</span>
<span class="n">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">pass</span><span class="o">);</span>
<span class="n">Statement</span> <span class="n">st</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
<span class="n">st</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&#34;create table book (&#34;</span>
        <span class="o">+</span> <span class="s">&#34;id integer, &#34;</span>
        <span class="o">+</span> <span class="s">&#34;title varchar(50), &#34;</span>
        <span class="o">+</span> <span class="s">&#34;author varchar(50)&#34;</span>
        <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="o">);</span>
<span class="n">con</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><p>Y ya está todo listo para nuestros tests.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">IDatabaseConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="n">conn</span><span class="o">.</span><span class="na">getRowCount</span><span class="o">(</span><span class="s">&#34;book&#34;</span><span class="o">));</span>
    <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>En ese caso, obtenemos la conexión (al heredar de <em>DBTestCase</em> tenemos acceso al método <em>getConnection</em>) y comparamos el número de filas en &ldquo;book&rdquo; con 3.</p>
<h2 id="volcado-de-bbdd">Volcado de BBDD</h2>
<p>Lo normal es crear la BBDD que deseamos probar y volcar los datos. Para ello podemos utilizar lo siguiente:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_volcar_flatxml</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">IDatabaseConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
    <span class="n">IDataSet</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createDataSet</span><span class="o">();</span>
    <span class="n">FlatXmlDataSet</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">dataset</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
    <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Además, existe otro formato para el XML utilizado, solo que puede resultar demasiado grande (aunque, técnicamente, más correcto):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_volcar_xml</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">IDatabaseConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
    <span class="n">IDataSet</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createDataSet</span><span class="o">();</span>
    <span class="n">XmlDataSet</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">dataset</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
    <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Que generará algo como:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#39;&#39;1.0&#39;&#39; encoding=&#39;&#39;UTF-8&#39;&#39;?&gt;</span>
<span class="nt">&lt;dataset&gt;</span>
  <span class="nt">&lt;table</span> <span class="na">name=</span><span class="s">&#34;BOOK&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;column&gt;</span>ID<span class="nt">&lt;/column&gt;</span>
    <span class="nt">&lt;column&gt;</span>TITLE<span class="nt">&lt;/column&gt;</span>
    <span class="nt">&lt;column&gt;</span>AUTHOR<span class="nt">&lt;/column&gt;</span>
    <span class="nt">&lt;row&gt;</span>
      <span class="nt">&lt;value&gt;</span>1<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span>Fundación<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span><span class="cp">&lt;![CDATA[Isaac Asimov]]&gt;</span><span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/row&gt;</span>
    <span class="nt">&lt;row&gt;</span>
      <span class="nt">&lt;value&gt;</span>2<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span><span class="cp">&lt;![CDATA[Clean Code]]&gt;</span><span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span><span class="cp">&lt;![CDATA[Robert C. Martin]]&gt;</span><span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/row&gt;</span>
    <span class="nt">&lt;row&gt;</span>
      <span class="nt">&lt;value&gt;</span>3<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span><span class="cp">&lt;![CDATA[Diseño Ágil con TDD]]&gt;</span><span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span><span class="cp">&lt;![CDATA[Carlos Ble]]&gt;</span><span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/row&gt;</span>
  <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/dataset&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="comparando-tablas">Comparando tablas</h2>
<p>Todo lo anterior está muy bien, pero lo que de verdad nos interesa es comparar datos. El uso habitual es:</p>
<ul>
<li>Se cargan unos datos,</li>
<li>se realizan operaciones,</li>
<li>se comprueba que los datos son correctos.</li>
</ul>
<p>Pues esto resulta una tarea sencilla cuando se utiliza dbunit:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_comparar_tablas</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">IDatabaseConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
    <span class="n">InputStream</span> <span class="n">file</span> <span class="o">=</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&#34;/tests/test2.xml&#34;</span><span class="o">);</span>
    <span class="n">IDataSet</span> <span class="n">expected</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FlatXmlDataSet</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
    <span class="n">ITable</span> <span class="n">table</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createQueryTable</span><span class="o">(</span> <span class="s">&#34;books&#34;</span><span class="o">,</span>
            <span class="s">&#34;select * from book where author != &#39;&#39;Isaac Asimov&#39;&#39;&#34;</span><span class="o">);</span>
    <span class="n">Assertion</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">expected</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="s">&#34;book&#34;</span><span class="o">),</span> <span class="n">table</span><span class="o">);</span>
    <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Como se ve, estamos cargamos un nuevo archivo de datos (<em>test2.xml</em>), realizamos una consulta y comparamos los resultados.</p>
<p>El archivo de datos cargado tendrá esta forma (en el paquete &ldquo;tests&rdquo;):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&#34;1.0&#34;</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="n">dataset</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">book</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="n">title</span><span class="o">=</span><span class="s">&#34;Clean Code&#34;</span> <span class="n">author</span><span class="o">=</span><span class="s">&#34;Robert C. Martin&#34;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">book</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;3&#34;</span> <span class="n">title</span><span class="o">=</span><span class="s">&#34;Diseño Ágil con TDD&#34;</span> <span class="n">author</span><span class="o">=</span><span class="s">&#34;Carlos Ble&#34;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">dataset</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="a-tener-en-cuenta">A tener en cuenta</h2>
<p>Hay varios puntos a tener en cuenta:</p>
<ul>
<li>Si nuestros tests no comienzan por <em>test</em>, no se ejecutarán (formato de junit 3).</li>
<li>Podemos utilizar una BBDD en memoria para probar datos para no modificar la BBDD real. Además, resultará más rápido y cómodo.</li>
<li>Cuanto más pequeños sean los archivos de pruebas, serán menos propensos a cambios y más rápidos de ejecutar</li>
</ul>
<h2 id="más-información">Más información</h2>
<p>Tenéis más información en la web de <a href="https://www.dbunit.org/" target="_blank" rel="noopener noreffer">DBUnit</a> , en la de <a href="https://www.junit.org/" target="_blank" rel="noopener noreffer">JUnit</a>  y en la de
<a href="https://hsqldb.org/" target="_blank" rel="noopener noreffer">HyperSQL</a> . También podría haberse hecho con <a href="https://db.apache.org/derby/" target="_blank" rel="noopener noreffer">Derby</a> , como <a href="https://magmax.org/blog/apache-derby/" rel="">ya comenté</a>.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Actualizado el 28 Jan 2021</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartir en Twitter" data-sharer="twitter" data-url="https://magmax.org/blog/hsqldb-dbunit/" data-title="Pruebas con Bases de Datos en memoria: DBUnit &#43; HSQLDB" data-hashtags="dbunit,db testing,hsqldb,sql"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Facebook" data-sharer="facebook" data-url="https://magmax.org/blog/hsqldb-dbunit/" data-hashtag="dbunit"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Linkedin" data-sharer="linkedin" data-url="https://magmax.org/blog/hsqldb-dbunit/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en WhatsApp" data-sharer="whatsapp" data-url="https://magmax.org/blog/hsqldb-dbunit/" data-title="Pruebas con Bases de Datos en memoria: DBUnit &#43; HSQLDB" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Tumblr" data-sharer="tumblr" data-url="https://magmax.org/blog/hsqldb-dbunit/" data-title="Pruebas con Bases de Datos en memoria: DBUnit &#43; HSQLDB" data-tags="dbunit,db testing,hsqldb,sql"><i class="fab fa-tumblr fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Reddit" data-sharer="reddit" data-url="https://magmax.org/blog/hsqldb-dbunit/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Instapaper" data-sharer="instapaper" data-url="https://magmax.org/blog/hsqldb-dbunit/" data-title="Pruebas con Bases de Datos en memoria: DBUnit &#43; HSQLDB" data-description=""><i data-svg-src="/lib/simple-icons/icons/instapaper.min.svg"></i></a><a href="javascript:void(0);" title="Compartir en Digg" data-sharer="digg" data-url="https://magmax.org/blog/hsqldb-dbunit/"><i class="fab fa-digg fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Blogger" data-sharer="blogger" data-url="https://magmax.org/blog/hsqldb-dbunit/" data-title="Pruebas con Bases de Datos en memoria: DBUnit &#43; HSQLDB" data-description=""><i class="fab fa-blogger fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/dbunit/">dbunit</a>,&nbsp;<a href="/tags/db-testing/">db testing</a>,&nbsp;<a href="/tags/hsqldb/">hsqldb</a>,&nbsp;<a href="/tags/sql/">sql</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Regresar</a></span>&nbsp;|&nbsp;<span><a href="/">Inicio</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/formatos-simples/" class="prev" rel="prev" title="Formatos simples: XML, Yaml, Json, Properties e &#39;Ini&#39;"><i class="fas fa-angle-left fa-fw"></i>Formatos simples: XML, Yaml, Json, Properties e &#39;Ini&#39;</a>
            <a href="/blog/buenas-practicas-c-2/" class="next" rel="next" title="Buenas prácticas en Ansi C (2)">Buenas prácticas en Ansi C (2)<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Provisto por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.79.1">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Miguel Ángel</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Volver arriba">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentarios">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copiar al portapapeles","maxShownLines":10},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
