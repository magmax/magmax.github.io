<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Cache-Control" content="max-age=43200">
<meta http-equiv="ETag" content="b'9d3a2c636e1f062842af3aff686491e3efba2446'">
<title>Tablas en Drupal: Haciendo una tabla perfecta | MagMax Blog</title>
<link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="/assets/css/code.css" rel="stylesheet" type="text/css">
<link href="/assets/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="/assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="/assets/css/custom.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/magmax">
<link rel="canonical" href="http://magmax.org/blog/drupal-tabla-perfecta/">
<link rel="icon" href="/favicon.png" sizes="128x128">
<link rel="icon" href="/favicon_330.png" sizes="330x330">
<link rel="icon" href="/favicon.ico" sizes="16x16">
<meta name="author" content="Miguel Ángel García">
<link rel="prev" href="/blog/google-adiccion/" title="Google-Adicción" type="text/html">
<link rel="next" href="/blog/derechos-fundamentales-internet/" title="Derechos fundamentales de Internet" type="text/html">
<meta property="og:site_name" content="MagMax Blog">
<meta property="og:title" content="Tablas en Drupal: Haciendo una tabla perfecta">
<meta property="og:url" content="http://magmax.org/blog/drupal-tabla-perfecta/">
<meta property="og:description" content='Sobre el artículo
Este artículo, basado en el original "Tables in Drupal: Making a perfect table", escrito por Kevin Bowler, ha sido traducido por Miguel Ángel García al español.
El copyright pertenec'>
<meta property="og:type" content="article">
<meta property="article:author" content="Miguel Ángel García">
<meta property="article:published_time" content="2009-12-18T00:00:00+00:00">
<meta property="article:updated" content="2009-12-18T00:00:00">
<meta property="article:tag" content="drupal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@magmax">
<meta name="twitter:creator" content="@magmax">
<meta name="twitter:title" content="MagMax Blog">
<meta name="twitter:description" content="El blog de un Ingeniero Informático: tutoriales, manuales, opiniones, comparativas, ...">
<meta name="twitter:url" content="http://magmax.org//blog/drupal-tabla-perfecta/">
<meta name="twitter:image" content="http://magmax.org/favicon.png">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="container">
<!-- This keeps the margins nice -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://magmax.org/">

        <span id="blog-title">MagMax Blog</span>
      </a>
    </div>
<!-- /.navbar-header -->
    <div class="collapse navbar-collapse navbar-ex1-collapse">
      <ul class="nav navbar-nav">
<li>
<a href="/">Inicio</a>
                </li>
<li>
<a href="/archive.html">Archivo</a>
                </li>
<li>
<a href="/categories">Categorías</a>
                </li>
<li>
<a href="/projects">Proyectos</a>
                </li>
<li>
<a href="/news">Posts Externos</a>

        
      </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
<form class="navbar-form navbar-left" role="search" action="http://google.com/search" method="get">
<div class="form-group">
<input type="hidden" name="sitesearch" value="magmax.org"><input type="text" name="q" class="form-control" placeholder="Search / Buscar">
</div>
</form>
</li>

        <li style="margin-left:0">
          <a href="http://feeds.feedburner.com/magmax">
            <img src="/assets/images/rss.png" style="width:22px;height:22px"></a>
        </li>

        
      </ul>
</div>
<!-- /.navbar-collapse -->
  </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
  <div class="body-content">
    <div class="row">
      <div class="page-content col-md-9">
        
        <article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="/blog/drupal-tabla-perfecta/" class="u-url">Tablas en Drupal: Haciendo una tabla perfecta</a></h1>
            <div class="metadata text-muted">
              <i class="glyphicon glyphicon-calendar"></i>
              <p class="dateline">
                <time class="published dt-published" datetime="2009-12-18T00:00:00+00:00" title="2009-12-18">2009-12-18</time>
                // <time class="updated dt-updated" datetime="2009-12-18T00:00:00" title="2009-12-18">2009-12-18</time></p>
              <p class="commentline">            <a href="/blog/drupal-tabla-perfecta/#disqus_thread" data-disqus-identifier="cache/posts/drupal-tabla-perfecta.html">Comments</a>

</p>
              <address class="vcard author"><a class="url fn" href="http://magmax.org">Miguel Ángel García</a></address>
            </div>
            <br></header><div class="e-content entry-content" itemprop="articleBody text">
            <div>
<h2 id="sobre-el-articulo">Sobre el artículo</h2>
<p>Este artículo, basado en el original "<a href="http://www.kpbowler.co.uk/perfect-tables-in-drupal" title="Tables in Drupal: Making a perfect table">Tables in Drupal: Making a perfect table</a>", escrito por <a href="http://www.kpbowler.co.uk/" title="Página personal de Kevin Bowler">Kevin Bowler</a>, ha sido traducido por <a href="http://www.magmax.org" title="MagMax Blog">Miguel Ángel García</a> al español.</p>
<p>El copyright pertenece a <a href="http://www.kpbowler.co.uk/" title="Página personal de Kevin Bowler">Kevin Bowler</a>, por lo que deberán dirigirse a éste para los agradecimientos y cualquier comentario sobre el código.</p>
<p>Por favor, use el foro en castellano únicamente para comentarios sobre la traducción.</p>
<!-- TEASER_END -->

<h2 id="alguna-vez-has">¿Alguna vez has...?</h2>
<p>¿Alguna vez ha querido hacer una tabla en Drupal usando <code>theme_table</code>? Bien, ¿qué tal si le añadimos unos links extra, por ejemplo para opciones (Edit/Delete etc)? ¿Y si la ordenamos? ¿Algo de paginación? Bien, este tutorial le mostrará cómo hacer todo esto. ¡Después de esto será el máster de las Tablas en Drupal!</p>
<h2 id="paso-1-difinir-las-cabeceras">Paso 1: Difinir las cabeceras</h2>
<p>¿Cuáles son los nombres de las columnas?</p>
<p>Suena estúpido, pero será útil más adelante durante el proceso.</p>
<p>Puede encontrarlos buscando la tabla correspondiente en su base de datos.</p>
<p>Debería terminar con un array de cabeceras como éste:</p>
<pre class="code literal-block"><span class="x">$headers = array("data" =&gt; t([field_name]));</span>
</pre>


<p>Claro que es necesario sustituir el texto entre corchetes con el nombre del campo de la base de datos.</p>
<h2 id="paso-2-define-los-extras">Paso 2: Define los extras</h2>
<p>Los extras son las acciones que se quieren realizar sobre los datos, como editar o borrar el dato.</p>
<p>La manera más limpia y clara de hacer esto es crear una función de ayuda separada a la que se pueda llamar mientras se construye la tabla principal.</p>
<pre class="code literal-block"><span class="x">/**</span>
<span class="x">* Función de utilidad para construir enlaces para la tabla</span>
<span class="x">*/</span>
<span class="x">function _generate_options ( $id )</span>
<span class="x">{</span>
<span class="x">  $links = l(t('Edit'), "admin/settings/data/edit/$id") ."&amp;nbsp;&amp;nbsp;" . l(t('Remove'), "admon/settings/data/remove/$id");</span>
<span class="x">  return $links;</span>
<span class="x">}</span>
</pre>


<p>Realmente no es demasiado código, y se observa que puede ser muy manejable. Simplemente construya un enlace (utilizando la función <code>l()</code> ) con acciones basadas en las elecciones de la cabecera, y añada el id de la columna en el enlace, con el fin de asegurar que se actúa sobre el elemento correcto.</p>
<p>Uso el subrayado al principio del nombre de la función para marcar que es una función 'privada'; sólo se va a utilizar de forma interna en este módulo.</p>
<p>Esta función se llamará en el paso 4, durante el proceso de los datos para construir la tabla actual.</p>
<h2 id="paso-3-ejecuta-la-consulta">Paso 3: Ejecuta la consulta</h2>
<p>Ahora tenemos que extablecer la consulta para obtener todos los datos de nuestra deseada tabla.</p>
<pre class="code literal-block"><span class="x">$sql = "SELECT [fields] FROM {table}";</span>
</pre>


<p>Como puede observarse, no es una query demasiado compleja. Puede pensarse que es ineficiente, y así es.</p>
<p>Dejaremos que Drupal se ocupe de esto más adelante (paso 6).</p>
<h2 id="paso-4-procesado-de-datos">Paso 4: Procesado de datos</h2>
<p>Es en este paso cuando transforman los datos de base de datos en un array, preparado para ser introducido con un tema en una tabla.</p>
<pre class="code literal-block"><span class="x">// ejecutar la query</span>
<span class="x">$result = db_query ( $sql );</span>
<span class="x">if ( $result )</span>
<span class="x">{</span>
<span class="x">  // Establecer el array de datos</span>
<span class="x">  $data = '';</span>
<span class="x">  $i = 1;</span>
<span class="x">  // Bucle básico para obtener los datos</span>
<span class="x">  while ( $tmp = db_fetch_array ( $result ) )</span>
<span class="x">  {</span>
<span class="x">    $data[$i] = $tmp;</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre>


<p>Puede ser tan simple o tan complejo como se desee. Aquí sólo se cubrirá un ejemplo de personalización.</p>
<h3 id="eliminando-el-id">Eliminando el ID</h3>
<p>A veces no se desea mostrar al usuario el ID de un elemento, pero se necesita para generar la URL o los extras.</p>
<p>De esta manera, después de usarlo en el código anterior se puede 'desestablecer'.</p>
<p>Simplemente inserte la línea siguiente al final del bucle while ( ¡¡¡ pero dentro de él !!! ):</p>
<pre class="code literal-block"><span class="x">unset ( $data[$i]['id'] );</span>
</pre>


<p>Ahora el ID no requiere una cabecera, por lo que no es necesario seleccionar el ID en la query y no tiene que mostrarse al usuario cómo se ordenan los datos.</p>
<h2 id="paso-5-establecer-un-tema-para-la-salida">Paso 5: Establecer un tema para la salida</h2>
<p>De esta forma, ahora vamos a establecer un tema para la salida, y obtendremos una tabla básica:</p>
<pre class="code literal-block"><span class="x">theme ( 'table', $headers, $data );</span>
</pre>


<p>Lo que se está haciendo es llamar a la función <code>theme</code>, y pasarle el tipo del elemento a renderizar, en nuestro caso una tabla.</p>
<p>Esto llama a la función interna para el tema de la tabla, llamada <code>theme_table()</code>, y se le pasan los dos parámetros; el array de cabeceras, y el array de datos (ambos definidos antes en el código).</p>
<p>Si lo único que busca es una tabla simple, puede dejarlo aquí.</p>
<p>De todas maneras, es muy fácil añadirle algunas características interesantes a la tabla, de forma que impresione a la gente con su asistente de tablas Drupal, ¡por lo que siga leyendo!</p>
<h2 id="paso-6-el-paginador">Paso 6: El paginador</h2>
<p>Ok, esta tabla está bien, pero ¿qué ocurre si tiene 1.000 registros? ¡Eso hace una página muuuuuuuuuy larga, y una consulta masivamente ineficiente! ¡Pobre servidor de bases de datos!</p>
<p>Así, se le puede pedir a Drupal que añada un paginador a nuestra consulta, y sólo devuelva cada vez un número de filas predefinido:</p>
<pre class="code literal-block"><span class="x">$limit = 10;</span>
<span class="x">// generar una consulta paginada</span>
<span class="x">$result = pager_query ( $sql, $limit );</span>
</pre>


<p>¿Parece simple? Bien. Lo es. Lo único que estamos haciendo es reemplazar la llamada a <code>db_query</code> con una llamada a <code>pager_query</code>, y pasándola un límite, o el número de filas a devolver por página.</p>
<p>Si quería ser realmente listo, este valor se podría establecer en una página de administracción, y añadida aquí usando <code>variable_get</code> (Le dejaré éste a usted, ¡no me gustaría fastidiarle toda la diversión!).</p>
<p>Ésta es una de las cosas a hacer antes de que nuestro paginador funcione. Hay que establecer el tema de la salida como una tabla paginada.</p>
<p>No se preocupe, no es difícil, y no requiere cambiar mucho código.</p>
<p>Todo lo que haremos es reemplazar la llamada actual a <code>theme</code> por:</p>
<pre class="code literal-block"><span class="x">$output = theme (</span>
<span class="x">  'table',</span>
<span class="x">  $headers,</span>
<span class="x">  $data</span>
<span class="x">);</span>
<span class="x">$output .= theme ( 'pager', NULL, $limit, 0 );</span>
<span class="x">print theme ( 'page', $output );</span>
</pre>


<p>¿Qué es lo que estamos haciendo aquí?</p>
<ol>
<li>Llamar a <code>theme</code> para establecer el tema de nuestra tabla original, y almacenando el resultado en una variable.</li>
<li>Añadir el paginador a esa variable llamando a <code>theme_pager</code>, pero esta vez usando 'pager' como tipo, para así llamar a la función con subrayado <code>theme_pager</code>, y concatenarlo con nuestra variable.</li>
<li>Finalmente, establecemos el tema a la salida como una página a renderizar lista para mostrar.</li>
</ol>
<p>Simple, ¿no?</p>
<h2 id="paso-7-ordenacion">Paso 7: Ordenación</h2>
<p>El paso final en la ruta de la Tabla Zen es la ordenación de la tabla. ¿No estaría bien poder ordenar por un campo específico distinto del ID, o simplemente cambiar el orden de la tabla, al vuelo?</p>
<p>Bien, con unos pocos cambios en nuestro código, ¡podemos!</p>
<p>¿Recuerda el array de cabeceras que creamos anteriormente? Bien, ahora nos va a venir de perlas.</p>
<p>Para que la ordenación de la tabla funcione, tenemos que indicarle cómo ordenar los datos. Se hace con el array de cabeceras. Simplemente se le da a cada cabecera (que es el nombre del campo en la base de datos) el orden por el que ordenar los datos.</p>
<p>En el siguiente ejemplo, usaremos el campo 'Name'.</p>
<p>Así, nuestro array de cabeceras queda de la forma:</p>
<pre class="code literal-block"><span class="x">$headers = array (</span>
<span class="x">  array ( 'data' =&gt; t('name'), 'field' =&gt; 'name', 'sort' =&gt; 'desc' ),</span>
<span class="x">);</span>
</pre>


<p>Esto nos permitirá ordenar por un campo llamado 'name', y ordenar en orden descendiente cuando se pulse sobre la cabecera.</p>
<p>Ahora se requiere añadir la ordenación de las tablas SQL a nuestra SQL original:</p>
<pre class="code literal-block"><span class="x">$sql = "SELECT id, name, state, customer, creator FROM {[table]}";</span>
<span class="x">// añadir el orden mediante la cláusula</span>
<span class="x">$sql .= tablesort_sql ( $headers );</span>
</pre>


<p>Ahora le pasamos esto a nuestra llamada a <code>pager_query</code> y bingo, tenemos una tabla ordenable, paginada y con opciones extra.</p>
<h2 id="aun-mas-lejos">Aún más lejos</h2>
<p>La belleza de Drupal es que puede llegar tan lejos como quiera. Una opción obvia es añadirle la funcionalidad de Arrastrar y Soltar, o envolverlo en una función <code>theme</code>, de manera que todo el código se añada a una página con con una llamada a su propia función de tema, como por ejemplo <code>theme ( 'paged_table', $data );</code>.</p>
<p>Por favor, hágame saber si lo encuentra útil o si ha llegado más lejos.</p>
<p>En futuras semanas iré comentando cómo definir sus propios elementos personalizables como mencioné más arriba.</p>
<p>¡Feliz codificación!</p>
<h2 id="nt">N.T.</h2>
<p>En el código, los literales se han mantenido en inglés. Así lo recomienda la gente de Drupal, ya que el inglés es el idioma oficial de Drupal. Las traducciones al resto de idiomas se realizarán todas de la misma manera, con el inglés como base.</p>
</div>
          </div>
          <br><div>
            <nav><span class="author">
                <span class="glyphicon glyphicon-user"></span> 
                <span>Publicado:Miguel Ángel García</span>
              </span>
               

              
              <span class="dateline">
                <span class="glyphicon glyphicon-calendar"></span> 
                <time class="published dt-published" datetime="2009-12-18T00:00:00+00:00" title="2009-12-18">2009-12-18</time></span>
               
              <span class="tags">
                <span class="glyphicon glyphicon-tags"></span> 
                <a class="label label-primary p-category" href="/categories/drupal/" rel="tag">drupal</a>
              </span>
                      <ul class="pager">
<li class="previous">
              <a href="/blog/google-adiccion/" rel="prev" title="Google-Adicción">
                <span class="glyphicon glyphicon-arrow-left"></span>
                Publicación anterior
              </a>
            </li>
            <li class="next">
              <a href="/blog/derechos-fundamentales-internet/" rel="next" title="Derechos fundamentales de Internet">
                Siguiente publicación
                <span class="glyphicon glyphicon-arrow-right"></span>
              </a>
            </li>
        </ul>
<div style="margin-left: auto; margin-right: auto;">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-1887364423515042" data-ad-slot="4236077264"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>
            </nav>
</div>
          <section class="comments"><h2>Comentarios</h2>
                            <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="magmax",
            disqus_url="http://magmax.org/blog/drupal-tabla-perfecta/",
        disqus_title="Tablas en Drupal: Haciendo una tabla perfecta",
        disqus_identifier="cache/posts/drupal-tabla-perfecta.html",
        disqus_config = function () {
            this.language = "es_ES";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


          </section></article><script>var disqus_shortname="magmax";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
      <aside class="sidebar col-md-3"><div>
<section class="panel panel-default"><div class="panel-body">
    <div id="recentcomments" class="dsq-widget">
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:inline-block;width:180px;height:150px" data-ad-client="ca-pub-1887364423515042" data-ad-slot="7479875641"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
</div>
  </div>
</section>
</div>
          <div>
<section class="panel panel-default"><div class="panel-heading">
    <h3 class="panel-title">Last comments</h3>
  </div>
  <div class="panel-body">
    <div id="disqus_last_comments" class="dsq-widget">
      <script type="text/javascript" src="http://magmax.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=32&amp;excerpt_length=150">
      </script>
</div>
  </div>
</section>
</div>
          <div>
<section class="panel panel-default"><div class="panel-heading">
    <h3 class="panel-title">GitHub Repos</h3>
  </div>
  <div class="panel-body">
    <ul id="gh_repos" class="list-unstyled">
<li class="loading">Status updating…</li>
    </ul>
</div>
  <div class="panel-footer">
    <a href="https://github.com/magmax">@magmax</a> on GitHub
  </div>
</section>
</div>
      </aside>
</div>

    <footer>
      Contents © 2009-2016 <a href="mailto:">Miguel Ángel García</a> 
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/es/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;width:80px;height:15px;vertical-align:middle" src="https://i.creativecommons.org/l/by-nc-sa/2.5/es/80x15.png"></a>; Using <a href="/stories/credits/">a lot of free software</a>
      
    </footer>
</div>
</div>




<script data-main="/assets/js/main" src="/assets/js/libs/require/require.min.js"></script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9308241-3', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
