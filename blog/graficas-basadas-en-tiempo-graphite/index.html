<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Gráficas basadas en tiempo: Graphite - El blog de MagMax</title><meta name="Description" content="Pequeña introducción a Graphite y Carbon"><meta property="og:title" content="Gráficas basadas en tiempo: Graphite" />
<meta property="og:description" content="Pequeña introducción a Graphite y Carbon" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/graficas-basadas-en-tiempo-graphite/" /><meta property="og:image" content="https://magmax.org/icons/favicon.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-07-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-28T00:00:00+00:00" /><meta property="og:site_name" content="My cool site" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://magmax.org/icons/favicon.png"/>

<meta name="twitter:title" content="Gráficas basadas en tiempo: Graphite"/>
<meta name="twitter:description" content="Pequeña introducción a Graphite y Carbon"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://magmax.org/blog/graficas-basadas-en-tiempo-graphite/" /><link rel="prev" href="https://magmax.org/blog/creando-tu-propia-entidad-certificadora-ssl/" /><link rel="next" href="https://magmax.org/blog/yapsy-un-sistema-de-plugins-pythonico/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Gráficas basadas en tiempo: Graphite",
        "inLanguage": "es",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/magmax.org\/blog\/graficas-basadas-en-tiempo-graphite\/"
        },"genre": "posts","keywords": "graphite, monitoring","wordcount":  1195 ,
        "url": "https:\/\/magmax.org\/blog\/graficas-basadas-en-tiempo-graphite\/","datePublished": "2015-07-05T00:00:00+00:00","dateModified": "2021-01-28T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Miguel Ángel"
            },"description": "Pequeña introducción a Graphite y Carbon"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Inicio </a><a class="menu-item" href="/posts"> Posts </a><a class="menu-item" href="/tags"> Tags </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="Selecciona el lenguage">
                    <i class="fa fa-globe" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/blog/graficas-basadas-en-tiempo-graphite/" selected>Español</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">Inicio</a><a class="menu-item" href="/posts" title="">Posts</a><a class="menu-item" href="/tags" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Selecciona el lenguage">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/blog/graficas-basadas-en-tiempo-graphite/" selected>Español</option></select>
                </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contenido</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Gráficas basadas en tiempo: Graphite</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Miguel Ángel</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="05 Jul 2015">05 Jul 2015</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1195 palabras&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 minutos&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contenido</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#entendiendo-graphite">Entendiendo Graphite</a></li>
    <li><a href="#instalando-graphite">Instalando Graphite</a></li>
    <li><a href="#primeros-pasos-en-graphite">Primeros pasos en Graphite</a>
      <ul>
        <li><a href="#graphite-dashboard">Graphite Dashboard</a></li>
        <li><a href="#graphite-events">Graphite Events</a></li>
      </ul>
    </li>
    <li><a href="#puntos-fuertes-de-graphite">Puntos fuertes de Graphite</a>
      <ul>
        <li><a href="#interfaz-get">Interfaz GET</a></li>
        <li><a href="#interfaz-post">Interfaz POST</a></li>
      </ul>
    </li>
    <li><a href="#ejemplo-de-uso-de-graphite">Ejemplo de uso de Graphite</a></li>
    <li><a href="#conclusión">Conclusión</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>En esta ocasión voy a escribir sobre <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a>, una utilidad para generar gráficas basadas en tiempo.</p>
<p>Una vez tengamos <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a> instalado, se podrá utilizar para distintos usos: contar las visitas a una web, contar las ejecuciones de un programa, medir el tiempo de ejecución de un programa, &hellip;</p>
<p>Veremos que es un programa sencillo de manejar, pero muy potente.</p>
<figure><img src="/images/stats.png"
         alt="Distintos tipos de gráficas"/>
</figure>

<h2 id="entendiendo-graphite">Entendiendo Graphite</h2>
<p>Antes de meternos en harina, es importante tener claros los conceptos.</p>
<p><a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a> es una herramienta <a href="https://www.djangoproject.com/" target="_blank" rel="noopener noreffer ">Django</a> que permite graficar lo almacenado en una base de datos <strong>Round Robin</strong> llamada <code>whisper</code>. También permite guardar <strong>eventos discretos</strong> (luego lo vemos).</p>
<p>Por tanto, podremos mostrar información, pero <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a> no guarda esa
información. Eso se delega en otros servicios, como <a href="https://pypi.python.org/pypi/carbon/" target="_blank" rel="noopener noreffer ">Carbon</a>:</p>
<div hidden>

@startuml graphite-basic-flow
actor "Program 1" as p1
actor "Program 2" as p2
actor Browser
component Carbon
component Graphite
database Whisper

p1 --> Carbon
p2 --> Carbon
Carbon --> Whisper: escribir
Graphite <-- Whisper: leer
Browser --> Graphite
@enduml

</div>

<img src="/diagrams/graphite-basic-flow.png"/>

<p><strong>Whisper</strong> es una base de datos de tipo <strong>Round Robin</strong>. Eso significa que tiene una especie de &ldquo;casillas&rdquo; (<em>slots</em>) que se rellenan cada cierto tiempo. Cuando se han rellenado todas, se comienza otra vez por el principio. De esta manera, el tamaño de la base de datos es siempre fijo, permitiéndonos calcularlo antes de comenzar a medir.</p>
<p>El problema de las bases de datos de este tipo es cuando se reciben varios valores en un <em>slot</em> de tiempo. En estos casos se opta por la media o bien por el último de los valores. El tamaño de estos <em>slots</em> se realiza en el archivo <code>/etc/carbon/storage-schemas.conf</code>. Ejemplo:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="k">[carbon]</span>
</span></span><span class="line"><span class="cl"><span class="na">pattern</span> <span class="o">=</span> <span class="s">^carbon\.</span>
</span></span><span class="line"><span class="cl"><span class="na">retentions</span> <span class="o">=</span> <span class="s">60:90d</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[local]</span>
</span></span><span class="line"><span class="cl"><span class="na">pattern</span> <span class="o">=</span> <span class="s">^local\.</span>
</span></span><span class="line"><span class="cl"><span class="na">retentions</span> <span class="o">=</span> <span class="s">1:1h</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[default_1min_for_1day]</span>
</span></span><span class="line"><span class="cl"><span class="na">pattern</span> <span class="o">=</span> <span class="s">.*</span>
</span></span><span class="line"><span class="cl"><span class="na">retentions</span> <span class="o">=</span> <span class="s">60s:1d</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Como se puede observar, el formato es sencillo.</p>
<p>Existen más piezas en este puzzle, que iremos introduciendo a lo largo de otros posts. Este artículo se centrará en los que se ven.</p>
<h2 id="instalando-graphite">Instalando Graphite</h2>
<p>Como no sólo tenemos que instalar <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a> sino también <a href="https://pypi.python.org/pypi/carbon/" target="_blank" rel="noopener noreffer ">Carbon</a>, lo más sencillo es usar:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt-get install graphite-web graphite-carbon
</span></span></code></pre></td></tr></table>
</div>
</div><p>A continuación tendremos que configurar el <a href="https://www.djangoproject.com/" target="_blank" rel="noopener noreffer ">Django</a> detrás de <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a>. Esta información se encuentra en <code>/usr/share/doc/graphite-web/README.Debian</code>, pero voy a repetirla aquí.</p>
<p>Si sólo queremos probar <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a>, lo más sencillo es hacer, como <code>root</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">su -s /bin/bash -c <span class="s1">&#39;/usr/bin/django-admin runserver --settings graphite.settings 0.0.0.0:8080&#39;</span> _graphite
</span></span></code></pre></td></tr></table>
</div>
</div><p>Eso utiliza el servidor web de <a href="https://www.djangoproject.com/" target="_blank" rel="noopener noreffer ">Django</a> y una base de datos <a href="https://www.sqlite.org/" target="_blank" rel="noopener noreffer ">sqlite</a>, que puede no ser suficiente para producción, pero es ideal para probarlo rápidamente.</p>
<p>En producción, por el contrario, será mejor montarlo de una forma más decente,
usando <a href="https://httpd.apache.org/" target="_blank" rel="noopener noreffer ">Apache httpd</a>, por ejemplo:</p>
<ol>
<li>Instalar <code>wsgi</code> para <a href="https://httpd.apache.org/" target="_blank" rel="noopener noreffer ">Apache httpd</a>:</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt-get install libapache2-mod-wsgi
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>Copiar los valores por defecto que ya nos proporciona el paquete Debian de <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a>:</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cp /usr/share/graphite-web/apache2-graphite.conf /etc/apache2/sites-available/graphite-web.conf
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>Habilitarlo:</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">a2ensite graphite-web
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>Reiniciar apache:</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">service apache2 restart
</span></span></code></pre></td></tr></table>
</div>
</div><p>Si también queremos usar <a href="https://www.mysql.com/" target="_blank" rel="noopener noreffer ">MySQL</a> o <a href="https://www.postgresql.org.es/" target="_blank" rel="noopener noreffer ">PostgreSQL</a> en lugar de <a href="https://www.sqlite.org/" target="_blank" rel="noopener noreffer ">sqlite</a>, tendremos
que modificar la configuración de <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a>, que se encuentra en
<code>/etc/graphite/local_setting.py</code> y que es equivalente a la de cualquier
<a href="https://www.djangoproject.com/" target="_blank" rel="noopener noreffer ">Django</a>.</p>
<p>Si habéis trabajado con <a href="https://www.djangoproject.com/" target="_blank" rel="noopener noreffer ">Django</a>, sabréis que el programa principal se suele
llamar <code>manage.py</code>&hellip; Pues el de <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a> es accesible invocando <code>graphite-manage</code> en su lugar.</p>
<h2 id="primeros-pasos-en-graphite">Primeros pasos en Graphite</h2>
<p>Asumiendo que se ha optado por la vía rápida, ejecutando el <code>runserver</code>, o
bien una configuración similiar, tendremos <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a> escuchando en el puerto 8080, y podremos acceder a él: https://localhost:8080</p>
<p>Probablemente se queje porque la clave <code>SECRET_KEY</code> utilizada es el valor por defecto. Podéis ignorarlo o arreglarlo editando su valor en el archivo <code>/etc/graphite/local_setting.py</code> y poniendo un valor aleatorio y grande.</p>
<p>Pues ya está, ya tenemos <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a> corriendo. No ha sido tan duro.</p>
<p>Como también instalamos <a href="https://pypi.python.org/pypi/carbon/" target="_blank" rel="noopener noreffer ">Carbon</a>, éste ya se ha puesto a insertar valores por su cuenta. En la interfaz, veréis un árbol a la izquierda que podéis ir desplegando. Los nodos pintarán gráficas:</p>
<figure><img src="/images/graphite/graphite_main.png"
         alt="Página por defecto de Graphite"/>
</figure>

<p>Si pensáis que la interfaz es horrible, sólo os diré que la han mejorado desde la última vez que entré.</p>
<p>Abajo tenéis los botones <code>Graph Options</code> y <code>Graph Data</code> permiten modificar la forma de los gráficos u operar sobre los datos. Volveremos sobre esto en la sección de la API.</p>
<p>A la derecha veréis varios botones, donde me centraré en dos: <strong>Dashboard</strong> y <strong>Events</strong>.</p>
<h3 id="graphite-dashboard">Graphite Dashboard</h3>
<p>En un intento por hacer <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a> algo más usable, hicieron el <strong>Dashboard</strong>, que no es más que otra aberración para la vista:</p>
<figure><img src="/images/graphite/graphite_dashboard.png"
         alt="Dashboard de Graphite"/>
</figure>

<p>Al menos tiene <em>completion</em>.</p>
<p>Permite generar paneles y así gestionar varias gráficas de una vez. De todas
maneras, es mejor hacer eso con <a href="https://grafana.org/" target="_blank" rel="noopener noreffer ">Grafana</a>, como veremos en próximos posts.</p>
<h3 id="graphite-events">Graphite Events</h3>
<p>Si hemos pulsado en el botón de <strong>Events</strong>, veremos una página horrible que dice:</p>
<blockquote>
<p>No events. Add events using the admin interface or by posting (eg, curl -X POST https://localhost:8000/events/ -d &lsquo;{&ldquo;what&rdquo;: &ldquo;Something Interesting&rdquo;, &ldquo;tags&rdquo; : &ldquo;tag1 &ldquo;}&rsquo;)</p>
</blockquote>
<p>Recomiendo hacerle caso, aunque tendréis que cambiar el puerto, sólo por probar:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X POST https://localhost:8080/events/ -d <span class="s1">&#39;{&#34;what&#34;: &#34;Something Interesting&#34;, &#34;tags&#34; : &#34;tag1 &#34;}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Y, si recargamos la página, veremos el evento. Esto será útil para registrar
acciones no periódicas: una actualización de configuración, una ejecución de
<a href="https://puppetlabs.com/" target="_blank" rel="noopener noreffer ">Puppet</a>, etc. Veremos más sobre su uso en el post sobre <a href="https://grafana.org/" target="_blank" rel="noopener noreffer ">Grafana</a>.</p>
<h2 id="puntos-fuertes-de-graphite">Puntos fuertes de Graphite</h2>
<p>Algún lector dirá: &ldquo;bueno, pues si la interfaz es tan horrible como dices, ¿por qué nos cuentas todo esto?&rdquo;.</p>
<h3 id="interfaz-get">Interfaz GET</h3>
<p>Y tendría toda la razón, pero es que Graphite tiene una interfaz, accesible por GET, muy versátil y molona.</p>
<p>Por ejemplo&hellip; obtenemos la URL de la imagen anterior, obtendremos:
<code>https://localhost:8080/render/?width=586&amp;height=308&amp;_salt=1436083979.749&amp;target=carbon.agents.nightcrawler-a.avgUpdateTime</code></p>
<p>Vamos por partes:</p>
<ul>
<li><code>https://localhost:8080/render/</code> Punto de acceso a la API</li>
<li><code>width=586</code> Ancho que tendrá la imagen.</li>
<li><code>height=308</code> Alto que tendrá la imagen.</li>
<li><code>_salt=1436083979.749</code> Podéis ignorarlo. Es la semilla utilizada en caso de usar valores aleatorios.</li>
<li><code>target=carbon.agents.nightcrawler-a.avgUpdateTime</code> Lo que se está pintando.</li>
</ul>
<p>El <code>target</code> permite realizar operaciones, tales como sumar diferentes series, filtrar valores, etc. Por ejemplo, para mostrar el percentil 90 de las consultas a la caché de carbon:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">target</span><span class="o">=</span>percentileOfSeries<span class="o">(</span>carbon.agents.nightcrawler-a.cache.queries,0.9<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>También se pueden obtener los valores guardados con el argumento <code>format</code>.
Recomiendo echar un ojo a toda la <a href="https://graphite.readthedocs.org/en/latest/render_api.html" target="_blank" rel="noopener noreffer ">API de Graphite</a>.</p>
<h3 id="interfaz-post">Interfaz POST</h3>
<p>Carbon también tiene una interfaz POST que permite insertar datos en <strong>Whisper</strong>
y así renderizarlos desde <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a>. Por defecto estará escuchando en el puerto 2003:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;local.random.diceroll 4 `date +%s`&#34;</span> <span class="p">|</span> nc -q0 localhost <span class="m">2003</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Como se puede observar, el formato es my sencillo:</p>
<ul>
<li><em>Nombre de la métrica</em>, separando por puntos los distintos niveles. Esto permite generar una especie de árbol, por lo que se recomienda colocar los términos más genéricos al principio y los más específicos al final.</li>
<li><em>Valor</em> de la métrica.</li>
<li><em>timestamp</em>, en formato UNIX</li>
</ul>
<h2 id="ejemplo-de-uso-de-graphite">Ejemplo de uso de Graphite</h2>
<p>Aquí os dejo un pequeño ejemplo de uso:</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/UGTb2J-a_0Q" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>No conté con que <code>$RANDOM</code> se resuelve en el primer shell, por lo que enviaba un valor fijo XD</p>
<h2 id="conclusión">Conclusión</h2>
<p><a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a> es una herramienta mucho más potente de lo que pueda parecer. Lo veremos en próximos posts.</p>
<p>De momento es importante quedarse con la idea principal: generación de gráficos donde el tiempo es el eje X.</p>
<p>En próximos posts veremos cómo graficar información del sistema, cómo embeber
estos gráficos en nuestro sistema de alertas o cómo dar soporte a millones de
métricas por segundo. Y todo basado en <a href="https://graphite.wikidot.com/" target="_blank" rel="noopener noreffer ">Graphite</a>.</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Actualizado el 28 Jan 2021</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartir en Twitter" data-sharer="twitter" data-url="https://magmax.org/blog/graficas-basadas-en-tiempo-graphite/" data-title="Gráficas basadas en tiempo: Graphite" data-via="magmax_en" data-hashtags="graphite,monitoring"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Facebook" data-sharer="facebook" data-url="https://magmax.org/blog/graficas-basadas-en-tiempo-graphite/" data-hashtag="graphite"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Linkedin" data-sharer="linkedin" data-url="https://magmax.org/blog/graficas-basadas-en-tiempo-graphite/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en WhatsApp" data-sharer="whatsapp" data-url="https://magmax.org/blog/graficas-basadas-en-tiempo-graphite/" data-title="Gráficas basadas en tiempo: Graphite" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Tumblr" data-sharer="tumblr" data-url="https://magmax.org/blog/graficas-basadas-en-tiempo-graphite/" data-title="Gráficas basadas en tiempo: Graphite" data-caption="Pequeña introducción a Graphite y Carbon" data-tags="graphite,monitoring"><i class="fab fa-tumblr fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Reddit" data-sharer="reddit" data-url="https://magmax.org/blog/graficas-basadas-en-tiempo-graphite/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Instapaper" data-sharer="instapaper" data-url="https://magmax.org/blog/graficas-basadas-en-tiempo-graphite/" data-title="Gráficas basadas en tiempo: Graphite" data-description="Pequeña introducción a Graphite y Carbon"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/instapaper.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en 微博" data-sharer="weibo" data-url="https://magmax.org/blog/graficas-basadas-en-tiempo-graphite/" data-title="Gráficas basadas en tiempo: Graphite"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartir en Blogger" data-sharer="blogger" data-url="https://magmax.org/blog/graficas-basadas-en-tiempo-graphite/" data-title="Gráficas basadas en tiempo: Graphite" data-description="Pequeña introducción a Graphite y Carbon"><i class="fab fa-blogger fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/graphite/">graphite</a>,&nbsp;<a href="/tags/monitoring/">monitoring</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Regresar</a></span>&nbsp;|&nbsp;<span><a href="/">Inicio</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/creando-tu-propia-entidad-certificadora-ssl/" class="prev" rel="prev" title="Creando tu propia Entidad Certificadora SSL (y volcando certificados autofirmados)"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Creando tu propia Entidad Certificadora SSL (y volcando certificados autofirmados)</a>
            <a href="/blog/yapsy-un-sistema-de-plugins-pythonico/" class="next" rel="next" title="Yapsy, un sistema de plugins pythónico">Yapsy, un sistema de plugins pythónico<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Con la tecnología de <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.119.0">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Miguel Ángel</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Volver arriba">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentarios">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script type="text/javascript" src="https://magmax.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copiar al portapapeles","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-X5FEBMGR06', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-X5FEBMGR06" async></script></body>
</html>
