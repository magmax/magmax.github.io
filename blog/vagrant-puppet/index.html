<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Vagrant y Puppet - El blog de MagMax</title><meta name="Description" content="El blog de un Ingeniero Informático: tutoriales, manuales, opiniones, comparativas, ..."><meta property="og:title" content="Vagrant y Puppet" />
<meta property="og:description" content="Hay mucha gente que tiene que trabajar a diario con más de un ordenador. En ocasiones, tienen cientos. Las máquinas se estropean y hay que reemplazarlas, así que se pierde mucho tiempo en reinstalar el sistema. Incluso si sólo tienes una máquina, siempre se te olvida instalar algo que necesitarás cuando no tengas red.
Una solución es clonar discos, pero eso es poco flexible. Resulta complejo cambiar la versión de un programa en todas las máquinas.
¿Qué sería lo ideal? Pues poder tener la configuración de tu PC en un repositorio Git o Mercurial. Y poder probar la configuración en una máquina virtual." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/vagrant-puppet/" /><meta property="og:image" content="https://magmax.org/icons/favicon.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-05-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-28T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://magmax.org/icons/favicon.png"/>

<meta name="twitter:title" content="Vagrant y Puppet"/>
<meta name="twitter:description" content="Hay mucha gente que tiene que trabajar a diario con más de un ordenador. En ocasiones, tienen cientos. Las máquinas se estropean y hay que reemplazarlas, así que se pierde mucho tiempo en reinstalar el sistema. Incluso si sólo tienes una máquina, siempre se te olvida instalar algo que necesitarás cuando no tengas red.
Una solución es clonar discos, pero eso es poco flexible. Resulta complejo cambiar la versión de un programa en todas las máquinas.
¿Qué sería lo ideal? Pues poder tener la configuración de tu PC en un repositorio Git o Mercurial. Y poder probar la configuración en una máquina virtual."/>
<meta name="application-name" content="El blog de MagMax">
<meta name="apple-mobile-web-app-title" content="El blog de MagMax"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://magmax.org/blog/vagrant-puppet/" /><link rel="prev" href="https://magmax.org/blog/python-curses/" /><link rel="next" href="https://magmax.org/blog/python-compiler-internals/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Vagrant y Puppet",
        "inLanguage": "es",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/magmax.org\/blog\/vagrant-puppet\/"
        },"genre": "posts","keywords": "devops, vagrant, puppet","wordcount":  1868 ,
        "url": "https:\/\/magmax.org\/blog\/vagrant-puppet\/","datePublished": "2012-05-18T00:00:00+00:00","dateModified": "2021-01-28T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "Miguel Ángel"},"author": {
                "@type": "Person",
                "name": "Miguel Ángel"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Inicio </a><a class="menu-item" href="/tags"> Tags </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/blog/vagrant-puppet/" selected>Español</option></select>
                    </a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">Inicio</a><a class="menu-item" href="/tags" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/blog/vagrant-puppet/" selected>Español</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contenido</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Vagrant y Puppet</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Miguel Ángel</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="18 May 2012">18 May 2012</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1868 palabras&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;9 minutos&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contenido</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#antes-que-nada">Antes que nada&hellip;</a></li>
    <li><a href="#vagrant">Vagrant</a></li>
    <li><a href="#puppet">Puppet</a>
      <ul>
        <li><a href="#estructura-básica-de-un-proyecto">Estructura básica de un proyecto</a></li>
        <li><a href="#configuración">Configuración</a></li>
        <li><a href="#módulos">Módulos</a></li>
      </ul>
    </li>
    <li><a href="#lanzándolo">Lanzándolo</a></li>
    <li><a href="#aplicándolo-a-nuestra-máquina">Aplicándolo a nuestra máquina</a></li>
    <li><a href="#ventajas">Ventajas</a></li>
    <li><a href="#inconvenientes">Inconvenientes</a></li>
    <li><a href="#más-información">Más información</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Hay mucha gente que tiene que trabajar a diario con más de un ordenador. En ocasiones, tienen cientos. Las máquinas se estropean y hay que reemplazarlas, así que se pierde mucho tiempo en reinstalar el sistema. Incluso si sólo tienes una máquina, siempre se te olvida instalar algo que necesitarás cuando no tengas red.</p>
<p>Una solución es clonar discos, pero eso es poco flexible. Resulta complejo cambiar la versión de un programa en todas las máquinas.</p>
<p>¿Qué sería lo ideal? Pues poder tener la configuración de tu PC en un repositorio Git o Mercurial. Y poder probar la configuración en una máquina virtual.</p>
<figure><img src="/images/puppet.png"
         alt="Puppet"/>
</figure>

<h2 id="antes-que-nada">Antes que nada&hellip;</h2>
<p>Antes de comenzar, una advertencia: <em>Vamos a hacer cosas peligrosas</em>. Eso significa que puede que se nos reinicie el ordenador o que perdamos datos.</p>
<p>Tras hacer esa advertencia, también os diré que todo será razonablemente seguro y que vamos a trabajar en máquinas virtuales para que no pase, pero no puedo garantizar nada.</p>
<h2 id="vagrant">Vagrant</h2>
<p>Lo primero que necesitamos es un entorno para gestionar máquinas virtuales. Uno de los más utilizados hoy en día es <a href="https://www.virtualbox.org/" target="_blank" rel="noopener noreffer">VirtualBox</a> . Pero nosotros no vamos a necesitar un entorno gráfico ni nada de eso.</p>
<p>VirtualBox tiene soporte para máquinas virtuales <em>headless</em>, es decir, máquinas que &ldquo;están por ahí&rdquo;, pero que no se ven.</p>
<p><a href="https://vagrantup.com/" target="_blank" rel="noopener noreffer">Vagrant</a>  no es más que una interfaz a VirtualBox, pero que nos hace la vida más fácil.</p>
<p>Así que vamos a usar Vagrant. Llegada a esta conclusión, tendríamos dos opciones: instalar una máquina virtual desde cero o coger una ya instalada y partir de ahí. Si optáramos por la primera opción, tendríamos que ver <a href="https://github.com/jedi4ever/veewee" target="_blank" rel="noopener noreffer">VeeWee</a> ; como este artículo va de Puppet, vamos a optar por la segunda opción.</p>
<p>Lo primero: vamos a instalarnos Vagrant:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ sudo gem install vagrant
</code></pre></td></tr></table>
</div>
</div><p>Sí, es Ruby.</p>
<p>Tras pelearme con algunas máquinas virtuales públicas, algunos reinicios y demás, os recomiendo que utilicéis la siguiente:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">$ vagrant box add squeeze32 https://mathie-vagrant-boxes.s3.amazonaws.com/debian_squeeze_32.box
</code></pre></td></tr></table>
</div>
</div><p>Eso tardará un poco, ya que tiene que descargarse 4Gb. Os recomiendo que <em>no</em> utilicéis la wifi. Básicamente, nos descargamos la imagen y la llamamos <em>squeeze32</em>. Eso es importante para referirnos a ella desde el <em>Vagrantfile</em>.</p>
<p>Mientras se descarga, vamos a crearnos una carpeta en alguna parte y a ir configurando Vagrant. El archivo de configuración que yo utilizo tiene el siguiente aspecto (debe llamarse <em>Vagrantfile</em>):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># file: Vagrantfile</span>
<span class="no">Vagrant</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">run</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
	<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;squeeze32&#34;</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>Difícil, ¿eh?</p>
<p>Vamos con el manejo básico de vagrant:</p>
<ul>
<li><em>up</em> levanta nuestra máquina virtual. Eso implica construirla si no existe y <em>provisionarla</em>.</li>
<li><em>destroy</em> mata nuestra máquina virtual y la borra.</li>
<li><em>halt</em> sólo mata nuestra máquina virtual. No lo uséis. Ya se morirá sola y, si vais a apagarla, borradla del todo con <em>destroy</em>. ¡Es más divertido!</li>
<li><em>provision</em> Hará que se ejecute Puppet (cuando lo tengamos configurado). Esto es lo que se llama &ldquo;provisionar&rdquo;.</li>
<li><em>status</em> Muestra las máquinas virtuales existentes y el estado en el que se encuentran.</li>
<li><em>ssh</em> Os conectará por ssh a la máquina virtual.</li>
</ul>
<p>Habría que contar algo sobre usar varias máquinas virtuales y tal, pero esto es un artículo introductorio. Para cosas avanzadas, buscad otra cosa o la propia documentación :D</p>
<p>Vamos con Puppet.</p>
<h2 id="puppet">Puppet</h2>
<p>Este artículo va a ser introductorio, así que me centraré en la estructura básica, la configuración y la instalación de un único paquete sencillo.</p>
<h3 id="estructura-básica-de-un-proyecto">Estructura básica de un proyecto</h3>
<p>La estructura básica es:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">.
├── manifests
│   └── desktop.pp
├── modules
│   └── module
│       ├── files
│       ├── templates
│       └── manifests
└── Vagrantfile
</code></pre></td></tr></table>
</div>
</div><p>El archivo que se encuentra en @manifests/desktop.pp@ va a ser el que defina nuestra máquina. Aquí hacemos un breve paréntesis.</p>
<p>Puppet está pensado para utilizarse en grandes empresas, con cientos o miles de máquinas. Algunas de estas máquinas serán iguales, pero otras serán distintas. Por eso tiene una estructura cliente-servidor segura, mediante claves ssl.</p>
<p>Yo lo estoy contando para un entorno casero, así que olvidaos de eso. Vamos a tener un archivo distinto por cada máquina y no voy a contar nada de <em>nodes</em>. Tan sólo nuestra máquinita y ya. Como tengo un ordenador de escritorio y el que utilizo para viajar, tengo un archivito &ldquo;desktop.pp&rdquo;. Quizá algún día tenga un &ldquo;laptop.pp&rdquo; :D</p>
<h3 id="configuración">Configuración</h3>
<p>La idea es mantener el archivo @desktop.pp@ lo más sencillo posible, de manera que podamos reutilizar su información en otras máquinas. Por eso el mío es así:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># file: manifests/desktop.pp</span>
<span class="n">stage</span> <span class="p">{</span> <span class="o">[</span><span class="n">apt</span><span class="p">,</span> <span class="n">pre</span><span class="p">,</span> <span class="n">post</span><span class="o">]</span><span class="p">:</span> <span class="p">}</span>
<span class="no">Stage</span><span class="o">[</span><span class="n">apt</span><span class="o">]</span> <span class="o">-&gt;</span> <span class="no">Stage</span><span class="o">[</span><span class="n">pre</span><span class="o">]</span> <span class="o">-&gt;</span> <span class="no">Stage</span><span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="o">-&gt;</span> <span class="no">Stage</span><span class="o">[</span><span class="n">post</span><span class="o">]</span>

<span class="k">class</span> <span class="p">{</span> <span class="s1">&#39;apt&#39;</span><span class="p">:</span> <span class="n">stage</span> <span class="o">=&gt;</span> <span class="n">apt</span> <span class="p">}</span>
<span class="k">class</span> <span class="p">{</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Lo que hago es definirme 3 etapas: apt, pre y post; después establezco el orden de las etapas, relativas a <em>main</em>. Puppet no tiene orden de ejecución, pero hay cosas que hay que hacer antes que nada. Yo, por ejemplo, quiero que se me actualice APT antes de comenzar a trabajar.</p>
<p>A continuación declaro las clases a utilizar. Queda claro que quiero la clase &ldquo;apt&rdquo; que se ejecutará en la etapa &ldquo;apt&rdquo; (derrocho imaginación).</p>
<p>Finalmente, incluyo también la clase &ldquo;kernel&rdquo;, que me instalará el núcleo. Evidentemente, para usarlo tendré que reiniciar, pero me hace ilusión tener instalada la última versión.</p>
<h3 id="módulos">Módulos</h3>
<p>Ahora hay que definir los módulos. Comenzaremos por APT. la definición está en @modules/apt/manifests/init.pp@. Siempre, los manifiestos se llamarán <em>init.pp</em> y estarán en la carpeta <em>manifests</em>, dentro de nuestro módulo. Este archivo contendrá:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># file: modules/apt/manifests/init.pp</span>
<span class="k">class</span> <span class="n">apt</span> <span class="p">{</span>
  <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;sources.list&#39;</span><span class="p">:</span>
    <span class="n">path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc/apt/sources.list&#39;</span><span class="p">,</span>
    <span class="n">source</span> <span class="o">=&gt;</span> <span class="s1">&#39;puppet:///modules/apt/sources.list&#39;</span><span class="p">,</span>
    <span class="n">owner</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="n">replace</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="nb">exec</span> <span class="p">{</span> <span class="s1">&#39;update&#39;</span><span class="p">:</span>
    <span class="n">path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/bin&#39;</span><span class="p">,</span>
    <span class="n">command</span> <span class="o">=&gt;</span> <span class="s1">&#39;apt-get update&#39;</span><span class="p">,</span>
    <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;sources.list&#39;</span><span class="o">]</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Esto es lo más dificil que vamos a hacer y lo más sencillo de explicar. Como véis, el módulo APT necesita un fichero de configuración y ejecutar una orden. El fichero será el @sources.list@, claro :D</p>
<p>No hay mucho que contar, tan solo que sobreescribo el @sources.list@ y después lanzo un update. Estos requisitos se ejecutarán sin orden fijo, así que tengo que forzar un orden mediante la orden <em>require</em>.</p>
<p>Claro, el archivo que quiero instalar tiene que estar en el directorio <em>files</em> (mirad la estructura más arriba). Y tendrá algo como esto:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"># file: modules/apt/files/sources.list
deb https://ftp.es.debian.org/debian unstable main contrib non-free
</code></pre></td></tr></table>
</div>
</div><p>Ahora vamos a configurar el módulo del <em>kernel</em>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># file: modules/kernel/manifests/init.pp</span>
<span class="k">class</span> <span class="n">kernel</span> <span class="p">{</span>
  <span class="n">package</span> <span class="p">{</span> <span class="s1">&#39;linux-image-amd64&#39;</span><span class="p">:</span>
    <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">latest</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">package</span> <span class="p">{</span> <span class="s1">&#39;linux-headers-amd64&#39;</span><span class="p">:</span>
    <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">latest</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Como véis, es una clase que necesitará dos paquetes: el kernel y las headers. Y me aseguro de tener instalada la última versión.</p>
<h2 id="lanzándolo">Lanzándolo</h2>
<p>Bueno, ya lo tenemos todo configurado, así que hay que decirle a Vagrant que lance a Puppet:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># file: Vagrantfile</span>
<span class="no">Vagrant</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">run</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
	<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;squeeze32&#34;</span>
	<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:puppet</span> <span class="k">do</span> <span class="o">|</span><span class="n">puppet</span><span class="o">|</span>
		<span class="n">puppet</span><span class="o">.</span><span class="n">manifests_path</span> <span class="o">=</span> <span class="s2">&#34;manifests&#34;</span>
		<span class="n">puppet</span><span class="o">.</span><span class="n">module_path</span> <span class="o">=</span> <span class="s2">&#34;modules&#34;</span>
		<span class="n">puppet</span><span class="o">.</span><span class="n">manifest_file</span> <span class="o">=</span> <span class="s2">&#34;desktop.pp&#34;</span>
	<span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>Bueeeeeeeeeeeno. Pues ya está todo. Vamos con la magia:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ vagrant up
</code></pre></td></tr></table>
</div>
</div><p>Y flipad con los mensajes de pantalla. Nos dejará una máquina perfectamente configurada:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ vagrant up
<span class="o">[</span>default<span class="o">]</span> Importing base box <span class="s1">&#39;squeeze32&#39;</span>...
<span class="o">[</span>default<span class="o">]</span> The guest additions on this VM <span class="k">do</span> not match the install version of
VirtualBox! This may cause things such as forwarded ports, shared
folders, and more to not work properly. If any of those things fail on
this machine, please update the guest additions and repackage the
box.

Guest Additions Version: 4.0.4
VirtualBox Version: 4.1.14
<span class="o">[</span>default<span class="o">]</span> Matching MAC address <span class="k">for</span> NAT networking...
<span class="o">[</span>default<span class="o">]</span> Clearing any previously <span class="nb">set</span> forwarded ports...
<span class="o">[</span>default<span class="o">]</span> Forwarding ports...
<span class="o">[</span>default<span class="o">]</span> -- <span class="nv">22</span> <span class="o">=</span>&gt; <span class="m">2222</span> <span class="o">(</span>adapter 1<span class="o">)</span>
<span class="o">[</span>default<span class="o">]</span> Creating shared folders metadata...
<span class="o">[</span>default<span class="o">]</span> Clearing any previously <span class="nb">set</span> network interfaces...
<span class="o">[</span>default<span class="o">]</span> Booting VM...
<span class="o">[</span>default<span class="o">]</span> Waiting <span class="k">for</span> VM to boot. This can take a few minutes.
<span class="o">[</span>default<span class="o">]</span> VM booted and ready <span class="k">for</span> use!
<span class="o">[</span>default<span class="o">]</span> Mounting shared folders...
<span class="o">[</span>default<span class="o">]</span> -- v-root: /vagrant
<span class="o">[</span>default<span class="o">]</span> -- manifests: /tmp/vagrant-puppet/manifests
<span class="o">[</span>default<span class="o">]</span> -- v-pp-m0: /tmp/vagrant-puppet/modules-0
<span class="o">[</span>default<span class="o">]</span> Running provisioner: Vagrant::Provisioners::Puppet...
<span class="o">[</span>default<span class="o">]</span> Running Puppet with /tmp/vagrant-puppet/manifests/desktop.pp...
stdin: is not a tty
notice: /Stage<span class="o">[</span>apt<span class="o">]</span>/Apt/File<span class="o">[</span>sources.list<span class="o">]</span>/content: content changed <span class="s1">&#39;{md5}c6f69c7769cbbd3b3c938217487efa02&#39;</span> to <span class="s1">&#39;{md5}509cf608fd519f230246df247418b7b2&#39;</span>

notice: /Stage<span class="o">[</span>apt<span class="o">]</span>/Apt/File<span class="o">[</span>sources.list<span class="o">]</span>/group: group changed <span class="s1">&#39;root&#39;</span> to <span class="s1">&#39;vagrant&#39;</span>

notice: /Stage<span class="o">[</span>apt<span class="o">]</span>/Apt/Exec<span class="o">[</span>update<span class="o">]</span>/returns: executed successfully

notice: /Stage<span class="o">[</span>main<span class="o">]</span>/Kernel/Package<span class="o">[</span>linux-image-amd64<span class="o">]</span>/ensure: ensure changed <span class="s1">&#39;purged&#39;</span> to <span class="s1">&#39;latest&#39;</span>

notice: /Stage<span class="o">[</span>main<span class="o">]</span>/Kernel/Package<span class="o">[</span>linux-headers-amd64<span class="o">]</span>/ensure: ensure changed <span class="s1">&#39;purged&#39;</span> to <span class="s1">&#39;latest&#39;</span>
$
</code></pre></td></tr></table>
</div>
</div><h2 id="aplicándolo-a-nuestra-máquina">Aplicándolo a nuestra máquina</h2>
<p><em>NOTA</em>: Mucho ojo. Si seguís estos pasos, es perfectamente posible que rompáis vuestra máquina. ¡Sobreescribiríais el @sources.list@!</p>
<p>Como todas las operaciones que realizamos requieren ser root, si lo ejecutamos como usuarios normales no debería ocurrir nada, pero insisto una vez más: <em>si ejecutas esto es bajo tu cuenta y riesgo</em>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># puppet apply manifests/desktop.pp --modulepath=modules/</span>
</code></pre></td></tr></table>
</div>
</div><p>Poco que contar: le pedimos a puppet que aplique nuestra configuración y le indicamos dónde están los módulos.</p>
<h2 id="ventajas">Ventajas</h2>
<p>El uso de Vagrant sólo nos da una ventaja: la de poder probar nuestra configuración antes de aplicarla en una máquina real.</p>
<p>El uso de Puppet es otro cantar:</p>
<ul>
<li>podemos compartir configuraciones entre máquinas,</li>
<li>podemos replicar configuraciones,</li>
<li>podemos guardar las configuraciones en un repositorio,</li>
<li>podemos volver a una configuración determinada,</li>
<li>si identificamos un nuevo tipo de máquina, podemos basarnos en una ya existente,</li>
<li>si se rompe una máquina, podemos tener otra operativa en poco tiempo,</li>
<li>no olvidaremos instalar nada,</li>
<li>&hellip;</li>
</ul>
<p>Aunque tiene algunos&hellip;</p>
<h2 id="inconvenientes">Inconvenientes</h2>
<p>Requiere un poquitín de trabajo extra. Hay que modificar los archivos y después lanzar puppet, en lugar de tocar los archivos originales o ejecutar APT a mano.</p>
<p>Además, pueden darse situaciones poco agradables, como que un paquete entre en conflicto con otro. Como Puppet no garantiza ningún orden, puede darse que el primero se instale y el segundo desinstale al primero. Como, de forma individual, no hay errores, Puppet no nos informará del problema.</p>
<p>Hay algunas soluciones, como realizar <em>pruebas</em>. Existen distintos entornos de pruebas, pero se basan en comprobar que la sintaxis es la adecuada y, en mi opinión, es lo mismo que tener redundancia: se especifican las reglas de dos maneras distintas y deben coincidir. Personalmente, no me gusta el sistema y no le veo un beneficio.</p>
<p>Nuevamente, en mi opinión, lo más útil es definir una nueva etapa de pruebas que <em>realice pruebas por los efectos</em>, no por los requisitos: si queremos que un servidor esté corriendo, comprobamos que el puerto está ocupado. Si hemos modificado un archivo, podemos comprobar su fecha de modificación. Pero no hay ningún framework que nos facilite esta tarea.</p>
<h2 id="más-información">Más información</h2>
<p>Podéis visitar la propia <a href="https://docs.puppetlabs.com/learning/" target="_blank" rel="noopener noreffer">web de Puppet</a> . Está todo muy bien explicadito, salvo la estructura inicial (para lo que ya estoy yo XD).</p>
<p>En este artículo he introducido los tipos <a href="https://docs.puppetlabs.com/references/stable/type.html" target="_blank" rel="noopener noreffer">file&quot;, &ldquo;package&rdquo; y &ldquo;exec&rdquo;; podéis visitar la &ldquo;lista completa de tipos puppet</a>  si queréis.</p>
<p>Así mismo, he comentado las etapas, pero hay muchos otros <a href="https://www.puppetlabs.com/references/2.6.8/metaparameter.html" target="_blank" rel="noopener noreffer">metaparámetros</a>.</p>
<p>También tenéis <a href="https://vagrantup.com/" target="_blank" rel="noopener noreffer">la página de Vagrant</a>, claro.</p>
<p>Si os gustan estos temas, os recomiendo que sigáis a <a href="https://blog.carlossanchez.eu/" target="_blank" rel="noopener noreffer">Carlos Sánchez</a>, que presentó en el <a href="https://codemotion.es/" target="_blank" rel="noopener noreffer">CodeMotion</a>  la charla <a href="https://www.slideshare.net/carlossg/from-dev-to-devops-codemotion-es-2012" target="_blank" rel="noopener noreffer">From Dev to DevOps</a>.</p>
<p>Podréis encontrar más información si buscáis la palabra &ldquo;devops&rdquo; en google :D</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Actualizado el 28 Jan 2021</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartir en Twitter" data-sharer="twitter" data-url="https://magmax.org/blog/vagrant-puppet/" data-title="Vagrant y Puppet" data-hashtags="devops,vagrant,puppet"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Facebook" data-sharer="facebook" data-url="https://magmax.org/blog/vagrant-puppet/" data-hashtag="devops"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Linkedin" data-sharer="linkedin" data-url="https://magmax.org/blog/vagrant-puppet/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en WhatsApp" data-sharer="whatsapp" data-url="https://magmax.org/blog/vagrant-puppet/" data-title="Vagrant y Puppet" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Tumblr" data-sharer="tumblr" data-url="https://magmax.org/blog/vagrant-puppet/" data-title="Vagrant y Puppet" data-tags="devops,vagrant,puppet"><i class="fab fa-tumblr fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Reddit" data-sharer="reddit" data-url="https://magmax.org/blog/vagrant-puppet/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Instapaper" data-sharer="instapaper" data-url="https://magmax.org/blog/vagrant-puppet/" data-title="Vagrant y Puppet" data-description=""><i data-svg-src="/lib/simple-icons/icons/instapaper.min.svg"></i></a><a href="javascript:void(0);" title="Compartir en Digg" data-sharer="digg" data-url="https://magmax.org/blog/vagrant-puppet/"><i class="fab fa-digg fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Blogger" data-sharer="blogger" data-url="https://magmax.org/blog/vagrant-puppet/" data-title="Vagrant y Puppet" data-description=""><i class="fab fa-blogger fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/devops/">devops</a>,&nbsp;<a href="/tags/vagrant/">vagrant</a>,&nbsp;<a href="/tags/puppet/">puppet</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Regresar</a></span>&nbsp;|&nbsp;<span><a href="/">Inicio</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/python-curses/" class="prev" rel="prev" title="Python curses"><i class="fas fa-angle-left fa-fw"></i>Python curses</a>
            <a href="/blog/python-compiler-internals/" class="next" rel="next" title="El compilador de Python desde dentro">El compilador de Python desde dentro<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Provisto por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Miguel Ángel</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Volver arriba">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentarios">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="https://magmax.disqus.com/embed.js" defer></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copiar al portapapeles","maxShownLines":10},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'UA-9308241-3', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-9308241-3" async></script></body>
</html>
