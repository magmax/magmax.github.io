<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>pydoubles on El blog de MagMax</title>
    <link>https://magmax.org/tags/pydoubles/</link>
    <description>Recent content in pydoubles on El blog de MagMax</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 09 Nov 2011 00:00:00 +0000</lastBuildDate><atom:link href="https://magmax.org/tags/pydoubles/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Python: Cómo hacer pruebas 4: pyDoubles</title>
      <link>https://magmax.org/blog/python-pruebas-4/</link>
      <pubDate>Wed, 09 Nov 2011 00:00:00 +0000</pubDate>
      
      <guid>https://magmax.org/blog/python-pruebas-4/</guid>
      <description>
        
          &lt;p&gt;Tras las &lt;a href=&#34;https://twitter.com/#!/programania/status/133533559779635200&#34;&gt;peticiones populares&lt;/a&gt; , no puedo evitar escribir este post antes de lo que esperaba.&lt;/p&gt;
&lt;p&gt;Es la continuación del artículo &lt;a href=&#34;https://magmax.org/blog/python-pruebas-3/&#34;&gt;Python: Cómo hacer pruebas(3)&lt;/a&gt;, que parece haber tenido bastante éxito.&lt;/p&gt;
&lt;p&gt;En este caso vamos a ver los dobles de prueba, y utilizaremos, cómo no, &lt;a href=&#34;http://www.pydoubles.org/&#34;&gt;pyDoubles&lt;/a&gt; , creado principalmente por &lt;a href=&#34;http://www.carlosble.com/&#34;&gt;Carlos Blé&lt;/a&gt;  y disponible en Debian gracias a mi buen amigo &lt;a href=&#34;http://arco.esi.uclm.es/~david.villa/&#34;&gt;David Villa&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Actualización 2011-11-16&lt;/em&gt;: Corrijo el significado de las siglas F.I.R.S.T. (¡Gracias, David!).&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;figure&gt;
    &lt;img src=&#34;https://magmax.org/images/python.png&#34;
         alt=&#34;Python&#34;/&gt; 
&lt;/figure&gt;

&lt;h2 id=&#34;qué-vamos-a-hacer&#34;&gt;Qué vamos a hacer&lt;/h2&gt;
&lt;p&gt;En las ocasiones anteriores me he centrado en pruebas unitarias de objetos que no tienen relación con el mundo exterior. Esto está muy bien, pero es una mala programación. En una programación más &lt;em&gt;pythónica&lt;/em&gt; utilizaremos objetos. Montones de objetos. Y los objetos hablan entre ellos.&lt;/p&gt;
&lt;p&gt;Una batería de pruebas unitarias que se precie tiene que cumplir las condiciones FIRST, a saber:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Fast&lt;/em&gt;, deben ejecutarse en unos pocos segundos.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Independant&lt;/em&gt;, evitando el &lt;em&gt;scripting&lt;/em&gt;: una prueba es independiente de todas las anteriores y, por tanto, pueden ejecutarse en cualquier orden.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Repeatable&lt;/em&gt;, de manera que podemos ejecutarla dos o más veces seguidas sin que afecte al resultado.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Self-Validating&lt;/em&gt;, dando un valor booleano por respuesta, y evitando así buscar esta respuesta en un mar de logs.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Timely&lt;/em&gt;, en el momento adecuado; de nada sirve escribir los tests &lt;em&gt;después&lt;/em&gt; del código, ya que éste puede resultar difícil de probar.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Podéis consultar la definición original de estas reglas en el libro &amp;ldquo;Clean Code&amp;rdquo;, de Robert C. Martin, al final del capítulo 9, &amp;ldquo;Unit Tests&amp;rdquo;, páginas 130-131.&lt;/p&gt;
&lt;p&gt;Supongamos por un momento que tenemos un objeto que depende de otro. ¿Cómo hacemos que sean las pruebas del primero sean independientes? Lo tenemos complicado. Bueno, pues aquí es donde entran los &lt;em&gt;dobles de pruebas&lt;/em&gt;: Creamos un objeto que &lt;em&gt;parece&lt;/em&gt; el original, pero que &lt;em&gt;no es&lt;/em&gt; el original (bueno, o sí&amp;hellip; ya lo veremos).&lt;/p&gt;
&lt;p&gt;Puedo aseguraros que me ha resultado difícil encontrar un ejemplo en el que relacionar dos objetos, con un dominio conocido por todos, pequeño y sencillo, de manera que resulte altamente didáctico&amp;hellip; Y resulta que tenía el caso justo enfrente de mí :D. Vamos a implementar un pequeño &lt;em&gt;sistema de ficheros&lt;/em&gt; muy muy básico. Vamos a centrarnos en un &lt;em&gt;directorio&lt;/em&gt;. Y nos vamos a centrar en dos operaciones: &lt;em&gt;borrar&lt;/em&gt; y &lt;em&gt;cambiar permisos&lt;/em&gt;. Claro&amp;hellip; Tenemos el problema de que un directorio depende fuertemente de otros directorios y de archivos, pero no quiero meterme en la implementación de los archivos&amp;hellip; ¿Cómo lo hacemos?&lt;/p&gt;
&lt;h2 id=&#34;archivos&#34;&gt;Archivos&lt;/h2&gt;
&lt;p&gt;Como he dicho, no queremos meternos en la implementación de archivos, así que esto es lo que vamos a necesitar (lo copio aquí para no estar repitiéndolo todo el rato):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Archivo&lt;/span&gt;:
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;borrar&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;raise&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NotImplementedError&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;no lo vamos a necesitar&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cambiar_permisos&lt;/span&gt;(self, permisos):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;raise&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NotImplementedError&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;no lo vamos a necesitar&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Como véis, si llegáramos a entrar en alguna de las funciones, nuestros tests fallarían estrepitosamente. Tenemos que ser capaces de probarlo sin usar el archivo real.&lt;/p&gt;
&lt;h2 id=&#34;las-pruebas&#34;&gt;Las Pruebas&amp;hellip;&lt;/h2&gt;
&lt;p&gt;Para probarlo voy a usar &lt;a href=&#34;http://readthedocs.org/docs/nose/en/latest/&#34;&gt;nose&lt;/a&gt; , ¡¡que para eso expliqué &lt;a href=&#34;https://magmax.org/blog/python-pruebas-3/&#34;&gt;en el artículo anterior&lt;/a&gt; cómo usarlo!!.&lt;/p&gt;
&lt;p&gt;El problema de &lt;em&gt;nose&lt;/em&gt; es que la clase de pruebas debe estar arriba del todo. Tenedlo en cuenta a la hora de ir componiendo los tests&amp;hellip;&lt;/p&gt;
&lt;h2 id=&#34;directorios&#34;&gt;Directorios&lt;/h2&gt;
&lt;p&gt;Asumamos que nuestro código es &lt;em&gt;legacy&lt;/em&gt; y ya teníamos las clases escritas&amp;hellip; Así me ahorro bastante tiempo XD. Ahí va la clase Directorio:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Directorio&lt;/span&gt;:
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3&lt;/span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;contenido &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;borrar&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;contenido:
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7&lt;/span&gt;            x&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;borrar()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;anadir&lt;/span&gt;(self, objeto):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10&lt;/span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;contenido&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(objeto)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cambiar_permisos&lt;/span&gt;(self, permisos):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;contenido:
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14&lt;/span&gt;            x&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cambiar_permisos(permisos)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;probando-que-es-gerundio&#34;&gt;Probando, que es gerundio&lt;/h2&gt;
&lt;h3 id=&#34;añadiendo&#34;&gt;Añadiendo&lt;/h3&gt;
&lt;p&gt;Pues ya tenemos nuestros Directorios, (no) tenemos nuestros Archivos&amp;hellip; ¡¡Vamos a probarlo!! Voy a necesitar una prueba de la que no os he hablado, y es que para probar que borramos, necesitamos añadir. ¿Estará funcionando correctamente este método? (nuevamente recuerdo que los tests deben ir al principio del archivo para que &lt;em&gt;nose&lt;/em&gt; funcione):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; unittest
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; pyDoubles.framework &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;testSeBorrarDirectorios&lt;/span&gt; (unittest&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;TestCase):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_probamos_que_anadimos&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7&lt;/span&gt;        archivo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stub(Archivo())
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8&lt;/span&gt;        sut &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Directorio()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10&lt;/span&gt;        sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;anadir(archivo)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12&lt;/span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;assertTrue (archivo &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;contenido)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;¿Qué ha ocurrido aquí? ¿Qué es todo eso?&lt;/p&gt;
&lt;p&gt;Bueno, es más sencillo de lo que parece. Lo que hacemos es usar pyDoubles, y por eso importamos todo lo que hay en el framework. Además, creamos una clase que hereda de &lt;em&gt;TestCase&lt;/em&gt; para que se ejecuten las pruebas, y será en esta clase donde meteremos todos los tests.&lt;/p&gt;
&lt;p&gt;El primero de los tests crea un archivo que no es un archivo&amp;hellip; Es un &amp;ldquo;&lt;em&gt;stub&lt;/em&gt;&amp;rdquo;. ¿Qué es eso?&lt;/p&gt;
&lt;p&gt;Un &lt;em&gt;STUB&lt;/em&gt; es un objeto que se comporta como el original, pero no es el original. Puede reemplazar un único método o un conjunto de ellos.&lt;/p&gt;
&lt;p&gt;Como véis, lo que sea &amp;ldquo;archivo&amp;rdquo; no importa, ya que sólo me importa comprobar que, después, puedo recuperarlo. Técnicamente, y aprovechando la potencia de &lt;em&gt;Python&lt;/em&gt; podría haber puesto cualquier cosa, pero usar un objeto pseudo-real es más claro. Si no me creéis, podéis comprobar que es un objeto de tipo Archivo.&lt;/p&gt;
&lt;p&gt;Pero veamos el segundo ejemplo, que es más claro.&lt;/p&gt;
&lt;h3 id=&#34;borrando&#34;&gt;Borrando&lt;/h3&gt;
&lt;p&gt;En este caso vamos a borrar. Evidentemente, se tratará de un borrado recursivo, ya que si no pierde la gracia.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_probamos_que_borramos&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;    archivo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; spy(Archivo())
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3&lt;/span&gt;    sut &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Directorio()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4&lt;/span&gt;    sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;anadir(archivo)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6&lt;/span&gt;    sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;borrar()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8&lt;/span&gt;    assert_that_method(archivo&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;borrar)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;was_called()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Aquí no he usado un &lt;em&gt;stub&lt;/em&gt;, sino un &lt;em&gt;spy&lt;/em&gt;, un espía.&lt;/p&gt;
&lt;p&gt;Los &lt;em&gt;SPY&lt;/em&gt; o &lt;em&gt;spies&lt;/em&gt; son dobles de prueba como los &lt;em&gt;stub&lt;/em&gt;, solo que tienen post-condiciones. Es decir: se crean, se usan y después se comprueba que se usaron correctamente.&lt;/p&gt;
&lt;p&gt;Precisamente por eso está la comprobación final, en la que compruebo que el método &amp;ldquo;&lt;em&gt;borrar&lt;/em&gt;&amp;rdquo; del objeto &amp;ldquo;&lt;em&gt;archivo&lt;/em&gt;&amp;rdquo; se llamó. ¿Qué hizo? Pues nada, porque era un objeto de coña :D&lt;/p&gt;
&lt;p&gt;Una de las grandes ventajas de pyDoubles es lo semántico que resulta su uso. ¡¡Casi se puede leer!!&lt;/p&gt;
&lt;h3 id=&#34;cambiando-permisos&#34;&gt;Cambiando permisos&lt;/h3&gt;
&lt;p&gt;Ahora vamos con la segunda parte: comprobar que el cambio de permisos es recursivo. Es igual que el borrado, con la diferencia de que tenemos que pasar un parámetro:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_cambiar_permisos_llama_con_valores_adecuados&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;    archivo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; spy(Archivo())
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3&lt;/span&gt;    sut &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Directorio()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4&lt;/span&gt;    sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;anadir(archivo)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6&lt;/span&gt;    sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cambiar_permisos(&lt;span style=&#34;color:#ae81ff&#34;&gt;0777&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8&lt;/span&gt;    assert_that_method(archivo&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cambiar_permisos)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;was_called()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;with_args(&lt;span style=&#34;color:#ae81ff&#34;&gt;0777&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9&lt;/span&gt;    assert_that_method(archivo&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;borrar)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;was_never_called()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Como podemos observar, en este caso hemos vuelto a utilizar un espía. Aquí comprobamos que el método se llamó con los permisos indicados, y también que el método borrar no se llamó nunca. Esto no es ni necesario, pero lo he puesto por mostrar más capacidades de pyDoubles.&lt;/p&gt;
&lt;p&gt;Lo mismo se podría hacer de otra manera ligeramente diferente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_cambiar_permisos_con_mock&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;    archivo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mock(Archivo())
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3&lt;/span&gt;    expect_call(archivo&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cambiar_permisos)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;with_args(&lt;span style=&#34;color:#ae81ff&#34;&gt;0777&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4&lt;/span&gt;    sut &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Directorio()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5&lt;/span&gt;    sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;anadir(archivo)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7&lt;/span&gt;    sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cambiar_permisos(&lt;span style=&#34;color:#ae81ff&#34;&gt;0777&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9&lt;/span&gt;    archivo&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;assert_that_is_satisfied()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Aquí he utilizado un &lt;em&gt;mock&lt;/em&gt;. Un &lt;em&gt;mock&lt;/em&gt; es un &lt;em&gt;stub&lt;/em&gt; con precondiciones. Es decir: primero digo lo que va a pasar, ejecuto, y compruebo que ha pasado.&lt;/p&gt;
&lt;p&gt;Tan solo nos quedaría ver los &amp;ldquo;&lt;em&gt;proxyspy&lt;/em&gt;&amp;rdquo;, que son espías que llaman al objeto real.&lt;/p&gt;
&lt;h3 id=&#34;todo-junto&#34;&gt;Todo junto&lt;/h3&gt;
&lt;p&gt;Aquí tenéis todo el código de un tirón:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; unittest
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; pyDoubles.framework &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;testSeBorrarDirectorios&lt;/span&gt; (unittest&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;TestCase):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_probamos_que_anadimos&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7&lt;/span&gt;        archivo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stub(Archivo())
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8&lt;/span&gt;        sut &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Directorio()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10&lt;/span&gt;        sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;anadir(archivo)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12&lt;/span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;assertTrue (archivo &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;contenido)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_probamos_que_borramos&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15&lt;/span&gt;        archivo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; spy(Archivo())
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16&lt;/span&gt;        sut &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Directorio()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17&lt;/span&gt;        sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;anadir(archivo)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19&lt;/span&gt;        sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;borrar()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21&lt;/span&gt;        assert_that_method(archivo&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;borrar)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;was_called()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_cambiar_permisos_llama_con_valores_adecuados&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24&lt;/span&gt;        archivo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; spy(Archivo())
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25&lt;/span&gt;        sut &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Directorio()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26&lt;/span&gt;        sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;anadir(archivo)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28&lt;/span&gt;        sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cambiar_permisos(&lt;span style=&#34;color:#ae81ff&#34;&gt;0777&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30&lt;/span&gt;        assert_that_method(archivo&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cambiar_permisos)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;was_called()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;with_args(&lt;span style=&#34;color:#ae81ff&#34;&gt;0777&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;31&lt;/span&gt;        assert_that_method(archivo&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;borrar)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;was_never_called()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;32&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;33&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test_cambiar_permisos_con_mock&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;34&lt;/span&gt;        archivo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mock(Archivo())
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;35&lt;/span&gt;        expect_call(archivo&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cambiar_permisos)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;with_args(&lt;span style=&#34;color:#ae81ff&#34;&gt;0777&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;36&lt;/span&gt;        sut &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Directorio()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;37&lt;/span&gt;        sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;anadir(archivo)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;38&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;39&lt;/span&gt;        sut&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cambiar_permisos(&lt;span style=&#34;color:#ae81ff&#34;&gt;0777&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;40&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;41&lt;/span&gt;        archivo&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;assert_that_is_satisfied()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;42&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;43&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Archivo&lt;/span&gt;:
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;45&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;borrar&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;46&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;raise&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NotImplementedError&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;no lo vamos a necesitar&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;47&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;48&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cambiar_permisos&lt;/span&gt;(self, permisos):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;49&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;raise&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NotImplementedError&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;no lo vamos a necesitar&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;50&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;51&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;52&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Directorio&lt;/span&gt;:
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;53&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;54&lt;/span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;contenido &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;55&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;56&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;borrar&lt;/span&gt;(self):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;57&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;contenido:
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;58&lt;/span&gt;            x&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;borrar()
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;59&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;60&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;anadir&lt;/span&gt;(self, objeto):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;61&lt;/span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;contenido&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(objeto)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;62&lt;/span&gt;
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;63&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cambiar_permisos&lt;/span&gt;(self, permisos):
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;64&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;contenido:
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;65&lt;/span&gt;            x&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cambiar_permisos(permisos)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;respuestas-predefinidas&#34;&gt;Respuestas predefinidas&lt;/h2&gt;
&lt;p&gt;Habrá casos en los que necesitemos una respuesta determinada cuando se llame a un método, de manera que el algoritmo que estamos probando pueda continuar. Para ello podemos &amp;ldquo;prediseñar&amp;rdquo; métodos; ahí van diferentes maneras diferentes de hacerlo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;objeto&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;metodo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; method_returning(&lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;objeto&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;metodo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; method_raising(&lt;span style=&#34;color:#a6e22e&#34;&gt;NotImplementedError&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3&lt;/span&gt;when(objeto&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;metodo)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;then_return(&lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4&lt;/span&gt;when(objeto&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;metodo)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;with_args(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;then_return(&lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;cuestión-de-nomenclatura&#34;&gt;Cuestión de nomenclatura&lt;/h2&gt;
&lt;p&gt;La diferencia entre un &lt;em&gt;stub&lt;/em&gt;, &lt;em&gt;mock&lt;/em&gt; y &lt;em&gt;spy&lt;/em&gt; es puramente teórica. Hay muchos &lt;em&gt;frameworks&lt;/em&gt; que los confunden o ignoran. Yo, personalmente, utilizo siempre &lt;em&gt;spies&lt;/em&gt;, ya que me parecen más intuitivos, aunque suelo llamarlos &lt;em&gt;mocks&lt;/em&gt;, término con el que se suelen denominar globalmente a todos los dobles de prueba.&lt;/p&gt;
&lt;p&gt;Hay más dobles de prueba, como los &lt;em&gt;Fake&lt;/em&gt;, que son implementaciones completas de una interfaz pero con funcionalidad simplificada (imaginad una clase de acceso a base de datos que siempre devuelve datos fijos, sin acceder realmente). Si lo pensáis, un &lt;em&gt;stub&lt;/em&gt; no es más que un &lt;em&gt;fake&lt;/em&gt; automático XD. ¡¡Todos están relacionados!!&lt;/p&gt;
&lt;p&gt;Así que, resumiendo:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Es un &lt;em&gt;stub&lt;/em&gt; si no se realizan comprobaciones.&lt;/li&gt;
&lt;li&gt;Será un &lt;em&gt;mock&lt;/em&gt; si tenemos precondiciones.&lt;/li&gt;
&lt;li&gt;Un &lt;em&gt;spy&lt;/em&gt; si tenemos postcondiciones.&lt;/li&gt;
&lt;li&gt;Un &lt;em&gt;fake&lt;/em&gt; si usamos un objeto que implementa la funcionalidad simplificada.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Diré una cosa de corazón: llamadlos como queráis, pero no los mezcléis. La mezcla da lugar a métodos más complejos. Podéis usar distintos tipos en distintas pruebas, pero en una misma prueba, no los mezcléis. Y mucho menos con un único objeto.&lt;/p&gt;
&lt;h2 id=&#34;hamcrest-y-pydoubles&#34;&gt;Hamcrest y pyDoubles&lt;/h2&gt;
&lt;p&gt;Resulta que escribí el artículo anterior sabiendo lo que me hacía, y que
podemos combinar los &lt;em&gt;matchers&lt;/em&gt; de &lt;a href=&#34;http://code.google.com/p/hamcrest/&#34;&gt;Hamcrest&lt;/a&gt;  junto a pyDoubles&amp;hellip; ¿Cómo?
Pues, por ejemplo, en el método &lt;code&gt;with_args&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;when(objeto&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;metodo)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;with_args(instance_of(objeto))&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;then_return(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;hola, mundo&amp;#39;&lt;/span&gt;)
&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;when(objeto&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;metodo)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;with_args(any_of(starts_with(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;hola&amp;#39;&lt;/span&gt;), ends_with(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mundo&amp;#39;&lt;/span&gt;))&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;then_return(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;hola, mundo&amp;#39;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Como véis, hemos usado &lt;code&gt;instance_of&lt;/code&gt;, &lt;code&gt;any_of&lt;/code&gt;, &lt;code&gt;starts_with&lt;/code&gt; y &lt;code&gt;ends_with&lt;/code&gt;, que son &lt;em&gt;matchers&lt;/em&gt; de &lt;em&gt;Hamcrest&lt;/em&gt;.&lt;/p&gt;
&lt;h2 id=&#34;un-gran-poder-conlleva-una-gran-responsabilidad&#34;&gt;Un gran poder conlleva una gran responsabilidad&lt;/h2&gt;
&lt;p&gt;&amp;hellip; como le dijo el Tío Ben a Peter Parker :D&lt;/p&gt;
&lt;p&gt;Tenemos en nuestras manos una gran herramienta, pero debemos tener en cuenta que debemos usarlo con cuidado, de la misma manera que un mecánico no arregla todas las averías con el mismo martillo.&lt;/p&gt;
&lt;p&gt;Hay ciertas reglas básicas que cumplir, con el fin de evitar terminar con pruebas terriblemente complejas o nos metamos en camisas de once varas.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Nunca &amp;ldquo;&lt;em&gt;mockeéis&lt;/em&gt;&amp;rdquo; un objeto que no sea vuestro.&lt;/em&gt; De esta manera se evitan &lt;em&gt;mocks&lt;/em&gt; interminables de todo &lt;em&gt;Hibernate&lt;/em&gt; o cosas incluso peores. Es un fallo habitual en todo novato, y yo no fui la excepción.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Realizad &lt;em&gt;mocks&lt;/em&gt; precisos&lt;/em&gt;. Cuantas menos cosas reemplacéis, más estable será el test (en la terminología típica, &amp;ldquo;los tests serán menos frágiles&amp;rdquo;). Si estáis reemplazando muchos métodos, a lo mejor necesitáis un &lt;em&gt;fake&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;para-más-información&#34;&gt;Para más información&lt;/h2&gt;
&lt;p&gt;Podéis visitar &lt;a href=&#34;http://www.pydoubles.org/&#34;&gt;la web de pyDoubles&lt;/a&gt; , la de &lt;a href=&#34;http://code.google.com/p/hamcrest/&#34;&gt;Hamcrest&lt;/a&gt; , la de &lt;a href=&#34;http://readthedocs.org/docs/nose/en/latest/&#34;&gt;nose&lt;/a&gt; , &amp;hellip; O releer mis antiguos posts:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://magmax.org/blog/python-pruebas-1/&#34;&gt;Python: Cómo hacer pruebas(1)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://magmax.org/blog/python-pruebas-2/&#34;&gt;Python: Cómo hacer pruebas(2)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://magmax.org/blog/python-pruebas-3/&#34;&gt;Python: Cómo hacer pruebas(3)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://magmax.org/blog/asegura/&#34;&gt;No comentes: ¡Asegura!&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://magmax.org/blog/atheist-no-seas-credulo/&#34;&gt;Atheist: No seas crédulo ¡¡Prueba!!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;No sé si me he dejado algo en el tintero. Tengo la sensación de que sí&amp;hellip; sobre todo en las reglas a cumplir cuando usamos mocks. Toda contribución será bienvenida.&lt;/p&gt;
&lt;p&gt;Un saludo!!&lt;/p&gt;

        
      </description>
    </item>
    
  </channel>
</rss>
