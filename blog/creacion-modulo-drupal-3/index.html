<!DOCTYPE html>
<html prefix="
og: https://ogp.me/ns#
article: https://ogp.me/ns/article#
" lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Cache-Control" content="max-age=43200">
<meta http-equiv="ETag" content="b'43516d322f35b42f7136bc9e4ca4c9c80cc1466c'">
<title>Creación de un módulo Drupal III | MagMax Blog</title>
<link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="/assets/css/code.css" rel="stylesheet" type="text/css">
<link href="/assets/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="/assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="/assets/css/custom.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/magmax">
<link rel="canonical" href="http://magmax.org/blog/creacion-modulo-drupal-3/">
<link rel="icon" href="/favicon.png" sizes="128x128">
<link rel="icon" href="/favicon_330.png" sizes="330x330">
<link rel="icon" href="/favicon.ico" sizes="16x16">
<meta name="author" content="Miguel Ángel García">
<link rel="prev" href="/blog/creacion-modulo-drupal-2/" title="Creación de un módulo Drupal II" type="text/html">
<link rel="next" href="/blog/creacion-modulo-drupal-4/" title="Creación de un módulo Drupal IV" type="text/html">
<meta property="og:site_name" content="MagMax Blog">
<meta property="og:title" content="Creación de un módulo Drupal III">
<meta property="og:url" content="http://magmax.org/blog/creacion-modulo-drupal-3/">
<meta property="og:description" content="Qué vamos a hacer
En esta ocasión me voy a dedicar a arreglar los estropicios que hice anteriomente :D
Además, voy a añadir enlaces para eliminar los feeds (como me han solicitado) y también vamos a r">
<meta property="og:type" content="article">
<meta property="article:author" content="Miguel Ángel García">
<meta property="article:published_time" content="2010-05-11T00:00:00+00:00">
<meta property="article:updated" content="2010-05-11T00:00:00">
<meta property="article:tag" content="drupal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@magmax_en">
<meta name="twitter:creator" content="@magmax">
<meta name="twitter:title" content="MagMax Blog">
<meta name="twitter:description" content="El blog de un Ingeniero Informático: tutoriales, manuales, opiniones, comparativas, ...">
<meta name="twitter:url" content="http://magmax.org//blog/creacion-modulo-drupal-3/">
<meta name="twitter:image" content="http://magmax.org/favicon.png">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="container">
<!-- This keeps the margins nice -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://magmax.org/">

        <span id="blog-title">MagMax Blog</span>
      </a>
    </div>
<!-- /.navbar-header -->
    <div class="collapse navbar-collapse navbar-ex1-collapse">
      <ul class="nav navbar-nav">
<li>
<a href="/">Inicio</a>
                </li>
<li>
<a href="/archive.html">Archivo</a>
                </li>
<li>
<a href="/categories">Categorías</a>
                </li>
<li>
<a href="/projects">Proyectos</a>
                </li>
<li>
<a href="/news">Posts Externos</a>

        
      </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
<form class="navbar-form navbar-left" role="search" action="http://google.com/search" method="get">
<div class="form-group">
<input type="hidden" name="sitesearch" value="magmax.org"><input type="text" name="q" class="form-control" placeholder="Search / Buscar">
</div>
</form>
</li>

        <li style="margin-left:0">
          <a href="http://feeds.feedburner.com/magmax">
            <img src="/assets/images/rss.png" style="width:22px;height:22px"></a>
        </li>

        
      </ul>
</div>
<!-- /.navbar-collapse -->
  </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
  <div class="body-content">
    <div class="row">
      <div class="page-content col-md-9">
        
        <article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="https://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="/blog/creacion-modulo-drupal-3/" class="u-url">Creación de un módulo Drupal III</a></h1>
            <div class="metadata text-muted">
              <i class="glyphicon glyphicon-calendar"></i>
              <p class="dateline">
                <time class="published dt-published" datetime="2010-05-11T00:00:00+00:00" title="2010-05-11">2010-05-11</time>
                // <time class="updated dt-updated" datetime="2010-05-11T00:00:00" title="2010-05-11">2010-05-11</time></p>
              <p class="commentline">            <a href="/blog/creacion-modulo-drupal-3/#disqus_thread" data-disqus-identifier="cache/posts/creacion-modulo-drupal-3.html">Comments</a>

</p>
              <address class="vcard author"><a class="url fn" href="https://magmax.org">Miguel Ángel García</a></address>
            </div>
            <br></header><div class="e-content entry-content" itemprop="articleBody text">
            <div>
<div class="section" id="que-vamos-a-hacer">
<h2>Qué vamos a hacer</h2>
<p>En esta ocasión me voy a dedicar a arreglar los estropicios que hice anteriomente :D</p>
<p>Además, voy a añadir enlaces para eliminar los feeds (como me han solicitado) y también vamos a redirigir al usuario a la página principal después de añadir un feed (como también me han solicitado).</p>
<p>También añadiremos un mail al usuario que inserta el mensaje, por si no está registrado. En caso de que esté registrado, guardaremos una referencia al mismo.</p>
<!-- TEASER_END -->
</div>
<div class="section" id="que-se-explica-aqui">
<h2>Qué se explica aquí</h2>
<p>En esta ocasión veremos cómo:</p>
<ul class="simple">
<li>Redirigir al usuario a la página que deseemos.</li>
<li>Ordenación de tablas.</li>
<li>Expresiones regulares.</li>
</ul>
</div>
<div class="section" id="notas-previas">
<h2>Notas previas</h2>
<p>En la <a class="reference external" href="/blog/creacion-modulo-drupal">primera parte del tutorial drupal</a> ya insistí en que sólo se debe abrir el tag de <code>&lt;?php</code>, y no se debe cerrar con <code>?&gt;</code>. Dicho esto, continuamos.</p>
</div>
<div class="section" id="modificando-la-bbdd">
<h2>Modificando la BBDD</h2>
<p>Añadimos el campo usermail. Además, modificamos el campo "uid" para que referencie al usuario si éste hizo login.</p>
<pre class="code php"><a name="rest_code_0c06ceb6f6ba4b52954a85c76977f4a8-1"></a><span class="x">function feedback_update_6102() {</span>
<a name="rest_code_0c06ceb6f6ba4b52954a85c76977f4a8-2"></a><span class="x">  $ret = array();</span>
<a name="rest_code_0c06ceb6f6ba4b52954a85c76977f4a8-3"></a><span class="x">  db_add_field ( $ret, 'feedback_messages', 'usermail', array ( 'type' =&gt; 'text' ) );</span>
<a name="rest_code_0c06ceb6f6ba4b52954a85c76977f4a8-4"></a><span class="x">  db_change_field ( $ret, 'feedback_messages', 'uid', 'uid', array ( 'type'=&gt; 'int', 'unsigned'=&gt;TRUE ) );</span>
<a name="rest_code_0c06ceb6f6ba4b52954a85c76977f4a8-5"></a><span class="x">  return $ret;</span>
<a name="rest_code_0c06ceb6f6ba4b52954a85c76977f4a8-6"></a><span class="x">}</span>
</pre>
</div>
<div class="section" id="fe-de-erratas">
<h2>Fe de erratas</h2>
<p>El primer error fue la contabilización de feeds. Si miráis el tutorial <a class="reference external" href="/blog/creacion-modulo-drupal-2">Creación de un módulo Drupal (II)</a>, veréis la siguiente línea (función <code>_feedback_count</code>):</p>
<pre class="code php"><a name="rest_code_7afda662c5d8490d8c9144a2f6f5bb63-1"></a><span class="x">$query = "SELECT count(id) as total from {feedback_messages} fm where fm.read != 1";</span>
</pre>
<p>Bueno, pues está <em>mal</em>. Lo correcto es lo siguiente:</p>
<pre class="code php"><a name="rest_code_d6d723df67b144aca233fc86efb1e02f-1"></a><span class="x">$query = "select count(*) from drupal6.feedback_messages fm where isnull (fm.read) or fm.read != 1";</span>
</pre>
<p>Como véis, comprobamos que no sea nulo, ya que en ese caso no estaba contabilizando correctamente.</p>
<p>El segundo error cometido es que los <code>set_error</code> deben realizarse sobre un campo. Así, en el primer tutorial, donde aparecen los <code>set_error</code>, están mal. Realmente no veremos la diferencia si no la conocemos: Si lo hacemos bien, los campos indicados se marcarán en rojo (depende del tema) indicando que el problema se encuentra en ése campo. De esta manera, quedarían así (función <code>feedback_message_form_submit</code>):</p>
<pre class="code php"><a name="rest_code_ac855f4cd5a94d199afdfd07775827f5-1"></a><span class="x">form_set_error ( 'feedback', t( "An error has happened. Your feedback has not been sent." ) );</span>
</pre>
<p>Veremos la función completa cuando añadamos más cosas.</p>
<p>Y ya, como error menor, deciros que las etiquetas 'Date' y 'User' estaban cambiadas en la función <code>feedback_admin</code>.</p>
<p>Al final de este tutorial, pondré todo seguido para que podáis aclararos.</p>
</div>
<div class="section" id="modificando-funciones">
<h2>Modificando funciones</h2>
<p>Primero vamos con lo más sencillo de todo: Queremos que cuando alguien meta un feed, que vuelva a la pantalla de inicio. Asumiré que la página de inicio es <code>?q=node</code>, por lo que basta con indicarle:</p>
<pre class="code php"><a name="rest_code_1781f1bf4b79403997fc06187c21cee3-1"></a><span class="x">drupal_goto ( 'node' );</span>
</pre>
<p>A continuación, no sé si notásteis que la tabla con todos los mensajes no se ordena al pulsar las columnas. Esto nos puede venir bien para poder agrupar los mensajes no leídos, para ordenar por fecha, para agrupar los mensajes sin contenido, etc. ¡¡ Y es tan sencillo !! Basta con realizar un cambio durante la consulta, así que en <code>feedback_admin</code>:</p>
<pre class="code php"><a name="rest_code_df99566b19cf45eb9b81edbd8f6cbaaf-1"></a><span class="x">$query = "SELECT fm.id, u.name, fm.indate, fm.message FROM {feedback_messages} fm, {users} u WHERE fm.uid=u.uid";</span>
<a name="rest_code_df99566b19cf45eb9b81edbd8f6cbaaf-2"></a><span class="x">$query .= tablesort_sql ( $header );</span>
<a name="rest_code_df99566b19cf45eb9b81edbd8f6cbaaf-3"></a><span class="x">$queryResult =  db_query ( $query );</span>
</pre>
<p>Con eso le decimos a drupal que nos ordene la tabla. Ésa es una de las gracias de usar los headers en una tabla a parte, y por eso los definimos antes de realizar la consulta.</p>
</div>
<div class="section" id="anadiendo-un-mail">
<h2>Añadiendo un mail</h2>
<p>En las modificaciones de la base de datos, añadimos el campo <code>usermail</code>. Ahora vamos a usarlo. Necesitaremos que el usuario lo inserte, así que tenemos que modificar <code>feedback_message_form</code>:</p>
<pre class="code php"><a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-1"></a><span class="x">function feedback_message_form ()</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-2"></a><span class="x">{</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-3"></a><span class="x">  global $user;</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-4"></a><span class="x">  $mail = "";</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-5"></a>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-6"></a><span class="x">  if ( $user-&gt;uid != 0 )</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-7"></a><span class="x">    $mail = $user-&gt;mail;</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-8"></a>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-9"></a><span class="x">  $form = array</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-10"></a><span class="x">  (</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-11"></a><span class="x">    'feedback' =&gt; array</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-12"></a><span class="x">    (</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-13"></a><span class="x">      '#type' =&gt; 'fieldset',</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-14"></a><span class="x">      '#title' =&gt; t( 'Feedback' ),</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-15"></a><span class="x">      'mail' =&gt; array ('#type' =&gt; 'textfield', "#title"=&gt;"E-Mail", "#default_value" =&gt; $mail,</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-16"></a><span class="x">                "#description"=&gt;"If you want any answer, please, tell me your mail. It would not be shown anywhere." ),</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-17"></a><span class="x">      'message' =&gt; array ( '#type' =&gt; 'textarea', "#description"=&gt;"Write here your message" ),</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-18"></a><span class="x">      'submit' =&gt; array ( '#type' =&gt; 'submit',  '#value' =&gt; t('Submit'),  ),</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-19"></a><span class="x">    ),</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-20"></a><span class="x">  );</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-21"></a>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-22"></a><span class="x">  return $form;</span>
<a name="rest_code_0b7323249d2c4a7c8a02ba188ea5354b-23"></a><span class="x">}</span>
</pre>
<p>Como veréis, esta función tiene un añadido: si el usuario ha hecho <em>login</em>, rellenamos el campo con el mail que puso para su usuario. Así le ahorramos trabajo. El UID del usuario no es necesario que lo metamos en el formulario, ya que podemos recuperarlo directamente de la variable global.</p>
<p>Las validaciones también cambian, ya que no sólo vamos a comprobar que el mensaje no esté vacío, sino que queremos hacer más cosas. Queremos que, si el usuario hizo <em>login</em>, entonces el campo de e-mail no es obligatorio. Si no lo hizo, entonces sí que lo es. Y el e-mail tiene que parecer un e-mail, es decir, tener su arroba y demás:</p>
<pre class="code php"><a name="rest_code_968005f7cfab4254a996f98c8d0496d9-1"></a><span class="x">function feedback_message_form_validate ( $form, &amp;$form_state )</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-2"></a><span class="x">{</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-3"></a><span class="x">  global $user;</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-4"></a>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-5"></a><span class="x">  $message = $form_state['values']['message'];</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-6"></a><span class="x">  $mail    = $form_state['values']['mail'];</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-7"></a><span class="x">  $validmail = preg_match ("/^[^0-9][A-z0-9_]+([.][A-z0-9_]+)*[@][A-z0-9_]+([.][A-z0-9_]+)*[.][A-z]{2,4}$/" , $mail );</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-8"></a>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-9"></a><span class="x">  if ( $mail == '' &amp;&amp; $user-&gt;uid == 0 )</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-10"></a><span class="x">    form_set_error ( 'mail', t('You are not a registered user. Please, insert your e-mail.') );</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-11"></a><span class="x">  if ( $mail != '' &amp;&amp; ! $validmail )</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-12"></a><span class="x">    form_set_error ( 'mail', t('The mail does not like an e-mail address.') );</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-13"></a><span class="x">  if ( $message == '' )</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-14"></a><span class="x">    form_set_error ( 'message', t('Message cannot be empty.'));</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-15"></a>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-16"></a><span class="x">  return $form;</span>
<a name="rest_code_968005f7cfab4254a996f98c8d0496d9-17"></a><span class="x">}</span>
</pre>
<p>Aquí hemos introducido la creación de una expresión regular. Explicada brevemente, estamos comprobando si encaja el mail con un patrón dado. La expresión regular es bastante compleja, así que sólo comentaré lo más básico de todo:</p>
<ul class="simple">
<li>Lo que va entre corchetes, significa "uno de estos". Ej: <em>[A-z0-9_]</em> significa que queremos una letra mayúscula o minúscula, un número o un guión bajo.</li>
<li>Lo que va entre corchetes pero comienza por "^", significa "ninguno de estos". Ej. <em>[^0-9]</em> significa "algo que no sea un número".</li>
<li>El asterisco significa "lo anterior se puede repetir 0 o más veces". Ej: <em>[0-9]&amp;#42;</em> significa que puede no haber nada o bien un número indeterminado de números.</li>
<li>El símbolo de suma significa "lo anterior se puede repetir 1 o más veces". Ej: <em>[0-9]+</em> significa que puede haber un número indeterminado de números, pero debe aparecer al menos uno.</li>
<li>Los paréntesis permiten agrupar cosas para aplicarle otros símbolos.</li>
<li>Las llaves implican la multiplicidad exacta. Ej: <em>[A-z]{2}</em> significa "dos letras". <em>[A-z]{2,4}</em> significa "entre 2 y 4 letras".</li>
</ul>
<p>Habitualmente, crear una expresión regular es mucho más sencillo de lo que parece, pero modificar una que ya existe suele ser bastante complicadete :-D</p>
<p>Bueno, y nos queda la inserción:</p>
<pre class="code php"><a name="rest_code_471bec2bb00f488ab4eb4eec58232169-1"></a><span class="x">function feedback_message_form_submit ( $form, &amp;$form_state )</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-2"></a><span class="x">{</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-3"></a><span class="x">  global $user;</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-4"></a><span class="x">  $userid = NULL;</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-5"></a><span class="x">  if ( $user )</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-6"></a><span class="x">    $userid = $user-&gt;uid;</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-7"></a><span class="x">  $message = $form_state['values']['message'];</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-8"></a><span class="x">  $mail = $form_state['values']['mail'];</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-9"></a>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-10"></a><span class="x">  $query = "INSERT into {feedback_messages} ( uid, message, indate, usermail ) values ( %d, '%s', now(), '%s' ) ";</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-11"></a><span class="x">  $queryResult = db_query ( $query, $userid, $message, $mail );</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-12"></a>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-13"></a><span class="x">  if ( db_affected_rows() )</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-14"></a><span class="x">  {</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-15"></a><span class="x">    drupal_set_message ( t ( "Thank you for your feedback." ) );</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-16"></a><span class="x">    drupal_goto ( 'node' );</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-17"></a><span class="x">  }</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-18"></a><span class="x">  else</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-19"></a><span class="x">    form_set_error ( 'feedback', t( "An error has happened. Your feedback has not been sent." ) );</span>
<a name="rest_code_471bec2bb00f488ab4eb4eec58232169-20"></a><span class="x">}</span>
</pre>
<p>Como ya sabemos redirigir, si todo va bien, nos iremos a la página principal :-D</p>
<p>Ya que tenemos el mail, lo suyo es que lo veamos desde la tabla principal de feeds:</p>
<pre class="code php"><a name="rest_code_c71740de45214d5ea6412771f661aef9-1"></a><span class="x">function feedback_admin ( $messageid=null )</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-2"></a><span class="x">{</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-3"></a><span class="x">  $content = '';</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-4"></a>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-5"></a><span class="x">  if ( $messageid != null )</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-6"></a><span class="x">  {</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-7"></a><span class="x">    $content .= drupal_get_form ( 'feedback_messageadmin_form', $messageid );</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-8"></a><span class="x">    $content .= "";</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-9"></a><span class="x">  }</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-10"></a>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-11"></a><span class="x">  $header = array</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-12"></a><span class="x">  (</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-13"></a><span class="x">    array('data' =&gt; t('Date'), 'field' =&gt; 'indate', 'sort' =&gt; 'desc'),</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-14"></a><span class="x">    array('data' =&gt; t('User'), 'field' =&gt; 'name'),</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-15"></a><span class="x">    array('data' =&gt; t('email'), 'field'=&gt;'mail'),</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-16"></a><span class="x">    array('data' =&gt; t('Message'), 'field' =&gt; 'message'),</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-17"></a><span class="x">    array('data' =&gt; t('Read'), 'field'=&gt;'fm.read'),</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-18"></a><span class="x">  );</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-19"></a>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-20"></a><span class="x">  $query = "SELECT fm.id, u.uid as uid, u.name, fm.usermail, fm.indate, fm.message, fm.read FROM {feedback_messages} fm, {users} u WHERE fm.uid=u.uid";</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-21"></a><span class="x">  $query .= tablesort_sql ( $header );</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-22"></a><span class="x">  $queryResult =  db_query ( $query );</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-23"></a>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-24"></a><span class="x">  $rows = array ();</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-25"></a><span class="x">  while ( $message = db_fetch_object ( $queryResult ) )</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-26"></a><span class="x">  {</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-27"></a><span class="x">    $row = array ();</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-28"></a><span class="x">    $row['indate'] = $message-&gt;indate;</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-29"></a><span class="x">    $row['name'] = $message-&gt;uid != 0 ? '' . $message-&gt;name . '' : $message-&gt;name;</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-30"></a><span class="x">    $row['mail'] = $message-&gt;usermail;</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-31"></a><span class="x">    $row['message'] = $message-&gt;message;</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-32"></a><span class="x">    $row['read'] = $message-&gt;read;</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-33"></a><span class="x">    $row['edit'] = l ( t('edit'), "feedback/adminmessages/" . $message-&gt;id );</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-34"></a><span class="x">    $rows[] = $row;</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-35"></a><span class="x">  }</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-36"></a>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-37"></a><span class="x">  $content .= theme_table($header, $rows);</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-38"></a><span class="x">  return $content;</span>
<a name="rest_code_c71740de45214d5ea6412771f661aef9-39"></a><span class="x">}</span>
</pre>
<p>¡¡¡ Mucho ojo, porque a esta función aún tenemos que añadirle una línea para el borrado !!!</p>
<p>Además he añadido una cosa nueva. Si pulsáis sobre el nombre de uno de los usuarios, os redirigirá a la página personal del mismo.</p>
<div class="section" id="borrando">
<h3>Borrando</h3>
<p>Ahora vamos a añadir una nueva operación: el borrado.</p>
<p>La forma de realizarlo va a ser similar a como está hecha la edición, con la diferencia de que vamos a cambiar el botón por uno de "eliminar". Así que resulta fácil realizar este paso, aunque tendrá sus inconvenientes :-D</p>
<p>Comenzamos como siempre: permisos, menú, función principal y formularios.</p>
<p>No necesitamos más permisos de los que ya tenemos, así que en la función de menú (<code>feedback_menu</code>), añadimos lo siguiente:</p>
<pre class="code php"><a name="rest_code_b03ecfc0fcef4d4184c5ba7865b8f621-1"></a><span class="x">$items['feedback/delete/%'] = array</span>
<a name="rest_code_b03ecfc0fcef4d4184c5ba7865b8f621-2"></a><span class="x">  (</span>
<a name="rest_code_b03ecfc0fcef4d4184c5ba7865b8f621-3"></a><span class="x">    'title' =&gt; 'Feedback delete',</span>
<a name="rest_code_b03ecfc0fcef4d4184c5ba7865b8f621-4"></a><span class="x">    'page callback' =&gt; 'feedback_delete',</span>
<a name="rest_code_b03ecfc0fcef4d4184c5ba7865b8f621-5"></a><span class="x">    'access arguments' =&gt; array('view messages'),</span>
<a name="rest_code_b03ecfc0fcef4d4184c5ba7865b8f621-6"></a><span class="x">    'page arguments' =&gt; array ( 2 ),</span>
<a name="rest_code_b03ecfc0fcef4d4184c5ba7865b8f621-7"></a><span class="x">    'type' =&gt; MENU_CALLBACK,</span>
<a name="rest_code_b03ecfc0fcef4d4184c5ba7865b8f621-8"></a><span class="x">  );</span>
</pre>
<p>Ahora creamos la función principal:</p>
<pre class="code php"><a name="rest_code_fdd6c502e8734dac9b5292599dd35583-1"></a><span class="x">function feedback_delete ( $messageid=null )</span>
<a name="rest_code_fdd6c502e8734dac9b5292599dd35583-2"></a><span class="x">{</span>
<a name="rest_code_fdd6c502e8734dac9b5292599dd35583-3"></a><span class="x">  $content = '';</span>
<a name="rest_code_fdd6c502e8734dac9b5292599dd35583-4"></a><span class="x">  $content .= drupal_get_form ( 'feedback_delete_form', $messageid );</span>
<a name="rest_code_fdd6c502e8734dac9b5292599dd35583-5"></a>
<a name="rest_code_fdd6c502e8734dac9b5292599dd35583-6"></a><span class="x">  return $content;</span>
<a name="rest_code_fdd6c502e8734dac9b5292599dd35583-7"></a><span class="x">}</span>
</pre>
<p>Muy similar a <code>feedback_message</code>. Y también creamos el formulario:</p>
<pre class="code php"><a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-1"></a><span class="x">function feedback_delete_form ( $form, $messageid )</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-2"></a><span class="x">{</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-3"></a><span class="x">  $query = "SELECT fm.message, fm.read, fm.indate, u.name FROM {feedback_messages} fm, {users} u WHERE fm.id=%d and u.uid=fm.uid";</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-4"></a><span class="x">  $queryResult = db_query ( $query, $messageid );</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-5"></a><span class="x">  $message = db_fetch_object ( $queryResult );</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-6"></a>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-7"></a><span class="x">  $form = array</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-8"></a><span class="x">    (</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-9"></a><span class="x">      'feedback' =&gt; array</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-10"></a><span class="x">      (</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-11"></a><span class="x">        '#type' =&gt; 'fieldset',</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-12"></a><span class="x">        '#title' =&gt; t( 'Feedback from ' . $message-&gt;name .' sended on ' . $message-&gt;indate ),</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-13"></a><span class="x">        'messageid' =&gt; array ( '#type' =&gt; 'hidden', "#default_value" =&gt; $messageid ),</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-14"></a><span class="x">        'message' =&gt; array ( '#type' =&gt; 'textarea', "#default_value" =&gt; $message-&gt;message, "#disabled" =&gt; TRUE ),</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-15"></a><span class="x">        'read'  =&gt; array ( '#type'=&gt; 'checkbox', "#title" =&gt; "Read","#default_value" =&gt; $message-&gt;read, "#disabled" =&gt; TRUE ),</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-16"></a><span class="x">        'submit' =&gt; array ( '#type' =&gt; 'submit',  '#value' =&gt; t('Delete forever'),  ),</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-17"></a><span class="x">      ),</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-18"></a><span class="x">    );</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-19"></a><span class="x">    return $form;</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-20"></a><span class="x">}</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-21"></a>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-22"></a><span class="x">function feedback_delete_form_submit ( $form, &amp;$form_state )</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-23"></a><span class="x">{</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-24"></a><span class="x">  $messageid = $form_state['values']['messageid'];</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-25"></a>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-26"></a><span class="x">  $query = "DELETE FROM {feedback_messages} where id=%d";</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-27"></a><span class="x">  $queryResult = db_query ( $query, $messageid );</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-28"></a>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-29"></a><span class="x">  if(db_affected_rows()){</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-30"></a><span class="x">    drupal_set_message ( t ( "Message deleted" ) );</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-31"></a><span class="x">  }</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-32"></a>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-33"></a><span class="x">  drupal_goto ('/feedback/adminmessages');</span>
<a name="rest_code_4c4e3277fdd84c99a4d9b732f83a2357-34"></a><span class="x">}</span>
</pre>
<p>Como véis, me he saltado la validación, ya que no hay nada que validar. El formulario es muy parecido al de <code>feedback_messageadmin_form</code>, pero con la diferencia de que el campo "read" también es de sólo lectura.</p>
<p>Lo que nos queda es poder llegar a este formulario. Para llegar, dijimos que usaríamos un sistema similar al del botón "edit", así que eso mismo vamos a hacer: En la función <code>feedback_admin</code>, el final quedará así:</p>
<pre class="code php"><a name="rest_code_1264817588d84b76ad463b5a24db25fd-1"></a><span class="x">function feedback_admin( $messageid=null ) {</span>
<a name="rest_code_1264817588d84b76ad463b5a24db25fd-2"></a><span class="x">    [...]</span>
<a name="rest_code_1264817588d84b76ad463b5a24db25fd-3"></a><span class="x">    $row['edit'] = l ( t('edit'), "feedback/adminmessages/" . $message-&gt;id );</span>
<a name="rest_code_1264817588d84b76ad463b5a24db25fd-4"></a><span class="x">    $row['delete'] = l ( t('delete'), "feedback/delete/" . $message-&gt;id );</span>
<a name="rest_code_1264817588d84b76ad463b5a24db25fd-5"></a><span class="x">    $rows[] = $row;</span>
<a name="rest_code_1264817588d84b76ad463b5a24db25fd-6"></a><span class="x">  }</span>
<a name="rest_code_1264817588d84b76ad463b5a24db25fd-7"></a>
<a name="rest_code_1264817588d84b76ad463b5a24db25fd-8"></a><span class="x">  $content .= theme_table($header, $rows);</span>
<a name="rest_code_1264817588d84b76ad463b5a24db25fd-9"></a><span class="x">  return $content;</span>
<a name="rest_code_1264817588d84b76ad463b5a24db25fd-10"></a><span class="x">}</span>
</pre>
</div>
</div>
<div class="section" id="dos-palabras">
<h2>Dos palabras</h2>
<p>Últimamente estoy recibiendo muchas consultas sobre cómo hacer tal o cual cosa en drupal. La verdad es que no esperaba tener "tanto" éxito con los tutoriales... casi ni explico nada, sólo he desglosado un ejercicio en partes tan pequeñas que no dé miedo atacarlas.</p>
<p>Así que tan sólo puedo deciros una cosa: ¡¡ Muchas gracias !! ;)</p>
</div>
<div class="section" id="mas-tutoriales">
<h2>Más tutoriales</h2>
<p>Este tutorial es la continuación de una serie de tutoriales relacionados con Drupal. Podéis consultar cualquiera de ellos:</p>
<ul class="simple">
<li><a class="reference external" href="/blog/creacion-modulo-drupal">Creación de un módulo drupal (I)</a></li>
<li><a class="reference external" href="/blog/creacion-modulo-drupal-2">Creación de un módulo drupal (II)</a></li>
<li><a class="reference external" href="/blog/creacion-modulo-drupal-4">Creación de un módulo drupal (IV)</a></li>
<li><a class="reference external" href="/blog/drupal-expansors">Drupal: Creando contenido con 'expansors'</a></li>
<li><a class="reference external" href="/blog/critica-drupal">Crítica a Drupal</a></li>
<li><a class="reference external" href="/blog/drupal-tabla-perfecta">Tablas en Drupal: Haciendo la tabla perfecta</a></li>
</ul>
</div>
<div class="section" id="codigo">
<h2>Código</h2>
<p>Aquí tenéis todo el código necesario:</p>
<div class="section" id="feedback-info">
<h3>feedback.info</h3>
<pre class="code php"><a name="rest_code_d2b5e2f78c3a4dc09cdd386a2f3f593e-1"></a><span class="x">; $Id$</span>
<a name="rest_code_d2b5e2f78c3a4dc09cdd386a2f3f593e-2"></a><span class="x">name = "MagMax Feedback"</span>
<a name="rest_code_d2b5e2f78c3a4dc09cdd386a2f3f593e-3"></a><span class="x">description = "Proporciona un sistema de feedbacks fácil para drupal"</span>
<a name="rest_code_d2b5e2f78c3a4dc09cdd386a2f3f593e-4"></a><span class="x">core = 6.x</span>
</pre>
</div>
<div class="section" id="feedback-install">
<h3>feedback.install</h3>
<pre class="code php"><a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-1"></a><span class="cp">&lt;?php</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-2"></a><span class="cm">/*</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-3"></a><span class="cm">Copyright 2009 Miguel Ángel García Martínez</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-4"></a>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-5"></a><span class="cm">  'Feedback' is free software; you can redistribute it and/or modify</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-6"></a><span class="cm">it under the terms of the GNU General Public License as published by</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-7"></a><span class="cm">the Free Software Foundation; either version 3 of the License, or</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-8"></a><span class="cm">(at your option) any later version.</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-9"></a>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-10"></a><span class="cm">  'Feedback' is distributed in the hope that it will be useful,</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-11"></a><span class="cm">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-12"></a><span class="cm">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-13"></a><span class="cm">GNU General Public License for more details.</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-14"></a>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-15"></a><span class="cm">  You should have received a copy of the GNU General Public License</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-16"></a><span class="cm">along with 'Feedback' (maybe in file "COPYING"); if not, write to the Free Software</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-17"></a><span class="cm">Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-18"></a><span class="cm">*/</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-19"></a>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-20"></a>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-21"></a><span class="k">function</span> <span class="nf">feedback_schema</span> <span class="p">()</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-22"></a><span class="p">{</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-23"></a>  <span class="nv">$schema</span><span class="p">[</span><span class="s1">'feedback_messages'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-24"></a>  <span class="p">(</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-25"></a>    <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Tabla para mensajes de retroalimentacion'</span><span class="p">),</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-26"></a>    <span class="s1">'fields'</span> <span class="o">=&gt;</span> <span class="k">array</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-27"></a>    <span class="p">(</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-28"></a>      <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="k">array</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-29"></a>      <span class="p">(</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-30"></a>        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Identificador de mensaje'</span><span class="p">),</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-31"></a>        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'serial'</span><span class="p">,</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-32"></a>        <span class="s1">'unsigned'</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-33"></a>        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-34"></a>      <span class="p">),</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-35"></a>      <span class="s1">'uid'</span> <span class="o">=&gt;</span> <span class="k">array</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-36"></a>      <span class="p">(</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-37"></a>        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Identificador del usuario que realiza el feedback'</span><span class="p">),</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-38"></a>        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'int'</span><span class="p">,</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-39"></a>        <span class="s1">'unsigned'</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-40"></a>        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="k">FALSE</span><span class="p">,</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-41"></a>      <span class="p">),</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-42"></a>      <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="k">array</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-43"></a>      <span class="p">(</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-44"></a>        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Mensaje de feedback'</span><span class="p">),</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-45"></a>        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'text'</span><span class="p">,</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-46"></a>        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-47"></a>      <span class="p">),</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-48"></a>      <span class="s1">'indate'</span> <span class="o">=&gt;</span> <span class="k">array</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-49"></a>      <span class="p">(</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-50"></a>        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Fecha en la que se crea el comentario'</span><span class="p">),</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-51"></a>        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'datetime'</span><span class="p">,</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-52"></a>        <span class="s1">'not null'</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-53"></a>      <span class="p">),</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-54"></a>    <span class="p">),</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-55"></a>    <span class="s1">'primary key'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'id'</span><span class="p">),</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-56"></a>  <span class="p">);</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-57"></a>  <span class="k">return</span> <span class="nv">$schema</span><span class="p">;</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-58"></a><span class="p">}</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-59"></a>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-60"></a><span class="k">function</span> <span class="nf">feedback_update_6100</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-61"></a>  <span class="nv">$ret</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-62"></a>  <span class="nx">db_add_field</span><span class="p">(</span><span class="nv">$ret</span><span class="p">,</span> <span class="s1">'feedback_messages'</span><span class="p">,</span> <span class="s1">'read'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'int'</span><span class="p">,</span> <span class="s1">'size'</span> <span class="o">=&gt;</span> <span class="s1">'tiny'</span><span class="p">));</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-63"></a>  <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-64"></a><span class="p">}</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-65"></a>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-66"></a><span class="k">function</span> <span class="nf">feedback_update_6103</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-67"></a>  <span class="nv">$ret</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-68"></a>  <span class="nx">db_add_field</span> <span class="p">(</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s1">'feedback_messages'</span><span class="p">,</span> <span class="s1">'usermail'</span><span class="p">,</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'text'</span> <span class="p">)</span> <span class="p">);</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-69"></a>  <span class="nx">db_change_field</span> <span class="p">(</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s1">'feedback_messages'</span><span class="p">,</span> <span class="s1">'uid'</span><span class="p">,</span> <span class="s1">'uid'</span><span class="p">,</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'type'</span><span class="o">=&gt;</span> <span class="s1">'int'</span><span class="p">,</span> <span class="s1">'unsigned'</span><span class="o">=&gt;</span><span class="k">TRUE</span> <span class="p">)</span> <span class="p">);</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-70"></a>  <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-71"></a><span class="p">}</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-72"></a>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-73"></a><span class="k">function</span> <span class="nf">feedback_install</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-74"></a>  <span class="c1">// Create my tables.</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-75"></a>  <span class="nx">drupal_install_schema</span><span class="p">(</span><span class="s1">'feedback'</span><span class="p">);</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-76"></a><span class="p">}</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-77"></a>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-78"></a><span class="k">function</span> <span class="nf">feedback_uninstall</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-79"></a>  <span class="c1">// Drop my tables.</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-80"></a>  <span class="nx">drupal_uninstall_schema</span><span class="p">(</span><span class="s1">'feedback'</span><span class="p">);</span>
<a name="rest_code_435793a9caff48a2b42ca18dc9e8ea0b-81"></a><span class="p">}</span>
</pre>
</div>
<div class="section" id="feedback-module">
<h3>feedback.module</h3>
<pre class="code php"><a name="rest_code_a722a671434b47fc94c7ae7db3565af4-1"></a><span class="cp">&lt;?php</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-2"></a><span class="cm">/*</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-3"></a><span class="cm">Copyright 2009 Miguel Ángel García Martínez</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-4"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-5"></a><span class="cm">  'Feedback' is free software; you can redistribute it and/or modify</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-6"></a><span class="cm">it under the terms of the GNU General Public License as published by</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-7"></a><span class="cm">the Free Software Foundation; either version 3 of the License, or</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-8"></a><span class="cm">(at your option) any later version.</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-9"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-10"></a><span class="cm">  'Feedback' is distributed in the hope that it will be useful,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-11"></a><span class="cm">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-12"></a><span class="cm">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-13"></a><span class="cm">GNU General Public License for more details.</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-14"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-15"></a><span class="cm">  You should have received a copy of the GNU General Public License</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-16"></a><span class="cm">along with 'Feedback' (maybe in file "COPYING"); if not, write to the Free Software</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-17"></a><span class="cm">Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-18"></a><span class="cm">*/</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-19"></a><span class="sd">/**</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-20"></a><span class="sd">* Implements hook_help().</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-21"></a><span class="sd">*/</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-22"></a><span class="k">function</span> <span class="nf">feedback_help</span> <span class="p">(</span> <span class="nv">$path</span><span class="p">,</span> <span class="nv">$arg</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-23"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-24"></a>  <span class="nv">$output</span><span class="o">=</span><span class="s1">''</span><span class="p">;</span> <span class="c1">// para construir la salida</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-25"></a>  <span class="k">switch</span> <span class="p">(</span> <span class="nx">path</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-26"></a>  <span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-27"></a>    <span class="k">case</span> <span class="s1">'admin/help#feedback'</span><span class="o">:</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-28"></a>      <span class="nv">$output</span> <span class="o">.=</span> <span class="s1">''</span> <span class="o">.</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Módulo que permite la inserción de mensajes de feedback.'</span><span class="p">)</span> <span class="o">.</span> <span class="s1">''</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-29"></a>      <span class="k">break</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-30"></a>  <span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-31"></a>  <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-32"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-33"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-34"></a><span class="sd">/**</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-35"></a><span class="sd">* Implements hook_perm().</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-36"></a><span class="sd">*/</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-37"></a><span class="k">function</span> <span class="nf">feedback_perm</span> <span class="p">()</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-38"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-39"></a>  <span class="k">return</span> <span class="k">array</span> <span class="p">(</span><span class="s1">'send message'</span><span class="p">,</span> <span class="s1">'view messages'</span><span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-40"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-41"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-42"></a><span class="sd">/**</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-43"></a><span class="sd">* Implementation of hook_block().</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-44"></a><span class="sd">*/</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-45"></a><span class="k">function</span> <span class="nf">feedback_block</span> <span class="p">(</span> <span class="nv">$op</span> <span class="o">=</span> <span class="s1">'list'</span><span class="p">,</span> <span class="nv">$delta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$edit</span> <span class="o">=</span> <span class="k">array</span><span class="p">()</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-46"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-47"></a>  <span class="k">if</span> <span class="p">(</span> <span class="nv">$op</span> <span class="o">==</span> <span class="s2">"list"</span><span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-48"></a>  <span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-49"></a>      <span class="nv">$blocks</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-50"></a>      <span class="nv">$blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"info"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Feedback'</span><span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-51"></a>      <span class="nv">$blocks</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">"info"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'New Feedbacks'</span><span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-52"></a>      <span class="k">return</span> <span class="nv">$blocks</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-53"></a>  <span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-54"></a>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nv">$op</span> <span class="o">==</span> <span class="s2">"view"</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-55"></a>  <span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-56"></a>      <span class="nv">$content</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-57"></a>      <span class="nv">$block</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-58"></a>      <span class="k">switch</span> <span class="p">(</span> <span class="nv">$delta</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-59"></a>      <span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-60"></a>        <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-61"></a>          <span class="nv">$block</span><span class="p">[</span><span class="s1">'subject'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Feedback'</span><span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-62"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-63"></a>          <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s2">"attributes"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">"title"</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s2">"Sends a feedback message"</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-64"></a>          <span class="nv">$link</span> <span class="o">=</span> <span class="nx">l</span><span class="p">(</span> <span class="nx">t</span><span class="p">(</span><span class="s2">"New Feedback"</span><span class="p">),</span> <span class="s2">"feedback/message"</span><span class="p">,</span> <span class="nv">$options</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-65"></a>          <span class="nv">$content</span> <span class="o">.=</span> <span class="s1">''</span> <span class="o">.</span> <span class="nv">$link</span> <span class="o">.</span> <span class="s2">""</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-66"></a>          <span class="k">break</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-67"></a>        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-68"></a>          <span class="nv">$block</span><span class="p">[</span><span class="s1">'subject'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Feedback Messages'</span><span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-69"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-70"></a>          <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s2">"attributes"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">"title"</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s2">"Shows feedback messages"</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-71"></a>          <span class="nv">$title</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s2">"There are @total new feeds"</span><span class="p">,</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'@total'</span> <span class="o">=&gt;</span> <span class="nx">_feedback_count</span><span class="p">()</span> <span class="p">)</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-72"></a>          <span class="nv">$link</span> <span class="o">=</span> <span class="nx">l</span><span class="p">(</span> <span class="nv">$title</span> <span class="p">,</span> <span class="s2">"feedback/adminmessages"</span><span class="p">,</span> <span class="nv">$options</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-73"></a>          <span class="nv">$content</span> <span class="o">.=</span> <span class="s1">''</span> <span class="o">.</span> <span class="nv">$link</span> <span class="o">.</span> <span class="s2">""</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-74"></a>          <span class="k">break</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-75"></a>      <span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-76"></a>      <span class="nv">$block</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$content</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-77"></a>      <span class="k">return</span> <span class="nv">$block</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-78"></a>  <span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-79"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-80"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-81"></a><span class="sd">/**</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-82"></a><span class="sd">* Implementation of hook_menu().</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-83"></a><span class="sd">*/</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-84"></a><span class="k">function</span> <span class="nf">feedback_menu</span> <span class="p">(</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-85"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-86"></a>  <span class="nv">$items</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-87"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-88"></a>  <span class="nv">$items</span><span class="p">[</span><span class="s1">'feedback/message'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-89"></a>  <span class="p">(</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-90"></a>    <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'Feedback'</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-91"></a>    <span class="s1">'page callback'</span> <span class="o">=&gt;</span> <span class="s1">'feedback_message'</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-92"></a>    <span class="s1">'access arguments'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'send message'</span><span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-93"></a>    <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="nx">MENU_CALLBACK</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-94"></a>  <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-95"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-96"></a>  <span class="nv">$items</span><span class="p">[</span><span class="s1">'feedback/adminmessages/%'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-97"></a>  <span class="p">(</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-98"></a>    <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'Feedback admin'</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-99"></a>    <span class="s1">'page callback'</span> <span class="o">=&gt;</span> <span class="s1">'feedback_admin'</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-100"></a>    <span class="s1">'page arguments'</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="mi">2</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-101"></a>    <span class="s1">'access arguments'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'view messages'</span><span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-102"></a>    <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="nx">MENU_CALLBACK</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-103"></a>  <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-104"></a>  <span class="nv">$items</span><span class="p">[</span><span class="s1">'feedback/adminmessages'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-105"></a>  <span class="p">(</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-106"></a>    <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'Feedback admin'</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-107"></a>    <span class="s1">'page callback'</span> <span class="o">=&gt;</span> <span class="s1">'feedback_admin'</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-108"></a>    <span class="s1">'access arguments'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'view messages'</span><span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-109"></a>    <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="nx">MENU_CALLBACK</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-110"></a>  <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-111"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-112"></a>  <span class="nv">$items</span><span class="p">[</span><span class="s1">'feedback/delete/%'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-113"></a>  <span class="p">(</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-114"></a>    <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'Feedback delete'</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-115"></a>    <span class="s1">'page callback'</span> <span class="o">=&gt;</span> <span class="s1">'feedback_delete'</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-116"></a>    <span class="s1">'page arguments'</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="mi">2</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-117"></a>    <span class="s1">'access arguments'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'view messages'</span><span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-118"></a>    <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="nx">MENU_CALLBACK</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-119"></a>  <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-120"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-121"></a>  <span class="k">return</span> <span class="nv">$items</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-122"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-123"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-124"></a><span class="k">function</span> <span class="nf">feedback_message</span> <span class="p">()</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-125"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-126"></a>  <span class="nv">$content</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-127"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-128"></a>  <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">drupal_get_form</span> <span class="p">(</span> <span class="s1">'feedback_message_form'</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-129"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-130"></a>  <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-131"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-132"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-133"></a><span class="k">function</span> <span class="nf">feedback_message_form</span> <span class="p">()</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-134"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-135"></a>  <span class="k">global</span> <span class="nv">$user</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-136"></a>  <span class="nv">$mail</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-137"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-138"></a>  <span class="k">if</span> <span class="p">(</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">uid</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-139"></a>    <span class="nv">$mail</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">mail</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-140"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-141"></a>  <span class="nv">$form</span> <span class="o">=</span> <span class="k">array</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-142"></a>  <span class="p">(</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-143"></a>    <span class="s1">'feedback'</span> <span class="o">=&gt;</span> <span class="k">array</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-144"></a>    <span class="p">(</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-145"></a>      <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'fieldset'</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-146"></a>      <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span> <span class="s1">'Feedback'</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-147"></a>      <span class="s1">'mail'</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textfield'</span><span class="p">,</span> <span class="s2">"#title"</span><span class="o">=&gt;</span><span class="s2">"E-Mail"</span><span class="p">,</span> <span class="s2">"#description"</span><span class="o">=&gt;</span><span class="s2">"If you want any answer, please, tell me your mail. It would not be shown anywhere."</span><span class="p">,</span> <span class="s2">"#default_value"</span> <span class="o">=&gt;</span> <span class="nv">$mail</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-148"></a>      <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textarea'</span><span class="p">,</span> <span class="s2">"#description"</span><span class="o">=&gt;</span><span class="s2">"Write here your message"</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-149"></a>      <span class="s1">'submit'</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'submit'</span><span class="p">,</span>  <span class="s1">'#value'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Submit'</span><span class="p">),</span>  <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-150"></a>    <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-151"></a>  <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-152"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-153"></a>  <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-154"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-155"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-156"></a><span class="k">function</span> <span class="nf">feedback_message_form_validate</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-157"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-158"></a>  <span class="k">global</span> <span class="nv">$user</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-159"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-160"></a>  <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">'values'</span><span class="p">][</span><span class="s1">'message'</span><span class="p">];</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-161"></a>  <span class="nv">$mail</span>    <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">'values'</span><span class="p">][</span><span class="s1">'mail'</span><span class="p">];</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-162"></a>  <span class="nv">$validmail</span> <span class="o">=</span> <span class="nb">preg_match</span> <span class="p">(</span><span class="s2">"/^[^0-9][A-z0-9_]+([.][A-z0-9_]+)*[@][A-z0-9_]+([.][A-z0-9_]+)*[.][A-z]{2,4}$/"</span> <span class="p">,</span> <span class="nv">$mail</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-163"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-164"></a>  <span class="k">if</span> <span class="p">(</span> <span class="nv">$mail</span> <span class="o">==</span> <span class="s1">''</span> <span class="o">&amp;&amp;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">uid</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-165"></a>    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">'mail'</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'You are not a registered user. Please, insert your e-mail.'</span><span class="p">)</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-166"></a>  <span class="k">if</span> <span class="p">(</span> <span class="nv">$mail</span> <span class="o">!=</span> <span class="s1">''</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nv">$validmail</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-167"></a>    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">'mail'</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'The mail does not like an e-mail address.'</span><span class="p">)</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-168"></a>  <span class="k">if</span> <span class="p">(</span> <span class="nv">$message</span> <span class="o">==</span> <span class="s1">''</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-169"></a>    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">'message'</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Message cannot be empty.'</span><span class="p">));</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-170"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-171"></a>  <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-172"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-173"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-174"></a><span class="k">function</span> <span class="nf">feedback_message_form_submit</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-175"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-176"></a>  <span class="k">global</span> <span class="nv">$user</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-177"></a>  <span class="nv">$userid</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-178"></a>  <span class="k">if</span> <span class="p">(</span> <span class="nv">$user</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-179"></a>    <span class="nv">$userid</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">uid</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-180"></a>  <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">'values'</span><span class="p">][</span><span class="s1">'message'</span><span class="p">];</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-181"></a>  <span class="nv">$mail</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">'values'</span><span class="p">][</span><span class="s1">'mail'</span><span class="p">];</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-182"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-183"></a>  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"INSERT into {feedback_messages} ( uid, message, indate, usermail ) values ( %d, '%s', now(), '%s' ) "</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-184"></a>  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$userid</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$mail</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-185"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-186"></a>  <span class="k">if</span> <span class="p">(</span> <span class="nx">db_affected_rows</span><span class="p">()</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-187"></a>  <span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-188"></a>    <span class="nx">drupal_set_message</span> <span class="p">(</span> <span class="nx">t</span> <span class="p">(</span> <span class="s2">"Thank you for your feedback."</span> <span class="p">)</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-189"></a>    <span class="nx">drupal_goto</span> <span class="p">(</span> <span class="s1">'node'</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-190"></a>  <span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-191"></a>  <span class="k">else</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-192"></a>    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">'feedback'</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span> <span class="s2">"An error has happened. Your feedback has not been sent."</span> <span class="p">)</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-193"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-194"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-195"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-196"></a><span class="k">function</span> <span class="nf">feedback_admin</span> <span class="p">(</span> <span class="nv">$messageid</span><span class="o">=</span><span class="k">null</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-197"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-198"></a>  <span class="nv">$content</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-199"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-200"></a>  <span class="k">if</span> <span class="p">(</span> <span class="nv">$messageid</span> <span class="o">!=</span> <span class="k">null</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-201"></a>  <span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-202"></a>    <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">drupal_get_form</span> <span class="p">(</span> <span class="s1">'feedback_messageadmin_form'</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-203"></a>    <span class="nv">$content</span> <span class="o">.=</span> <span class="s2">""</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-204"></a>  <span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-205"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-206"></a>  <span class="nv">$header</span> <span class="o">=</span> <span class="k">array</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-207"></a>  <span class="p">(</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-208"></a>    <span class="k">array</span><span class="p">(</span><span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Date'</span><span class="p">),</span> <span class="s1">'field'</span> <span class="o">=&gt;</span> <span class="s1">'indate'</span><span class="p">,</span> <span class="s1">'sort'</span> <span class="o">=&gt;</span> <span class="s1">'desc'</span><span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-209"></a>    <span class="k">array</span><span class="p">(</span><span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'User'</span><span class="p">),</span> <span class="s1">'field'</span> <span class="o">=&gt;</span> <span class="s1">'name'</span><span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-210"></a>    <span class="k">array</span><span class="p">(</span><span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'email'</span><span class="p">),</span> <span class="s1">'field'</span><span class="o">=&gt;</span><span class="s1">'mail'</span><span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-211"></a>    <span class="k">array</span><span class="p">(</span><span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Message'</span><span class="p">),</span> <span class="s1">'field'</span> <span class="o">=&gt;</span> <span class="s1">'message'</span><span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-212"></a>    <span class="k">array</span><span class="p">(</span><span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Read'</span><span class="p">),</span> <span class="s1">'field'</span><span class="o">=&gt;</span><span class="s1">'fm.read'</span><span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-213"></a>  <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-214"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-215"></a>  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT fm.id, u.uid as uid, u.name, fm.usermail, fm.indate, fm.message, fm.read FROM {feedback_messages} fm, {users} u WHERE fm.uid=u.uid"</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-216"></a>  <span class="nv">$query</span> <span class="o">.=</span> <span class="nx">tablesort_sql</span> <span class="p">(</span> <span class="nv">$header</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-217"></a>  <span class="nv">$queryResult</span> <span class="o">=</span>  <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-218"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-219"></a>  <span class="nv">$rows</span> <span class="o">=</span> <span class="k">array</span> <span class="p">();</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-220"></a>  <span class="k">while</span> <span class="p">(</span> <span class="nv">$message</span> <span class="o">=</span> <span class="nx">db_fetch_object</span> <span class="p">(</span> <span class="nv">$queryResult</span> <span class="p">)</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-221"></a>  <span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-222"></a>    <span class="nv">$row</span> <span class="o">=</span> <span class="k">array</span> <span class="p">();</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-223"></a>    <span class="nv">$row</span><span class="p">[</span><span class="s1">'indate'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">indate</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-224"></a>    <span class="nv">$row</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">uid</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">''</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span> <span class="s1">''</span> <span class="o">:</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-225"></a>    <span class="nv">$row</span><span class="p">[</span><span class="s1">'mail'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">usermail</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-226"></a>    <span class="nv">$row</span><span class="p">[</span><span class="s1">'message'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-227"></a>    <span class="nv">$row</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-228"></a>    <span class="nv">$row</span><span class="p">[</span><span class="s1">'edit'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">l</span> <span class="p">(</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'edit'</span><span class="p">),</span> <span class="s2">"feedback/adminmessages/"</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">id</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-229"></a>    <span class="nv">$row</span><span class="p">[</span><span class="s1">'delete'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">l</span> <span class="p">(</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'delete'</span><span class="p">),</span> <span class="s2">"feedback/delete/"</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">id</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-230"></a>    <span class="nv">$rows</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-231"></a>  <span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-232"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-233"></a>  <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">theme_table</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="nv">$rows</span><span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-234"></a>  <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-235"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-236"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-237"></a><span class="sd">/** Devuelve el número de feeds creados en la última semana</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-238"></a><span class="sd">*/</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-239"></a><span class="k">function</span> <span class="nf">_feedback_count</span> <span class="p">()</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-240"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-241"></a>  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT count(id) as total from {feedback_messages} fm where fm.read != 1 or isnull(fm.read)"</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-242"></a>  <span class="nv">$queryResult</span> <span class="o">=</span>  <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-243"></a>  <span class="nv">$result</span> <span class="o">=</span> <span class="nx">db_fetch_object</span> <span class="p">(</span> <span class="nv">$queryResult</span> <span class="p">)</span> <span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-244"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-245"></a>  <span class="k">return</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">total</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-246"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-247"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-248"></a><span class="k">function</span> <span class="nf">feedback_messageadmin_form</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-249"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-250"></a>  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT fm.message, fm.read, fm.indate, u.name FROM {feedback_messages} fm, {users} u WHERE fm.id=%d and u.uid=fm.uid"</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-251"></a>  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-252"></a>  <span class="nv">$message</span> <span class="o">=</span> <span class="nx">db_fetch_object</span> <span class="p">(</span> <span class="nv">$queryResult</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-253"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-254"></a>  <span class="nv">$form</span> <span class="o">=</span> <span class="k">array</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-255"></a>    <span class="p">(</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-256"></a>      <span class="s1">'feedback'</span> <span class="o">=&gt;</span> <span class="k">array</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-257"></a>      <span class="p">(</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-258"></a>        <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'fieldset'</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-259"></a>        <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span> <span class="s1">'Feedback from '</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span><span class="s1">' sended on '</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">indate</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-260"></a>        <span class="s1">'messageid'</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'hidden'</span><span class="p">,</span> <span class="s2">"#default_value"</span> <span class="o">=&gt;</span> <span class="nv">$messageid</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-261"></a>        <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textarea'</span><span class="p">,</span> <span class="s2">"#default_value"</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">,</span> <span class="s2">"#disabled"</span> <span class="o">=&gt;</span> <span class="k">TRUE</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-262"></a>        <span class="s1">'read'</span>  <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'#type'</span><span class="o">=&gt;</span> <span class="s1">'checkbox'</span><span class="p">,</span> <span class="s2">"#title"</span> <span class="o">=&gt;</span> <span class="s2">"Read"</span><span class="p">,</span><span class="s2">"#default_value"</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">read</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-263"></a>        <span class="s1">'submit'</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'submit'</span><span class="p">,</span>  <span class="s1">'#value'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Submit'</span><span class="p">),</span>  <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-264"></a>      <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-265"></a>    <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-266"></a>    <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-267"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-268"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-269"></a><span class="k">function</span> <span class="nf">feedback_messageadmin_form_submit</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-270"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-271"></a>  <span class="nv">$messageid</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">'values'</span><span class="p">][</span><span class="s1">'messageid'</span><span class="p">];</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-272"></a>  <span class="nv">$read</span>      <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">'values'</span><span class="p">][</span><span class="s1">'read'</span><span class="p">];</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-273"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-274"></a>  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"UPDATE {feedback_messages} fm set fm.read=%d where fm.id=%d"</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-275"></a>  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$read</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-276"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-277"></a>  <span class="nx">drupal_goto</span> <span class="p">(</span><span class="s1">'/feedback/adminmessages'</span><span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-278"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-279"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-280"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-281"></a><span class="k">function</span> <span class="nf">feedback_delete</span> <span class="p">(</span> <span class="nv">$messageid</span><span class="o">=</span><span class="k">null</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-282"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-283"></a>  <span class="nv">$content</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-284"></a>  <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">drupal_get_form</span> <span class="p">(</span> <span class="s1">'feedback_delete_form'</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-285"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-286"></a>  <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-287"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-288"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-289"></a><span class="k">function</span> <span class="nf">feedback_delete_form</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-290"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-291"></a>  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT fm.message, fm.read, fm.indate, u.name FROM {feedback_messages} fm, {users} u WHERE fm.id=%d and u.uid=fm.uid"</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-292"></a>  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-293"></a>  <span class="nv">$message</span> <span class="o">=</span> <span class="nx">db_fetch_object</span> <span class="p">(</span> <span class="nv">$queryResult</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-294"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-295"></a>  <span class="nv">$form</span> <span class="o">=</span> <span class="k">array</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-296"></a>    <span class="p">(</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-297"></a>      <span class="s1">'feedback'</span> <span class="o">=&gt;</span> <span class="k">array</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-298"></a>      <span class="p">(</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-299"></a>        <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'fieldset'</span><span class="p">,</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-300"></a>        <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span> <span class="s1">'Feedback from '</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span><span class="s1">' sended on '</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">indate</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-301"></a>        <span class="s1">'messageid'</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'hidden'</span><span class="p">,</span> <span class="s2">"#default_value"</span> <span class="o">=&gt;</span> <span class="nv">$messageid</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-302"></a>        <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textarea'</span><span class="p">,</span> <span class="s2">"#default_value"</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">,</span> <span class="s2">"#disabled"</span> <span class="o">=&gt;</span> <span class="k">TRUE</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-303"></a>        <span class="s1">'read'</span>  <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'#type'</span><span class="o">=&gt;</span> <span class="s1">'checkbox'</span><span class="p">,</span> <span class="s2">"#title"</span> <span class="o">=&gt;</span> <span class="s2">"Read"</span><span class="p">,</span><span class="s2">"#default_value"</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">,</span> <span class="s2">"#disabled"</span> <span class="o">=&gt;</span> <span class="k">TRUE</span> <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-304"></a>        <span class="s1">'submit'</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'submit'</span><span class="p">,</span>  <span class="s1">'#value'</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Delete forever'</span><span class="p">),</span>  <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-305"></a>      <span class="p">),</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-306"></a>    <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-307"></a>    <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-308"></a><span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-309"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-310"></a><span class="k">function</span> <span class="nf">feedback_delete_form_submit</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span> <span class="p">)</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-311"></a><span class="p">{</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-312"></a>  <span class="nv">$messageid</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">'values'</span><span class="p">][</span><span class="s1">'messageid'</span><span class="p">];</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-313"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-314"></a>  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"DELETE FROM {feedback_messages} where id=%d"</span><span class="p">;</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-315"></a>  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-316"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-317"></a>  <span class="k">if</span><span class="p">(</span><span class="nx">db_affected_rows</span><span class="p">()){</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-318"></a>    <span class="nx">drupal_set_message</span> <span class="p">(</span> <span class="nx">t</span> <span class="p">(</span> <span class="s2">"Message deleted"</span> <span class="p">)</span> <span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-319"></a>  <span class="p">}</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-320"></a>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-321"></a>  <span class="nx">drupal_goto</span> <span class="p">(</span><span class="s1">'/feedback/adminmessages'</span><span class="p">);</span>
<a name="rest_code_a722a671434b47fc94c7ae7db3565af4-322"></a><span class="p">}</span>
</pre>
</div>
</div>
</div>
          </div>
          <br><div>
            <nav><span class="author">
                <span class="glyphicon glyphicon-user"></span> 
                <span>Publicado:Miguel Ángel García</span>
              </span>
               

              
              <span class="dateline">
                <span class="glyphicon glyphicon-calendar"></span> 
                <time class="published dt-published" datetime="2010-05-11T00:00:00+00:00" title="2010-05-11">2010-05-11</time></span>
               
              <span class="tags">
                <span class="glyphicon glyphicon-tags"></span> 
                <a class="label label-primary p-category" href="/categories/drupal/" rel="tag">drupal</a>
              </span>
                      <ul class="pager">
<li class="previous">
              <a href="/blog/creacion-modulo-drupal-2/" rel="prev" title="Creación de un módulo Drupal II">
                <span class="glyphicon glyphicon-arrow-left"></span>
                Publicación anterior
              </a>
            </li>
            <li class="next">
              <a href="/blog/creacion-modulo-drupal-4/" rel="next" title="Creación de un módulo Drupal IV">
                Siguiente publicación
                <span class="glyphicon glyphicon-arrow-right"></span>
              </a>
            </li>
        </ul></nav>
</div>
          <section class="comments"><h2>Comentarios</h2>
                            <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="magmax",
            disqus_url="http://magmax.org/blog/creacion-modulo-drupal-3/",
        disqus_title="Creaci\u00f3n de un m\u00f3dulo Drupal III",
        disqus_identifier="cache/posts/creacion-modulo-drupal-3.html",
        disqus_config = function () {
            this.language = "es_ES";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


          </section></article><script>var disqus_shortname="magmax";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
      <aside class="sidebar col-md-3"><div>
<section class="panel panel-default"><div class="panel-heading">
    <h3 class="panel-title">Last comments</h3>
  </div>
  <div class="panel-body">
    <div id="disqus_last_comments" class="dsq-widget">
      <script type="text/javascript" src="https://magmax.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=32&amp;excerpt_length=150">
      </script>
</div>
  </div>
</section>
</div>
          <div>
<section class="panel panel-default"><div class="panel-heading">
    <h3 class="panel-title">GitHub Repos</h3>
  </div>
  <div class="panel-body">
    <ul id="gh_repos" class="list-unstyled">
<li class="loading">Status updating…</li>
    </ul>
</div>
  <div class="panel-footer">
    <a href="https://github.com/magmax">@magmax</a> on GitHub
  </div>
</section>
</div>
      </aside>
</div>

    <footer>
      Contents © 2009-2020 <a href="mailto:">Miguel Ángel García</a> 
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/es/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;width:80px;height:15px;vertical-align:middle" src="https://i.creativecommons.org/l/by-nc-sa/2.5/es/80x15.png"></a>; Using <a href="/stories/credits/">a lot of free software</a>
      
    </footer>
</div>
</div>




<script data-main="/assets/js/main" src="/assets/js/libs/require/require.min.js"></script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9308241-3', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
