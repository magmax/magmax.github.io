<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Hg vs Git | El blog de MagMax</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Voy a comparar mercurial y git, pero sólo valen formas que sean reproducibles. Pretendo desmitificar o corroborar rumores.">
    <meta name="generator" content="Hugo 0.79.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    

    
      

    

    
    
    <meta property="og:title" content="Hg vs Git" />
<meta property="og:description" content="Voy a comparar mercurial y git, pero sólo valen formas que sean reproducibles. Pretendo desmitificar o corroborar rumores." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/comparativa-mercurial-git/" />
<meta property="article:published_time" content="2013-05-27T00:00:00+00:00" />
<meta property="article:modified_time" content="2013-05-27T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />
<meta itemprop="name" content="Hg vs Git">
<meta itemprop="description" content="Voy a comparar mercurial y git, pero sólo valen formas que sean reproducibles. Pretendo desmitificar o corroborar rumores.">
<meta itemprop="datePublished" content="2013-05-27T00:00:00+00:00" />
<meta itemprop="dateModified" content="2013-05-27T00:00:00+00:00" />
<meta itemprop="wordCount" content="1487">



<meta itemprop="keywords" content="mercurial,git,dvcs," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Hg vs Git"/>
<meta name="twitter:description" content="Voy a comparar mercurial y git, pero sólo valen formas que sean reproducibles. Pretendo desmitificar o corroborar rumores."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        El blog de MagMax
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="" title="Inicio page">
              Inicio
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="../en" title="English page">
              English
            </a>
          </li>
          
        </ul>
      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://magmax.org/blog/comparativa-mercurial-git/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://magmax.org/blog/comparativa-mercurial-git/&amp;text=Hg%20vs%20Git" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://magmax.org/blog/comparativa-mercurial-git/&amp;title=Hg%20vs%20Git" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Hg vs Git</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2013-05-27T00:00:00Z">May 27, 2013</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Vamos con tópicos: Mercurial vs Git.</p>
<p>Voy a intentar desmitificar o corroborar rumores, de manera unívoca y que cualquiera pueda reproducir.</p>
<p>Este artículo y los siguientes admiten colaboraciones :D</p>
<!-- raw HTML omitted -->
<figure>
    <img src="/images/gitvshg.png"
         alt="Git vs Mercurial"/> 
</figure>

<h2 id="este-artículo-es-un-coñazo">Este artículo es un coñazo</h2>
<p>Pues sí. Este artículo es un coñazo total. Por eso voy a comenzar por el final: las conclusiones. Así, los crédulos, pueden evitarse la parte de demostración y leer sólo las conclusiones. Los incrédulos pueden llegar hasta el final y comprobar que he tratado de ser todo lo objetivo posible.</p>
<h2 id="conclusiones">Conclusiones</h2>
<p>Aquí tenemos las conclusiones finales:</p>
<ul>
<li>Si en Mercurial renombras un archivo, el repositorio requiere de nuevo el espacio ocupado por el archivo. En git, la diferencia es inapreciable.</li>
<li>En Mercurial, dos &ldquo;push&rdquo; simultáneos sin conflicto pueden provocar que el segundo se cancele. En git no ocurre.</li>
</ul>
<p>Esto demuestra que Git da un mejor rendimiento que Mercurial.</p>
<h2 id="críticas">Críticas</h2>
<p>Por favor, estoy dispuesto a soportar cualquier tipo de crítica. Sin embargo, me gustaría indicar que este artículo me ha costado <strong>MUCHO</strong>, ya que no es nada sencillo pensar en las demostraciones y menos realizarlas de manera que se puedan repetir. Y también ha sido compleja la maquetación. Por esa razón, espero que cualquier crítica venga acompañada de demostraciones.</p>
<p>Sé de algunos otros problemas, pero no puedo demostrarlos, así que me los cayo. Estas pruebas son completamente <strong>OBJETIVAS</strong>.</p>
<p>También acepto demostraciones a favor/en contra de ambos. Sed creativos.</p>
<h2 id="agradecimientos">Agradecimientos</h2>
<p>Agradezco a <a href="https://arco.esi.uclm.es/~david.villa/">David Villa</a> su paciencia haciendo <em>code review</em> de estos scripts.
Me equivoqué al pasarle el de Mercurial y se puede decir que lo rehizo él solo.</p>
<h2 id="scripts">Scripts</h2>
<p>Los <em>Scripts</em> necesarios para reproducir lo que expongo aquí se pueden encontrar
en <a href="https://github.com/magmax/git-vs-hg">github</a>. Allí será donde haga modificaciones a los mismos.</p>
<h2 id="demostraciones">Demostraciones</h2>
<h3 id="si-mueves-un-archivo-en-mercurial-ocupará-espacio-de-nuevo">Si mueves un archivo en mercurial, ocupará espacio de nuevo</h3>
<table>

  <tr>

    <th>Mercurial</th>

    <th>Git</th>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ seq <span style="color:#ae81ff">10000000</span> &gt; $WC1/file
$ ls -lh $WC1
total 6,6M
-rw-r--r-- <span style="color:#ae81ff">1</span> miguel miguel 6,6M may <span style="color:#ae81ff">27</span> 19:39 file
$ hg -R $WC1 add $WC1/file
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ seq <span style="color:#ae81ff">10000000</span> &gt; $WC1/file
$ ls -lh $WC1
total 6,6M
-rw-r--r-- <span style="color:#ae81ff">1</span> miguel miguel 6,6M may <span style="color:#ae81ff">27</span> 19:39 file
$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 add $WC1/file
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ export WC1<span style="color:#f92672">=</span>/tmp/wc1-hg
$ hg init $WC1
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ export WC1<span style="color:#f92672">=</span>/tmp/wc1-git
$ git init $WC1
Initialized empty Git repository in /tmp/wc1-git/.git/
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ hg -R $WC1 commit -m <span style="color:#e6db74">&#34;initial&#34;</span>
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 commit -m <span style="color:#e6db74">&#34;initial&#34;</span>
<span style="color:#f92672">[</span>master <span style="color:#f92672">(</span>root-commit<span style="color:#f92672">)</span> 50f537c<span style="color:#f92672">]</span> initial
 <span style="color:#ae81ff">1</span> file changed, <span style="color:#ae81ff">1000000</span> insertions<span style="color:#f92672">(</span>+<span style="color:#f92672">)</span>
 create mode <span style="color:#ae81ff">100644</span> file
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ du -hs
8,7M /tmp/wc1-hg
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ du -hs /tmp/wc1-git
8,9M /tmp/wc1-git
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ hg -R $WC1 mv $WC1/file $WC1/example
$ hg -R $WC1 commit -m <span style="color:#e6db74">&#34;second&#34;</span>
$ du -hs $WC1
11M /tmp/wc1-hg
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 mv file example
$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 commit -am <span style="color:#e6db74">&#34;second&#34;</span>
<span style="color:#f92672">[</span>master f206fe1<span style="color:#f92672">]</span> second
 <span style="color:#ae81ff">1</span> file changed, <span style="color:#ae81ff">0</span> insertions<span style="color:#f92672">(</span>+<span style="color:#f92672">)</span>, <span style="color:#ae81ff">0</span> deletions<span style="color:#f92672">(</span>-<span style="color:#f92672">)</span>
 rename file <span style="color:#f92672">=</span>&gt; example <span style="color:#f92672">(</span>100%<span style="color:#f92672">)</span>
$ du -hs $WC1
8,9M /tmp/wc1-git
      </code></pre></div>
    </td>

  
</tr>



</table>

<p><strong>Conclusión:</strong> Si mueves un archivo en Mercurial, volverá a ocupar espacio. Si mueves un archivo en git, el repositorio seguirá ocupando lo mismo (prácticamente).</p>
<h3 id="conservando-historia-entre-moves">Conservando historia entre moves</h3>
<p>Este apartado continúa el script anterior:</p>
<table>

  <tr>

    <th>Mercurial</th>

    <th>Git</th>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ hg -R $WC1 mv $WC1/example $WC1/file
$ hg -R $WC1 commit -m <span style="color:#e6db74">&#34;third&#34;</span>
$ du -hs $WC1
11M /tmp/wc1-hg
$ hg -R $WC1 log $WC1/file --follow
changeset: 2:3d54fb888504
tag: tip
user: Miguel Angel Garcia &lt;magmax@example.org&gt;
date: Thu Jun <span style="color:#ae81ff">13</span> 05:31:08 <span style="color:#ae81ff">2013</span> +0200
summary: third

changeset: 1:f13ffb871397
user: Miguel Angel Garcia &lt;magmax@example.org&gt;
date: Thu Jun <span style="color:#ae81ff">13</span> 05:31:07 <span style="color:#ae81ff">2013</span> +0200
summary: second

changeset: 0:e47df7ca3541
user: Miguel Angel Garcia &lt;magmax@example.org&gt;
date: Thu Jun <span style="color:#ae81ff">13</span> 05:31:07 <span style="color:#ae81ff">2013</span> +0200
summary: initial
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 mv example file
$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 commit -am <span style="color:#e6db74">&#34;third&#34;</span>
<span style="color:#f92672">[</span>master dd45fed<span style="color:#f92672">]</span> third
 <span style="color:#ae81ff">1</span> file changed, <span style="color:#ae81ff">0</span> insertions<span style="color:#f92672">(</span>+<span style="color:#f92672">)</span>, <span style="color:#ae81ff">0</span> deletions<span style="color:#f92672">(</span>-<span style="color:#f92672">)</span>
 rename example <span style="color:#f92672">=</span>&gt; file <span style="color:#f92672">(</span>100%<span style="color:#f92672">)</span>
$ du -hs $WC1
8,9M /tmp/wc1-git
$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 log -- file
commit dd45fedd449babb33a019f23a2dae244e18f400c
Author: Miguel Angel Garcia &lt;magmax@example.org&gt;
Date: Mon May <span style="color:#ae81ff">27</span> 19:46:49 <span style="color:#ae81ff">2013</span> +0200

    third

commit f206fe12540494bf1f6f5193bd6234865da75e13
Author: Miguel Angel Garcia &lt;magmax@example.org&gt;
Date: Mon May <span style="color:#ae81ff">27</span> 19:46:48 <span style="color:#ae81ff">2013</span> +0200

    second

commit 50f537cac82b6499c8519af7c7710211bf96c0c3
Author: Miguel Angel Garcia &lt;magmax@example.org&gt;
Date: Mon May <span style="color:#ae81ff">27</span> 19:46:48 <span style="color:#ae81ff">2013</span> +0200

    initial
      </code></pre></div>
    </td>


  
</tr>



</table>

<p><strong>Conclusión</strong>: Tanto Mercurial como Git siguen correctamente la historia del archivo. (Gracias, Juan Penalta)</p>
<p>Como dato curioso, se observa que al volver a mover el archivo, en esta ocasión
no ocupa espacio en mercurial.</p>
<h3 id="dos-pushes-simultáneos-sin-conflicto">Dos <em>pushes</em> simultáneos sin conflicto</h3>
<p><strong>NOTA:</strong> En esta demostración se utilizará el archivo <code>annotate-output</code>, que se encuentra en el paquete &ldquo;<strong>devscripts</strong>&rdquo;. Tan solo añade la hora y el tipo de salida (<em>stdout</em> o <em>stderr</em>) y redirecciona todo a la salida estándar.</p>
<table>

  <tr>

    <th>Mercurial</th>

    <th>Git</th>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ export SERVER<span style="color:#f92672">=</span>server-hg
$ export WC1<span style="color:#f92672">=</span>/tmp/wc1-hg
$ export WC2<span style="color:#f92672">=</span>/tmp/wc2-hg
$ hg init $SERVER
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ export SERVER<span style="color:#f92672">=</span>/home/miguel/server-git
$ export WC1<span style="color:#f92672">=</span>/tmp/wc1-git
$ export WC2<span style="color:#f92672">=</span>/tmp/wc2-git
$ git --bare init $SERVER
Initialized empty Git repository in /tmp/server-git/
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo -e <span style="color:#e6db74">&#39;[hooks]\npretxnchangegroup.sleep=sleep 2&#39;</span> &gt; $SERVER/.hg/hgrc
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo -e <span style="color:#e6db74">&#39;#!/bin/bash\nsleep 2&#39;</span> &gt; $SERVER/hooks/post-receive
$ chmod <span style="color:#ae81ff">755</span> $SERVER/hooks/post-receive
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ hg clone ssh://localhost/$SERVER $WC1
no changes found
updating to branch default
<span style="color:#ae81ff">0</span> files updated, <span style="color:#ae81ff">0</span> files merged, <span style="color:#ae81ff">0</span> files removed, <span style="color:#ae81ff">0</span> files unresolved
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git clone $SERVER $WC1
Cloning into <span style="color:#e6db74">&#39;/tmp/wc1-git&#39;</span>...
warning: You appear to have cloned an empty repository.
<span style="color:#66d9ef">done</span>.
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ touch $WC1/file
$ hg -R $WC1 add $WC1/file
$ hg -R $WC1 commit -m <span style="color:#e6db74">&#34;initial version&#34;</span>
$ hg -R $WC1 push
pushing to ssh://localhost//tmp/server-hg
searching <span style="color:#66d9ef">for</span> changes
remote: adding changesets
remote: adding manifests
remote: adding file changes
remote: added <span style="color:#ae81ff">1</span> changesets with <span style="color:#ae81ff">1</span> changes to <span style="color:#ae81ff">1</span> files
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ touch $WC1/INITIAL
$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 add INITIAL
$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 commit -m <span style="color:#e6db74">&#34;master branch creation&#34;</span>
<span style="color:#f92672">[</span>master <span style="color:#f92672">(</span>root-commit<span style="color:#f92672">)</span> 38576fe<span style="color:#f92672">]</span> master branch creation
 <span style="color:#ae81ff">0</span> files changed
 create mode <span style="color:#ae81ff">100644</span> INITIAL
$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 push origin master
To /tmp/server-git
 * <span style="color:#f92672">[</span>new branch<span style="color:#f92672">]</span> master -&gt; master
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ hg clone ssh://localhost/$SERVER $WC2
requesting all changes
adding changesets
adding manifests
adding file changes
added <span style="color:#ae81ff">1</span> changesets with <span style="color:#ae81ff">1</span> changes to <span style="color:#ae81ff">1</span> files
updating to branch default
<span style="color:#ae81ff">1</span> files updated, <span style="color:#ae81ff">0</span> files merged, <span style="color:#ae81ff">0</span> files removed, <span style="color:#ae81ff">0</span> files unresolved
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git clone $SERVER $WC2
Cloning into <span style="color:#e6db74">&#39;/tmp/wc2-git&#39;</span>...
<span style="color:#66d9ef">done</span>.
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ touch $WC1/file2
$ hg -R $WC1 branch branch1
marked working directory as branch branch1
<span style="color:#f92672">(</span>branches are permanent and global, did you want a bookmark?<span style="color:#f92672">)</span>
$ hg -R $WC1 add $WC2/file2
$ hg -R $WC1 commit -m <span style="color:#e6db74">&#34;changes on wc1&#34;</span>
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ touch $WC1/file
$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 checkout -b working-copy-1
Switched to a new branch <span style="color:#e6db74">&#39;working-copy-1&#39;</span>
$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 add file
$ git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1 commit -m <span style="color:#e6db74">&#34;change 1&#34;</span>
<span style="color:#f92672">[</span>working-copy-1 de8c105<span style="color:#f92672">]</span> change <span style="color:#ae81ff">1</span>
 <span style="color:#ae81ff">0</span> files changed
 create mode <span style="color:#ae81ff">100644</span> file
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ touch $WC2/fileB
$ hg -R $WC2 branch branch2
marked working directory as branch branch2
<span style="color:#f92672">(</span>branches are permanent and global, did you want a bookmark?<span style="color:#f92672">)</span>
$ hg -R $WC2 add $WC2/fileB
$ hg -R $WC2 commit -m <span style="color:#e6db74">&#34;changes on wc2&#34;</span>
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ touch $WC2/fileB
$ git --git-dir<span style="color:#f92672">=</span>$WC2/.git --work-tree<span style="color:#f92672">=</span>$WC2 checkout -b working-copy-2
Switched to a new branch <span style="color:#e6db74">&#39;working-copy-2&#39;</span>
$ git --git-dir<span style="color:#f92672">=</span>$WC2/.git --work-tree<span style="color:#f92672">=</span>$WC2 add fileB
$ git --git-dir<span style="color:#f92672">=</span>$WC2/.git --work-tree<span style="color:#f92672">=</span>$WC2 commit -m <span style="color:#e6db74">&#34;changes on wc2&#34;</span>
<span style="color:#f92672">[</span>working-copy-2 eee3889<span style="color:#f92672">]</span> changes on wc2
 <span style="color:#ae81ff">0</span> files changed
 create mode <span style="color:#ae81ff">100644</span> fileB
      </code></pre></div>
    </td>

  
</tr>


  <tr>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ annotate-output +<span style="color:#e6db74">&#34;WC__1__%H:%M:%S&#34;</span> hg -R $WC1 push --new-branch &amp;
$ annotate-output +<span style="color:#e6db74">&#34;WC__2__%H:%M:%S&#34;</span> hg -R $WC2 push --new-branch
WC__2__13:31:54 I: Started hg -R /tmp/wc2-hg push --new-branch
WC__1__13:31:54 I: Started hg -R /tmp/wc1-hg push --new-branch
WC__1__13:31:57 O: pushing to ssh://localhost//tmp/server-hg
WC__1__13:31:57 O: searching <span style="color:#66d9ef">for</span> changes
WC__1__13:31:57 O: remote: adding changesets
WC__1__13:31:57 O: remote: adding manifests
WC__1__13:31:57 O: remote: adding file changes
WC__1__13:31:57 O: remote: added <span style="color:#ae81ff">1</span> changesets with <span style="color:#ae81ff">1</span> changes to <span style="color:#ae81ff">1</span> files
WC__1__13:31:57 I: Finished with exitcode <span style="color:#ae81ff">0</span>
WC__2__13:31:58 E: abort: push failed:
WC__2__13:31:58 O: pushing to ssh://localhost//tmp/server-hg
WC__2__13:31:58 E: <span style="color:#e6db74">&#39;unsynced changes&#39;</span>
WC__2__13:31:58 O: searching <span style="color:#66d9ef">for</span> changes
WC__2__13:31:58 O: remote: waiting <span style="color:#66d9ef">for</span> lock on repository /tmp/server-hg held by
<span style="color:#e6db74">&#39;nightcrawler:6267&#39;</span>
WC__2__13:31:58 I: Finished with exitcode <span style="color:#ae81ff">255</span>
      </code></pre></div>
    </td>

    <td>
      <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ annotate-output +<span style="color:#e6db74">&#34;WC__1__%H:%M:%S&#34;</span> git --git-dir<span style="color:#f92672">=</span>$WC1/.git --work-tree<span style="color:#f92672">=</span>$WC1
push origin master &amp;
$ annotate-output +<span style="color:#e6db74">&#34;WC__2__%H:%M:%S&#34;</span> git --git-dir<span style="color:#f92672">=</span>$WC2/.git --work-tree<span style="color:#f92672">=</span>$WC2
push origin master
WC__1__13:30:35 I: Started git --git-dir<span style="color:#f92672">=</span>/tmp/wc1-git/.git
--work-tree<span style="color:#f92672">=</span>/tmp/wc1-git push origin working-copy-1:working-copy-1
WC__2__13:30:35 I: Started git --git-dir<span style="color:#f92672">=</span>/tmp/wc2-git/.git
--work-tree<span style="color:#f92672">=</span>/tmp/wc2-git push origin working-copy-2:working-copy-2
WC__2__13:30:37 E: To /tmp/server-git
WC__1__13:30:37 E: To /tmp/server-git
WC__2__13:30:37 E: * <span style="color:#f92672">[</span>new branch<span style="color:#f92672">]</span> working-copy-2 -&gt; working-copy-2
WC__1__13:30:37 E: * <span style="color:#f92672">[</span>new branch<span style="color:#f92672">]</span> working-copy-1 -&gt; working-copy-1
WC__2__13:30:37 I: Finished with exitcode <span style="color:#ae81ff">0</span>
WC__1__13:30:37 I: Finished with exitcode <span style="color:#ae81ff">0</span>
      </code></pre></div>
    </td>

  
</tr>



</table>

<p><strong>Conclusión:</strong> Dos pushes simultáneos sobre ramas diferentes en Mercurial dará un error a la segunda que entre, si la primera se acepta. En git ambas podrán pasar.</p>
<p>¿Por qué ha ocurrido esto en Mercurial? ¿Qué es <strong>&ldquo;Unsynced changes&rdquo;</strong>? Mirando el código es un problema en el protocolo; Mercurial realiza 4 fases principales:</p>
<ol>
<li>Saludo</li>
<li>Solicitar un hash con el estado de las cabezas del servidor.</li>
<li>Ejecutar hooks</li>
<li>Enviar los deltas con el hash. Si el hash no coincide, abortará.</li>
</ol>
<p>En nuestro caso, un proceso se ha quedado bloqueado en el paso 3 y el otro ha
obtenido una hash que no coincidirá más tarde. El resultado es que ambas ramas
se bloquean hasta poder alcanzar el paso 4. La primera que llegue, modificará
las cabezas y, por tanto, la hash, que hará que la segunda aborte.
Si el primer proceso falla (un hook que no devuelve 0), la segunda pasará.</p>
<p><strong>Nota personal:</strong> Subjetivamente, encuentro mucho más útiles los mensajes de Git que de Mercurial.</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/mercurial" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">mercurial</a>
   </li>
  
   <li class="list">
     <a href="/tags/git" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">git</a>
   </li>
  
   <li class="list">
     <a href="/tags/dvcs" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">dvcs</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "magmax" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Relacionado</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/blog/home-en-git/">Guardar la configuración de tu máquina</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/git/">Git</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/mercurial-subversion/">Sistemas de Control de Versiones (Subversion y Mercurial)</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://magmax.org/" >
    &copy;  El blog de MagMax 2021 
  </a>
    <div>














</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
