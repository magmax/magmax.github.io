
<!DOCTYPE html>
<html lang="es" data-figures="" class="page">
  <head>
<title>Creación de un módulo Drupal IV | El blog de MagMax</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.79.1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta property="og:locale" content="es" />

<meta property="og:type" content="article">
<meta name="description" content="En esta ocasión vamos a tirar a la basura la mayor parte del código que ya tenemos. Así es la vida de dura&hellip; cuando estamos aprendiendo, las cosas se …">
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="">
<meta name="twitter:title" content="Creación de un módulo Drupal IV" />
<meta property="og:url" content="http://example.org/blog/creacion-modulo-drupal-4/" />
<meta property="og:title" content="Creación de un módulo Drupal IV" />
<meta property="og:description" content="En esta ocasión vamos a tirar a la basura la mayor parte del código que ya tenemos. Así es la vida de dura&hellip; cuando estamos aprendiendo, las cosas se …" />
<meta property="og:image" content="http://example.org/" />
<link rel="apple-touch-icon" sizes="180x180" href='http://example.org/icons/apple-touch-icon.png'>
<link rel="icon" type="image/png" sizes="32x32" href='http://example.org/icons/favicon-32x32.png'>
<link rel="manifest" href='http://example.org/icons/site.webmanifest'>
<link rel="mask-icon" href='http://example.org/safari-pinned-tab.svg' color="#002538">
<meta name="msapplication-TileColor" content="#002538">
<meta name="theme-color" content="#002538">

<link rel="canonical" href="http://example.org/blog/creacion-modulo-drupal-4/">

    

    
    
    <link rel="preload" href="http://example.org/css/styles.37cea41fe2c1b43e2a17095e01eb999e8701c9f0ba06d4df0a9db514a215e26dfbdb8a606a36c9d3b54bb1c09fd4a9ce41ee8f6788a8c6b17067830f34396135.css" integrity = "sha512-N86kH&#43;LBtD4qFwleAeuZnocByfC6BtTfCp21FKIV4m3724pgajbJ07VLscCf1KnOQe6PZ4ioxrFwZ4MPNDlhNQ==" as="style" crossorigin="anonymous">
    <link rel="preload" href="http://example.org/js/bundle.min.d47d3d6894e66aa67f2514c171756283d3e8847b56f8f158bdd8430843da5f5af874c7a89a316c6743a845399bdb89649685154dc88b7e9bff1a155ca9e5108a.js" as="script" integrity=
    "sha512-1H09aJTmaqZ/JRTBcXVig9PohHtW&#43;PFYvdhDCEPaX1r4dMeomjFsZ0OoRTmb24lkloUVTciLfpv/GhVcqeUQig==" crossorigin="anonymous">

    
    <link rel="stylesheet" type="text/css" href="http://example.org/css/styles.37cea41fe2c1b43e2a17095e01eb999e8701c9f0ba06d4df0a9db514a215e26dfbdb8a606a36c9d3b54bb1c09fd4a9ce41ee8f6788a8c6b17067830f34396135.css" integrity="sha512-N86kH&#43;LBtD4qFwleAeuZnocByfC6BtTfCp21FKIV4m3724pgajbJ07VLscCf1KnOQe6PZ4ioxrFwZ4MPNDlhNQ==" crossorigin="anonymous">
    
  </head>
  
  
    
  
  <body data-code="20" data-lines="false" id="documentTop">

<header class="nav_header" >
  <nav class="nav">
    <a href='http://example.org/' class="nav_brand nav_item">
        El blog de MagMax
      <div class="nav_close">
        <div>
          <svg class="icon">
  <use xlink:href="#open-menu"></use>
</svg>
          <svg class="icon">
  <use xlink:href="#closeme"></use>
</svg>
        </div>
      </div>
    </a>
    <div class='nav_body nav_body_'>
      
      
      
        

  <div class="nav_parent">
    <a href="http://example.org/" class="nav_item">Inicio </a>
  </div>
  <div class="nav_parent">
    <a href="http://example.org/en" class="nav_item">English </a>
  </div>
      
      <div class="nav_parent">
        <a href="#" class="nav_item"></a>
        <div class="nav_sub">
          <span class="nav_child"></span>
          
          <a href="http://example.org/en/" class="nav_child nav_item">English</a>
          
          <a href="http://example.org/" class="nav_child nav_item">Español</a>
          
        </div>
      </div>
      
<div class='follow'>
    
    
  <a href="https://github.com/magmax/">
    <svg class="icon">
  <use xlink:href="#github"></use>
</svg>
  </a>
    
    
  <a href="https://twitter.com/magmax_en">
    <svg class="icon">
  <use xlink:href="#twitter"></use>
</svg>
  </a>
    
    
  <a href="https://www.linkedin.com/in/miguelangelgarciamartinez/">
    <svg class="icon">
  <use xlink:href="#linkedin"></use>
</svg>
  </a>
    
    
    
  <a href="http://example.org/index.xml">
    <svg class="icon">
  <use xlink:href="#rss"></use>
</svg>
  </a>
<div class="color_mode">
  <input type="checkbox" class="color_choice" id="mode">
</div>

</div>

    </div>
  </nav>
</header>

    <main>
  
<div class="grid-inverse wrap content">
  <article class="post_content">
    <h1 class="post_title">Creación de un módulo Drupal IV</h1><div class="post_meta">
  
    <svg class="icon">
  <use xlink:href="#calendar"></use>
</svg>
    <span class="post_date">
      May 11, 2010</span>
      <a href='http://example.org/tags/drupal' class="post_tag button button_translucent">drupal
      </a>
</div>

    
  <div class="post_share">
    Compartir en:
    <a href="https://twitter.com/intent/tweet?text=Creaci%c3%b3n%20de%20un%20m%c3%b3dulo%20Drupal%20IV&url=http%3a%2f%2fexample.org%2fblog%2fcreacion-modulo-drupal-4%2f&tw_p=tweetbutton" class="twitter" title="Compartir en Twitter" target="_blank" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#twitter"></use>
</svg>
    </a>
    <a href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fexample.org%2fblog%2fcreacion-modulo-drupal-4%2f&t=Creaci%c3%b3n%20de%20un%20m%c3%b3dulo%20Drupal%20IV" class="facebook" title="Compartir en Facebook" target="_blank" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#facebook"></use>
</svg>
    </a>
    <a href="#linkedinshare" id = "linkedinshare" class="linkedin" title="Compartir en LinkedIn" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#linkedin"></use>
</svg>
    </a>
    <a href="http://example.org/blog/creacion-modulo-drupal-4/" title="Copy Link" class="link link_yank">
      <svg class="icon">
  <use xlink:href="#copy"></use>
</svg>
    </a>
  </div>

    
    <p>En esta ocasión vamos a tirar a la basura la mayor parte del código que ya tenemos. Así es la vida de dura&hellip; cuando estamos aprendiendo, las cosas se hacen de una manera; cuando ya sabemos, las cosas se hacen de otra manera diferente.</p>
<p>Hoy queremos que nuestros &ldquo;feedbacks&rdquo; se adapten a drupal. Hasta ahora parecían formar parte del site, pero realmente sólo tenían el mismo aspecto. Lo que queremos conseguir es que realmente pertenezcan a nuestro drupal: aparecerán en las búsquedas, se administrarán como parte del contenido, etc.</p>
<p>Me voy a basar en el <a href="http://drupal.org/node/231019">magnífico tutorial para crear contenido en Drupal</a>.</p>
<!-- raw HTML omitted -->
<figure>
    <img src="/images/drupal.png"
         alt="Drupal"/> 
</figure>

<h2 id="versiones">Versiones</h2>
<p>Igual que es posible que este documento se copie, también es posible que yo lo
modifique. Por eso, la última versión del mismo siempre se encontrará en la
<a href="http://example.org/blog/creacion-modulo-drupal-4/">cuarta parte del tutorial de drupal</a>. Un
saludo.</p>
<h2 id="qué-se-explica-aquí">Qué se explica aquí</h2>
<p>Cómo crear un nodo programáticamente. Una vez hayamos terminado, todo lo que hayamos hecho se podría haber hecho con el módulo CCK, pero de lo que se trata es aprender.</p>
<h2 id="qué-es-el-cck">Qué es el CCK</h2>
<p>Fácil: es el <em>Content Construction Kit</em> :-D</p>
<p>Consiste en una herramienta muy potente para la creación de formularios mediante el propio Drupal. De esta manera, sólo tenemos que ir añadiendo una lista de elementos, que posteriormente se renderizarán como un formulario. Gran parte de nuestro módulo &ldquo;feedback&rdquo; se podría haber hecho directamente sobre el CCK, por no decir todo.</p>
<p>¿Por qué no usar el CCK? En nuestro caso, &ldquo;porque estamos aprendiendo&rdquo; es una razón tan válida como cualquier otra. En concreto, para un módulo de las características de &ldquo;feedback&rdquo;, tal vez haya sido una pérdida de tiempo usar un módulo en lugar de el CCK. Sin embargo, un módulo tiene unas características de replicabilidad que el CCK creo que no tiene.</p>
<p>Además, el CCK nos permite crear formularios simples, pero si lo que queremos es poder manipular los datos, entonces necesitaremos crear nuestro propio módulo.</p>
<h2 id="pasos">Pasos</h2>
<p>Vamos a necesitar los siguientes <em>hooks</em>, aunque algunos de ellos ya los hemos implementado:</p>
<ul>
<li><code>hook_node_info</code></li>
<li><code>hook_perm</code></li>
<li><code>hook_access</code></li>
<li><code>hook_form</code></li>
</ul>
<p>También vamos a necesitar algunos de los siguientes <em>hooks</em> opcionales:</p>
<ul>
<li><code>hook_insert</code></li>
<li><code>hook_update</code></li>
<li><code>hook_delete</code></li>
<li><code>hook_validate</code></li>
<li><code>hook_nodeapi</code></li>
<li><code>hook_view</code></li>
<li><code>hook_load</code></li>
</ul>
<h2 id="hooks-obligatorios">Hooks obligatorios</h2>
<p>Nosotros ya tenemos nuestro <code>hook_node_info</code> y nuestro propio <code>hook_perm</code>, así que saltamos directamente a implementar el <code>hook_access</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#e6db74">* Implements hook_access()
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_access</span> ( $op, $node, $account )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  $retval <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  <span style="color:#66d9ef">switch</span> ( $op )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;view&#39;</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>      $retval <span style="color:#f92672">=</span> <span style="color:#a6e22e">user_access</span> ( <span style="color:#e6db74">&#39;view messages&#39;</span>, $account );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;create&#39;</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>      $retval <span style="color:#f92672">=</span> <span style="color:#a6e22e">user_access</span> ( <span style="color:#e6db74">&#39;send message&#39;</span>, $account );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>      <span style="color:#66d9ef">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;update&#39;</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>      $retval <span style="color:#f92672">=</span> <span style="color:#a6e22e">user_access</span> ( <span style="color:#e6db74">&#39;admin messages&#39;</span>, $account ) <span style="color:#f92672">&amp;&amp;</span> ( $account<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">==</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>      <span style="color:#66d9ef">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;delete&#39;</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>      $retval <span style="color:#f92672">=</span> <span style="color:#a6e22e">user_access</span> ( <span style="color:#e6db74">&#39;admin messages&#39;</span>, $account ) <span style="color:#f92672">&amp;&amp;</span> ( $account<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">==</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>      <span style="color:#66d9ef">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>  <span style="color:#66d9ef">return</span> $retval;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>La función va a devolver <code>true</code> si queremos que el usuario tenga acceso. Para ello comprobamos si el usuario tiene los roles necesarios como para realizar ciertas acciones. En el caso de &ldquo;update&rdquo; y &ldquo;delete&rdquo; comprobamos también que el usuario sea el propietario del nodo.</p>
<p>Siguiendo con la lista, implementaremos el <code>hook_node_info</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#e6db74">* Implements hook_node_info()
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_node_info</span>() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">array</span>(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    <span style="color:#e6db74">&#39;feedback&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>      <span style="color:#e6db74">&#39;name&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Feedback&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>      <span style="color:#e6db74">&#39;module&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;feedback&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>      <span style="color:#e6db74">&#39;description&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Handle a feedback message&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>}
</code></pre></div><p>Ahora vamos a renombrar algunas de nuestras funciones&hellip; En concreto, <code>feedback_message_form</code>, que pasará a ser <code>feedback_form</code>. Es necesario también renombrar las funciones <code>feedback_message_form_validate</code> y <code>feedback_message_form_submit</code> para que todo siga funcionando como hasta ahora. También tendremos que modificar la llamada a <code>feedback_message_form</code> (ojo, que luego seguiremos transformando estas funciones):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_message</span> ()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  $content <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  $content <span style="color:#f92672">.=</span> <span style="color:#a6e22e">drupal_get_form</span> ( <span style="color:#e6db74">&#39;feedback_form&#39;</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  <span style="color:#66d9ef">return</span> $content;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_form</span> ()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  [<span style="color:#f92672">...</span>]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_form_validate</span> ( $form, <span style="color:#f92672">&amp;</span>$form_state )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>  [<span style="color:#f92672">...</span>]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_form_submit</span> ( $form, <span style="color:#f92672">&amp;</span>$form_state )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>  [<span style="color:#f92672">...</span>]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>}
</code></pre></div><p>Y&hellip;. ya está. Ya tenemos nuestro elemento integrado con Drupal. Si recargamos la caché (Administration-&gt;Performance), y nos vamos a &ldquo;create content&rdquo;, veremos que tenemos un tipo de contenido llamado &ldquo;feedback&rdquo;.</p>
<p>El caso es que también veremos que no funciona del todo bien :-D</p>
<h3 id="hooks-recomendables">Hooks recomendables</h3>
<p>Antes de nada, os voy a hablar de <code>hook_nodeapi</code>. Hacéos un favor a vosotros mismos: olvidad que alguna vez existió. Las funciones que tienen parámetros que cambian en función de otros parámetros nunca son una buena idea. Además, en Drupal 7 lo han quitado, por lo que su uso está obsoleto. Toda la funcionalidad que podía ofrecer esta función la cumplen el resto de los hooks de la lista: insert, update, delete, validate, view y load. Existe una remota posibilidad de que necesitéis usar <code>hook_nodeapi</code>; pensáoslo bien antes de usarla.</p>
<p>El resto de <code>hooks</code> se ejecutarán automáticamente cuando alguien realice la operación esperada: <code>hook_insert</code> cuando se cree un nuevo elemento, etc.</p>
<p>Realmente lo que vamos a hacer es realizar una serie de transformaciones. Por ejemplo, nuestro antiguo <code>feedback_form_submit</code> se va a transformar en el nuevo y flamante <code>feedback_insert</code>, nuestro propio <code>hook_insert</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_insert</span> ( $node )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  $userid  <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  $message <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  $mail    <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">mail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;INSERT into {feedback_messages} ( uid, message, indate, usermail ) values ( %d, &#39;%s&#39;, now(), &#39;%s&#39; ) &#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  $queryResult <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_query</span> ( $query, $userid, $message, $mail );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">db_affected_rows</span>() )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    <span style="color:#a6e22e">drupal_set_message</span> ( <span style="color:#a6e22e">t</span> ( <span style="color:#e6db74">&#34;Thank you for your feedback.&#34;</span> ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    <span style="color:#a6e22e">drupal_goto</span> ( <span style="color:#e6db74">&#39;node&#39;</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>  <span style="color:#66d9ef">else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>    <span style="color:#a6e22e">form_set_error</span> ( <span style="color:#e6db74">&#39;feedback&#39;</span>, <span style="color:#a6e22e">t</span>( <span style="color:#e6db74">&#34;An error has happened. Your feedback has not been sent.&#34;</span> ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>}
</code></pre></div><p>Vamos a estudiarlo un poquito&hellip; Hemos cambiado la cabecera, de manera que ahora
el <em>UID</em>, el mensaje y el e-mail lo sacamos del nodo en lugar de usar variables
globales y formularios. Nosotros tenemos que decidir cómo almacenar la
información que sobrepasa a la información del nodo, por lo que insertamos en
nuestra tabla exactamente la misma información que antes. Es decir: a partir de
<code>$query</code> no hemos cambiado nada.</p>
<p>No ha sido difícil, ¿verdad? Ahora ya podemos insertar nodos que son feeds. Y
podemos probarlo: <code>Create Content-&gt;feedback</code>, escribimos y guardamos.</p>
<p>Se nos ha quedado el submit del formulario. Eso queda un poquito feo, ¿no? Ahora
que tenemos nuestro botón &ldquo;preview&rdquo; y nuestro &ldquo;save&rdquo;, amén de todas las opciones
de publicación, permisos, etc&hellip; Así que vamos a quitarlo. Además hay un
problema: se va a utilizar el mismo formulario para editar y para crear nuevos
elementos. Por esa razón, he decidido sacar una serie de variables que se
establecerán cuando se esté editando el nodo. Además, en modo &ldquo;edición&rdquo; se
mostrará también el check para indicar que ya se ha leído.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_form</span> ( <span style="color:#f92672">&amp;</span>$node )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  <span style="color:#66d9ef">global</span> $user;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  $title <span style="color:#f92672">=</span> <span style="color:#a6e22e">sprintf</span> ( <span style="color:#e6db74">&#39;Feed from %s&#39;</span>, $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  $mail <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  $message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  $read <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  $editing <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  <span style="color:#66d9ef">if</span> ( $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    $mail <span style="color:#f92672">=</span> $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">mail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>  <span style="color:#66d9ef">if</span> ( $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">nid</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>    <span style="color:#75715e">// estamos editando
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span style="color:#75715e"></span>    $editing <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>    $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT uid, message, indate, usermail, fm.read FROM {feedback_messages} fm WHERE id=%d&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>    $queryResult <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_query</span> ( $query, $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">nid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>    $storednode <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_fetch_object</span> ( $queryResult );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>    $mail    <span style="color:#f92672">=</span> $storednode<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">usermail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>    $message <span style="color:#f92672">=</span> $storednode<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>    $read    <span style="color:#f92672">=</span> $storednode<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">read</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>  $form [<span style="color:#e6db74">&#39;feedback&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>    (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>      <span style="color:#e6db74">&#39;#type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;fieldset&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>      <span style="color:#e6db74">&#39;#title&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>( <span style="color:#e6db74">&#39;Feedback&#39;</span> ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>      <span style="color:#e6db74">&#39;mail&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span> (<span style="color:#e6db74">&#39;#type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;textfield&#39;</span>, <span style="color:#e6db74">&#34;#title&#34;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#34;E-Mail&#34;</span>, <span style="color:#e6db74">&#34;#description&#34;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#34;If you want any answer, please, tell me your mail. It would not be shown anywhere.&#34;</span>, <span style="color:#e6db74">&#34;#default_value&#34;</span> <span style="color:#f92672">=&gt;</span> $mail ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>      <span style="color:#e6db74">&#39;message&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span> ( <span style="color:#e6db74">&#39;#type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;textarea&#39;</span>, <span style="color:#e6db74">&#34;#description&#34;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#34;Write here your message&#34;</span>, <span style="color:#e6db74">&#39;#default_value&#39;</span><span style="color:#f92672">=&gt;</span>$message ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>      <span style="color:#e6db74">&#39;#required&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">TRUE</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>    );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>  <span style="color:#66d9ef">if</span> ( $editing )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>    $form [<span style="color:#e6db74">&#39;feedback&#39;</span>][<span style="color:#e6db74">&#39;read&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span> ( <span style="color:#e6db74">&#39;#type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;checkbox&#39;</span>, <span style="color:#e6db74">&#34;#title&#34;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#34;The message has been read&#34;</span>, <span style="color:#e6db74">&#39;#default_value&#39;</span><span style="color:#f92672">=&gt;</span>$read ) ;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span>  $form[<span style="color:#e6db74">&#39;title&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span>    (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span>      <span style="color:#e6db74">&#39;#type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;hidden&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span>      <span style="color:#e6db74">&#39;#default_value&#39;</span> <span style="color:#f92672">=&gt;</span> $title,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span>    );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span>  <span style="color:#66d9ef">return</span> $form;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span>}
</code></pre></div><p>¡Eh!, ¡Para!, que aquí al final hay algo extraño&hellip; Sí, lo que hacemos es
preguntarle a Drupal el tipo de nodo que estamos tratando, y comprobar si este
tipo necesita un título. Si es así, pues lo pintamos. Se podría hacer lo mismo
con el <em>body</em>, pero en esta ocasión no lo queremos. El título es interesante
para que después nos aparezca en la lista de contenido y podamos pincharle.</p>
<p>Ahora vamos a realizar las comprobaciones adecuadas, renombrando
<code>feedback_form_validate</code> y haciendo los cambios pertinentes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_validate</span> ( $node, <span style="color:#f92672">&amp;</span>$form )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  $message <span style="color:#f92672">=</span> $form[<span style="color:#e6db74">&#39;values&#39;</span>][<span style="color:#e6db74">&#39;message&#39;</span>];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  $mail    <span style="color:#f92672">=</span> $form[<span style="color:#e6db74">&#39;values&#39;</span>][<span style="color:#e6db74">&#39;mail&#39;</span>];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  $validmail <span style="color:#f92672">=</span> <span style="color:#a6e22e">preg_match</span> (<span style="color:#e6db74">&#34;/^[^0-9][A-z0-9_]+([.][A-z0-9_]+)*[@][A-z0-9_]+([.][A-z0-9_]+)*[.][A-z]{2,4}$/&#34;</span> , $mail );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  <span style="color:#66d9ef">if</span> ( $mail <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">&amp;&amp;</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>    <span style="color:#a6e22e">form_set_error</span> ( <span style="color:#e6db74">&#39;mail&#39;</span>, <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;You are not a registered user. Please, insert your e-mail.&#39;</span>) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  <span style="color:#66d9ef">if</span> ( $mail <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span> $validmail )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    <span style="color:#a6e22e">form_set_error</span> ( <span style="color:#e6db74">&#39;mail&#39;</span>, <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;The mail does not like an e-mail address.&#39;</span>) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  <span style="color:#66d9ef">if</span> ( $message <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#39;</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    <span style="color:#a6e22e">form_set_error</span> ( <span style="color:#e6db74">&#39;message&#39;</span>, <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Message cannot be empty.&#39;</span>));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>  <span style="color:#66d9ef">return</span> $form;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>}
</code></pre></div><p>Es una lástima ver lo fácil que habría resultado realizarlo así desde el principio, ¿verdad? ¡¡Pero había que aprender!! Pasito a pasito&hellip;</p>
<p>Ahora vamos a &ldquo;ver&rdquo; los feeds. No sé si habréis notado que cuando pulsáis sobre un feed, no se ve nada. Igual que en el <em>preview</em>. Eso es porque tenemos que implementar el <code>hook_view</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_view</span> ( $node, $teaser <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, $page <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  $messageread <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  $messagedata <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  $messagename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  $messageusermail <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  <span style="color:#66d9ef">if</span> ( $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    <span style="color:#75715e">// ya tenemos el mensaje. Puede deberse a que estamos editando.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#75715e"></span>    $messageread <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">read</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    $messagedata <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    $messagename <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>    $messageusermail <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">mail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>  <span style="color:#66d9ef">else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>    <span style="color:#75715e">// tenemos que obtener el mensaje
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#75715e"></span>    $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT fm.uid, message, indate, usermail, u.name, fm.read FROM {feedback_messages} fm, {users} u WHERE id=%d and fm.uid=u.uid&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>    $queryResult <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_query</span> ( $query, $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">nid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>    $message <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_fetch_object</span> ( $queryResult );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>    $messageread <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">read</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>    $messagedata <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>    $messagename <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>    $messageusermail <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">usermail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>  $read <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>  <span style="color:#66d9ef">if</span> ( $messageread )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>    $read <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#34; and &lt;b&gt;already read&lt;/b&gt;&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>  $content  <span style="color:#f92672">=</span> <span style="color:#a6e22e">sprintf</span> ( <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;&lt;blockquote&gt;&lt;i&gt;%s&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;Sent by %s&lt;a href=&#34;mailto:%s&#34;&gt;&amp;lt;%s&amp;gt;&lt;/a&gt;%s.&lt;/p&gt;&#39;</span>), $messagedata, $messagename, $messageusermail, $messageusermail, $read );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>  $node <span style="color:#f92672">=</span> <span style="color:#a6e22e">node_prepare</span> ( $node, $teaser );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>  $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">content</span>[<span style="color:#e6db74">&#39;message&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>    <span style="color:#e6db74">&#39;#value&#39;</span> <span style="color:#f92672">=&gt;</span> $content,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>    <span style="color:#e6db74">&#39;#weight&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>  );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span>  <span style="color:#66d9ef">return</span> $node;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span>}
</code></pre></div><p>Ahora vamos con la edición, para que se hagan efectivos los cambios:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_update</span> ( $node )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  $userid  <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  $message <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  $mail    <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">mail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  $read    <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">read</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UPDATE {feedback_messages} fm SET message=&#39;%s&#39;, usermail=&#39;%s&#39;, fm.read=%d where id=%d&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  $queryResult <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_query</span> ( $query, $message, $mail, $read, $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">nid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">db_affected_rows</span>() )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    <span style="color:#a6e22e">drupal_set_message</span> ( <span style="color:#a6e22e">t</span>( <span style="color:#e6db74">&#34;The feedback has been updated.&#34;</span> ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>    <span style="color:#a6e22e">drupal_goto</span> ( <span style="color:#e6db74">&#39;node&#39;</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>  <span style="color:#66d9ef">else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>    <span style="color:#a6e22e">form_set_error</span> ( <span style="color:#e6db74">&#39;feedback&#39;</span>, <span style="color:#a6e22e">t</span>( <span style="color:#e6db74">&#34;An error has happened. Your feedback has not been sent.&#34;</span> ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>}
</code></pre></div><p>Ahora una nota sobre el borrado: Si tratamos de borrar el nodo, veremos que se realiza sin problemas, pero eso no quiere decir que lo estemos haciendo BIEN. Se habrá borrado el nodo, pero no se habrá borrado la información asociada a nuestro feed, dejando basura inaccesible en la base de datos. Por eso implementaremos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span style="color:#e6db74">* Implementation of hook_delete
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_delete</span> ( $node )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span>  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;DELETE FROM {feedback_messages} where id=%d&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span>  $queryResult <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_query</span> ( $query, $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">nid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span>}
</code></pre></div><p>Con esto, queda obsoleto lo que implementamos en la cuarta entrega del curso
para poder eliminar mensajes :-D. Claro, que también hay una serie de enlaces
anticuados que nos están permitiendo crear feeds que no son nodos. Por estas
razones, vamos a eliminar:</p>
<ul>
<li><code>feedback_delete_form_submit</code></li>
<li><code>feedback_delete_form</code></li>
<li><code>feedback_messageadmin_form_submit</code></li>
<li><code>feedback_messageadmin_form_submit</code></li>
<li><code>feedback_messageadmin_form</code></li>
</ul>
<p>Y vamos a cambiar los enlaces en <code>feedback_admin</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_admin</span> ( $messageid<span style="color:#f92672">=</span><span style="color:#66d9ef">null</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  $content <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  <span style="color:#66d9ef">if</span> ( $messageid <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>    $content <span style="color:#f92672">.=</span> <span style="color:#a6e22e">drupal_get_form</span> ( <span style="color:#e6db74">&#39;feedback_messageadmin_form&#39;</span>, $messageid );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>    $content <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#34;&lt;hr/&gt;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  $header <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Date&#39;</span>), <span style="color:#e6db74">&#39;field&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;indate&#39;</span>, <span style="color:#e6db74">&#39;sort&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;desc&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>    <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;User&#39;</span>), <span style="color:#e6db74">&#39;field&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;name&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>    <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;email&#39;</span>), <span style="color:#e6db74">&#39;field&#39;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#39;mail&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>    <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Message&#39;</span>), <span style="color:#e6db74">&#39;field&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;message&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>    <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Read&#39;</span>), <span style="color:#e6db74">&#39;field&#39;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#39;fm.read&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>  );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT fm.id, u.uid as uid, u.name, fm.usermail, fm.indate, fm.message, fm.read FROM {feedback_messages} fm, {users} u WHERE fm.uid=u.uid&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>  $query <span style="color:#f92672">.=</span> <span style="color:#a6e22e">tablesort_sql</span> ( $header );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>  $queryResult <span style="color:#f92672">=</span>  <span style="color:#a6e22e">db_query</span> ( $query );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>  $rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span> ();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>  <span style="color:#66d9ef">while</span> ( $message <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_fetch_object</span> ( $queryResult ) )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>    $row <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span> ();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>    $row[<span style="color:#e6db74">&#39;indate&#39;</span>] <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">indate</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>    $row[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;&lt;a href=&#34;?q=user/&#39;</span><span style="color:#f92672">.</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">.</span><span style="color:#e6db74">&#39;&#34;&gt;&#39;</span> <span style="color:#f92672">.</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;&lt;/a&gt;&#39;</span> <span style="color:#f92672">:</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>    $row[<span style="color:#e6db74">&#39;mail&#39;</span>] <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">usermail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>    $row[<span style="color:#e6db74">&#39;message&#39;</span>] <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>    $row[<span style="color:#e6db74">&#39;read&#39;</span>] <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">read</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>    $row[<span style="color:#e6db74">&#39;edit&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">l</span> ( <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;edit&#39;</span>), <span style="color:#e6db74">&#34;node/&#34;</span> <span style="color:#f92672">.</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">id</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;/edit&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>    $rows[] <span style="color:#f92672">=</span> $row;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>  $content <span style="color:#f92672">.=</span> <span style="color:#a6e22e">theme_table</span>($header, $rows);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>  <span style="color:#66d9ef">return</span> $content;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>}
</code></pre></div><p>Y lo más importante: ¡¡Ahora no podemos permitir que se cree un elemento
<em>feedback</em> sin que sea un nodo!! Así que se tercian dos cambios: Cambiar el
enlace del bloque (acordaos de limpiar la caché en Administration-&gt;performance)
y eliminar el acceso del <code>hook_menu</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#e6db74">* Implementation of hook_block().
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_block</span> ( $op <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;list&#39;</span>, $delta <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, $edit <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>() )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  <span style="color:#66d9ef">if</span> ( $op <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;list&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>      $blocks <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>      $blocks[<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#34;info&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Feedback&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>      $blocks[<span style="color:#ae81ff">1</span>][<span style="color:#e6db74">&#34;info&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;New Feedbacks&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>      <span style="color:#66d9ef">return</span> $blocks;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( $op <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;view&#34;</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>      $content <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>      $block <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>      <span style="color:#66d9ef">switch</span> ( $delta )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>      {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>          $block[<span style="color:#e6db74">&#39;subject&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Feedback&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>          $options <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>( <span style="color:#e6db74">&#34;attributes&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;title&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#34;Sends a feedback message&#34;</span>) ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>          $link <span style="color:#f92672">=</span> <span style="color:#a6e22e">l</span>( <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#34;New Feedback&#34;</span>), <span style="color:#e6db74">&#34;node/add/feedback&#34;</span>, $options );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>          $content <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#39;&lt;div class=&#34;link&#34;&gt;&#39;</span> <span style="color:#f92672">.</span> $link <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;&lt;/div&gt;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>          <span style="color:#66d9ef">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>          $block[<span style="color:#e6db74">&#39;subject&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Feedback Messages&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>          $options <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>( <span style="color:#e6db74">&#34;attributes&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;title&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#34;Shows feedback messages&#34;</span>) ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>          $title <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#34;There are @total new feeds&#34;</span>, <span style="color:#66d9ef">array</span> ( <span style="color:#e6db74">&#39;@total&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">_feedback_count</span>() ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>          $link <span style="color:#f92672">=</span> <span style="color:#a6e22e">l</span>( $title , <span style="color:#e6db74">&#34;feedback/adminmessages&#34;</span>, $options );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>          $content <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#39;&lt;div class=&#34;link&#34;&gt;&#39;</span> <span style="color:#f92672">.</span> $link <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;&lt;/div&gt;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>          <span style="color:#66d9ef">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>      }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>      $block[<span style="color:#e6db74">&#39;content&#39;</span>] <span style="color:#f92672">=</span> $content;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>      <span style="color:#66d9ef">return</span> $block;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span style="color:#e6db74">* Implementation of hook_menu().
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_menu</span> ( )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span>  $items <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span>  $items[<span style="color:#e6db74">&#39;feedback/adminmessages&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span>  (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span>    <span style="color:#e6db74">&#39;title&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;Feedback admin&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span>    <span style="color:#e6db74">&#39;page callback&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;feedback_admin&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span>    <span style="color:#e6db74">&#39;access arguments&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;view messages&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53</span>    <span style="color:#e6db74">&#39;type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">MENU_CALLBACK</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54</span>  );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56</span>  <span style="color:#66d9ef">return</span> $items;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57</span>}
</code></pre></div><h2 id="drupal-7">Drupal 7</h2>
<p>Mucho me temo que todo lo que cuento aquí es válido para Drupal 6, pero no para Drupal 7.</p>
<p>Hay tutoriales de cómo pasar de Drupal 6 a Drupal 7, y seguro que todo lo contado en esta parte del tutorial se verá afectado.</p>
<h2 id="más-tutoriales">Más tutoriales</h2>
<p>Tengo en mente hacer un tutorial más y terminar con toda la tanda. Lo que queda por ver es sencillo: aplicar <em>themes</em> y añadir archivos de traducción. Si se os ocurre algo más, ¡¡decidlo ahora!!</p>
<h2 id="opinión-personal">Opinión personal</h2>
<p>En muchos casos puede venir bien crear un módulo para drupal que gestiona nodos. Sin embargo, también es cierto que en este caso a mí, particulamente, me parece un problema. Al ser nodos, se verán afectados por los permisos de nodos, por lo que si en tu site no dejas crear contenido, se acabaron los feeds.</p>
<p>De todas maneras, me parecía interesante contarlo de esta manera, con el fin de que quede como una continuación y se aprenda a crear contenido para Drupal, que no es nada difícil</p>
<h2 id="más-tutoriales-1">Más tutoriales</h2>
<p>Este tutorial es la continuación de una serie de tutoriales relacionados con Drupal. Podéis consultar cualquiera de ellos:</p>
<ul>
<li><a href="http://example.org/blog/creacion-modulo-drupal/">Creación de un módulo drupal (I)</a></li>
<li><a href="http://example.org/blog/creacion-modulo-drupal-2/">Creación de un módulo drupal (II)</a></li>
<li><a href="http://example.org/blog/creacion-modulo-drupal-4/">Creación de un módulo drupal (III)</a></li>
<li><a href="http://example.org/blog/drupal-expansors/">Drupal: Creando contenido con &lsquo;expansors&rsquo;</a></li>
<li><a href="http://example.org/blog/critica-drupal/">Crítica a Drupal</a></li>
<li><a href="http://example.org/blog/drupal-tabla-perfecta/">Tablas en Drupal: Haciendo la tabla perfecta</a></li>
</ul>
<h2 id="código">Código</h2>
<p>Como en este caso no se ha modificado nada del <code>feedback.install</code>, pongo sólo el módulo principal:</p>
<h3 id="feedbackmodule">feedback.module</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1</span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2</span><span style="color:#75715e">/*
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3</span><span style="color:#75715e">Copyright 2009-2010 Miguel Ángel García Martínez &lt;miguelangel.garcia@gmail.com&gt;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4</span><span style="color:#75715e">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5</span><span style="color:#75715e">  &#39;Feedback&#39; is free software; you can redistribute it and/or modify
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6</span><span style="color:#75715e">it under the terms of the GNU General Public License as published by
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7</span><span style="color:#75715e">the Free Software Foundation; either version 3 of the License, or
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8</span><span style="color:#75715e">(at your option) any later version.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9</span><span style="color:#75715e">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10</span><span style="color:#75715e">  &#39;Feedback&#39; is distributed in the hope that it will be useful,
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11</span><span style="color:#75715e">but WITHOUT ANY WARRANTY; without even the implied warranty of
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12</span><span style="color:#75715e">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13</span><span style="color:#75715e">GNU General Public License for more details.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14</span><span style="color:#75715e">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15</span><span style="color:#75715e">  You should have received a copy of the GNU General Public License
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16</span><span style="color:#75715e">along with &#39;Feedback&#39; (maybe in file &#34;COPYING&#34;); if not, write to the Free Software
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17</span><span style="color:#75715e">Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18</span><span style="color:#75715e">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20</span><span style="color:#e6db74">* Implements hook_help().
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_help</span> ( $path, $arg )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24</span>  $output<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>; <span style="color:#75715e">// para construir la salida
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">switch</span> ( <span style="color:#a6e22e">path</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27</span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;admin/help#feedback&#39;</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28</span>      $output <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#39;&lt;p&gt;&#39;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Módulo que permite la inserción de mensajes de feedback.&#39;</span>) <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;&lt;/p&gt;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29</span>      <span style="color:#66d9ef">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31</span>  <span style="color:#66d9ef">return</span> $output;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35</span><span style="color:#e6db74">* Implements hook_perm().
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_perm</span> ()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39</span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">array</span> ( <span style="color:#e6db74">&#39;send message&#39;</span>, <span style="color:#e6db74">&#39;view messages&#39;</span>, <span style="color:#e6db74">&#39;admin messages&#39;</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43</span><span style="color:#e6db74">* Implements hook_access()
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_access</span> ( $op, $node, $account )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47</span>  $retval <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49</span>  <span style="color:#66d9ef">switch</span> ( $op )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51</span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;view&#39;</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52</span>      $retval <span style="color:#f92672">=</span> <span style="color:#a6e22e">user_access</span> ( <span style="color:#e6db74">&#39;view messages&#39;</span>, $account );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53</span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;create&#39;</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54</span>      $retval <span style="color:#f92672">=</span> <span style="color:#a6e22e">user_access</span> ( <span style="color:#e6db74">&#39;send message&#39;</span>, $account );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55</span>      <span style="color:#66d9ef">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56</span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;update&#39;</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57</span>      $retval <span style="color:#f92672">=</span> <span style="color:#a6e22e">user_access</span> ( <span style="color:#e6db74">&#39;admin messages&#39;</span>, $account ) <span style="color:#f92672">&amp;&amp;</span> ( $account<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">==</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58</span>      <span style="color:#66d9ef">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59</span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;delete&#39;</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60</span>      $retval <span style="color:#f92672">=</span> <span style="color:#a6e22e">user_access</span> ( <span style="color:#e6db74">&#39;admin messages&#39;</span>, $account ) <span style="color:#f92672">&amp;&amp;</span> ( $account<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">==</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61</span>      <span style="color:#66d9ef">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64</span>  <span style="color:#66d9ef">return</span> $retval;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68</span><span style="color:#e6db74">* Implements hook_node_info()
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_node_info</span>() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71</span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">array</span>(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72</span>    <span style="color:#e6db74">&#39;feedback&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73</span>      <span style="color:#e6db74">&#39;name&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Feedback&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74</span>      <span style="color:#e6db74">&#39;module&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;feedback&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75</span>      <span style="color:#e6db74">&#39;description&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Handle a feedback message&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76</span>    ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77</span>  );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81</span><span style="color:#e6db74">* Implementation of hook_block().
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_block</span> ( $op <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;list&#39;</span>, $delta <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, $edit <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>() )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85</span>  <span style="color:#66d9ef">if</span> ( $op <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;list&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87</span>      $blocks <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88</span>      $blocks[<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#34;info&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Feedback&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89</span>      $blocks[<span style="color:#ae81ff">1</span>][<span style="color:#e6db74">&#34;info&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;New Feedbacks&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90</span>      <span style="color:#66d9ef">return</span> $blocks;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92</span>  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( $op <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;view&#34;</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94</span>      $content <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95</span>      $block <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96</span>      <span style="color:#66d9ef">switch</span> ( $delta )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97</span>      {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98</span>        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99</span>          $block[<span style="color:#e6db74">&#39;subject&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Feedback&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101</span>          $options <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>( <span style="color:#e6db74">&#34;attributes&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;title&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#34;Sends a feedback message&#34;</span>) ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102</span>          $link <span style="color:#f92672">=</span> <span style="color:#a6e22e">l</span>( <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#34;New Feedback&#34;</span>), <span style="color:#e6db74">&#34;node/add/feedback&#34;</span>, $options );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103</span>          $content <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#39;&lt;div class=&#34;link&#34;&gt;&#39;</span> <span style="color:#f92672">.</span> $link <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;&lt;/div&gt;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104</span>          <span style="color:#66d9ef">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105</span>        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106</span>          $block[<span style="color:#e6db74">&#39;subject&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Feedback Messages&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108</span>          $options <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>( <span style="color:#e6db74">&#34;attributes&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;title&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#34;Shows feedback messages&#34;</span>) ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109</span>          $title <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#34;There are @total new feeds&#34;</span>, <span style="color:#66d9ef">array</span> ( <span style="color:#e6db74">&#39;@total&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">_feedback_count</span>() ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110</span>          $link <span style="color:#f92672">=</span> <span style="color:#a6e22e">l</span>( $title , <span style="color:#e6db74">&#34;feedback/adminmessages&#34;</span>, $options );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111</span>          $content <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#39;&lt;div class=&#34;link&#34;&gt;&#39;</span> <span style="color:#f92672">.</span> $link <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;&lt;/div&gt;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112</span>          <span style="color:#66d9ef">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113</span>      }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114</span>      $block[<span style="color:#e6db74">&#39;content&#39;</span>] <span style="color:#f92672">=</span> $content;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115</span>      <span style="color:#66d9ef">return</span> $block;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120</span><span style="color:#e6db74">* Implementation of hook_menu().
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_menu</span> ( )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124</span>  $items <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126</span>  $items[<span style="color:#e6db74">&#39;feedback/adminmessages&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127</span>  (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128</span>    <span style="color:#e6db74">&#39;title&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;Feedback admin&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129</span>    <span style="color:#e6db74">&#39;page callback&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;feedback_admin&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130</span>    <span style="color:#e6db74">&#39;access arguments&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;view messages&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131</span>    <span style="color:#e6db74">&#39;type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">MENU_CALLBACK</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132</span>  );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134</span>  <span style="color:#66d9ef">return</span> $items;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_message</span> ()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139</span>  $content <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141</span>  $content <span style="color:#f92672">.=</span> <span style="color:#a6e22e">drupal_get_form</span> ( <span style="color:#e6db74">&#39;feedback_form&#39;</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143</span>  <span style="color:#66d9ef">return</span> $content;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_form</span> ( <span style="color:#f92672">&amp;</span>$node )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148</span>  <span style="color:#66d9ef">global</span> $user;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150</span>  $title <span style="color:#f92672">=</span> <span style="color:#a6e22e">sprintf</span> ( <span style="color:#e6db74">&#39;Feed from %s&#39;</span>, $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151</span>  $mail <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152</span>  $message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153</span>  $read <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154</span>  $editing <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156</span>  <span style="color:#66d9ef">if</span> ( $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157</span>    $mail <span style="color:#f92672">=</span> $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">mail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159</span>  <span style="color:#66d9ef">if</span> ( $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">nid</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161</span>    <span style="color:#75715e">// estamos editando
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162</span><span style="color:#75715e"></span>    $editing <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163</span>    <span style="color:#66d9ef">if</span> ( $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164</span>    {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165</span>      <span style="color:#75715e">// estamos previsualizando datos
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166</span><span style="color:#75715e"></span>      $mail    <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">mail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167</span>      $message <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168</span>      $read    <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">read</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170</span>    <span style="color:#66d9ef">else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171</span>    {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172</span>      $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT uid, message, indate, usermail, fm.read FROM {feedback_messages} fm WHERE id=%d&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173</span>      $queryResult <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_query</span> ( $query, $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">nid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174</span>      $storednode <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_fetch_object</span> ( $queryResult );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176</span>      $mail    <span style="color:#f92672">=</span> $storednode<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">usermail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177</span>      $message <span style="color:#f92672">=</span> $storednode<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178</span>      $read    <span style="color:#f92672">=</span> $storednode<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">read</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182</span>  $form [<span style="color:#e6db74">&#39;feedback&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183</span>    (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184</span>      <span style="color:#e6db74">&#39;#type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;fieldset&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185</span>      <span style="color:#e6db74">&#39;#title&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>( <span style="color:#e6db74">&#39;Feedback&#39;</span> ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186</span>      <span style="color:#e6db74">&#39;mail&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span> (<span style="color:#e6db74">&#39;#type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;textfield&#39;</span>, <span style="color:#e6db74">&#34;#title&#34;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#34;E-Mail&#34;</span>, <span style="color:#e6db74">&#34;#description&#34;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#34;If you want any answer, please, tell me your mail. It would not be shown anywhere.&#34;</span>, <span style="color:#e6db74">&#34;#default_value&#34;</span> <span style="color:#f92672">=&gt;</span> $mail ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187</span>      <span style="color:#e6db74">&#39;message&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span> ( <span style="color:#e6db74">&#39;#type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;textarea&#39;</span>, <span style="color:#e6db74">&#34;#description&#34;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#34;Write here your message&#34;</span>, <span style="color:#e6db74">&#39;#default_value&#39;</span><span style="color:#f92672">=&gt;</span>$message ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188</span>      <span style="color:#e6db74">&#39;#required&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">TRUE</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189</span>    );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191</span>  <span style="color:#66d9ef">if</span> ( $editing )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193</span>    $form [<span style="color:#e6db74">&#39;feedback&#39;</span>][<span style="color:#e6db74">&#39;read&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span> ( <span style="color:#e6db74">&#39;#type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;checkbox&#39;</span>, <span style="color:#e6db74">&#34;#title&#34;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#34;The message has been read&#34;</span>, <span style="color:#e6db74">&#39;#default_value&#39;</span><span style="color:#f92672">=&gt;</span>$read ) ;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196</span>  $form[<span style="color:#e6db74">&#39;title&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197</span>    (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198</span>      <span style="color:#e6db74">&#39;#type&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;hidden&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199</span>      <span style="color:#e6db74">&#39;#default_value&#39;</span> <span style="color:#f92672">=&gt;</span> $title,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200</span>    );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202</span>  <span style="color:#66d9ef">return</span> $form;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_insert</span> ( $node )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207</span>  $userid  <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208</span>  $message <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209</span>  $mail    <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">mail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211</span>  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;INSERT into {feedback_messages} ( id, uid, message, indate, usermail ) values ( %d, %d, &#39;%s&#39;, now(), &#39;%s&#39; ) &#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212</span>  $queryResult <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_query</span> ( $query, $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">nid</span>, $userid, $message, $mail );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214</span>  <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">db_affected_rows</span>() )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216</span>    <span style="color:#a6e22e">drupal_set_message</span> ( <span style="color:#a6e22e">t</span> ( <span style="color:#e6db74">&#34;Thank you for your feedback.&#34;</span> ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217</span>    <span style="color:#a6e22e">drupal_goto</span> ( <span style="color:#e6db74">&#39;node&#39;</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219</span>  <span style="color:#66d9ef">else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220</span>    <span style="color:#a6e22e">form_set_error</span> ( <span style="color:#e6db74">&#39;feedback&#39;</span>, <span style="color:#a6e22e">t</span>( <span style="color:#e6db74">&#34;An error has happened. Your feedback has not been sent.&#34;</span> ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_update</span> ( $node )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225</span>  $userid  <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226</span>  $message <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227</span>  $mail    <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">mail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228</span>  $read    <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">read</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230</span>  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UPDATE {feedback_messages} fm SET message=&#39;%s&#39;, usermail=&#39;%s&#39;, fm.read=%d where id=%d&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231</span>  $queryResult <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_query</span> ( $query, $message, $mail, $read, $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">nid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233</span>  <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">db_affected_rows</span>() )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235</span>    <span style="color:#a6e22e">drupal_set_message</span> ( <span style="color:#a6e22e">t</span> ( <span style="color:#e6db74">&#34;The feedback has been updated.&#34;</span> ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236</span>    <span style="color:#a6e22e">drupal_goto</span> ( <span style="color:#e6db74">&#39;node&#39;</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238</span>  <span style="color:#66d9ef">else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239</span>    <span style="color:#a6e22e">form_set_error</span> ( <span style="color:#e6db74">&#39;feedback&#39;</span>, <span style="color:#a6e22e">t</span>( <span style="color:#e6db74">&#34;An error has happened. Your feedback has not been sent.&#34;</span> ) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242</span><span style="color:#e6db74">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243</span><span style="color:#e6db74">* Implementation of hook_delete
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_delete</span> ( $node )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247</span>  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;DELETE FROM {feedback_messages} where id=%d&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248</span>  $queryResult <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_query</span> ( $query, $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">nid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_validate</span> ( $node, <span style="color:#f92672">&amp;</span>$form )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253</span>  $message <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254</span>  $mail    <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">mail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255</span>  $validmail <span style="color:#f92672">=</span> <span style="color:#a6e22e">preg_match</span> (<span style="color:#e6db74">&#34;/^[^0-9][A-z0-9_]+([.][A-z0-9_]+)*[@][A-z0-9_]+([.][A-z0-9_]+)*[.][A-z]{2,4}$/&#34;</span> , $mail );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257</span>  <span style="color:#66d9ef">if</span> ( $mail <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">&amp;&amp;</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258</span>    <span style="color:#a6e22e">form_set_error</span> ( <span style="color:#e6db74">&#39;mail&#39;</span>, <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;You are not a registered user. Please, insert your e-mail.&#39;</span>) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259</span>  <span style="color:#66d9ef">if</span> ( $mail <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span> $validmail )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260</span>    <span style="color:#a6e22e">form_set_error</span> ( <span style="color:#e6db74">&#39;mail&#39;</span>, <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;The mail does not like an e-mail address.&#39;</span>) );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261</span>  <span style="color:#66d9ef">if</span> ( $message <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#39;</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262</span>    <span style="color:#a6e22e">form_set_error</span> ( <span style="color:#e6db74">&#39;message&#39;</span>, <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Message cannot be empty.&#39;</span>));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264</span>  <span style="color:#66d9ef">return</span> $form;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_view</span> ( $node, $teaser <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, $page <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269</span>  $messageread <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270</span>  $messagedata <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271</span>  $messagename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272</span>  $messageusermail <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274</span>  <span style="color:#66d9ef">if</span> ( $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276</span>    <span style="color:#75715e">// ya tenemos el mensaje. Puede deberse a que estamos editando.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277</span><span style="color:#75715e"></span>    $messageread <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">read</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278</span>    $messagedata <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279</span>    $messagename <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280</span>    $messageusermail <span style="color:#f92672">=</span> $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">mail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">282</span>  <span style="color:#66d9ef">else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">283</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">284</span>    <span style="color:#75715e">// tenemos que obtener el mensaje
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">285</span><span style="color:#75715e"></span>    $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT fm.uid, message, indate, usermail, u.name, fm.read FROM {feedback_messages} fm, {users} u WHERE id=%d and fm.uid=u.uid&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">286</span>    $queryResult <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_query</span> ( $query, $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">nid</span> );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">287</span>    $message <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_fetch_object</span> ( $queryResult );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">288</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">289</span>    $messageread <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">read</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">290</span>    $messagedata <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">291</span>    $messagename <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">292</span>    $messageusermail <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">usermail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">293</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">294</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">295</span>  $read <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">296</span>  <span style="color:#66d9ef">if</span> ( $messageread )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">297</span>    $read <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#34; and &lt;b&gt;already read&lt;/b&gt;&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">298</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">299</span>  $content  <span style="color:#f92672">=</span> <span style="color:#a6e22e">sprintf</span> ( <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;&lt;blockquote&gt;&lt;i&gt;%s&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;Sent by %s&lt;a href=&#34;mailto:%s&#34;&gt;&amp;lt;%s&amp;gt;&lt;/a&gt;%s.&lt;/p&gt;&#39;</span>), $messagedata, $messagename, $messageusermail, $messageusermail, $read );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">300</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">301</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">302</span>  $node <span style="color:#f92672">=</span> <span style="color:#a6e22e">node_prepare</span> ( $node, $teaser );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">303</span>  $node<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">content</span>[<span style="color:#e6db74">&#39;message&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">304</span>    <span style="color:#e6db74">&#39;#value&#39;</span> <span style="color:#f92672">=&gt;</span> $content,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">305</span>    <span style="color:#e6db74">&#39;#weight&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">306</span>  );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">307</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">308</span>  <span style="color:#66d9ef">return</span> $node;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">309</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">310</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">311</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">feedback_admin</span> ( $messageid<span style="color:#f92672">=</span><span style="color:#66d9ef">null</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">312</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">313</span>  $content <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">314</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">315</span>  <span style="color:#66d9ef">if</span> ( $messageid <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">316</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">317</span>    $content <span style="color:#f92672">.=</span> <span style="color:#a6e22e">drupal_get_form</span> ( <span style="color:#e6db74">&#39;feedback_messageadmin_form&#39;</span>, $messageid );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">318</span>    $content <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#34;&lt;hr/&gt;&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">319</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">320</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">321</span>  $header <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">322</span>  (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">323</span>    <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Date&#39;</span>), <span style="color:#e6db74">&#39;field&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;indate&#39;</span>, <span style="color:#e6db74">&#39;sort&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;desc&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">324</span>    <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;User&#39;</span>), <span style="color:#e6db74">&#39;field&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;name&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">325</span>    <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;email&#39;</span>), <span style="color:#e6db74">&#39;field&#39;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#39;mail&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">326</span>    <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Message&#39;</span>), <span style="color:#e6db74">&#39;field&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;message&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">327</span>    <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;Read&#39;</span>), <span style="color:#e6db74">&#39;field&#39;</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#39;fm.read&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">328</span>  );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">329</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">330</span>  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT fm.id, u.uid as uid, u.name, fm.usermail, fm.indate, fm.message, fm.read FROM {feedback_messages} fm, {users} u WHERE fm.uid=u.uid&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">331</span>  $query <span style="color:#f92672">.=</span> <span style="color:#a6e22e">tablesort_sql</span> ( $header );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">332</span>  $queryResult <span style="color:#f92672">=</span>  <span style="color:#a6e22e">db_query</span> ( $query );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">333</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">334</span>  $rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span> ();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">335</span>  <span style="color:#66d9ef">while</span> ( $message <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_fetch_object</span> ( $queryResult ) )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">336</span>  {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">337</span>    $row <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span> ();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">338</span>    $row[<span style="color:#e6db74">&#39;indate&#39;</span>] <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">indate</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">339</span>    $row[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;&lt;a href=&#34;?q=user/&#39;</span><span style="color:#f92672">.</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uid</span> <span style="color:#f92672">.</span><span style="color:#e6db74">&#39;&#34;&gt;&#39;</span> <span style="color:#f92672">.</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;&lt;/a&gt;&#39;</span> <span style="color:#f92672">:</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">340</span>    $row[<span style="color:#e6db74">&#39;mail&#39;</span>] <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">usermail</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">341</span>    $row[<span style="color:#e6db74">&#39;message&#39;</span>] <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">342</span>    $row[<span style="color:#e6db74">&#39;read&#39;</span>] <span style="color:#f92672">=</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">read</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">343</span>    $row[<span style="color:#e6db74">&#39;edit&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">l</span> ( <span style="color:#a6e22e">t</span>(<span style="color:#e6db74">&#39;edit&#39;</span>), <span style="color:#e6db74">&#34;node/&#34;</span> <span style="color:#f92672">.</span> $message<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">id</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;/edit&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">344</span>    $rows[] <span style="color:#f92672">=</span> $row;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">345</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">346</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">347</span>  $content <span style="color:#f92672">.=</span> <span style="color:#a6e22e">theme_table</span>($header, $rows);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">348</span>  <span style="color:#66d9ef">return</span> $content;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">349</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">350</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">351</span><span style="color:#e6db74">/** Devuelve el número de feeds creados en la última semana
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">352</span><span style="color:#e6db74">*/</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">353</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_feedback_count</span> ()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">354</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">355</span>  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT count(id) as total from {feedback_messages} fm where fm.read != 1 or isnull(fm.read)&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">356</span>  $queryResult <span style="color:#f92672">=</span>  <span style="color:#a6e22e">db_query</span> ( $query );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">357</span>  $result <span style="color:#f92672">=</span> <span style="color:#a6e22e">db_fetch_object</span> ( $queryResult ) ;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">358</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">359</span>  <span style="color:#66d9ef">return</span> $result<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">total</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">360</span>}
</code></pre></div>
    
      
    
  </article>
<aside class="sidebar">
  <section class="sidebar_inner">
    
    <h2 class="mt-4">Posts recientes</h2>
    <ul class="flex-column">
      <li>
        <a href="http://example.org/blog/argocd/" class="nav-link">ArgoCD con Kind</a>
      </li>
      <li>
        <a href="http://example.org/blog/monitorizacion-con-graphite/" class="nav-link">Monitorización con Graphite</a>
      </li>
      <li>
        <a href="http://example.org/blog/organizacion/" class="nav-link">Organización</a>
      </li>
      <li>
        <a href="http://example.org/blog/hosting/" class="nav-link">Hosting</a>
      </li>
      <li>
        <a href="http://example.org/blog/devops-rol-o-metodologia/" class="nav-link">DevOps: ¿Equipo, Rol o metodología?</a>
      </li>
      <li>
        <a href="http://example.org/blog/instalando-linux-con-uefi/" class="nav-link">Instalando Linux con UEFI</a>
      </li>
      <li>
        <a href="http://example.org/blog/plugins-en-python/" class="nav-link">Plugins en Python</a>
      </li>
      <li>
        <a href="http://example.org/blog/ipython-autoreload/" class="nav-link">ipython autoreload</a>
      </li>
    </ul>
    <div>
      <h2 class="mt-4 taxonomy" id="categories-section">Categorías</h2>
      <nav class="tags_nav">
        <a href='http://example.org/categories/django-tutorial/' class="post_tag button button_translucent">
          DJANGO-TUTORIAL
          <span class="button_tally">3</span>
        </a>
        
        <a href='http://example.org/categories/translations/' class="post_tag button button_translucent">
          TRANSLATIONS
          <span class="button_tally">1</span>
        </a>
        
        
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="tags-section">Tags</h2>
      <nav class="tags_nav">
        <a href='http://example.org/tags/python/' class="post_tag button button_translucent">
          PYTHON
          <span class="button_tally">32</span>
        </a>
        
        <a href='http://example.org/tags/agile/' class="post_tag button button_translucent">
          AGILE
          <span class="button_tally">15</span>
        </a>
        
        <a href='http://example.org/tags/engineering/' class="post_tag button button_translucent">
          ENGINEERING
          <span class="button_tally">14</span>
        </a>
        
        <a href='http://example.org/tags/retrospective/' class="post_tag button button_translucent">
          RETROSPECTIVE
          <span class="button_tally">13</span>
        </a>
        
        <a href='http://example.org/tags/testing/' class="post_tag button button_translucent">
          TESTING
          <span class="button_tally">13</span>
        </a>
        
        <a href='http://example.org/tags/life/' class="post_tag button button_translucent">
          LIFE
          <span class="button_tally">12</span>
        </a>
        
        <a href='http://example.org/tags/django/' class="post_tag button button_translucent">
          DJANGO
          <span class="button_tally">9</span>
        </a>
        
        <a href='http://example.org/tags/drupal/' class="post_tag button button_translucent">
          DRUPAL
          <span class="button_tally">9</span>
        </a>
        
        <a href='http://example.org/tags/git/' class="post_tag button button_translucent">
          GIT
          <span class="button_tally">9</span>
        </a>
        
        <a href='http://example.org/tags/dvcs/' class="post_tag button button_translucent">
          DVCS
          <span class="button_tally">8</span>
        </a>
        
        
        <br>
        <div class="post_tags_toggle button">Todos los Tags</div>
        <div class="post_tags">
          <div class="tags_list">
            
            <a href='http://example.org/tags/acceptance/' class=" post_tag button button_translucent" data-position=2>ACCEPTANCE<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/admin/' class=" post_tag button button_translucent" data-position=1>ADMIN<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/administration/' class=" post_tag button button_translucent" data-position=1>ADMINISTRATION<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/agile/' class=" post_tag button button_translucent" data-position=15>AGILE<span class="button_tally">15</span>
            </a>
            
            
            <a href='http://example.org/tags/ajax/' class=" post_tag button button_translucent" data-position=1>AJAX<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/alerting/' class=" post_tag button button_translucent" data-position=1>ALERTING<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/angularjs/' class=" post_tag button button_translucent" data-position=1>ANGULARJS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/ansi-c/' class=" post_tag button button_translucent" data-position=5>ANSI-C<span class="button_tally">5</span>
            </a>
            
            
            <a href='http://example.org/tags/ansi-c-testing/' class=" post_tag button button_translucent" data-position=2>ANSI-C-TESTING<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/ant/' class=" post_tag button button_translucent" data-position=1>ANT<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/apache/' class=" post_tag button button_translucent" data-position=1>APACHE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/argocd/' class=" post_tag button button_translucent" data-position=1>ARGOCD<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/atheist/' class=" post_tag button button_translucent" data-position=3>ATHEIST<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/automation/' class=" post_tag button button_translucent" data-position=3>AUTOMATION<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/awesome-wm/' class=" post_tag button button_translucent" data-position=1>AWESOME-WM<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/aws/' class=" post_tag button button_translucent" data-position=1>AWS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/bootstrap/' class=" post_tag button button_translucent" data-position=2>BOOTSTRAP<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/bower/' class=" post_tag button button_translucent" data-position=1>BOWER<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/buildbot/' class=" post_tag button button_translucent" data-position=2>BUILDBOT<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/celery/' class=" post_tag button button_translucent" data-position=1>CELERY<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/chemistry/' class=" post_tag button button_translucent" data-position=1>CHEMISTRY<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/code-coverage/' class=" post_tag button button_translucent" data-position=2>CODE-COVERAGE<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/code-highlight/' class=" post_tag button button_translucent" data-position=1>CODE-HIGHLIGHT<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/code-retreat/' class=" post_tag button button_translucent" data-position=1>CODE-RETREAT<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/codemotion/' class=" post_tag button button_translucent" data-position=1>CODEMOTION<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/codice-software/' class=" post_tag button button_translucent" data-position=1>CODICE-SOFTWARE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/compiler/' class=" post_tag button button_translucent" data-position=1>COMPILER<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/compilers/' class=" post_tag button button_translucent" data-position=1>COMPILERS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/configuration/' class=" post_tag button button_translucent" data-position=2>CONFIGURATION<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/continuous-integration/' class=" post_tag button button_translucent" data-position=4>CONTINUOUS-INTEGRATION<span class="button_tally">4</span>
            </a>
            
            
            <a href='http://example.org/tags/coverage/' class=" post_tag button button_translucent" data-position=1>COVERAGE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/crack/' class=" post_tag button button_translucent" data-position=1>CRACK<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/css/' class=" post_tag button button_translucent" data-position=5>CSS<span class="button_tally">5</span>
            </a>
            
            
            <a href='http://example.org/tags/curses/' class=" post_tag button button_translucent" data-position=1>CURSES<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/db-testing/' class=" post_tag button button_translucent" data-position=2>DB-TESTING<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/dbunit/' class=" post_tag button button_translucent" data-position=1>DBUNIT<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/debian/' class=" post_tag button button_translucent" data-position=1>DEBIAN<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/deployment/' class=" post_tag button button_translucent" data-position=1>DEPLOYMENT<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/derby-db/' class=" post_tag button button_translucent" data-position=1>DERBY-DB<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/devops/' class=" post_tag button button_translucent" data-position=4>DEVOPS<span class="button_tally">4</span>
            </a>
            
            
            <a href='http://example.org/tags/devscripts/' class=" post_tag button button_translucent" data-position=1>DEVSCRIPTS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/distributed-systems/' class=" post_tag button button_translucent" data-position=1>DISTRIBUTED-SYSTEMS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/django/' class=" post_tag button button_translucent" data-position=9>DJANGO<span class="button_tally">9</span>
            </a>
            
            
            <a href='http://example.org/tags/django-testing/' class=" post_tag button button_translucent" data-position=1>DJANGO-TESTING<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/docker/' class=" post_tag button button_translucent" data-position=4>DOCKER<span class="button_tally">4</span>
            </a>
            
            
            <a href='http://example.org/tags/docker-compose/' class=" post_tag button button_translucent" data-position=1>DOCKER-COMPOSE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/doctest/' class=" post_tag button button_translucent" data-position=1>DOCTEST<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/domain/' class=" post_tag button button_translucent" data-position=1>DOMAIN<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/drupal/' class=" post_tag button button_translucent" data-position=9>DRUPAL<span class="button_tally">9</span>
            </a>
            
            
            <a href='http://example.org/tags/dvcs/' class=" post_tag button button_translucent" data-position=8>DVCS<span class="button_tally">8</span>
            </a>
            
            
            <a href='http://example.org/tags/elasticsearch/' class=" post_tag button button_translucent" data-position=1>ELASTICSEARCH<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/emacs/' class=" post_tag button button_translucent" data-position=1>EMACS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/email/' class=" post_tag button button_translucent" data-position=1>EMAIL<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/engineering/' class=" post_tag button button_translucent" data-position=14>ENGINEERING<span class="button_tally">14</span>
            </a>
            
            
            <a href='http://example.org/tags/firefox/' class=" post_tag button button_translucent" data-position=1>FIREFOX<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/fish/' class=" post_tag button button_translucent" data-position=1>FISH<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/freshen/' class=" post_tag button button_translucent" data-position=1>FRESHEN<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/functional-programming/' class=" post_tag button button_translucent" data-position=1>FUNCTIONAL-PROGRAMMING<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/games/' class=" post_tag button button_translucent" data-position=1>GAMES<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/gettext/' class=" post_tag button button_translucent" data-position=1>GETTEXT<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/git/' class=" post_tag button button_translucent" data-position=9>GIT<span class="button_tally">9</span>
            </a>
            
            
            <a href='http://example.org/tags/gnome/' class=" post_tag button button_translucent" data-position=1>GNOME<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/gnu/linux/' class=" post_tag button button_translucent" data-position=3>GNU/LINUX<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/google/' class=" post_tag button button_translucent" data-position=1>GOOGLE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/grammar/' class=" post_tag button button_translucent" data-position=1>GRAMMAR<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/graphite/' class=" post_tag button button_translucent" data-position=2>GRAPHITE<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/grub/' class=" post_tag button button_translucent" data-position=1>GRUB<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/grunt/' class=" post_tag button button_translucent" data-position=1>GRUNT<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/gtk/' class=" post_tag button button_translucent" data-position=2>GTK<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/hamcrest/' class=" post_tag button button_translucent" data-position=1>HAMCREST<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/hibernate/' class=" post_tag button button_translucent" data-position=1>HIBERNATE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/home/' class=" post_tag button button_translucent" data-position=1>HOME<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/hosting/' class=" post_tag button button_translucent" data-position=1>HOSTING<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/hsqldb/' class=" post_tag button button_translucent" data-position=1>HSQLDB<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/ini-files/' class=" post_tag button button_translucent" data-position=1>INI-FILES<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/internationalization/' class=" post_tag button button_translucent" data-position=1>INTERNATIONALIZATION<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/internet/' class=" post_tag button button_translucent" data-position=1>INTERNET<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/ipython/' class=" post_tag button button_translucent" data-position=1>IPYTHON<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/it/' class=" post_tag button button_translucent" data-position=1>IT<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/java/' class=" post_tag button button_translucent" data-position=6>JAVA<span class="button_tally">6</span>
            </a>
            
            
            <a href='http://example.org/tags/java-ide/' class=" post_tag button button_translucent" data-position=3>JAVA-IDE<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/java-testing/' class=" post_tag button button_translucent" data-position=7>JAVA-TESTING<span class="button_tally">7</span>
            </a>
            
            
            <a href='http://example.org/tags/javascript/' class=" post_tag button button_translucent" data-position=6>JAVASCRIPT<span class="button_tally">6</span>
            </a>
            
            
            <a href='http://example.org/tags/jbehave/' class=" post_tag button button_translucent" data-position=2>JBEHAVE<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/jekyll/' class=" post_tag button button_translucent" data-position=2>JEKYLL<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/jenkins/' class=" post_tag button button_translucent" data-position=4>JENKINS<span class="button_tally">4</span>
            </a>
            
            
            <a href='http://example.org/tags/job/' class=" post_tag button button_translucent" data-position=1>JOB<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/jquery/' class=" post_tag button button_translucent" data-position=1>JQUERY<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/json/' class=" post_tag button button_translucent" data-position=2>JSON<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/junit/' class=" post_tag button button_translucent" data-position=1>JUNIT<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/kibana/' class=" post_tag button button_translucent" data-position=1>KIBANA<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/kind/' class=" post_tag button button_translucent" data-position=1>KIND<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/kitchen/' class=" post_tag button button_translucent" data-position=2>KITCHEN<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/kohana/' class=" post_tag button button_translucent" data-position=2>KOHANA<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/kubernetes/' class=" post_tag button button_translucent" data-position=1>KUBERNETES<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/lamp/' class=" post_tag button button_translucent" data-position=3>LAMP<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/languages/' class=" post_tag button button_translucent" data-position=7>LANGUAGES<span class="button_tally">7</span>
            </a>
            
            
            <a href='http://example.org/tags/latex/' class=" post_tag button button_translucent" data-position=1>LATEX<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/ldap/' class=" post_tag button button_translucent" data-position=1>LDAP<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/life/' class=" post_tag button button_translucent" data-position=12>LIFE<span class="button_tally">12</span>
            </a>
            
            
            <a href='http://example.org/tags/logstash/' class=" post_tag button button_translucent" data-position=1>LOGSTASH<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/make/' class=" post_tag button button_translucent" data-position=1>MAKE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/mathematics/' class=" post_tag button button_translucent" data-position=1>MATHEMATICS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/maven/' class=" post_tag button button_translucent" data-position=2>MAVEN<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/mercurial/' class=" post_tag button button_translucent" data-position=2>MERCURIAL<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/middleware/' class=" post_tag button button_translucent" data-position=1>MIDDLEWARE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/migrating/' class=" post_tag button button_translucent" data-position=4>MIGRATING<span class="button_tally">4</span>
            </a>
            
            
            <a href='http://example.org/tags/mock/' class=" post_tag button button_translucent" data-position=1>MOCK<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/mongodb/' class=" post_tag button button_translucent" data-position=2>MONGODB<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/monitor/' class=" post_tag button button_translucent" data-position=2>MONITOR<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/monitoring/' class=" post_tag button button_translucent" data-position=5>MONITORING<span class="button_tally">5</span>
            </a>
            
            
            <a href='http://example.org/tags/munin/' class=" post_tag button button_translucent" data-position=2>MUNIN<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/netbeans/' class=" post_tag button button_translucent" data-position=3>NETBEANS<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/nikola/' class=" post_tag button button_translucent" data-position=1>NIKOLA<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/nose/' class=" post_tag button button_translucent" data-position=1>NOSE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/nosql/' class=" post_tag button button_translucent" data-position=3>NOSQL<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/octopress/' class=" post_tag button button_translucent" data-position=1>OCTOPRESS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/openspace/' class=" post_tag button button_translucent" data-position=1>OPENSPACE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/organization/' class=" post_tag button button_translucent" data-position=1>ORGANIZATION<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/orm/' class=" post_tag button button_translucent" data-position=1>ORM<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/package/' class=" post_tag button button_translucent" data-position=1>PACKAGE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/patents/' class=" post_tag button button_translucent" data-position=1>PATENTS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/patterns/' class=" post_tag button button_translucent" data-position=7>PATTERNS<span class="button_tally">7</span>
            </a>
            
            
            <a href='http://example.org/tags/peewee/' class=" post_tag button button_translucent" data-position=1>PEEWEE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/permission/' class=" post_tag button button_translucent" data-position=1>PERMISSION<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/persistence/' class=" post_tag button button_translucent" data-position=1>PERSISTENCE<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/php/' class=" post_tag button button_translucent" data-position=3>PHP<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/php-testing/' class=" post_tag button button_translucent" data-position=1>PHP-TESTING<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/plugins/' class=" post_tag button button_translucent" data-position=1>PLUGINS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/programming/' class=" post_tag button button_translucent" data-position=1>PROGRAMMING<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/programs/' class=" post_tag button button_translucent" data-position=1>PROGRAMS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/puppet/' class=" post_tag button button_translucent" data-position=3>PUPPET<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/pydoubles/' class=" post_tag button button_translucent" data-position=1>PYDOUBLES<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/python/' class=" post_tag button button_translucent" data-position=32>PYTHON<span class="button_tally">32</span>
            </a>
            
            
            <a href='http://example.org/tags/python-testing/' class=" post_tag button button_translucent" data-position=7>PYTHON-TESTING<span class="button_tally">7</span>
            </a>
            
            
            <a href='http://example.org/tags/rabbitmq/' class=" post_tag button button_translucent" data-position=1>RABBITMQ<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/resume/' class=" post_tag button button_translucent" data-position=1>RESUME<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/retrospective/' class=" post_tag button button_translucent" data-position=13>RETROSPECTIVE<span class="button_tally">13</span>
            </a>
            
            
            <a href='http://example.org/tags/rounding/' class=" post_tag button button_translucent" data-position=1>ROUNDING<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/ruby/' class=" post_tag button button_translucent" data-position=3>RUBY<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/ruby-on-rails/' class=" post_tag button button_translucent" data-position=1>RUBY-ON-RAILS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/saltstack/' class=" post_tag button button_translucent" data-position=2>SALTSTACK<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/scrum/' class=" post_tag button button_translucent" data-position=1>SCRUM<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/security/' class=" post_tag button button_translucent" data-position=1>SECURITY<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/selenium/' class=" post_tag button button_translucent" data-position=5>SELENIUM<span class="button_tally">5</span>
            </a>
            
            
            <a href='http://example.org/tags/shell/' class=" post_tag button button_translucent" data-position=1>SHELL<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/smtp/' class=" post_tag button button_translucent" data-position=1>SMTP<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/spam/' class=" post_tag button button_translucent" data-position=1>SPAM<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/sql/' class=" post_tag button button_translucent" data-position=5>SQL<span class="button_tally">5</span>
            </a>
            
            
            <a href='http://example.org/tags/ssl/' class=" post_tag button button_translucent" data-position=1>SSL<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/static/' class=" post_tag button button_translucent" data-position=1>STATIC<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/statistic/' class=" post_tag button button_translucent" data-position=1>STATISTIC<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/subversion/' class=" post_tag button button_translucent" data-position=2>SUBVERSION<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/swing/' class=" post_tag button button_translucent" data-position=2>SWING<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/sysadmin/' class=" post_tag button button_translucent" data-position=2>SYSADMIN<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/tdd/' class=" post_tag button button_translucent" data-position=1>TDD<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/test/' class=" post_tag button button_translucent" data-position=2>TEST<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/testing/' class=" post_tag button button_translucent" data-position=13>TESTING<span class="button_tally">13</span>
            </a>
            
            
            <a href='http://example.org/tags/tests/' class=" post_tag button button_translucent" data-position=2>TESTS<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/tornado/' class=" post_tag button button_translucent" data-position=2>TORNADO<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/tuenti/' class=" post_tag button button_translucent" data-position=3>TUENTI<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/unittest/' class=" post_tag button button_translucent" data-position=1>UNITTEST<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/vagrant/' class=" post_tag button button_translucent" data-position=3>VAGRANT<span class="button_tally">3</span>
            </a>
            
            
            <a href='http://example.org/tags/virtualbox/' class=" post_tag button button_translucent" data-position=1>VIRTUALBOX<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/virtualenv/' class=" post_tag button button_translucent" data-position=1>VIRTUALENV<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/web/' class=" post_tag button button_translucent" data-position=1>WEB<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/webdriver/' class=" post_tag button button_translucent" data-position=2>WEBDRIVER<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/webviews/' class=" post_tag button button_translucent" data-position=1>WEBVIEWS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/windows/' class=" post_tag button button_translucent" data-position=1>WINDOWS<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/xml/' class=" post_tag button button_translucent" data-position=2>XML<span class="button_tally">2</span>
            </a>
            
            
            <a href='http://example.org/tags/yaml/' class=" post_tag button button_translucent" data-position=1>YAML<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/yeoman/' class=" post_tag button button_translucent" data-position=1>YEOMAN<span class="button_tally">1</span>
            </a>
            
            
            <a href='http://example.org/tags/zsh/' class=" post_tag button button_translucent" data-position=1>ZSH<span class="button_tally">1</span>
            </a>
            
            <div class="tags_sort"><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span>
            </div>
            <span class="tags_hide"><svg class="icon">
            <use xlink:href="#closeme"></use>
          </svg></span>
          </div>
        </div>
      </nav>
    </div>
  </section>
</aside>

</div>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab">
    <path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6 0L12.3 74.8z" />
    <path d="M12.3 74.7L.5 111c-1 3.2 0 6.8 3 8.8l101.6 74-92.5-119z"/>
    <path d="M105 193.7l-38.6-119h-54l92.7 119z"/>
    <path d="M105 193.7l38.7-119H66.4l38.7 119z"/>
    <path d="M105 193.7l38.7-119H198l-93 119z"/>
    <path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/>
    <path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6 0L198 74.8z"/> 
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="arrow">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id=youtube>
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
</svg>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
<footer class="footer">
  <div class="footer_inner wrap pale">
    <img src='http://example.org/icons/apple-touch-icon.png' class="icon icon_2 transparent">
    <p>Copyright<span class="year"></span> EL BLOG DE MAGMAX. Todos los Derechos Reservados</p><a class="to_top" href="#documentTop">
  <svg class="icon">
  <use xlink:href="#arrow"></use>
</svg>
</a>

  </div>
</footer>

    <script type="text/javascript" src="http://example.org/js/bundle.min.d47d3d6894e66aa67f2514c171756283d3e8847b56f8f158bdd8430843da5f5af874c7a89a316c6743a845399bdb89649685154dc88b7e9bff1a155ca9e5108a.js" integrity="sha512-1H09aJTmaqZ/JRTBcXVig9PohHtW&#43;PFYvdhDCEPaX1r4dMeomjFsZ0OoRTmb24lkloUVTciLfpv/GhVcqeUQig==" crossorigin="anonymous"></script>
    
  </body>
</html>
