<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Creación de un módulo Drupal III - El blog de MagMax</title><meta name="Description" content="El blog de un Ingeniero Informático: tutoriales, manuales, opiniones, comparativas, ..."><meta property="og:title" content="Creación de un módulo Drupal III" />
<meta property="og:description" content="Qué vamos a hacer
En esta ocasión me voy a dedicar a arreglar los estropicios que hice anteriomente :D
Además, voy a añadir enlaces para eliminar los feeds (como me han solicitado) y también vamos a redirigir al usuario a la página principal después de añadir un feed (como también me han solicitado).
También añadiremos un mail al usuario que inserta el mensaje, por si no está registrado. En caso de que esté registrado, guardaremos una referencia al mismo." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/creacion-modulo-drupal-3/" />
<meta property="og:image" content="https://magmax.org/icons/favicon.png"/>
<meta property="article:published_time" content="2010-05-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-28T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://magmax.org/icons/favicon.png"/>

<meta name="twitter:title" content="Creación de un módulo Drupal III"/>
<meta name="twitter:description" content="Qué vamos a hacer
En esta ocasión me voy a dedicar a arreglar los estropicios que hice anteriomente :D
Además, voy a añadir enlaces para eliminar los feeds (como me han solicitado) y también vamos a redirigir al usuario a la página principal después de añadir un feed (como también me han solicitado).
También añadiremos un mail al usuario que inserta el mensaje, por si no está registrado. En caso de que esté registrado, guardaremos una referencia al mismo."/>
<meta name="application-name" content="El blog de MagMax">
<meta name="apple-mobile-web-app-title" content="El blog de MagMax"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://magmax.org/blog/creacion-modulo-drupal-3/" /><link rel="prev" href="https://magmax.org/blog/creacion-modulo-drupal-4/" /><link rel="next" href="https://magmax.org/blog/creacion-modulo-drupal-2/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Creación de un módulo Drupal III",
        "inLanguage": "es",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/magmax.org\/blog\/creacion-modulo-drupal-3\/"
        },"genre": "posts","keywords": "drupal","wordcount":  4068 ,
        "url": "https:\/\/magmax.org\/blog\/creacion-modulo-drupal-3\/","datePublished": "2010-05-11T00:00:00+00:00","dateModified": "2021-01-28T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "Miguel Ángel"},"author": {
                "@type": "Person",
                "name": "Miguel Ángel"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Inicio </a><a class="menu-item" href="/tags"> Tags </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/blog/creacion-modulo-drupal-3/" selected>Español</option></select>
                    </a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">Inicio</a><a class="menu-item" href="/tags" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/blog/creacion-modulo-drupal-3/" selected>Español</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contenido</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Creación de un módulo Drupal III</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Miguel Ángel</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="11 May 2010">11 May 2010</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;4068 palabras&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;20 minutos&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contenido</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#qué-vamos-a-hacer">Qué vamos a hacer</a></li>
    <li><a href="#qué-se-explica-aquí">Qué se explica aquí</a></li>
    <li><a href="#notas-previas">Notas previas</a></li>
    <li><a href="#modificando-la-bbdd">Modificando la BBDD</a></li>
    <li><a href="#fe-de-erratas">Fe de erratas</a></li>
    <li><a href="#modificando-funciones">Modificando funciones</a></li>
    <li><a href="#añadiendo-un-mail">Añadiendo un mail</a>
      <ul>
        <li><a href="#borrando">Borrando</a></li>
      </ul>
    </li>
    <li><a href="#dos-palabras">Dos palabras</a></li>
    <li><a href="#más-tutoriales">Más tutoriales</a></li>
    <li><a href="#código">Código</a>
      <ul>
        <li><a href="#feedbackinfo">feedback.info</a></li>
        <li><a href="#feedbackinstall">feedback.install</a></li>
        <li><a href="#feedbackmodule">feedback.module</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="qué-vamos-a-hacer">Qué vamos a hacer</h2>
<p>En esta ocasión me voy a dedicar a arreglar los estropicios que hice anteriomente :D</p>
<p>Además, voy a añadir enlaces para eliminar los feeds (como me han solicitado) y también vamos a redirigir al usuario a la página principal después de añadir un feed (como también me han solicitado).</p>
<p>También añadiremos un mail al usuario que inserta el mensaje, por si no está registrado. En caso de que esté registrado, guardaremos una referencia al mismo.</p>
<figure>
    <img src="/images/drupal.png"
         alt="Drupal"/> 
</figure>

<h2 id="qué-se-explica-aquí">Qué se explica aquí</h2>
<p>En esta ocasión veremos cómo:</p>
<ul>
<li>Redirigir al usuario a la página que deseemos.</li>
<li>Ordenación de tablas.</li>
<li>Expresiones regulares.</li>
</ul>
<h2 id="notas-previas">Notas previas</h2>
<p>En la <a href="https://magmax.org/blog/creacion-modulo-drupal/" rel="">primera parte del tutorial drupal</a> ya insistí en que sólo se debe abrir el tag de <code>&lt;?php</code>, y no se debe cerrar con <code>?&gt;</code>. Dicho esto, continuamos.</p>
<h2 id="modificando-la-bbdd">Modificando la BBDD</h2>
<p>Añadimos el campo usermail. Además, modificamos el campo &ldquo;uid&rdquo; para que referencie al usuario si éste hizo login.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="k">function</span> <span class="nf">feedback_update_6102</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$ret</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="nx">db_add_field</span> <span class="p">(</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s1">&#39;feedback_messages&#39;</span><span class="p">,</span> <span class="s1">&#39;usermail&#39;</span><span class="p">,</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span> <span class="p">)</span> <span class="p">);</span>
  <span class="nx">db_change_field</span> <span class="p">(</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s1">&#39;feedback_messages&#39;</span><span class="p">,</span> <span class="s1">&#39;uid&#39;</span><span class="p">,</span> <span class="s1">&#39;uid&#39;</span><span class="p">,</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;type&#39;</span><span class="o">=&gt;</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned&#39;</span><span class="o">=&gt;</span><span class="k">TRUE</span> <span class="p">)</span> <span class="p">);</span>
  <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="fe-de-erratas">Fe de erratas</h2>
<p>El primer error fue la contabilización de feeds. Si miráis el tutorial <code>Creación de un módulo Drupal (II)</code>_, veréis la siguiente línea (función <code>_feedback_count</code>):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;SELECT count(id) as total from {feedback_messages} fm where fm.read != 1&#34;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Bueno, pues está <em>mal</em>. Lo correcto es lo siguiente:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;select count(*) from drupal6.feedback_messages fm where isnull (fm.read) or fm.read != 1&#34;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Como véis, comprobamos que no sea nulo, ya que en ese caso no estaba
contabilizando correctamente.</p>
<p>El segundo error cometido es que los <code>set_error</code> deben realizarse sobre un
campo. Así, en el primer tutorial, donde aparecen los <code>set_error</code>, están mal.
Realmente no veremos la diferencia si no la conocemos: Si lo hacemos bien, los
campos indicados se marcarán en rojo (depende del tema) indicando que el
problema se encuentra en ése campo. De esta manera, quedarían así (función
<code>feedback_message_form_submit</code>):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">&#39;feedback&#39;</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span> <span class="s2">&#34;An error has happened. Your feedback has not been sent.&#34;</span> <span class="p">)</span> <span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Veremos la función completa cuando añadamos más cosas.</p>
<p>Y ya, como error menor, deciros que las etiquetas &lsquo;Date&rsquo; y &lsquo;User&rsquo; estaban cambiadas en la función <code>feedback_admin</code>.</p>
<p>Al final de este tutorial, pondré todo seguido para que podáis aclararos.</p>
<h2 id="modificando-funciones">Modificando funciones</h2>
<p>Primero vamos con lo más sencillo de todo: Queremos que cuando alguien meta un feed, que vuelva a la pantalla de inicio. Asumiré que la página de inicio es <code>?q=node</code>, por lo que basta con indicarle:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="nx">drupal_goto</span> <span class="p">(</span> <span class="s1">&#39;node&#39;</span> <span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>A continuación, no sé si notásteis que la tabla con todos los mensajes no se ordena al pulsar las columnas. Esto nos puede venir bien para poder agrupar los mensajes no leídos, para ordenar por fecha, para agrupar los mensajes sin contenido, etc. ¡¡ Y es tan sencillo !! Basta con realizar un cambio durante la consulta, así que en <code>feedback_admin</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;SELECT fm.id, u.name, fm.indate, fm.message FROM {feedback_messages} fm, {users} u WHERE fm.uid=u.uid&#34;</span><span class="p">;</span>
<span class="nv">$query</span> <span class="o">.=</span> <span class="nx">tablesort_sql</span> <span class="p">(</span> <span class="nv">$header</span> <span class="p">);</span>
<span class="nv">$queryResult</span> <span class="o">=</span>  <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span> <span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Con eso le decimos a drupal que nos ordene la tabla. Ésa es una de las gracias de usar los headers en una tabla a parte, y por eso los definimos antes de realizar la consulta.</p>
<h2 id="añadiendo-un-mail">Añadiendo un mail</h2>
<p>En las modificaciones de la base de datos, añadimos el campo <code>usermail</code>. Ahora vamos a usarlo. Necesitaremos que el usuario lo inserte, así que tenemos que modificar <code>feedback_message_form</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="k">function</span> <span class="nf">feedback_message_form</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="k">global</span> <span class="nv">$user</span><span class="p">;</span>
  <span class="nv">$mail</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">uid</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="nv">$mail</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">mail</span><span class="p">;</span>

  <span class="nv">$form</span> <span class="o">=</span> <span class="k">array</span>
  <span class="p">(</span>
    <span class="s1">&#39;feedback&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span>
    <span class="p">(</span>
      <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;fieldset&#39;</span><span class="p">,</span>
      <span class="s1">&#39;#title&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span> <span class="s1">&#39;Feedback&#39;</span> <span class="p">),</span>
      <span class="s1">&#39;mail&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span><span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;textfield&#39;</span><span class="p">,</span> <span class="s2">&#34;#title&#34;</span><span class="o">=&gt;</span><span class="s2">&#34;E-Mail&#34;</span><span class="p">,</span> <span class="s2">&#34;#default_value&#34;</span> <span class="o">=&gt;</span> <span class="nv">$mail</span><span class="p">,</span>
                <span class="s2">&#34;#description&#34;</span><span class="o">=&gt;</span><span class="s2">&#34;If you want any answer, please, tell me your mail. It would not be shown anywhere.&#34;</span> <span class="p">),</span>
      <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;textarea&#39;</span><span class="p">,</span> <span class="s2">&#34;#description&#34;</span><span class="o">=&gt;</span><span class="s2">&#34;Write here your message&#34;</span> <span class="p">),</span>
      <span class="s1">&#39;submit&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;submit&#39;</span><span class="p">,</span>  <span class="s1">&#39;#value&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Submit&#39;</span><span class="p">),</span>  <span class="p">),</span>
    <span class="p">),</span>
  <span class="p">);</span>

  <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Como veréis, esta función tiene un añadido: si el usuario ha hecho <em>login</em>, rellenamos el campo con el mail que puso para su usuario. Así le ahorramos trabajo. El UID del usuario no es necesario que lo metamos en el formulario, ya que podemos recuperarlo directamente de la variable global.</p>
<p>Las validaciones también cambian, ya que no sólo vamos a comprobar que el mensaje no esté vacío, sino que queremos hacer más cosas. Queremos que, si el usuario hizo <em>login</em>, entonces el campo de e-mail no es obligatorio. Si no lo hizo, entonces sí que lo es. Y el e-mail tiene que parecer un e-mail, es decir, tener su arroba y demás:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="k">function</span> <span class="nf">feedback_message_form_validate</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="k">global</span> <span class="nv">$user</span><span class="p">;</span>

  <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">];</span>
  <span class="nv">$mail</span>    <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;mail&#39;</span><span class="p">];</span>
  <span class="nv">$validmail</span> <span class="o">=</span> <span class="nx">preg_match</span> <span class="p">(</span><span class="s2">&#34;/^[^0-9][A-z0-9_]+([.][A-z0-9_]+)*[@][A-z0-9_]+([.][A-z0-9_]+)*[.][A-z]{2,4}$/&#34;</span> <span class="p">,</span> <span class="nv">$mail</span> <span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nv">$mail</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">uid</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">&#39;mail&#39;</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;You are not a registered user. Please, insert your e-mail.&#39;</span><span class="p">)</span> <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nv">$mail</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nv">$validmail</span> <span class="p">)</span>
    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">&#39;mail&#39;</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;The mail does not like an e-mail address.&#39;</span><span class="p">)</span> <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nv">$message</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span>
    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Message cannot be empty.&#39;</span><span class="p">));</span>

  <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Aquí hemos introducido la creación de una expresión regular. Explicada brevemente, estamos comprobando si encaja el mail con un patrón dado. La expresión regular es bastante compleja, así que sólo comentaré lo más básico de todo:</p>
<ul>
<li>Lo que va entre corchetes, significa &ldquo;uno de estos&rdquo;. Ej: *[A-z0-9_]* significa que queremos una letra mayúscula o minúscula, un número o un guión bajo.</li>
<li>Lo que va entre corchetes pero comienza por &ldquo;^&rdquo;, significa &ldquo;ninguno de estos&rdquo;. Ej. <em>[^0-9]</em> significa &ldquo;algo que no sea un número&rdquo;.</li>
<li>El asterisco significa &ldquo;lo anterior se puede repetir 0 o más veces&rdquo;. Ej: <em>[0-9]*</em> significa que puede no haber nada o bien un número indeterminado de números.</li>
<li>El símbolo de suma significa &ldquo;lo anterior se puede repetir 1 o más veces&rdquo;. Ej: <em>[0-9]+</em> significa que puede haber un número indeterminado de números, pero debe aparecer al menos uno.</li>
<li>Los paréntesis permiten agrupar cosas para aplicarle otros símbolos.</li>
<li>Las llaves implican la multiplicidad exacta. Ej: <em>[A-z]{2}</em> significa &ldquo;dos letras&rdquo;. <em>[A-z]{2,4}</em> significa &ldquo;entre 2 y 4 letras&rdquo;.</li>
</ul>
<p>Habitualmente, crear una expresión regular es mucho más sencillo de lo que parece, pero modificar una que ya existe suele ser bastante complicadete :-D</p>
<p>Bueno, y nos queda la inserción:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="k">function</span> <span class="nf">feedback_message_form_submit</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="k">global</span> <span class="nv">$user</span><span class="p">;</span>
  <span class="nv">$userid</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nv">$user</span> <span class="p">)</span>
    <span class="nv">$userid</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">uid</span><span class="p">;</span>
  <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">];</span>
  <span class="nv">$mail</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;mail&#39;</span><span class="p">];</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;INSERT into {feedback_messages} ( uid, message, indate, usermail ) values ( %d, &#39;%s&#39;, now(), &#39;%s&#39; ) &#34;</span><span class="p">;</span>
  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$userid</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$mail</span> <span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nx">db_affected_rows</span><span class="p">()</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">drupal_set_message</span> <span class="p">(</span> <span class="nx">t</span> <span class="p">(</span> <span class="s2">&#34;Thank you for your feedback.&#34;</span> <span class="p">)</span> <span class="p">);</span>
    <span class="nx">drupal_goto</span> <span class="p">(</span> <span class="s1">&#39;node&#39;</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">&#39;feedback&#39;</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span> <span class="s2">&#34;An error has happened. Your feedback has not been sent.&#34;</span> <span class="p">)</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Como ya sabemos redirigir, si todo va bien, nos iremos a la página principal :-D</p>
<p>Ya que tenemos el mail, lo suyo es que lo veamos desde la tabla principal de feeds:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="k">function</span> <span class="nf">feedback_admin</span> <span class="p">(</span> <span class="nv">$messageid</span><span class="o">=</span><span class="k">null</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nv">$messageid</span> <span class="o">!=</span> <span class="k">null</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">drupal_get_form</span> <span class="p">(</span> <span class="s1">&#39;feedback_messageadmin_form&#39;</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>
    <span class="nv">$content</span> <span class="o">.=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$header</span> <span class="o">=</span> <span class="k">array</span>
  <span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">),</span> <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;indate&#39;</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;desc&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">),</span> <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;name&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">),</span> <span class="s1">&#39;field&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;mail&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Message&#39;</span><span class="p">),</span> <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;message&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Read&#39;</span><span class="p">),</span> <span class="s1">&#39;field&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;fm.read&#39;</span><span class="p">),</span>
  <span class="p">);</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;SELECT fm.id, u.uid as uid, u.name, fm.usermail, fm.indate, fm.message, fm.read FROM {feedback_messages} fm, {users} u WHERE fm.uid=u.uid&#34;</span><span class="p">;</span>
  <span class="nv">$query</span> <span class="o">.=</span> <span class="nx">tablesort_sql</span> <span class="p">(</span> <span class="nv">$header</span> <span class="p">);</span>
  <span class="nv">$queryResult</span> <span class="o">=</span>  <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span> <span class="p">);</span>

  <span class="nv">$rows</span> <span class="o">=</span> <span class="k">array</span> <span class="p">();</span>
  <span class="k">while</span> <span class="p">(</span> <span class="nv">$message</span> <span class="o">=</span> <span class="nx">db_fetch_object</span> <span class="p">(</span> <span class="nv">$queryResult</span> <span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$row</span> <span class="o">=</span> <span class="k">array</span> <span class="p">();</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;indate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">indate</span><span class="p">;</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">uid</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;mail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">usermail</span><span class="p">;</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">;</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;read&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">;</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;edit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">l</span> <span class="p">(</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">),</span> <span class="s2">&#34;feedback/adminmessages/&#34;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">id</span> <span class="p">);</span>
    <span class="nv">$rows</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">theme_table</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="nv">$rows</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>¡¡¡ Mucho ojo, porque a esta función aún tenemos que añadirle una línea para el borrado !!!</p>
<p>Además he añadido una cosa nueva. Si pulsáis sobre el nombre de uno de los usuarios, os redirigirá a la página personal del mismo.</p>
<h3 id="borrando">Borrando</h3>
<p>Ahora vamos a añadir una nueva operación: el borrado.</p>
<p>La forma de realizarlo va a ser similar a como está hecha la edición, con la diferencia de que vamos a cambiar el botón por uno de &ldquo;eliminar&rdquo;. Así que resulta fácil realizar este paso, aunque tendrá sus inconvenientes :-D</p>
<p>Comenzamos como siempre: permisos, menú, función principal y formularios.</p>
<p>No necesitamos más permisos de los que ya tenemos, así que en la función de menú (<code>feedback_menu</code>), añadimos lo siguiente:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="nv">$items</span><span class="p">[</span><span class="s1">&#39;feedback/delete/%&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span>
  <span class="p">(</span>
    <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Feedback delete&#39;</span><span class="p">,</span>
    <span class="s1">&#39;page callback&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;feedback_delete&#39;</span><span class="p">,</span>
    <span class="s1">&#39;access arguments&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;view messages&#39;</span><span class="p">),</span>
    <span class="s1">&#39;page arguments&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="mi">2</span> <span class="p">),</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nx">MENU_CALLBACK</span><span class="p">,</span>
  <span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Ahora creamos la función principal:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="k">function</span> <span class="nf">feedback_delete</span> <span class="p">(</span> <span class="nv">$messageid</span><span class="o">=</span><span class="k">null</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">drupal_get_form</span> <span class="p">(</span> <span class="s1">&#39;feedback_delete_form&#39;</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>

  <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Muy similar a <code>feedback_message</code>. Y también creamos el formulario:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="k">function</span> <span class="nf">feedback_delete_form</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;SELECT fm.message, fm.read, fm.indate, u.name FROM {feedback_messages} fm, {users} u WHERE fm.id=%d and u.uid=fm.uid&#34;</span><span class="p">;</span>
  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>
  <span class="nv">$message</span> <span class="o">=</span> <span class="nx">db_fetch_object</span> <span class="p">(</span> <span class="nv">$queryResult</span> <span class="p">);</span>

  <span class="nv">$form</span> <span class="o">=</span> <span class="k">array</span>
    <span class="p">(</span>
      <span class="s1">&#39;feedback&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span>
      <span class="p">(</span>
        <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;fieldset&#39;</span><span class="p">,</span>
        <span class="s1">&#39;#title&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span> <span class="s1">&#39;Feedback from &#39;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span><span class="s1">&#39; sended on &#39;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">indate</span> <span class="p">),</span>
        <span class="s1">&#39;messageid&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;hidden&#39;</span><span class="p">,</span> <span class="s2">&#34;#default_value&#34;</span> <span class="o">=&gt;</span> <span class="nv">$messageid</span> <span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;textarea&#39;</span><span class="p">,</span> <span class="s2">&#34;#default_value&#34;</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">,</span> <span class="s2">&#34;#disabled&#34;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span> <span class="p">),</span>
        <span class="s1">&#39;read&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span><span class="o">=&gt;</span> <span class="s1">&#39;checkbox&#39;</span><span class="p">,</span> <span class="s2">&#34;#title&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;Read&#34;</span><span class="p">,</span><span class="s2">&#34;#default_value&#34;</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">,</span> <span class="s2">&#34;#disabled&#34;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span> <span class="p">),</span>
        <span class="s1">&#39;submit&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;submit&#39;</span><span class="p">,</span>  <span class="s1">&#39;#value&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Delete forever&#39;</span><span class="p">),</span>  <span class="p">),</span>
      <span class="p">),</span>
    <span class="p">);</span>
    <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_delete_form_submit</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$messageid</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;messageid&#39;</span><span class="p">];</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;DELETE FROM {feedback_messages} where id=%d&#34;</span><span class="p">;</span>
  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">db_affected_rows</span><span class="p">()){</span>
    <span class="nx">drupal_set_message</span> <span class="p">(</span> <span class="nx">t</span> <span class="p">(</span> <span class="s2">&#34;Message deleted&#34;</span> <span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">drupal_goto</span> <span class="p">(</span><span class="s1">&#39;/feedback/adminmessages&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Como véis, me he saltado la validación, ya que no hay nada que validar. El formulario es muy parecido al de <code>feedback_messageadmin_form</code>, pero con la diferencia de que el campo &ldquo;read&rdquo; también es de sólo lectura.</p>
<p>Lo que nos queda es poder llegar a este formulario. Para llegar, dijimos que usaríamos un sistema similar al del botón &ldquo;edit&rdquo;, así que eso mismo vamos a hacer: En la función <code>feedback_admin</code>, el final quedará así:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="k">function</span> <span class="nf">feedback_admin</span><span class="p">(</span> <span class="nv">$messageid</span><span class="o">=</span><span class="k">null</span> <span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;edit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">l</span> <span class="p">(</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">),</span> <span class="s2">&#34;feedback/adminmessages/&#34;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">id</span> <span class="p">);</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;delete&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">l</span> <span class="p">(</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;delete&#39;</span><span class="p">),</span> <span class="s2">&#34;feedback/delete/&#34;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">id</span> <span class="p">);</span>
    <span class="nv">$rows</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">theme_table</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="nv">$rows</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="dos-palabras">Dos palabras</h2>
<p>Últimamente estoy recibiendo muchas consultas sobre cómo hacer tal o cual cosa en drupal. La verdad es que no esperaba tener &ldquo;tanto&rdquo; éxito con los tutoriales&hellip; casi ni explico nada, sólo he desglosado un ejercicio en partes tan pequeñas que no dé miedo atacarlas.</p>
<p>Así que tan sólo puedo deciros una cosa: ¡¡ Muchas gracias !! ;)</p>
<h2 id="más-tutoriales">Más tutoriales</h2>
<p>Este tutorial es la continuación de una serie de tutoriales relacionados con Drupal. Podéis consultar cualquiera de ellos:</p>
<ul>
<li><a href="https://magmax.org/blog/creacion-modulo-drupal/" rel="">Creación de un módulo drupal (I)</a></li>
<li><a href="https://magmax.org/blog/creacion-modulo-drupal-2/" rel="">Creación de un módulo drupal (II)</a></li>
<li><a href="https://magmax.org/blog/creacion-modulo-drupal-4/" rel="">Creación de un módulo drupal (IV)</a></li>
<li><a href="https://magmax.org/blog/drupal-expansors/" rel="">Drupal: Creando contenido con &lsquo;expansors&rsquo;</a></li>
<li><a href="https://magmax.org/blog/critica-drupal/" rel="">Crítica a Drupal</a></li>
<li><a href="https://magmax.org/blog/drupal-tabla-perfecta/" rel="">Tablas en Drupal: Haciendo la tabla perfecta</a></li>
</ul>
<h2 id="código">Código</h2>
<p>Aquí tenéis todo el código necesario:</p>
<h3 id="feedbackinfo">feedback.info</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="p">;</span> <span class="nv">$Id</span><span class="err">$</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;MagMax Feedback&#34;</span>
<span class="nx">description</span> <span class="o">=</span> <span class="s2">&#34;Proporciona un sistema de feedbacks fácil para drupal&#34;</span>
<span class="nx">core</span> <span class="o">=</span> <span class="mf">6.</span><span class="nx">x</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="feedbackinstall">feedback.install</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
<span class="cm">/*
</span><span class="cm">Copyright 2009 Miguel Ángel García Martínez
</span><span class="cm">
</span><span class="cm">  &#39;Feedback&#39; is free software; you can redistribute it and/or modify
</span><span class="cm">it under the terms of the GNU General Public License as published by
</span><span class="cm">the Free Software Foundation; either version 3 of the License, or
</span><span class="cm">(at your option) any later version.
</span><span class="cm">
</span><span class="cm">  &#39;Feedback&#39; is distributed in the hope that it will be useful,
</span><span class="cm">but WITHOUT ANY WARRANTY; without even the implied warranty of
</span><span class="cm">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
</span><span class="cm">GNU General Public License for more details.
</span><span class="cm">
</span><span class="cm">  You should have received a copy of the GNU General Public License
</span><span class="cm">along with &#39;Feedback&#39; (maybe in file &#34;COPYING&#34;); if not, write to the Free Software
</span><span class="cm">Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
</span><span class="cm">*/</span>


<span class="k">function</span> <span class="nf">feedback_schema</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="nv">$schema</span><span class="p">[</span><span class="s1">&#39;feedback_messages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span>
  <span class="p">(</span>
    <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Tabla para mensajes de retroalimentacion&#39;</span><span class="p">),</span>
    <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span>
    <span class="p">(</span>
      <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span>
      <span class="p">(</span>
        <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Identificador de mensaje&#39;</span><span class="p">),</span>
        <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;serial&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unsigned&#39;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
        <span class="s1">&#39;not null&#39;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
      <span class="p">),</span>
      <span class="s1">&#39;uid&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span>
      <span class="p">(</span>
        <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Identificador del usuario que realiza el feedback&#39;</span><span class="p">),</span>
        <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unsigned&#39;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
        <span class="s1">&#39;not null&#39;</span> <span class="o">=&gt;</span> <span class="k">FALSE</span><span class="p">,</span>
      <span class="p">),</span>
      <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span>
      <span class="p">(</span>
        <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Mensaje de feedback&#39;</span><span class="p">),</span>
        <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
        <span class="s1">&#39;not null&#39;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
      <span class="p">),</span>
      <span class="s1">&#39;indate&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span>
      <span class="p">(</span>
        <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Fecha en la que se crea el comentario&#39;</span><span class="p">),</span>
        <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
        <span class="s1">&#39;not null&#39;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
      <span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">&#39;primary key&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
  <span class="p">);</span>
  <span class="k">return</span> <span class="nv">$schema</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_update_6100</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$ret</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="nx">db_add_field</span><span class="p">(</span><span class="nv">$ret</span><span class="p">,</span> <span class="s1">&#39;feedback_messages&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;tiny&#39;</span><span class="p">));</span>
  <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_update_6103</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$ret</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="nx">db_add_field</span> <span class="p">(</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s1">&#39;feedback_messages&#39;</span><span class="p">,</span> <span class="s1">&#39;usermail&#39;</span><span class="p">,</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span> <span class="p">)</span> <span class="p">);</span>
  <span class="nx">db_change_field</span> <span class="p">(</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s1">&#39;feedback_messages&#39;</span><span class="p">,</span> <span class="s1">&#39;uid&#39;</span><span class="p">,</span> <span class="s1">&#39;uid&#39;</span><span class="p">,</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;type&#39;</span><span class="o">=&gt;</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned&#39;</span><span class="o">=&gt;</span><span class="k">TRUE</span> <span class="p">)</span> <span class="p">);</span>
  <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_install</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create my tables.
</span><span class="c1"></span>  <span class="nx">drupal_install_schema</span><span class="p">(</span><span class="s1">&#39;feedback&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_uninstall</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Drop my tables.
</span><span class="c1"></span>  <span class="nx">drupal_uninstall_schema</span><span class="p">(</span><span class="s1">&#39;feedback&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="feedbackmodule">feedback.module</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
<span class="cm">/*
</span><span class="cm">Copyright 2009 Miguel Ángel García Martínez
</span><span class="cm">
</span><span class="cm">  &#39;Feedback&#39; is free software; you can redistribute it and/or modify
</span><span class="cm">it under the terms of the GNU General Public License as published by
</span><span class="cm">the Free Software Foundation; either version 3 of the License, or
</span><span class="cm">(at your option) any later version.
</span><span class="cm">
</span><span class="cm">  &#39;Feedback&#39; is distributed in the hope that it will be useful,
</span><span class="cm">but WITHOUT ANY WARRANTY; without even the implied warranty of
</span><span class="cm">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
</span><span class="cm">GNU General Public License for more details.
</span><span class="cm">
</span><span class="cm">  You should have received a copy of the GNU General Public License
</span><span class="cm">along with &#39;Feedback&#39; (maybe in file &#34;COPYING&#34;); if not, write to the Free Software
</span><span class="cm">Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
</span><span class="cm">*/</span>
<span class="sd">/**
</span><span class="sd">* Implements hook_help().
</span><span class="sd">*/</span>
<span class="k">function</span> <span class="nf">feedback_help</span> <span class="p">(</span> <span class="nv">$path</span><span class="p">,</span> <span class="nv">$arg</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$output</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span> <span class="c1">// para construir la salida
</span><span class="c1"></span>  <span class="k">switch</span> <span class="p">(</span> <span class="nx">path</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;admin/help#feedback&#39;</span><span class="o">:</span>
      <span class="nv">$output</span> <span class="o">.=</span> <span class="s1">&#39;&#39;</span> <span class="o">.</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Módulo que permite la inserción de mensajes de feedback.&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
<span class="p">}</span>

<span class="sd">/**
</span><span class="sd">* Implements hook_perm().
</span><span class="sd">*/</span>
<span class="k">function</span> <span class="nf">feedback_perm</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">array</span> <span class="p">(</span><span class="s1">&#39;send message&#39;</span><span class="p">,</span> <span class="s1">&#39;view messages&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="sd">/**
</span><span class="sd">* Implementation of hook_block().
</span><span class="sd">*/</span>
<span class="k">function</span> <span class="nf">feedback_block</span> <span class="p">(</span> <span class="nv">$op</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="nv">$delta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$edit</span> <span class="o">=</span> <span class="k">array</span><span class="p">()</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nv">$op</span> <span class="o">==</span> <span class="s2">&#34;list&#34;</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="nv">$blocks</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
      <span class="nv">$blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&#34;info&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Feedback&#39;</span><span class="p">);</span>
      <span class="nv">$blocks</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&#34;info&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;New Feedbacks&#39;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nv">$blocks</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nv">$op</span> <span class="o">==</span> <span class="s2">&#34;view&#34;</span> <span class="p">)</span>
  <span class="p">{</span>
      <span class="nv">$content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="nv">$block</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
      <span class="k">switch</span> <span class="p">(</span> <span class="nv">$delta</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
          <span class="nv">$block</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Feedback&#39;</span><span class="p">);</span>

          <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s2">&#34;attributes&#34;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;title&#34;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s2">&#34;Sends a feedback message&#34;</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
          <span class="nv">$link</span> <span class="o">=</span> <span class="nx">l</span><span class="p">(</span> <span class="nx">t</span><span class="p">(</span><span class="s2">&#34;New Feedback&#34;</span><span class="p">),</span> <span class="s2">&#34;feedback/message&#34;</span><span class="p">,</span> <span class="nv">$options</span> <span class="p">);</span>
          <span class="nv">$content</span> <span class="o">.=</span> <span class="s1">&#39;&#39;</span> <span class="o">.</span> <span class="nv">$link</span> <span class="o">.</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
          <span class="nv">$block</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Feedback Messages&#39;</span><span class="p">);</span>

          <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s2">&#34;attributes&#34;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;title&#34;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s2">&#34;Shows feedback messages&#34;</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
          <span class="nv">$title</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s2">&#34;There are @total new feeds&#34;</span><span class="p">,</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;@total&#39;</span> <span class="o">=&gt;</span> <span class="nx">_feedback_count</span><span class="p">()</span> <span class="p">)</span> <span class="p">);</span>
          <span class="nv">$link</span> <span class="o">=</span> <span class="nx">l</span><span class="p">(</span> <span class="nv">$title</span> <span class="p">,</span> <span class="s2">&#34;feedback/adminmessages&#34;</span><span class="p">,</span> <span class="nv">$options</span> <span class="p">);</span>
          <span class="nv">$content</span> <span class="o">.=</span> <span class="s1">&#39;&#39;</span> <span class="o">.</span> <span class="nv">$link</span> <span class="o">.</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nv">$block</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$content</span><span class="p">;</span>
      <span class="k">return</span> <span class="nv">$block</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="sd">/**
</span><span class="sd">* Implementation of hook_menu().
</span><span class="sd">*/</span>
<span class="k">function</span> <span class="nf">feedback_menu</span> <span class="p">(</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$items</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

  <span class="nv">$items</span><span class="p">[</span><span class="s1">&#39;feedback/message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span>
  <span class="p">(</span>
    <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Feedback&#39;</span><span class="p">,</span>
    <span class="s1">&#39;page callback&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;feedback_message&#39;</span><span class="p">,</span>
    <span class="s1">&#39;access arguments&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;send message&#39;</span><span class="p">),</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nx">MENU_CALLBACK</span><span class="p">,</span>
  <span class="p">);</span>

  <span class="nv">$items</span><span class="p">[</span><span class="s1">&#39;feedback/adminmessages/%&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span>
  <span class="p">(</span>
    <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Feedback admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;page callback&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;feedback_admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;page arguments&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="mi">2</span> <span class="p">),</span>
    <span class="s1">&#39;access arguments&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;view messages&#39;</span><span class="p">),</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nx">MENU_CALLBACK</span><span class="p">,</span>
  <span class="p">);</span>
  <span class="nv">$items</span><span class="p">[</span><span class="s1">&#39;feedback/adminmessages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span>
  <span class="p">(</span>
    <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Feedback admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;page callback&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;feedback_admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;access arguments&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;view messages&#39;</span><span class="p">),</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nx">MENU_CALLBACK</span><span class="p">,</span>
  <span class="p">);</span>

  <span class="nv">$items</span><span class="p">[</span><span class="s1">&#39;feedback/delete/%&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span>
  <span class="p">(</span>
    <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Feedback delete&#39;</span><span class="p">,</span>
    <span class="s1">&#39;page callback&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;feedback_delete&#39;</span><span class="p">,</span>
    <span class="s1">&#39;page arguments&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="mi">2</span> <span class="p">),</span>
    <span class="s1">&#39;access arguments&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;view messages&#39;</span><span class="p">),</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nx">MENU_CALLBACK</span><span class="p">,</span>
  <span class="p">);</span>

  <span class="k">return</span> <span class="nv">$items</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_message</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="nv">$content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

  <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">drupal_get_form</span> <span class="p">(</span> <span class="s1">&#39;feedback_message_form&#39;</span> <span class="p">);</span>

  <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_message_form</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="k">global</span> <span class="nv">$user</span><span class="p">;</span>
  <span class="nv">$mail</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">uid</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="nv">$mail</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">mail</span><span class="p">;</span>

  <span class="nv">$form</span> <span class="o">=</span> <span class="k">array</span>
  <span class="p">(</span>
    <span class="s1">&#39;feedback&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span>
    <span class="p">(</span>
      <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;fieldset&#39;</span><span class="p">,</span>
      <span class="s1">&#39;#title&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span> <span class="s1">&#39;Feedback&#39;</span> <span class="p">),</span>
      <span class="s1">&#39;mail&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span><span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;textfield&#39;</span><span class="p">,</span> <span class="s2">&#34;#title&#34;</span><span class="o">=&gt;</span><span class="s2">&#34;E-Mail&#34;</span><span class="p">,</span> <span class="s2">&#34;#description&#34;</span><span class="o">=&gt;</span><span class="s2">&#34;If you want any answer, please, tell me your mail. It would not be shown anywhere.&#34;</span><span class="p">,</span> <span class="s2">&#34;#default_value&#34;</span> <span class="o">=&gt;</span> <span class="nv">$mail</span> <span class="p">),</span>
      <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;textarea&#39;</span><span class="p">,</span> <span class="s2">&#34;#description&#34;</span><span class="o">=&gt;</span><span class="s2">&#34;Write here your message&#34;</span> <span class="p">),</span>
      <span class="s1">&#39;submit&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;submit&#39;</span><span class="p">,</span>  <span class="s1">&#39;#value&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Submit&#39;</span><span class="p">),</span>  <span class="p">),</span>
    <span class="p">),</span>
  <span class="p">);</span>

  <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_message_form_validate</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="k">global</span> <span class="nv">$user</span><span class="p">;</span>

  <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">];</span>
  <span class="nv">$mail</span>    <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;mail&#39;</span><span class="p">];</span>
  <span class="nv">$validmail</span> <span class="o">=</span> <span class="nx">preg_match</span> <span class="p">(</span><span class="s2">&#34;/^[^0-9][A-z0-9_]+([.][A-z0-9_]+)*[@][A-z0-9_]+([.][A-z0-9_]+)*[.][A-z]{2,4}$/&#34;</span> <span class="p">,</span> <span class="nv">$mail</span> <span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nv">$mail</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">uid</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">&#39;mail&#39;</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;You are not a registered user. Please, insert your e-mail.&#39;</span><span class="p">)</span> <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nv">$mail</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nv">$validmail</span> <span class="p">)</span>
    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">&#39;mail&#39;</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;The mail does not like an e-mail address.&#39;</span><span class="p">)</span> <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nv">$message</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span>
    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Message cannot be empty.&#39;</span><span class="p">));</span>

  <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_message_form_submit</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="k">global</span> <span class="nv">$user</span><span class="p">;</span>
  <span class="nv">$userid</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nv">$user</span> <span class="p">)</span>
    <span class="nv">$userid</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">uid</span><span class="p">;</span>
  <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">];</span>
  <span class="nv">$mail</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;mail&#39;</span><span class="p">];</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;INSERT into {feedback_messages} ( uid, message, indate, usermail ) values ( %d, &#39;%s&#39;, now(), &#39;%s&#39; ) &#34;</span><span class="p">;</span>
  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$userid</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$mail</span> <span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nx">db_affected_rows</span><span class="p">()</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">drupal_set_message</span> <span class="p">(</span> <span class="nx">t</span> <span class="p">(</span> <span class="s2">&#34;Thank you for your feedback.&#34;</span> <span class="p">)</span> <span class="p">);</span>
    <span class="nx">drupal_goto</span> <span class="p">(</span> <span class="s1">&#39;node&#39;</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="nx">form_set_error</span> <span class="p">(</span> <span class="s1">&#39;feedback&#39;</span><span class="p">,</span> <span class="nx">t</span><span class="p">(</span> <span class="s2">&#34;An error has happened. Your feedback has not been sent.&#34;</span> <span class="p">)</span> <span class="p">);</span>
<span class="p">}</span>


<span class="k">function</span> <span class="nf">feedback_admin</span> <span class="p">(</span> <span class="nv">$messageid</span><span class="o">=</span><span class="k">null</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nv">$messageid</span> <span class="o">!=</span> <span class="k">null</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">drupal_get_form</span> <span class="p">(</span> <span class="s1">&#39;feedback_messageadmin_form&#39;</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>
    <span class="nv">$content</span> <span class="o">.=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$header</span> <span class="o">=</span> <span class="k">array</span>
  <span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">),</span> <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;indate&#39;</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;desc&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">),</span> <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;name&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">),</span> <span class="s1">&#39;field&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;mail&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Message&#39;</span><span class="p">),</span> <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;message&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Read&#39;</span><span class="p">),</span> <span class="s1">&#39;field&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;fm.read&#39;</span><span class="p">),</span>
  <span class="p">);</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;SELECT fm.id, u.uid as uid, u.name, fm.usermail, fm.indate, fm.message, fm.read FROM {feedback_messages} fm, {users} u WHERE fm.uid=u.uid&#34;</span><span class="p">;</span>
  <span class="nv">$query</span> <span class="o">.=</span> <span class="nx">tablesort_sql</span> <span class="p">(</span> <span class="nv">$header</span> <span class="p">);</span>
  <span class="nv">$queryResult</span> <span class="o">=</span>  <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span> <span class="p">);</span>

  <span class="nv">$rows</span> <span class="o">=</span> <span class="k">array</span> <span class="p">();</span>
  <span class="k">while</span> <span class="p">(</span> <span class="nv">$message</span> <span class="o">=</span> <span class="nx">db_fetch_object</span> <span class="p">(</span> <span class="nv">$queryResult</span> <span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$row</span> <span class="o">=</span> <span class="k">array</span> <span class="p">();</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;indate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">indate</span><span class="p">;</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">uid</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;mail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">usermail</span><span class="p">;</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">;</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;read&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">;</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;edit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">l</span> <span class="p">(</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">),</span> <span class="s2">&#34;feedback/adminmessages/&#34;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">id</span> <span class="p">);</span>
    <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;delete&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">l</span> <span class="p">(</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;delete&#39;</span><span class="p">),</span> <span class="s2">&#34;feedback/delete/&#34;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">id</span> <span class="p">);</span>
    <span class="nv">$rows</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">theme_table</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="nv">$rows</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
<span class="p">}</span>

<span class="sd">/** Devuelve el número de feeds creados en la última semana
</span><span class="sd">*/</span>
<span class="k">function</span> <span class="nf">_feedback_count</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;SELECT count(id) as total from {feedback_messages} fm where fm.read != 1 or isnull(fm.read)&#34;</span><span class="p">;</span>
  <span class="nv">$queryResult</span> <span class="o">=</span>  <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span> <span class="p">);</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nx">db_fetch_object</span> <span class="p">(</span> <span class="nv">$queryResult</span> <span class="p">)</span> <span class="p">;</span>

  <span class="k">return</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">total</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_messageadmin_form</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;SELECT fm.message, fm.read, fm.indate, u.name FROM {feedback_messages} fm, {users} u WHERE fm.id=%d and u.uid=fm.uid&#34;</span><span class="p">;</span>
  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>
  <span class="nv">$message</span> <span class="o">=</span> <span class="nx">db_fetch_object</span> <span class="p">(</span> <span class="nv">$queryResult</span> <span class="p">);</span>

  <span class="nv">$form</span> <span class="o">=</span> <span class="k">array</span>
    <span class="p">(</span>
      <span class="s1">&#39;feedback&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span>
      <span class="p">(</span>
        <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;fieldset&#39;</span><span class="p">,</span>
        <span class="s1">&#39;#title&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span> <span class="s1">&#39;Feedback from &#39;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span><span class="s1">&#39; sended on &#39;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">indate</span> <span class="p">),</span>
        <span class="s1">&#39;messageid&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;hidden&#39;</span><span class="p">,</span> <span class="s2">&#34;#default_value&#34;</span> <span class="o">=&gt;</span> <span class="nv">$messageid</span> <span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;textarea&#39;</span><span class="p">,</span> <span class="s2">&#34;#default_value&#34;</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">,</span> <span class="s2">&#34;#disabled&#34;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span> <span class="p">),</span>
        <span class="s1">&#39;read&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span><span class="o">=&gt;</span> <span class="s1">&#39;checkbox&#39;</span><span class="p">,</span> <span class="s2">&#34;#title&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;Read&#34;</span><span class="p">,</span><span class="s2">&#34;#default_value&#34;</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">read</span> <span class="p">),</span>
        <span class="s1">&#39;submit&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;submit&#39;</span><span class="p">,</span>  <span class="s1">&#39;#value&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Submit&#39;</span><span class="p">),</span>  <span class="p">),</span>
      <span class="p">),</span>
    <span class="p">);</span>
    <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_messageadmin_form_submit</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$messageid</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;messageid&#39;</span><span class="p">];</span>
  <span class="nv">$read</span>      <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;read&#39;</span><span class="p">];</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;UPDATE {feedback_messages} fm set fm.read=%d where fm.id=%d&#34;</span><span class="p">;</span>
  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$read</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>

  <span class="nx">drupal_goto</span> <span class="p">(</span><span class="s1">&#39;/feedback/adminmessages&#39;</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">function</span> <span class="nf">feedback_delete</span> <span class="p">(</span> <span class="nv">$messageid</span><span class="o">=</span><span class="k">null</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">drupal_get_form</span> <span class="p">(</span> <span class="s1">&#39;feedback_delete_form&#39;</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>

  <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_delete_form</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;SELECT fm.message, fm.read, fm.indate, u.name FROM {feedback_messages} fm, {users} u WHERE fm.id=%d and u.uid=fm.uid&#34;</span><span class="p">;</span>
  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>
  <span class="nv">$message</span> <span class="o">=</span> <span class="nx">db_fetch_object</span> <span class="p">(</span> <span class="nv">$queryResult</span> <span class="p">);</span>

  <span class="nv">$form</span> <span class="o">=</span> <span class="k">array</span>
    <span class="p">(</span>
      <span class="s1">&#39;feedback&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span>
      <span class="p">(</span>
        <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;fieldset&#39;</span><span class="p">,</span>
        <span class="s1">&#39;#title&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span> <span class="s1">&#39;Feedback from &#39;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span><span class="s1">&#39; sended on &#39;</span> <span class="o">.</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">indate</span> <span class="p">),</span>
        <span class="s1">&#39;messageid&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;hidden&#39;</span><span class="p">,</span> <span class="s2">&#34;#default_value&#34;</span> <span class="o">=&gt;</span> <span class="nv">$messageid</span> <span class="p">),</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;textarea&#39;</span><span class="p">,</span> <span class="s2">&#34;#default_value&#34;</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">,</span> <span class="s2">&#34;#disabled&#34;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span> <span class="p">),</span>
        <span class="s1">&#39;read&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span><span class="o">=&gt;</span> <span class="s1">&#39;checkbox&#39;</span><span class="p">,</span> <span class="s2">&#34;#title&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;Read&#34;</span><span class="p">,</span><span class="s2">&#34;#default_value&#34;</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">,</span> <span class="s2">&#34;#disabled&#34;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span> <span class="p">),</span>
        <span class="s1">&#39;submit&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span> <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;submit&#39;</span><span class="p">,</span>  <span class="s1">&#39;#value&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Delete forever&#39;</span><span class="p">),</span>  <span class="p">),</span>
      <span class="p">),</span>
    <span class="p">);</span>
    <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">feedback_delete_form_submit</span> <span class="p">(</span> <span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$messageid</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="s1">&#39;messageid&#39;</span><span class="p">];</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&#34;DELETE FROM {feedback_messages} where id=%d&#34;</span><span class="p">;</span>
  <span class="nv">$queryResult</span> <span class="o">=</span> <span class="nx">db_query</span> <span class="p">(</span> <span class="nv">$query</span><span class="p">,</span> <span class="nv">$messageid</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">db_affected_rows</span><span class="p">()){</span>
    <span class="nx">drupal_set_message</span> <span class="p">(</span> <span class="nx">t</span> <span class="p">(</span> <span class="s2">&#34;Message deleted&#34;</span> <span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">drupal_goto</span> <span class="p">(</span><span class="s1">&#39;/feedback/adminmessages&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Actualizado el 28 Jan 2021</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartir en Twitter" data-sharer="twitter" data-url="https://magmax.org/blog/creacion-modulo-drupal-3/" data-title="Creación de un módulo Drupal III" data-hashtags="drupal"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Facebook" data-sharer="facebook" data-url="https://magmax.org/blog/creacion-modulo-drupal-3/" data-hashtag="drupal"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Linkedin" data-sharer="linkedin" data-url="https://magmax.org/blog/creacion-modulo-drupal-3/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en WhatsApp" data-sharer="whatsapp" data-url="https://magmax.org/blog/creacion-modulo-drupal-3/" data-title="Creación de un módulo Drupal III" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Tumblr" data-sharer="tumblr" data-url="https://magmax.org/blog/creacion-modulo-drupal-3/" data-title="Creación de un módulo Drupal III" data-tags="drupal"><i class="fab fa-tumblr fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Reddit" data-sharer="reddit" data-url="https://magmax.org/blog/creacion-modulo-drupal-3/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Instapaper" data-sharer="instapaper" data-url="https://magmax.org/blog/creacion-modulo-drupal-3/" data-title="Creación de un módulo Drupal III" data-description=""><i data-svg-src="/lib/simple-icons/icons/instapaper.min.svg"></i></a><a href="javascript:void(0);" title="Compartir en Digg" data-sharer="digg" data-url="https://magmax.org/blog/creacion-modulo-drupal-3/"><i class="fab fa-digg fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Blogger" data-sharer="blogger" data-url="https://magmax.org/blog/creacion-modulo-drupal-3/" data-title="Creación de un módulo Drupal III" data-description=""><i class="fab fa-blogger fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/drupal/">drupal</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Regresar</a></span>&nbsp;|&nbsp;<span><a href="/">Inicio</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/creacion-modulo-drupal-4/" class="prev" rel="prev" title="Creación de un módulo Drupal IV"><i class="fas fa-angle-left fa-fw"></i>Creación de un módulo Drupal IV</a>
            <a href="/blog/creacion-modulo-drupal-2/" class="next" rel="next" title="Creación de un módulo Drupal II">Creación de un módulo Drupal II<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Provisto por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.79.1">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Miguel Ángel</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Volver arriba">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentarios">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copiar al portapapeles","maxShownLines":10},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
