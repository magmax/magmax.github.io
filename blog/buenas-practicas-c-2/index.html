<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Buenas prácticas en Ansi C (2) - El blog de MagMax</title><meta name="Description" content="El blog de un Ingeniero Informático: tutoriales, manuales, opiniones, comparativas, ..."><meta property="og:title" content="Buenas prácticas en Ansi C (2)" />
<meta property="og:description" content="Tras comentar las buenas prácticas más básicas en Ansi C, veamos ahora las buenas prácticas cuando estamos haciendo una librería, ya sea estática o dinámica.
En concreto, me centraré en la librería estática y luego pasaré a dar algunas pautas para las dinámicas.
  Encapsulación El objetivo de lo que voy a exponer consiste en aislar en la medida de lo posible nuestra librería con el fin de que sea lo más reutilizable posible." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/buenas-practicas-c-2/" />
<meta property="og:image" content="https://magmax.org/icons/favicon.png"/>
<meta property="article:published_time" content="2011-06-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-28T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://magmax.org/icons/favicon.png"/>

<meta name="twitter:title" content="Buenas prácticas en Ansi C (2)"/>
<meta name="twitter:description" content="Tras comentar las buenas prácticas más básicas en Ansi C, veamos ahora las buenas prácticas cuando estamos haciendo una librería, ya sea estática o dinámica.
En concreto, me centraré en la librería estática y luego pasaré a dar algunas pautas para las dinámicas.
  Encapsulación El objetivo de lo que voy a exponer consiste en aislar en la medida de lo posible nuestra librería con el fin de que sea lo más reutilizable posible."/>
<meta name="application-name" content="El blog de MagMax">
<meta name="apple-mobile-web-app-title" content="El blog de MagMax"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://magmax.org/blog/buenas-practicas-c-2/" /><link rel="prev" href="https://magmax.org/blog/hsqldb-dbunit/" /><link rel="next" href="https://magmax.org/blog/buenas-practicas-c-1/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Buenas prácticas en Ansi C (2)",
        "inLanguage": "es",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/magmax.org\/blog\/buenas-practicas-c-2\/"
        },"genre": "posts","keywords": "ansi c","wordcount":  1477 ,
        "url": "https:\/\/magmax.org\/blog\/buenas-practicas-c-2\/","datePublished": "2011-06-18T00:00:00+00:00","dateModified": "2021-01-28T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "Miguel Ángel"},"author": {
                "@type": "Person",
                "name": "Miguel Ángel"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Inicio </a><a class="menu-item" href="/tags"> Tags </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/blog/buenas-practicas-c-2/" selected>Español</option></select>
                    </a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="El blog de MagMax"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/icons/favicon.png"
        data-srcset="/icons/favicon.png, /icons/favicon.png 1.5x, /icons/favicon.png 2x"
        data-sizes="auto"
        alt="/icons/favicon.png"
        title="/icons/favicon.png" />MagMax Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">Inicio</a><a class="menu-item" href="/tags" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Selecciona el lenguage">Español<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/blog/buenas-practicas-c-2/" selected>Español</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contenido</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Buenas prácticas en Ansi C (2)</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Miguel Ángel</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="18 Jun 2011">18 Jun 2011</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1477 palabras&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;7 minutos&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contenido</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#encapsulación">Encapsulación</a></li>
    <li><a href="#macros">Macros</a></li>
    <li><a href="#enumerados">Enumerados</a></li>
    <li><a href="#sólo-lo-indispensable">Sólo lo indispensable</a></li>
    <li><a href="#estructuras">Estructuras</a></li>
    <li><a href="#getters-y-setters">Getters y setters</a></li>
    <li><a href="#orientación-a-objetostads">Orientación a objetos/TADs</a></li>
    <li><a href="#creciendo">Creciendo</a></li>
    <li><a href="#librerías-dinámicas">Librerías dinámicas</a></li>
    <li><a href="#fachadas">Fachadas</a>
      <ul>
        <li><a href="#dll">DLL</a></li>
        <li><a href="#lib">Lib</a></li>
      </ul>
    </li>
    <li><a href="#olvidos-descuidos-etc">Olvidos, descuidos, etc.</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Tras comentar las <a href="https://magmax.org/blog/buenas-practicas-c-1/" rel="">buenas prácticas más básicas en Ansi C</a>, veamos ahora las buenas prácticas cuando estamos haciendo una librería, ya sea estática o dinámica.</p>
<p>En concreto, me centraré en la librería estática y luego pasaré a dar algunas pautas para las dinámicas.</p>
<!-- raw HTML omitted -->
<figure>
    <img src="/images/ansic.jpg"
         alt="Ansi C"/> 
</figure>

<h2 id="encapsulación">Encapsulación</h2>
<p>El objetivo de lo que voy a exponer consiste en aislar en la medida de lo posible nuestra librería con el fin de que sea lo más reutilizable posible.</p>
<p>Veremos cómo proteger a nuestra librería del mal programador, así como al mal programador de nuestra librería :D</p>
<p>Hay que diferenciar aquí dos tipos de archivos de cabecera: los internos, utilizados por nuestros archivos <code>.c</code>, y los externos, que será la forma que tengan otros programas de utilizar nuestra librería.</p>
<h2 id="macros">Macros</h2>
<p>Quedan completamente prohibidas las macros en los archivos de cabecera externos.</p>
<p>Hay distintas razones para esto: no forman parte como tales de nuestra librería, no son fácilmente mantenibles, y son más difíciles de depurar.</p>
<h2 id="enumerados">Enumerados</h2>
<p>No es buena idea utilizar enumerados en los archivos de cabecera externos. Sinceramente, me gustaría decir lo contrario, pero dependiendo de las opciones de compilación podemos conseguir verdaderos poltergeist por culpa de los enumerados.</p>
<p>Por lo tanto, para las constantes es mejor utilizar <code>#define</code>.</p>
<p>En los internos dará igual, porque para cuando lleguen al usuario de nuestra librería ya están compilados.</p>
<h2 id="sólo-lo-indispensable">Sólo lo indispensable</h2>
<p>En los archivos de cabecera externos se pondrá exclusivamente lo indispensable:</p>
<ul>
<li>Cuanta más funcionalidad exportemos, más tendremos que mantener.</li>
<li>Cuanto más complejo sea, más preguntas recibiremos.</li>
<li>Cuanto más sencillo sea, más feliz el usuario de la libreria.</li>
</ul>
<h2 id="estructuras">Estructuras</h2>
<p>Nunca deis la oportunidad al programador de poder acceder a una estructura de vuestra librería.</p>
<p>Para ello yo suelo utilizar la siguiente técnica: en las cabeceras externas no hay ninguna estructura, pero sí punteros a void; en las funciones que exporto, lo primero que hago es transformar los punteros a void a estructuras internas (que pueden estar en archivos de cabecera internos).</p>
<p>Veamos un ejemplo.</p>
<p>Archivo <code>ejemplo.h</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// archivo de cabecera externo &#34;ejemplo.h&#34;
</span><span class="c1"></span>
<span class="k">typedef</span> <span class="n">ejemplo_t</span> <span class="kt">void</span><span class="p">;</span>

<span class="n">ejemplo_t</span><span class="o">*</span> <span class="nf">ejemplo_new</span> <span class="p">();</span>
<span class="kt">void</span>       <span class="nf">ejemplo_destroy</span><span class="p">(</span><span class="n">ejemplo_t</span><span class="o">*</span> <span class="n">t</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Archivo <code>ejemplo.c</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&#34;ejemplo.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
  <span class="kt">char</span><span class="o">*</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ejemplo_tp</span><span class="p">;</span>

<span class="n">ejemplo_t</span><span class="o">*</span> <span class="nf">ejemplo_new</span> <span class="p">()</span> <span class="p">{</span>
  <span class="n">ejemplo_tp</span><span class="o">*</span> <span class="n">result</span><span class="p">;</span>

  <span class="n">result</span> <span class="o">=</span> <span class="n">calloc</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ejemplo_tp</span><span class="p">));</span>
  <span class="c1">// inicializar result
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ejemplo_destroy</span><span class="p">(</span><span class="n">ejemplo_t</span><span class="o">*</span> <span class="n">vejemplo</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ejemplo_tp</span><span class="o">*</span> <span class="n">ejemplo</span> <span class="o">=</span> <span class="p">(</span><span class="n">ejemplo_tp</span><span class="o">*</span><span class="p">)</span> <span class="n">vejemplo</span><span class="p">;</span>

  <span class="c1">// liberar variables internas de &#34;ejemplo&#34;
</span><span class="c1"></span>  <span class="n">free</span> <span class="p">(</span><span class="n">ejemplo</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Aquí hay algunas convenciones de nombrado que yo suelo utilizar, aunque seguro que podéis encontrar otras mejores.</p>
<p>Lo primero, es decir que el <code>_t</code> de la estructura me hace referencia a &ldquo;tipo&rdquo;, con el fin de diferenciar lo que es un tipo de lo que es una variable. Se me hace muy raro ver cosas como:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="n">ejemplo</span> <span class="n">data</span><span class="p">;</span> <span class="c1">// raro. Además, ¿cómo llamas a la variable?
</span><span class="c1"></span><span class="n">ejemplo_t</span> <span class="n">ejemplo</span><span class="p">;</span> <span class="c1">// se diferencia claramente el tipo de la variable.
</span><span class="c1"></span><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">ejemplo</span><span class="p">)(</span><span class="n">data</span><span class="p">);</span> <span class="c1">// ¿Estamos multiplicando variables o haciendo un cast?
</span></code></pre></td></tr></table>
</div>
</div><p>Después vemos un <code>_tp</code> que yo utilizo para nombrar mis <em>tipos privados</em>, para diferenciarlos de los que estarán en las cabeceras externas.</p>
<p>Para terminar, en mis métodos suelo llamar a las variables de los tipos públicos con una uve (<code>v</code>) delante, con el fin de avisarme que ése es el <code>void</code>.</p>
<h2 id="getters-y-setters">Getters y setters</h2>
<p>Como no dejamos al usuario acceder a nuestra estructura a mano, no podrá realizar modificaciones sobre las variables. Por lo tanto, será necesario utilizar getters y setters para este fin.</p>
<p>Y una vez dicho eso&hellip; No debería ser lo habitual utilizar estos getters y setters, ya que la librería no debe ser un almacén de datos, sino una unidad de proceso. Es decir: lo normal no debe ser modificar valores desde fuera, sino desde dentro, como resultado de operaciones. Es evidente que, aun así, siempre necesitaremos algún getter y setter, aunque trataremos de evitarlos.</p>
<p>Es bastante común tener que enviar mucha información de configuración. Ésta puede encapsularse en una estructura pública y recibirla en el constructor.</p>
<h2 id="orientación-a-objetostads">Orientación a objetos/TADs</h2>
<p>En C no tenemos Orientación a objetos, pero sí tenemos TADs (Tipos Abstractos de Datos). Toda librería debería ser un TAD.</p>
<p>Por esta razón, será normal encontrar en nuestras librerías un <em>constructor</em> y un <em>destructor</em>. Antes ya puse un ejemplo de esto.</p>
<p>Si dejamos al usuario acceder a nuestras variables, tarde o temprano tendremos un alto acoplamiento.</p>
<h2 id="creciendo">Creciendo</h2>
<p>Si necesitamos ampliar nuestras estructuras públicas, siempre deberían hacerlo por debajo. De esta manera se seguirá manteniendo compatibilidad hacia atrás.</p>
<p>A menudo suele ser buena idea utilizar un número de versión o el tamaño de la estructura en uno de sus propios campos, con el fin de determinar que estamos utilizando ésa versión. El problema de estas aproximaciones es que dependemos del buen uso que le dé el programador.</p>
<p>Una solución mejor es transformar esa estructura pública en un nuevo TAD que ya manejaremos nosotros, evitando cualquier tipo de imprudencia o descuido.</p>
<p>De todas maneras&hellip; ¡¡ya dije que no usárais estructuras públicas!! :P</p>
<h2 id="librerías-dinámicas">Librerías dinámicas</h2>
<p>Es importante que nuestra librería dinámica mantenga en su archivo de cabecera público tipos de datos con forma de puntero a función para facilitar la vida a quien vaya a usarla, ya que no se puede acceder directamente a las funciones, pero siempre habrá que cargarlas.</p>
<p>En el ejemplo anterior:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// archivo de cabecera externo &#34;ejemplodll.h&#34;
</span><span class="c1"></span>
<span class="k">typedef</span> <span class="n">ejemplo_t</span> <span class="kt">void</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">ejemplo_t</span><span class="o">*</span> <span class="p">(</span><span class="o">*</span> <span class="n">PF_ejemplo_new</span><span class="p">)</span> <span class="p">();</span>
<span class="k">typedef</span> <span class="nf">void</span>       <span class="p">(</span><span class="o">*</span> <span class="n">PF_ejemplo_destroy</span><span class="p">)</span> <span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="fachadas">Fachadas</h2>
<p>La creación de una librería dinámica es una invitación a la duplicación de código. Todos los programas que quieran utilizarla tendrán que cargar la librería, cargar sus funciones en variables/estructuras internas, realizar casts complejos, gestionar errores, etc.</p>
<p>Por lo tanto, es buena idea proporcionar una librería estática cuya función
consista en acceder a la librería dinámica. Es el resultado de aplicar el
<a href="https://en.wikipedia.org/wiki/Facade_pattern" target="_blank" rel="noopener noreffer">patrón fachada</a> o <em>facade</em>.</p>
<p>Esto facilitará mucho la vida al usuario. Veamos un ejemplo (continuando con el ejemplo de más arriba, que amplío un poco):</p>
<h3 id="dll">DLL</h3>
<p>Archivo <code>ejemplo.h</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// archivo de cabecera externo &#34;ejemplo.h&#34;
</span><span class="c1"></span>
<span class="k">typedef</span> <span class="n">ejemplo_t</span> <span class="kt">void</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">ejemplo_t</span><span class="o">*</span> <span class="p">(</span><span class="o">*</span> <span class="n">PF_ejemplo_new</span><span class="p">)</span> <span class="p">();</span>
<span class="k">typedef</span> <span class="nf">void</span>       <span class="p">(</span><span class="o">*</span> <span class="n">PF_ejemplo_destroy</span><span class="p">)</span> <span class="p">();</span>

<span class="k">typedef</span> <span class="nf">void</span>       <span class="p">(</span><span class="o">*</span> <span class="n">PF_ejemplo_operacion1</span><span class="p">)</span> <span class="p">(</span><span class="n">ejemplo_t</span><span class="o">*</span> <span class="n">t</span><span class="p">);</span>
<span class="k">typedef</span> <span class="nf">void</span>       <span class="p">(</span><span class="o">*</span> <span class="n">PF_ejemplo_operacion2</span><span class="p">)</span> <span class="p">(</span><span class="n">ejemplo_t</span><span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Archivo <code>ejemplo.c</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&#34;ejemplo.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
  <span class="kt">char</span><span class="o">*</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ejemplo_tp</span><span class="p">;</span>

<span class="n">ejemplo_t</span><span class="o">*</span> <span class="nf">ejemplo_new</span> <span class="p">()</span> <span class="p">{</span>
  <span class="n">ejemplo_tp</span><span class="o">*</span> <span class="n">result</span><span class="p">;</span>

  <span class="n">result</span> <span class="o">=</span> <span class="n">calloc</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ejemplo_tp</span><span class="p">));</span>
  <span class="c1">// inicializar result
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ejemplo_destroy</span><span class="p">(</span><span class="n">ejemplo_t</span><span class="o">*</span> <span class="n">vejemplo</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ejemplo_tp</span><span class="o">*</span> <span class="n">ejemplo</span> <span class="o">=</span> <span class="p">(</span><span class="n">ejemplo_tp</span><span class="o">*</span><span class="p">)</span> <span class="n">vejemplo</span><span class="p">;</span>

  <span class="c1">// liberar variables internas de &#34;ejemplo&#34;
</span><span class="c1"></span>  <span class="n">free</span> <span class="p">(</span><span class="n">ejemplo</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ejemplo_operacion1</span><span class="p">(</span><span class="n">ejemplo_t</span><span class="o">*</span> <span class="n">vejemplo</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ejemplo_tp</span><span class="o">*</span> <span class="n">ejemplo</span> <span class="o">=</span> <span class="p">(</span><span class="n">ejemplo_tp</span><span class="o">*</span><span class="p">)</span> <span class="n">vejemplo</span><span class="p">;</span>

  <span class="c1">// operar
</span><span class="c1"></span><span class="p">}</span>

<span class="kt">void</span> <span class="nf">ejemplo_operacion2</span><span class="p">(</span><span class="n">ejemplo_t</span><span class="o">*</span> <span class="n">vejemplo</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ejemplo_tp</span><span class="o">*</span> <span class="n">ejemplo</span> <span class="o">=</span> <span class="p">(</span><span class="n">ejemplo_tp</span><span class="o">*</span><span class="p">)</span> <span class="n">vejemplo</span><span class="p">;</span>

  <span class="c1">// operar
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="lib">Lib</h3>
<p>Archivo <code>lejemplo.h</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// archivo de cabecera &#34;lejemplo.h&#34;
</span><span class="c1"></span><span class="k">typedef</span>    <span class="n">lejemplo_t</span> <span class="kt">void</span><span class="p">;</span>

<span class="n">ejemplo_t</span><span class="o">*</span> <span class="nf">lejemplo_new</span> <span class="p">();</span>
<span class="kt">void</span>       <span class="nf">ljemplo_destroy</span><span class="p">(</span><span class="n">lejemplo_t</span><span class="o">*</span> <span class="n">t</span><span class="p">);</span>

<span class="kt">void</span>       <span class="nf">lejemplo_operacion1</span> <span class="p">(</span><span class="n">lejemplo_t</span><span class="o">*</span> <span class="n">t</span><span class="p">);</span>
<span class="kt">void</span>       <span class="nf">lejemplo_operacion2</span> <span class="p">(</span><span class="n">lejemplo_t</span><span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Archivo <code>lejemplo.c</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// archivo de implementación, &#34;lejemplo.c&#34;
</span><span class="c1"></span><span class="cp">#import &#34;ejemplo.h&#34;
</span><span class="cp">#import &#34;lejemplo.h&#34;
</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">PF_ejemplo_new</span> <span class="n">new</span><span class="p">;</span>
  <span class="n">PF_ejemplo_destroy</span> <span class="n">destroy</span><span class="p">;</span>
  <span class="n">PF_ejemplo_operacion1</span> <span class="n">operacion1</span><span class="p">;</span>
  <span class="n">PF_ejemplo_operacion2</span> <span class="n">operacion2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">functions_tp</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">void</span><span class="o">*</span> <span class="n">dllhandle</span><span class="p">;</span>
  <span class="n">ejemplo_t</span><span class="o">*</span> <span class="n">internal</span><span class="p">;</span>
  <span class="n">functions_tp</span> <span class="n">functions</span><span class="p">;</span>
<span class="p">}</span> <span class="n">lejemplo_tp</span><span class="p">;</span>

<span class="n">ejemplo_t</span><span class="o">*</span> <span class="nf">lejemplo_new</span> <span class="p">()</span> <span class="p">{</span>
  <span class="n">ejemplo_tp</span><span class="o">*</span> <span class="n">result</span> <span class="o">=</span> <span class="n">calloc</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">lejemplo_tp</span><span class="p">));</span>


  <span class="n">result</span><span class="o">-&gt;</span><span class="n">dllhandle</span> <span class="o">=</span> <span class="n">dlopen</span> <span class="p">(</span><span class="s">&#34;ejemplo.so&#34;</span><span class="p">,</span> <span class="n">RT_LAZY</span><span class="p">);</span>
  <span class="n">result</span><span class="o">-&gt;</span><span class="n">functions</span><span class="p">.</span><span class="n">new</span> <span class="o">=</span> <span class="p">(</span><span class="n">PF_ejemplo_new</span><span class="p">)</span> <span class="n">dlsym</span> <span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">dllhandle</span><span class="p">,</span> <span class="s">&#34;ejemplo_new&#34;</span><span class="p">);</span>
  <span class="n">result</span><span class="o">-&gt;</span><span class="n">functions</span><span class="p">.</span><span class="n">destroy</span> <span class="o">=</span> <span class="p">(</span><span class="n">PF_ejemplo_destroy</span><span class="p">)</span> <span class="n">dlsym</span> <span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">dllhandle</span><span class="p">,</span> <span class="s">&#34;ejemplo_destroy&#34;</span><span class="p">);</span>
  <span class="n">result</span><span class="o">-&gt;</span><span class="n">functions</span><span class="p">.</span><span class="n">operacion1</span> <span class="o">=</span> <span class="p">(</span><span class="n">PF_ejemplo_operacion1</span><span class="p">)</span> <span class="n">dlsym</span> <span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">dllhandle</span><span class="p">,</span> <span class="s">&#34;ejemplo_operacion1&#34;</span><span class="p">);</span>
  <span class="n">result</span><span class="o">-&gt;</span><span class="n">functions</span><span class="p">.</span><span class="n">operacion2</span> <span class="o">=</span> <span class="p">(</span><span class="n">PF_ejemplo_operacion2</span><span class="p">)</span> <span class="n">dlsym</span> <span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">dllhandle</span><span class="p">,</span> <span class="s">&#34;ejemplo_operacion2&#34;</span><span class="p">);</span>

  <span class="n">result</span><span class="o">-&gt;</span><span class="n">internal</span> <span class="o">=</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">funcitons</span><span class="p">.</span><span class="n">new</span> <span class="p">();</span>

  <span class="c1">// añadir control de errores allá donde haga falta
</span><span class="c1"></span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">lejemplo_destroy</span><span class="p">(</span><span class="n">lejemplo_t</span><span class="o">*</span> <span class="n">vejemplo</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">lejemplo_tp</span><span class="o">*</span> <span class="n">ejemplo</span> <span class="o">=</span> <span class="p">(</span><span class="n">lejemplo_tp</span><span class="o">*</span><span class="p">)</span> <span class="n">vejemplo</span><span class="p">;</span>

  <span class="n">ejemplo</span><span class="o">-&gt;</span><span class="n">functions</span><span class="p">.</span><span class="n">destroy</span><span class="p">(</span><span class="n">ejemplo</span><span class="o">-&gt;</span><span class="n">internal</span><span class="p">);</span>
  <span class="n">dlclose</span> <span class="p">(</span><span class="n">ejemplo</span><span class="o">-&gt;</span><span class="n">dllhandle</span><span class="p">);</span>
  <span class="n">free</span> <span class="p">(</span><span class="n">ejemplo</span><span class="p">);</span>
  <span class="c1">// Añadir comprobaciones de nulos y demás.
</span><span class="c1"></span><span class="p">}</span>

<span class="kt">void</span> <span class="nf">lejemplo_operacion1</span> <span class="p">(</span><span class="n">lejemplo_t</span><span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">lejemplo_tp</span><span class="o">*</span> <span class="n">ejemplo</span> <span class="o">=</span> <span class="p">(</span><span class="n">lejemplo_tp</span><span class="o">*</span><span class="p">)</span> <span class="n">vejemplo</span><span class="p">;</span>

  <span class="n">ejemplo</span><span class="o">-&gt;</span><span class="n">functions</span><span class="p">.</span><span class="n">operacion1</span> <span class="p">(</span><span class="n">ejemplo</span><span class="o">-&gt;</span><span class="n">internal</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">lejemplo_operacion2</span> <span class="p">(</span><span class="n">lejemplo_t</span><span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">lejemplo_tp</span><span class="o">*</span> <span class="n">ejemplo</span> <span class="o">=</span> <span class="p">(</span><span class="n">lejemplo_tp</span><span class="o">*</span><span class="p">)</span> <span class="n">vejemplo</span><span class="p">;</span>

  <span class="n">ejemplo</span><span class="o">-&gt;</span><span class="n">functions</span><span class="p">.</span><span class="n">operacion2</span> <span class="p">(</span><span class="n">ejemplo</span><span class="o">-&gt;</span><span class="n">internal</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Se podría hacer hasta una carga &ldquo;<em>lazy</em>&rdquo;, esperando a cargar las funciones en el momento de su utilización, pero eso puede implicar una gestión de errores más compleja (con lo indicado, la gestión de errores está centralizada al inicializar).</p>
<p>Utilizando esta librería, al usuario se le quitan muchos dolores de cabeza, ya que tendría que realizar eso mismo de todas maneras.</p>
<h2 id="olvidos-descuidos-etc">Olvidos, descuidos, etc.</h2>
<p>Seguramente he olvidado comentar muchísimas cosas, pero creo que ya me he extendido lo suficiente.</p>
<p>Se aceptan sugerencias para completar todos estos consejos.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Actualizado el 28 Jan 2021</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartir en Twitter" data-sharer="twitter" data-url="https://magmax.org/blog/buenas-practicas-c-2/" data-title="Buenas prácticas en Ansi C (2)" data-hashtags="ansi c"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Facebook" data-sharer="facebook" data-url="https://magmax.org/blog/buenas-practicas-c-2/" data-hashtag="ansi c"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Linkedin" data-sharer="linkedin" data-url="https://magmax.org/blog/buenas-practicas-c-2/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en WhatsApp" data-sharer="whatsapp" data-url="https://magmax.org/blog/buenas-practicas-c-2/" data-title="Buenas prácticas en Ansi C (2)" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Tumblr" data-sharer="tumblr" data-url="https://magmax.org/blog/buenas-practicas-c-2/" data-title="Buenas prácticas en Ansi C (2)" data-tags="ansi c"><i class="fab fa-tumblr fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Reddit" data-sharer="reddit" data-url="https://magmax.org/blog/buenas-practicas-c-2/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Instapaper" data-sharer="instapaper" data-url="https://magmax.org/blog/buenas-practicas-c-2/" data-title="Buenas prácticas en Ansi C (2)" data-description=""><i data-svg-src="/lib/simple-icons/icons/instapaper.min.svg"></i></a><a href="javascript:void(0);" title="Compartir en Digg" data-sharer="digg" data-url="https://magmax.org/blog/buenas-practicas-c-2/"><i class="fab fa-digg fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Blogger" data-sharer="blogger" data-url="https://magmax.org/blog/buenas-practicas-c-2/" data-title="Buenas prácticas en Ansi C (2)" data-description=""><i class="fab fa-blogger fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/ansi-c/">ansi c</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Regresar</a></span>&nbsp;|&nbsp;<span><a href="/">Inicio</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/hsqldb-dbunit/" class="prev" rel="prev" title="Pruebas con Bases de Datos en memoria: DBUnit &#43; HSQLDB"><i class="fas fa-angle-left fa-fw"></i>Pruebas con Bases de Datos en memoria: DBUnit &#43; HSQLDB</a>
            <a href="/blog/buenas-practicas-c-1/" class="next" rel="next" title="Buenas prácticas en Ansi C (1)">Buenas prácticas en Ansi C (1)<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Provisto por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.79.1">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Miguel Ángel</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Volver arriba">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentarios">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copiar al portapapeles","maxShownLines":10},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
