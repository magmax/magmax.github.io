<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Vagrant y Puppet | El blog de MagMax</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Hay mucha gente que tiene que trabajar a diario con más de un ordenador. En ocasiones, tienen cientos. Las máquinas se estropean y hay que reemplazarlas, así que se pierde mucho tiempo en reinstalar el sistema. Incluso si sólo tienes una máquina, siempre se te olvida instalar algo que necesitarás cuando no tengas red.
Una solución es clonar discos, pero eso es poco flexible. Resulta complejo cambiar la versión de un programa en todas las máquinas.">
    <meta name="generator" content="Hugo 0.79.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    

    
      

    

    
    
    <meta property="og:title" content="Vagrant y Puppet" />
<meta property="og:description" content="Hay mucha gente que tiene que trabajar a diario con más de un ordenador. En ocasiones, tienen cientos. Las máquinas se estropean y hay que reemplazarlas, así que se pierde mucho tiempo en reinstalar el sistema. Incluso si sólo tienes una máquina, siempre se te olvida instalar algo que necesitarás cuando no tengas red.
Una solución es clonar discos, pero eso es poco flexible. Resulta complejo cambiar la versión de un programa en todas las máquinas." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magmax.org/blog/vagrant-puppet/" />
<meta property="article:published_time" content="2012-05-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2012-05-18T00:00:00+00:00" /><meta property="og:site_name" content="El blog de MagMax" />
<meta itemprop="name" content="Vagrant y Puppet">
<meta itemprop="description" content="Hay mucha gente que tiene que trabajar a diario con más de un ordenador. En ocasiones, tienen cientos. Las máquinas se estropean y hay que reemplazarlas, así que se pierde mucho tiempo en reinstalar el sistema. Incluso si sólo tienes una máquina, siempre se te olvida instalar algo que necesitarás cuando no tengas red.
Una solución es clonar discos, pero eso es poco flexible. Resulta complejo cambiar la versión de un programa en todas las máquinas.">
<meta itemprop="datePublished" content="2012-05-18T00:00:00+00:00" />
<meta itemprop="dateModified" content="2012-05-18T00:00:00+00:00" />
<meta itemprop="wordCount" content="1805">



<meta itemprop="keywords" content="devops,vagrant,puppet," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Vagrant y Puppet"/>
<meta name="twitter:description" content="Hay mucha gente que tiene que trabajar a diario con más de un ordenador. En ocasiones, tienen cientos. Las máquinas se estropean y hay que reemplazarlas, así que se pierde mucho tiempo en reinstalar el sistema. Incluso si sólo tienes una máquina, siempre se te olvida instalar algo que necesitarás cuando no tengas red.
Una solución es clonar discos, pero eso es poco flexible. Resulta complejo cambiar la versión de un programa en todas las máquinas."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        El blog de MagMax
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="" title="Inicio page">
              Inicio
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="../en" title="English page">
              English
            </a>
          </li>
          
        </ul>
      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://magmax.org/blog/vagrant-puppet/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://magmax.org/blog/vagrant-puppet/&amp;text=Vagrant%20y%20Puppet" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://magmax.org/blog/vagrant-puppet/&amp;title=Vagrant%20y%20Puppet" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Vagrant y Puppet</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2012-05-18T00:00:00Z">May 18, 2012</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Hay mucha gente que tiene que trabajar a diario con más de un ordenador. En ocasiones, tienen cientos. Las máquinas se estropean y hay que reemplazarlas, así que se pierde mucho tiempo en reinstalar el sistema. Incluso si sólo tienes una máquina, siempre se te olvida instalar algo que necesitarás cuando no tengas red.</p>
<p>Una solución es clonar discos, pero eso es poco flexible. Resulta complejo cambiar la versión de un programa en todas las máquinas.</p>
<p>¿Qué sería lo ideal? Pues poder tener la configuración de tu PC en un repositorio Git o Mercurial. Y poder probar la configuración en una máquina virtual.</p>
<!-- raw HTML omitted -->
<figure>
    <img src="/images/puppet.png"
         alt="Puppet"/> 
</figure>

<h2 id="antes-que-nada">Antes que nada&hellip;</h2>
<p>Antes de comenzar, una advertencia: <em>Vamos a hacer cosas peligrosas</em>. Eso significa que puede que se nos reinicie el ordenador o que perdamos datos.</p>
<p>Tras hacer esa advertencia, también os diré que todo será razonablemente seguro y que vamos a trabajar en máquinas virtuales para que no pase, pero no puedo garantizar nada.</p>
<h2 id="vagrant">Vagrant</h2>
<p>Lo primero que necesitamos es un entorno para gestionar máquinas virtuales. Uno de los más utilizados hoy en día es <a href="https://www.virtualbox.org/">VirtualBox</a> . Pero nosotros no vamos a necesitar un entorno gráfico ni nada de eso.</p>
<p>VirtualBox tiene soporte para máquinas virtuales <em>headless</em>, es decir, máquinas que &ldquo;están por ahí&rdquo;, pero que no se ven.</p>
<p><a href="https://vagrantup.com/">Vagrant</a>  no es más que una interfaz a VirtualBox, pero que nos hace la vida más fácil.</p>
<p>Así que vamos a usar Vagrant. Llegada a esta conclusión, tendríamos dos opciones: instalar una máquina virtual desde cero o coger una ya instalada y partir de ahí. Si optáramos por la primera opción, tendríamos que ver <a href="https://github.com/jedi4ever/veewee">VeeWee</a> ; como este artículo va de Puppet, vamos a optar por la segunda opción.</p>
<p>Lo primero: vamos a instalarnos Vagrant:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>$ sudo gem install vagrant
</code></pre></div><p>Sí, es Ruby.</p>
<p>Tras pelearme con algunas máquinas virtuales públicas, algunos reinicios y demás, os recomiendo que utilicéis la siguiente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>$ vagrant box add squeeze32 https://mathie-vagrant-boxes.s3.amazonaws.com/debian_squeeze_32.box
</code></pre></div><p>Eso tardará un poco, ya que tiene que descargarse 4Gb. Os recomiendo que <em>no</em> utilicéis la wifi. Básicamente, nos descargamos la imagen y la llamamos <em>squeeze32</em>. Eso es importante para referirnos a ella desde el <em>Vagrantfile</em>.</p>
<p>Mientras se descarga, vamos a crearnos una carpeta en alguna parte y a ir configurando Vagrant. El archivo de configuración que yo utilizo tiene el siguiente aspecto (debe llamarse <em>Vagrantfile</em>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#75715e"># file: Vagrantfile</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#66d9ef">Vagrant</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Config</span><span style="color:#f92672">.</span>run <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>	config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;squeeze32&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span style="color:#66d9ef">end</span>
</code></pre></div><p>Difícil, ¿eh?</p>
<p>Vamos con el manejo básico de vagrant:</p>
<ul>
<li><em>up</em> levanta nuestra máquina virtual. Eso implica construirla si no existe y <em>provisionarla</em>.</li>
<li><em>destroy</em> mata nuestra máquina virtual y la borra.</li>
<li><em>halt</em> sólo mata nuestra máquina virtual. No lo uséis. Ya se morirá sola y, si vais a apagarla, borradla del todo con <em>destroy</em>. ¡Es más divertido!</li>
<li><em>provision</em> Hará que se ejecute Puppet (cuando lo tengamos configurado). Esto es lo que se llama &ldquo;provisionar&rdquo;.</li>
<li><em>status</em> Muestra las máquinas virtuales existentes y el estado en el que se encuentran.</li>
<li><em>ssh</em> Os conectará por ssh a la máquina virtual.</li>
</ul>
<p>Habría que contar algo sobre usar varias máquinas virtuales y tal, pero esto es un artículo introductorio. Para cosas avanzadas, buscad otra cosa o la propia documentación :D</p>
<p>Vamos con Puppet.</p>
<h2 id="puppet">Puppet</h2>
<p>Este artículo va a ser introductorio, así que me centraré en la estructura básica, la configuración y la instalación de un único paquete sencillo.</p>
<h3 id="estructura-básica-de-un-proyecto">Estructura básica de un proyecto</h3>
<p>La estructura básica es:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>├── manifests
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>│   └── desktop.pp
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>├── modules
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>│   └── module
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span>│       ├── files
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span>│       ├── templates
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span>│       └── manifests
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span>└── Vagrantfile
</code></pre></div><p>El archivo que se encuentra en @manifests/desktop.pp@ va a ser el que defina nuestra máquina. Aquí hacemos un breve paréntesis.</p>
<p>Puppet está pensado para utilizarse en grandes empresas, con cientos o miles de máquinas. Algunas de estas máquinas serán iguales, pero otras serán distintas. Por eso tiene una estructura cliente-servidor segura, mediante claves ssl.</p>
<p>Yo lo estoy contando para un entorno casero, así que olvidaos de eso. Vamos a tener un archivo distinto por cada máquina y no voy a contar nada de <em>nodes</em>. Tan sólo nuestra máquinita y ya. Como tengo un ordenador de escritorio y el que utilizo para viajar, tengo un archivito &ldquo;desktop.pp&rdquo;. Quizá algún día tenga un &ldquo;laptop.pp&rdquo; :D</p>
<h3 id="configuración">Configuración</h3>
<p>La idea es mantener el archivo @desktop.pp@ lo más sencillo posible, de manera que podamos reutilizar su información en otras máquinas. Por eso el mío es así:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#75715e"># file: manifests/desktop.pp</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>stage { <span style="color:#f92672">[</span>apt, pre, post<span style="color:#f92672">]</span>: }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span style="color:#66d9ef">Stage</span><span style="color:#f92672">[</span>apt<span style="color:#f92672">]</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Stage</span><span style="color:#f92672">[</span>pre<span style="color:#f92672">]</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Stage</span><span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Stage</span><span style="color:#f92672">[</span>post<span style="color:#f92672">]</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span style="color:#66d9ef">class</span> { <span style="color:#e6db74">&#39;apt&#39;</span>: stage <span style="color:#f92672">=&gt;</span> apt }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span style="color:#66d9ef">class</span> { <span style="color:#e6db74">&#39;kernel&#39;</span>: }
</code></pre></div><p>Lo que hago es definirme 3 etapas: apt, pre y post; después establezco el orden de las etapas, relativas a <em>main</em>. Puppet no tiene orden de ejecución, pero hay cosas que hay que hacer antes que nada. Yo, por ejemplo, quiero que se me actualice APT antes de comenzar a trabajar.</p>
<p>A continuación declaro las clases a utilizar. Queda claro que quiero la clase &ldquo;apt&rdquo; que se ejecutará en la etapa &ldquo;apt&rdquo; (derrocho imaginación).</p>
<p>Finalmente, incluyo también la clase &ldquo;kernel&rdquo;, que me instalará el núcleo. Evidentemente, para usarlo tendré que reiniciar, pero me hace ilusión tener instalada la última versión.</p>
<h3 id="módulos">Módulos</h3>
<p>Ahora hay que definir los módulos. Comenzaremos por APT. la definición está en @modules/apt/manifests/init.pp@. Siempre, los manifiestos se llamarán <em>init.pp</em> y estarán en la carpeta <em>manifests</em>, dentro de nuestro módulo. Este archivo contendrá:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#75715e"># file: modules/apt/manifests/init.pp</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#66d9ef">class</span> apt {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  file { <span style="color:#e6db74">&#39;sources.list&#39;</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>    path <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;/etc/apt/sources.list&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    source <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;puppet:///modules/apt/sources.list&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>    owner <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;root&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    replace <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  exec { <span style="color:#e6db74">&#39;update&#39;</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    path <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;/usr/bin&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>    command <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;apt-get update&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    require <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">File</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;sources.list&#39;</span><span style="color:#f92672">]</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>}
</code></pre></div><p>Esto es lo más dificil que vamos a hacer y lo más sencillo de explicar. Como véis, el módulo APT necesita un fichero de configuración y ejecutar una orden. El fichero será el @sources.list@, claro :D</p>
<p>No hay mucho que contar, tan solo que sobreescribo el @sources.list@ y después lanzo un update. Estos requisitos se ejecutarán sin orden fijo, así que tengo que forzar un orden mediante la orden <em>require</em>.</p>
<p>Claro, el archivo que quiero instalar tiene que estar en el directorio <em>files</em> (mirad la estructura más arriba). Y tendrá algo como esto:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span># file: modules/apt/files/sources.list
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>deb https://ftp.es.debian.org/debian unstable main contrib non-free
</code></pre></div><p>Ahora vamos a configurar el módulo del <em>kernel</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#75715e"># file: modules/kernel/manifests/init.pp</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#66d9ef">class</span> kernel {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  package { <span style="color:#e6db74">&#39;linux-image-amd64&#39;</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>    <span style="color:#66d9ef">ensure</span> <span style="color:#f92672">=&gt;</span> latest,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  package { <span style="color:#e6db74">&#39;linux-headers-amd64&#39;</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>    <span style="color:#66d9ef">ensure</span> <span style="color:#f92672">=&gt;</span> latest,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>}
</code></pre></div><p>Como véis, es una clase que necesitará dos paquetes: el kernel y las headers. Y me aseguro de tener instalada la última versión.</p>
<h2 id="lanzándolo">Lanzándolo</h2>
<p>Bueno, ya lo tenemos todo configurado, así que hay que decirle a Vagrant que lance a Puppet:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#75715e"># file: Vagrantfile</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#66d9ef">Vagrant</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Config</span><span style="color:#f92672">.</span>run <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>	config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;squeeze32&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>	config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provision <span style="color:#e6db74">:puppet</span> <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>puppet<span style="color:#f92672">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>		puppet<span style="color:#f92672">.</span>manifests_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;manifests&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span>		puppet<span style="color:#f92672">.</span>module_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;modules&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span>		puppet<span style="color:#f92672">.</span>manifest_file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;desktop.pp&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span>	<span style="color:#66d9ef">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span style="color:#66d9ef">end</span>
</code></pre></div><p>Bueeeeeeeeeeeno. Pues ya está todo. Vamos con la magia:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>$ vagrant up
</code></pre></div><p>Y flipad con los mensajes de pantalla. Nos dejará una máquina perfectamente configurada:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>$ vagrant up
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> Importing base box <span style="color:#e6db74">&#39;squeeze32&#39;</span>...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> The guest additions on this VM <span style="color:#66d9ef">do</span> not match the install version of
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>VirtualBox! This may cause things such as forwarded ports, shared
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>folders, and more to not work properly. If any of those things fail on
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>this machine, please update the guest additions and repackage the
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>box.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>Guest Additions Version: 4.0.4
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>VirtualBox Version: 4.1.14
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> Matching MAC address <span style="color:#66d9ef">for</span> NAT networking...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> Clearing any previously set forwarded ports...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> Forwarding ports...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> -- 22 <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">2222</span> <span style="color:#f92672">(</span>adapter 1<span style="color:#f92672">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> Creating shared folders metadata...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> Clearing any previously set network interfaces...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> Booting VM...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> Waiting <span style="color:#66d9ef">for</span> VM to boot. This can take a few minutes.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> VM booted and ready <span style="color:#66d9ef">for</span> use!
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> Mounting shared folders...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> -- v-root: /vagrant
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> -- manifests: /tmp/vagrant-puppet/manifests
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> -- v-pp-m0: /tmp/vagrant-puppet/modules-0
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> Running provisioner: Vagrant::Provisioners::Puppet...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span style="color:#f92672">[</span>default<span style="color:#f92672">]</span> Running Puppet with /tmp/vagrant-puppet/manifests/desktop.pp...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>stdin: is not a tty
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>notice: /Stage<span style="color:#f92672">[</span>apt<span style="color:#f92672">]</span>/Apt/File<span style="color:#f92672">[</span>sources.list<span style="color:#f92672">]</span>/content: content changed <span style="color:#e6db74">&#39;{md5}c6f69c7769cbbd3b3c938217487efa02&#39;</span> to <span style="color:#e6db74">&#39;{md5}509cf608fd519f230246df247418b7b2&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>notice: /Stage<span style="color:#f92672">[</span>apt<span style="color:#f92672">]</span>/Apt/File<span style="color:#f92672">[</span>sources.list<span style="color:#f92672">]</span>/group: group changed <span style="color:#e6db74">&#39;root&#39;</span> to <span style="color:#e6db74">&#39;vagrant&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>notice: /Stage<span style="color:#f92672">[</span>apt<span style="color:#f92672">]</span>/Apt/Exec<span style="color:#f92672">[</span>update<span style="color:#f92672">]</span>/returns: executed successfully
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>notice: /Stage<span style="color:#f92672">[</span>main<span style="color:#f92672">]</span>/Kernel/Package<span style="color:#f92672">[</span>linux-image-amd64<span style="color:#f92672">]</span>/ensure: ensure changed <span style="color:#e6db74">&#39;purged&#39;</span> to <span style="color:#e6db74">&#39;latest&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>notice: /Stage<span style="color:#f92672">[</span>main<span style="color:#f92672">]</span>/Kernel/Package<span style="color:#f92672">[</span>linux-headers-amd64<span style="color:#f92672">]</span>/ensure: ensure changed <span style="color:#e6db74">&#39;purged&#39;</span> to <span style="color:#e6db74">&#39;latest&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>$
</code></pre></div><h2 id="aplicándolo-a-nuestra-máquina">Aplicándolo a nuestra máquina</h2>
<p><em>NOTA</em>: Mucho ojo. Si seguís estos pasos, es perfectamente posible que rompáis vuestra máquina. ¡Sobreescribiríais el @sources.list@!</p>
<p>Como todas las operaciones que realizamos requieren ser root, si lo ejecutamos como usuarios normales no debería ocurrir nada, pero insisto una vez más: <em>si ejecutas esto es bajo tu cuenta y riesgo</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#75715e"># puppet apply manifests/desktop.pp --modulepath=modules/</span>
</code></pre></div><p>Poco que contar: le pedimos a puppet que aplique nuestra configuración y le indicamos dónde están los módulos.</p>
<h2 id="ventajas">Ventajas</h2>
<p>El uso de Vagrant sólo nos da una ventaja: la de poder probar nuestra configuración antes de aplicarla en una máquina real.</p>
<p>El uso de Puppet es otro cantar:</p>
<ul>
<li>podemos compartir configuraciones entre máquinas,</li>
<li>podemos replicar configuraciones,</li>
<li>podemos guardar las configuraciones en un repositorio,</li>
<li>podemos volver a una configuración determinada,</li>
<li>si identificamos un nuevo tipo de máquina, podemos basarnos en una ya existente,</li>
<li>si se rompe una máquina, podemos tener otra operativa en poco tiempo,</li>
<li>no olvidaremos instalar nada,</li>
<li>&hellip;</li>
</ul>
<p>Aunque tiene algunos&hellip;</p>
<h2 id="inconvenientes">Inconvenientes</h2>
<p>Requiere un poquitín de trabajo extra. Hay que modificar los archivos y después lanzar puppet, en lugar de tocar los archivos originales o ejecutar APT a mano.</p>
<p>Además, pueden darse situaciones poco agradables, como que un paquete entre en conflicto con otro. Como Puppet no garantiza ningún orden, puede darse que el primero se instale y el segundo desinstale al primero. Como, de forma individual, no hay errores, Puppet no nos informará del problema.</p>
<p>Hay algunas soluciones, como realizar <em>pruebas</em>. Existen distintos entornos de pruebas, pero se basan en comprobar que la sintaxis es la adecuada y, en mi opinión, es lo mismo que tener redundancia: se especifican las reglas de dos maneras distintas y deben coincidir. Personalmente, no me gusta el sistema y no le veo un beneficio.</p>
<p>Nuevamente, en mi opinión, lo más útil es definir una nueva etapa de pruebas que <em>realice pruebas por los efectos</em>, no por los requisitos: si queremos que un servidor esté corriendo, comprobamos que el puerto está ocupado. Si hemos modificado un archivo, podemos comprobar su fecha de modificación. Pero no hay ningún framework que nos facilite esta tarea.</p>
<h2 id="más-información">Más información</h2>
<p>Podéis visitar la propia <a href="https://docs.puppetlabs.com/learning/">web de Puppet</a> . Está todo muy bien explicadito, salvo la estructura inicial (para lo que ya estoy yo XD).</p>
<p>En este artículo he introducido los tipos <a href="https://docs.puppetlabs.com/references/stable/type.html">file&quot;, &ldquo;package&rdquo; y &ldquo;exec&rdquo;; podéis visitar la &ldquo;lista completa de tipos puppet</a>  si queréis.</p>
<p>Así mismo, he comentado las etapas, pero hay muchos otros <a href="https://www.puppetlabs.com/references/2.6.8/metaparameter.html">metaparámetros</a>.</p>
<p>También tenéis <a href="https://vagrantup.com/">la página de Vagrant</a>, claro.</p>
<p>Si os gustan estos temas, os recomiendo que sigáis a <a href="https://blog.carlossanchez.eu/">Carlos Sánchez</a>, que presentó en el <a href="https://codemotion.es/">CodeMotion</a>  la charla <a href="https://www.slideshare.net/carlossg/from-dev-to-devops-codemotion-es-2012">From Dev to DevOps</a>.</p>
<p>Podréis encontrar más información si buscáis la palabra &ldquo;devops&rdquo; en google :D</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/devops" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">devops</a>
   </li>
  
   <li class="list">
     <a href="/tags/vagrant" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">vagrant</a>
   </li>
  
   <li class="list">
     <a href="/tags/puppet" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">puppet</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "magmax" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://magmax.org/" >
    &copy;  El blog de MagMax 2021 
  </a>
    <div>














</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
